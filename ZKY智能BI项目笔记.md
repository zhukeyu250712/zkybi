# æ™ºèƒ½BIé¡¹ç›®
# é¡¹ç›®ä»‹ç»
## 1ã€ä»€ä¹ˆæ˜¯BIï¼Ÿ
BIæ˜¯å•†ä¸šæ™ºèƒ½ï¼ˆBusiness Intelligenceï¼‰çš„ç¼©å†™ã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡æ”¶é›†ã€åˆ†æå’Œå‘ˆç°æ•°æ®æ¥å¸®åŠ©ä¼ä¸šåšå‡ºæ›´å¥½å†³ç­–çš„æŠ€æœ¯å’Œè¿‡ç¨‹ã€‚BIé€šå¸¸æ¶‰åŠä½¿ç”¨å„ç§æ•°æ®ä»“åº“ã€æ•°æ®æŒ–æ˜å’Œæ•°æ®åˆ†æå·¥å…·ï¼Œä»¥æå–æœ‰å…³ä¼ä¸šç»©æ•ˆã€å¸‚åœºè¶‹åŠ¿ã€å®¢æˆ·è¡Œä¸ºç­‰æ–¹é¢çš„ä¿¡æ¯ã€‚è¿™äº›æ•°æ®å¯ä»¥è¢«è½¬åŒ–ä¸ºå¯è§†åŒ–å›¾è¡¨ã€æŠ¥è¡¨å’Œä»ªè¡¨ç›˜ï¼Œå¯ååŠ©ä¼ä¸šç®¡ç†å±‚äº†è§£ä»–ä»¬æ‰€è¿è¥çš„å…¬å¸çš„æƒ…å†µï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯åˆ¶å®šæ›´æ˜æ™ºçš„å•†ä¸šå†³ç­–ã€‚
ç±»ä¼¼äºä¸‹å›¾ï¼š
![](https://paperfly-blog.oss-cn-shenzhen.aliyuncs.com/blog/22957787-d7f446b2a08a616f.png#id=LdYwH&originHeight=938&originWidth=1500&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ä¸»æµBIå¹³å°ï¼š[å¸†è½¯BI](https://www.finebi.com/)ã€[å°é©¬BI](https://bi.zhls.qq.com/#/)ã€[å¾®è½¯Power BI](https://powerbi.microsoft.com/zh-cn/)
[é˜¿é‡Œäº‘çš„BIå¹³å°](https://chartcube.alipay.com/)
ä¼ ç»Ÿçš„ BI å¹³å°ï¼š

1. æ‰‹åŠ¨ä¸Šä¼ æ•°æ®
2. æ‰‹åŠ¨é€‰æ‹©åˆ†ææ‰€éœ€çš„æ•°æ®è¡Œå’Œåˆ—ï¼ˆç”±æ•°æ®åˆ†æå¸ˆå®Œæˆï¼‰
3. éœ€è¦æ‰‹åŠ¨é€‰æ‹©æ‰€éœ€çš„å›¾è¡¨ç±»å‹ï¼ˆç”±æ•°æ®åˆ†æå¸ˆå®Œæˆï¼‰
4. ç”Ÿæˆå›¾è¡¨å¹¶ä¿å­˜é…ç½®
## 2ã€æœ¬é¡¹ç›®çš„ BI å¹³å°
[é¡¹ç›®ä»‹ç»å­¦ä¹ ](https://www.bilibili.com/video/BV1em4y117oZ/)
åŒºåˆ«äºä¼ ç»Ÿçš„BIï¼Œç”¨æˆ·ï¼ˆæ•°æ®åˆ†æè€…ï¼‰åªéœ€è¦å¯¼å…¥æœ€åŸå§‹çš„æ•°æ®é›†ï¼Œè¾“å…¥æƒ³è¦è¿›è¡Œåˆ†æçš„ç›®æ ‡ï¼ˆæ¯”å¦‚å¸®æˆ‘åˆ†æä¸€ä¸‹ç½‘ç«™çš„å¢é•¿è¶‹åŠ¿)ï¼Œå°±èƒ½åˆ©ç”¨AIè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç¬¦åˆè¦æ±‚çš„å›¾è¡¨ä»¥åŠåˆ†æç»“è®ºã€‚æ­¤å¤–ï¼Œè¿˜ä¼šæœ‰å›¾è¡¨ç®¡ç†ã€å¼‚æ­¥ç”Ÿæˆç­‰åŠŸèƒ½ã€‚
**ä¼˜ç‚¹ï¼šè®©ä¸ä¼šæ•°æ®åˆ†æçš„ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡è¾“å…¥ç›®æ ‡å¿«é€Ÿå®Œæˆæ•°æ®åˆ†æï¼Œå¤§å¹…èŠ‚çº¦äººåŠ›æˆæœ¬ï¼Œå°†ä¼šç”¨åˆ° AI æ¥å£ç”Ÿæˆåˆ†æç»“æœ**
## 3ã€éœ€æ±‚åˆ†æ

1. æ™ºèƒ½åˆ†æï¼šç”¨æˆ·è¾“å…¥ç›®æ ‡å’ŒåŸå§‹æ•°æ®ï¼ˆå›¾è¡¨ç±»å‹ï¼‰ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå›¾è¡¨å’Œåˆ†æç»“è®º
2. å›¾è¡¨ç®¡ç†
3. **å›¾è¡¨ç”Ÿæˆçš„å¼‚æ­¥åŒ–ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰**
4. å¯¹æ¥ AI èƒ½åŠ›
## 4ã€é¡¹ç›®æ¶æ„å›¾
### 4.1 åŸºç¡€æµç¨‹
åŸºç¡€æµç¨‹ï¼šå®¢æˆ·ç«¯è¾“å…¥åˆ†æè¯‰æ±‚å’ŒåŸå§‹æ•°æ®ï¼Œå‘ä¸šåŠ¡åç«¯å‘é€è¯·æ±‚ã€‚ä¸šåŠ¡åç«¯åˆ©ç”¨AIæœåŠ¡å¤„ç†å®¢æˆ·ç«¯æ•°æ®ï¼Œä¿æŒåˆ°æ•°æ®åº“ï¼Œå¹¶ç”Ÿæˆå›¾è¡¨ã€‚å¤„ç†åçš„æ•°æ®ç”±ä¸šåŠ¡åç«¯å‘é€ç»™AIæœåŠ¡ï¼ŒAIæœåŠ¡ç”Ÿæˆç»“æœå¹¶è¿”å›ç»™åç«¯ï¼Œæœ€ç»ˆå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯å±•ç¤ºã€‚
> è¦æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ç”Ÿæˆå›¾æ ‡ï¼Œå€ŸåŠ©AIæœåŠ¡

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230626133359830.png#id=szlbE&originHeight=548&originWidth=919&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
> ä¸Šå›¾çš„æµç¨‹ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼š
> å‡è®¾ä¸€ä¸ª AI æœåŠ¡ç”Ÿæˆå›¾è¡¨å’Œåˆ†æç»“æœè¦ç­‰50ç§’ï¼Œå¦‚æœæœ‰å¤§é‡ç”¨æˆ·éœ€è¦ç”Ÿæˆå›¾è¡¨ï¼Œæ¯ä¸ªäººéƒ½éœ€è¦ç­‰å¾…50ç§’ï¼Œé‚£ä¹ˆ AI æœåŠ¡å¯èƒ½æ— æ³•å—è¿™ç§å‹åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—æŠ€æœ¯ã€‚
> è¿™ç±»ä»¥äºåœ¨é¤å…ç‚¹é¤æ—¶ï¼Œä¸ºäº†é¿å…é¡¾å®¢æ’é˜Ÿç­‰å¾…ï¼Œé¤å…ä¼šç»™é¡¾å®¢ä¸€ä¸ªå–é¤å·ç ï¼Œä¸Šé¡¾å®¢å¯ä»¥å…ˆå»åä¸‹æˆ–åšå…¶ä»–äº‹æƒ…ï¼Œç­‰åˆ°é¤å…å«åˆ°ä»–ä»¬çš„å·ç æ—¶å†å»é¢†å–é¤ç‚¹ï¼Œè¿™æ ·å°±èƒ½èŠ‚çœç­‰å¾…æ—¶é—´ã€‚
> åŒæ ·åœ°ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨æˆ·å¯ä»¥æäº¤ç”Ÿæˆå›¾è¡¨çš„è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚ä¼šè¿›å…¥é˜Ÿåˆ—ï¼ŒAI æœåŠ¡ä¼šä¾æ¬¡å¤„ç†é˜Ÿåˆ—ä¸­çš„è¯·æ±‚ï¼Œä»è€Œé¿å…äº†åŒæ—¶å¤„ç†å¤§é‡è¯·æ±‚é€ æˆçš„å‹åŠ›ï¼ŒåŒæ—¶ä¹Ÿå½±æ›´å¥½åœ°æ§åˆ¶èµ„æºçš„ä½¿ç”¨ã€‚

### 4.2 ä¼˜åŒ–æµç¨‹ï¼ˆå¼‚æ­¥åŒ–ï¼‰

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230626134246728.png#id=eCguK&originHeight=604&originWidth=1214&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ä¼˜åŒ–æµç¨‹ï¼ˆå¼‚æ­¥åŒ–ï¼‰ï¼šå®¢æˆ·ç«¯è¾“å…¥åˆ†æè¯‰æ±‚å’ŒåŸå§‹æ•°æ®ï¼Œå‘ä¸šåŠ¡åç«¯å‘é€è¯·æ±‚ã€‚ä¸šåŠ¡åç«¯å°†è¯·æ±‚äº‹ä»¶æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ä¸ºå®¢æˆ·ç«¯ç”Ÿæˆå–é¤å·ï¼Œè®©è¦ç”Ÿæˆå›¾è¡¨çš„å®¢æˆ·ç«¯å»æ’é˜Ÿï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ ¹æ®AIæœåŠ¡è´Ÿè½½æƒ…å†µï¼Œå®šæœŸæ£€æŸ¥è¿›åº¦ï¼Œå¦‚æœAIæœåŠ¡è¿˜èƒ½å¤„ç†æ›´å¤šçš„å›¾è¡¨ç”Ÿæˆè¯·æ±‚ï¼Œå°±å‘ä»»åŠ¡å¤„ç†æ¨¡å—å‘é€æ¶ˆæ¯ã€‚
ä»»åŠ¡å¤„ç†æ¨¡å—è°ƒç”¨AIæœåŠ¡å¤„ç†å®¢æˆ·ç«¯æ•°æ®ï¼ŒAI æœåŠ¡å¼‚æ­¥ç”Ÿæˆç»“æœè¿”å›ç»™åç«¯å¹¶ä¿å­˜åˆ°æ•°æ®åº“ï¼Œå½“åç«¯çš„AIå·¥æœåŠ¡ç”Ÿæˆå®Œæ¯•åï¼Œå¯ä»¥é€šè¿‡å‘å‰ç«¯å‘é€é€šçŸ¥çš„æ–¹å¼ï¼Œæˆ–è€…é€šè¿‡ä¸šåŠ¡åç«¯ç›‘æ§æ•°æ®åº“ä¸­å›¾è¡¨ç”ŸæˆæœåŠ¡çš„çŠ¶æ€ï¼Œæ¥ç¡®å®šç”Ÿæˆç»“æœæ˜¯å¦å¯ç”¨ã€‚è‹¥ç”Ÿæˆç»“æœå¯ç”¨ï¼Œå‰ç«¯å³å¯è·å–å¹¶å¤„ç†ç›¸åº”çš„æ•°æ®ï¼Œæœ€ç»ˆå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯å±•ç¤ºã€‚åœ¨æ­¤æœŸé—´ï¼Œç”¨æˆ·å¯ä»¥å»åšè‡ªå·±çš„äº‹æƒ…ã€‚

## 5ã€æŠ€æœ¯æ ˆ
### 5.1 å‰ç«¯

1. React
2. Umi
3. Ant Design Pro
4. å¯è§†åŒ–å¼€å‘åº“ï¼š**Echarts** âˆš ã€HighChairts + AntV
5. umi openapi ä»£ç ç”Ÿæˆï¼šè‡ªåŠ¨ç”Ÿæˆåç«¯è°ƒç”¨ä»£ç 
6. EChart å›¾è¡¨ç”Ÿæˆ
### 5.2 åç«¯

1. Spring Bootï¼šä¸‡ç”¨æ¨¡æ¿
2. MySQLæ•°æ®åº“
3. Redisï¼šRedisssoné™æµæ§åˆ¶
4. MyBatis Plus æ•°æ®åº“è®¿é—®ç»“æ„
5. æ¶ˆæ¯é˜Ÿåˆ—ï¼šRabbitMQ
6. AIèƒ½åŠ›ï¼šOpen AIæ¥å£å¼€å‘
7. Excelä¸Šä¼ å’Œæ•°æ®çš„è§£æï¼šEasy Excel
8. Swagger + Knife4j é¡¹ç›®æ–‡æ¡£
9. Hutool å·¥å…·åº“
# ç¬¬ä¸€æœŸç›´æ’­ - å‰åç«¯åˆå§‹åŒ–ã€å‰åç«¯è”è°ƒ
## 1ã€å‰ç«¯åˆå§‹åŒ–
[Nodejså®‰è£…](https://nodejs.org/en)ç‰ˆæœ¬å»ºè®®ï¼š16.14 < Â å»ºè®®ç‰ˆæœ¬ < 18 ï¼Œé¿å…ä¹±ä¸ƒå…«ç³Ÿçš„é”™è¯¯
[è·Ÿç€å®˜ç½‘æ­¥éª¤](https://pro.ant.design/zh-CN/docs/getting-started/)
```bash
npm i @ant-design/pro-cli -g

pro create é¡¹ç›®åç§°
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717413925533-2ffca4d4-1bb0-44f2-a5ab-0e7337ddf5e7.png#averageHue=%23222121&clientId=u73cb3262-daea-4&from=paste&height=858&id=u2b404992&originHeight=1030&originWidth=896&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=230764&status=done&style=none&taskId=u08de4fff-ace0-4912-90c0-eeb0151c25d&title=&width=746.6666369968002)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717414229213-76fa3727-ac59-47e1-b8e9-dbcb9d853317.png#averageHue=%231b1b1b&clientId=u73cb3262-daea-4&from=paste&height=507&id=u245d436f&originHeight=609&originWidth=941&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=86497&status=done&style=none&taskId=u5adf04bc-e0b9-42eb-bb1a-98178a39280&title=&width=784.1666355066842)
å‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œä½¿ç”¨Webstorm æˆ– å…¶ä»–ä»£ç ç¼–è¯‘å™¨æ‰“å¼€é¡¹ç›®
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717414430721-ba5e2051-21a2-428a-accf-5bffb6a1064a.png#averageHue=%232c2f33&clientId=u73cb3262-daea-4&from=paste&height=607&id=u8f6fa142&originHeight=728&originWidth=982&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=68552&status=done&style=none&taskId=u895dff8d-66ee-4063-8708-c0d1e2e2a7b&title=&width=818.3333008156895)
åœ¨ Webstorm ç»ˆç«¯è¾“å…¥ npm i Â æˆ–è€…yarn æˆ–è€…yarn installï¼ˆéœ€è¦å®‰è£…yarnï¼‰
å¯åŠ¨é¡¹ç›®
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717414669382-55d671b7-1b86-4372-a82b-75476e285d61.png#averageHue=%23232529&clientId=u73cb3262-daea-4&from=paste&height=860&id=u756cb834&originHeight=1032&originWidth=1920&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=233819&status=done&style=none&taskId=u5b072c14-6674-4e70-87c2-72c20a62166&title=&width=1599.9999364217147)
è¿è¡Œstartå‘½ä»¤
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717414871722-5d8ca9ab-7bd9-4b36-91e3-a0f9f44fb0c2.png#averageHue=%23232528&clientId=u73cb3262-daea-4&from=paste&height=860&id=ua85c9521&originHeight=1032&originWidth=1920&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=245101&status=done&style=none&taskId=u91c62117-fdba-495d-b81d-382cdeaeb4f&title=&width=1599.9999364217147)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717414957963-ab7f0d2b-a3a8-4f84-b973-4087b4578804.png#averageHue=%23f6f6f6&clientId=u73cb3262-daea-4&from=paste&height=822&id=u05adcf0d&originHeight=987&originWidth=1919&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=316590&status=done&style=none&taskId=ub3a0b5b5-49da-43d4-b0ee-87505d3fab2&title=&width=1599.1666031214952)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717415055928-f76d6ec7-fbd4-4fca-a116-0c97da24329a.png#averageHue=%23222529&clientId=u73cb3262-daea-4&from=paste&height=329&id=uf13a72e8&originHeight=395&originWidth=1227&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=67533&status=done&style=none&taskId=uc5aada2e-a5df-40da-a0b3-5b87c9202ef&title=&width=1022.4999593695021)
nvmå¯ä»¥ç®¡ç†nodeç‰ˆæœ¬
### 1.1 ç§»é™¤å›½é™…åŒ–
è¿è¡Œ i18n-remove å†åˆ é™¤å¯¹åº”çš„å›½é™…åŒ–æ–‡ä»¶
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717415157457-cf7945e0-e099-4e6e-9cda-d3d85ef4d2be.png#averageHue=%23222427&clientId=u73cb3262-daea-4&from=paste&height=842&id=Wboqp&originHeight=1011&originWidth=1904&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=201267&status=done&style=none&taskId=u56b26f29-c966-4ed4-8492-67c66f2b63e&title=&width=1586.6666036182005)
#### 1.1.1 ç§»é™¤å›½é™…åŒ–æŠ¥é”™

1. æ‰¾åˆ°å¼€æºåœ°å€ï¼š[https://github.com/ant-design/ant-design-pro](https://github.com/ant-design/ant-design-pro)
2. æ‰¾åˆ°é”™è¯¯åŸå› ï¼š[https://github.com/ant-design/ant-design-pro/issues/10452](https://github.com/ant-design/ant-design-pro/issues/10452)
3. å‰ç«¯è¿è¡Œï¼š`yarn add eslint-config-prettier --dev yarn add eslint-plugin-unicorn --dev`
4. ç„¶åä¿®æ”¹node_modules/@umijs/lint/dist/config/eslint/index.jsæ–‡ä»¶æ³¨é‡Š `// es2022: true`å¯ä»¥è§£å†³é—®é¢˜
5. å·¦åˆ™å¯¼èˆªæ ä¸æ˜¾ç¤ºé—®é¢˜
ç§»é™¤å›½é™…åŒ–åï¼Œé¡¹ç›®å·¦ä¾§å¯¼èˆªæ èœå•å’Œå³ä¸Šè§’é€€å‡ºç™»é™†æŒ‰é’®ä¸æ˜¾ç¤ºäº†ã€‚
è§£å†³æ–¹æ³•ï¼šç»™config/route.tsé…ç½®æ–‡ä»¶çš„æ¯ä¸€ä¸ªè·¯ç”±éƒ½åŠ ä¸Šå¯¹åº”çš„nameå±æ€§ï¼Œå¦‚æœä¸æ·»åŠ nameå±æ€§ï¼Œåˆ™èœå•é»˜è®¤å±•ç¤ºçš„æ˜¯pathå±æ€§ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717416118237-d31f26d1-f82f-48ef-b153-37d163c2fde2.png#averageHue=%2324262a&clientId=u73cb3262-daea-4&from=paste&height=597&id=udc057f3b&originHeight=717&originWidth=1673&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=129621&status=done&style=none&taskId=uaf3d7015-c865-44ef-b14e-99a9fcd26f3&title=&width=1394.166611267463)
è¿™é‡Œä¸€å®šè¦ç»™æ¯ä¸€ä¸ªè·¯ç”±éƒ½æ·»åŠ å¯¹åº”çš„nameå±æ€§ï¼Œä¸ç„¶å¯¼èˆªæ è¿˜æ˜¯ä¸æ˜¾ç¤º
![](https://gitee.com/kcsen/img/raw/master/picGo/image-20230514162121366.png#id=AJKPW&originHeight=414&originWidth=949&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717768410598-c25d3324-2614-474d-93ee-62c28202b11d.png#averageHue=%23222428&clientId=u1f7bbf76-80a8-4&from=paste&height=662&id=u38a9ffda&originHeight=795&originWidth=1444&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=124793&status=done&style=none&taskId=u325f2556-d20f-4df9-a13c-698a4e9739d&title=&width=1203.3332855171645)
å†æ¬¡è¿è¡Œé¡¹ç›®æˆåŠŸè§£å†³é—®é¢˜ã€‚
#### å…¶ä»–é”™è¯¯ï¼š
> eslintç‰ˆæœ¬è¿‡é«˜æŠ¥é”™
ç§»é™¤å›½é™…åŒ–åï¼Œå†æ¬¡è¿è¡Œi18n-removeå‘½ä»¤ï¼ŒåˆæŠ¥äº†ä¸€ä¸ªé”™è¯¯ï¼š
TypeError:Failed to load plugin 'jest'declared in 'BaseConfig':Class exte
21885118212814
åŸå› ï¼šè¿™æ˜¯å› ä¸ºeslintç‰ˆæœ¬é«˜äº8ï¼Œé¡¹ç›®ä¸­eslintç‰ˆæœ¬æ˜¯8.34.0ã€‚
@otypescript--eslint/eslint-pluginå’Œeslintç‰ˆæœ¬7å…¼å®¹ï¼Œç‰ˆæœ¬é«˜äº8ä¼šä¸å…¼å®¹ï¼Œä¸å…¼å®¹çš„æ—¶å€™å°±ä¼šæç¤ºè¿™ä¸ªé”™è¯¯ã€‚
> [https://blog.csdn.net/qq_43436008/article/details/126056307](https://blog.csdn.net/qq_43436008/article/details/126056307)
> è§£å†³åŠæ³•ï¼šæŠŠeslintçš„ç‰ˆæœ¬æ”¹æˆ7.32.0

## 2ã€åç«¯åˆå§‹åŒ–
é¦–å…ˆæ‹‰å–[springboot-iniä¸‡ç”¨æ¨¡æ¿](http://gitlab.code-nav.cn/root/springboot-init)
ä¿®æ”¹æˆé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æˆå±äºä½ çš„é…ç½®ï¼Œç„¶åè¿è¡Œé¡¹ç›®
ä¿®æ”¹ç™»å½•è´¦å·å¯†ç ï¼ŒåŒæ—¶è¿è¡Œsqlè¯­å¥åˆ›å»ºsql
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717418130370-db425aab-2217-466c-ae8d-77a4eea82d09.png#averageHue=%23303742&clientId=u73cb3262-daea-4&from=paste&height=792&id=u92c31936&originHeight=951&originWidth=1881&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=206472&status=done&style=none&taskId=uc20e6808-6b35-4e05-8142-f8082358a28&title=&width=1567.4999377131487)
[http://localhost:8080/api/doc.html](http://localhost:8080/api/doc.html)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717418088107-c117f4ad-1c5d-47ee-86a6-21b7caeb5f45.png#averageHue=%23c2b18b&clientId=u73cb3262-daea-4&from=paste&height=820&id=XsQFy&originHeight=984&originWidth=1928&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=117656&status=done&style=none&taskId=ud8fa96ca-32b6-48c5-9b38-919ae8cc89c&title=&width=1606.666602823472)
æ³¨å†Œç”¨æˆ·
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717418389474-b44264a7-2abe-4bb7-be7f-08c551a9a366.png#averageHue=%23c3b28a&clientId=u73cb3262-daea-4&from=paste&height=826&id=ue2647188&originHeight=991&originWidth=1925&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=147478&status=done&style=none&taskId=u65afbc55-dd47-466a-aaf9-4d2e8a63ea7&title=&width=1604.166602922813)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717418463210-e2d7064a-431a-48b8-8cf9-39101b9d06d1.png#averageHue=%23ac9971&clientId=u73cb3262-daea-4&from=paste&height=806&id=u030f0252&originHeight=967&originWidth=1943&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=156890&status=done&style=none&taskId=ua8b7e91e-d31e-456f-940d-25bc9770ca2&title=&width=1619.1666023267665)
### åç«¯å¯åŠ¨é¡¹ç›®ç«¯å£å†²çªé—®é¢˜è§£å†³
åŸå› ï¼šWindows Hyper-V è™šæ‹ŸåŒ–å¹³å°å ç”¨ç«¯å£
å…ˆä½¿ç”¨ï¼šnetsh interface ipv4 show excludedportrange protocol=tcp æŸ¥çœ‹è¢«å ç”¨çš„ç«¯å£èŒƒå›´ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªæ²¡è¢«å ç”¨çš„ç«¯å£ä½¿ç”¨ï¼Œç„¶åå¯åŠ¨é¡¹ç›®
[å‚è€ƒ](https://blog.csdn.net/weixin_52297086/article/details/128845095)
## 3ã€åº“è¡¨è®¾è®¡
### 3.1 ç”¨æˆ·è¡¨
```java
create table if not exists user
(
    id           bigint auto_increment comment 'id' primary key,
    userAccount  varchar(256)                           not null comment 'è´¦å·',
    userPassword varchar(512)                           not null comment 'å¯†ç ',
    userName     varchar(256)                           null comment 'ç”¨æˆ·æ˜µç§°',
    userAvatar   varchar(1024)                          null comment 'ç”¨æˆ·å¤´åƒ',
    userRole     varchar(256) default 'user'            not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser/admin',
    createTime   datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete     tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    index idx_userAccount(userAccount)
) comment 'ç”¨æˆ·' collate = utf8mb4_unicode_ci;
```
### 3.2 å›¾æ ‡ä¿¡æ¯è¡¨
```sql
-- å›¾è¡¨ä¿¡æ¯è¡¨
create table if not exists chart
(
    id         bigint auto_increment comment 'id' primary key,
    goal       text                               null comment 'åˆ†æç›®æ ‡',
    chartData  text                               null comment 'å›¾è¡¨ä¿¡æ¯',
    chartType  varchar(256)                       null comment 'å›¾è¡¨ç±»å‹',
    genChart   text                               null comment 'ç”Ÿæˆçš„å›¾è¡¨ä¿¡æ¯',
    getResult  text                               null comment 'ç”Ÿæˆçš„åˆ†æç»“è®º',
    userId     bigint                             null comment 'åˆ›å»ºå›¾æ ‡ç”¨æˆ· id',
    createTime datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete   tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤'
) comment 'å›¾è¡¨ä¿¡æ¯è¡¨' collate = utf8mb4_unicode_ci;
```
## 4ã€åç«¯å¼€å‘ï¼ˆæ ¹æ®PDFæ­¥éª¤æŸ¥çœ‹ï¼‰

1. ä½¿ç”¨MybatisXè‡ªåŠ¨ç”Ÿæˆå¢åˆ æ”¹æŸ¥ä»£ç 

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717419091295-afb1b346-ca98-40fd-a72b-002004d47b6e.png#averageHue=%23232830&clientId=u73cb3262-daea-4&from=paste&height=607&id=u2cefe38a&originHeight=728&originWidth=982&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=69396&status=done&style=none&taskId=u25a19b69-161c-4e9c-be38-5f741d99ee9&title=&width=818.3333008156895)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717419129875-fc576bcf-8316-4634-810d-047959bbd12f.png#averageHue=%2324282f&clientId=u73cb3262-daea-4&from=paste&height=557&id=uf5cb5b35&originHeight=669&originWidth=722&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=58022&status=done&style=none&taskId=u51f245f5-e611-4a38-aea9-88aab750ed5&title=&width=601.6666427585823)
control + shift + r
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717419355688-6eee5ad6-86f2-4e0e-9b2e-7a8331e5555f.png#averageHue=%23262b33&clientId=u73cb3262-daea-4&from=paste&height=777&id=u348bad8a&originHeight=932&originWidth=1473&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=133946&status=done&style=none&taskId=u6989ec05-ff58-4c1e-9465-8a914a1677f&title=&width=1227.4999512235343)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717419474890-ca07d591-4e9c-41b4-afb8-7440891a6ee0.png#averageHue=%23252a31&clientId=u73cb3262-daea-4&from=paste&height=424&id=u52da92ca&originHeight=509&originWidth=942&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=38022&status=done&style=none&taskId=uda07d66f-70c2-468b-9fd8-5661b1a6751&title=&width=784.9999688069038)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717419528225-c68f37e4-281a-49b4-813d-b49d8e3f9b71.png#averageHue=%23252a32&clientId=u73cb3262-daea-4&from=paste&height=422&id=u092e102d&originHeight=506&originWidth=942&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=59153&status=done&style=none&taskId=u7bb5b2a7-f87f-4e23-a029-b69cbeb99af&title=&width=784.9999688069038)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717419715105-25d4a867-b426-4f75-80af-2f382fb04b62.png#averageHue=%23252a31&clientId=u73cb3262-daea-4&from=paste&height=792&id=u7fdfed39&originHeight=951&originWidth=1223&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=159924&status=done&style=none&taskId=u84dcf443-a4c9-4a69-bcae-b5c1dfd6450&title=&width=1019.1666261686236)
ä¿®æ”¹chart å’Œ userå±æ€§çš„æ³¨è§£
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717419921403-c69a2346-7dd3-4c3b-a0c9-1fe148e21b5e.png#averageHue=%23262a32&clientId=u73cb3262-daea-4&from=paste&height=854&id=u006f82da&originHeight=1025&originWidth=1909&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=259170&status=done&style=none&taskId=uf74f9530-8d77-4325-b68b-14898e9dab2&title=&width=1590.8332701192987)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717423102701-b9211407-a56c-4dda-b31d-c4472a72ac16.png#averageHue=%23262d38&clientId=u73cb3262-daea-4&from=paste&height=221&id=uc91a989a&originHeight=265&originWidth=776&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=32929&status=done&style=none&taskId=u04897b21-c584-4a51-aa26-cf5fa6bd80f&title=&width=646.666640970443)
åˆ é™¤generateä»£ç ç›®å½•ä¹‹åéœ€è¦æŸ¥çœ‹å¯¼åŒ…æ˜¯å¦æ­£å¸¸ï¼Œä¹‹åéœ€è¦æŸ¥çœ‹resourcesä¸‹é¢å¾—mapperçš„è·¯å¾„æ˜¯å¦æ­£å¸¸ã€‚

2. å°†åŸæ¥çš„Userä¿®æ”¹ç°åœ¨ç”Ÿæˆçš„Userï¼Œè¿è¡Œï¼Œçœ‹æŠ¥é”™ï¼Œåˆ é™¤ä¸è¦çš„å¾®ä¿¡ç™»å½•ä»£ç 
3. å†æ¥èµ°ä¸€éç™»å½•æµç¨‹

æ­¥éª¤å¦‚ä¸‹ï¼š

1. æ‰§è¡ŒSQLè¯­å¥æ¥å»ºè¡¨
2. mybatisXæ’ä»¶ç”Ÿæˆä»£ç 
3. è¿ç§»ç”Ÿæˆçš„ä»£ç 
4. å¤åˆ¶è€çš„å¢å†Œåˆ æ”¹æŸ¥æ¨¡æ¿ï¼Œæ ¹æ®çš„è¡¨é‡æ„
5. æ ¹æ®æ¥å£æ–‡æ¡£æ¥æµ‹è¯•

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750116894-a253f976-ae25-40c3-b61c-bda57dbbb117.png#averageHue=%23fbfbfa&clientId=u1f7bbf76-80a8-4&from=paste&height=340&id=u223474d1&originHeight=408&originWidth=695&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=108264&status=done&style=none&taskId=u7516ee67-614d-4f9d-a05b-ce2e6636430&title=&width=579.1666436526519)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750146412-e7447fba-a498-4253-b58d-5bffa10bb2a0.png#averageHue=%23f9f8f6&clientId=u1f7bbf76-80a8-4&from=paste&height=1079&id=u5469147a&originHeight=1295&originWidth=1692&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=919412&status=done&style=none&taskId=u068f0ca5-12d2-4fb5-840d-99224d83095&title=&width=1409.9999439716362)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750161551-6960d0cb-e0d5-4ed2-9895-9c1389b39c89.png#averageHue=%23f9f8f6&clientId=u1f7bbf76-80a8-4&from=paste&height=931&id=u5b9eb1bd&originHeight=1117&originWidth=1791&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=1011685&status=done&style=none&taskId=u40b38691-d142-4481-a635-3b004d88785&title=&width=1492.4999406933807)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750178609-d6b1866a-615f-4db5-bfd0-3d96eae90ca4.png#averageHue=%23fafafa&clientId=u1f7bbf76-80a8-4&from=paste&height=1045&id=u6f9f4a56&originHeight=1254&originWidth=2006&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=454337&status=done&style=none&taskId=ucdaf2a33-d24e-4ab5-a8fc-8848badd9e3&title=&width=1671.666600240604)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750197668-22ceffe1-ed76-4c17-afe8-cd1549eca802.png#averageHue=%23fcfcfb&clientId=u1f7bbf76-80a8-4&from=paste&height=996&id=ue437ce7e&originHeight=1195&originWidth=1968&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=409828&status=done&style=none&taskId=u93825503-2fe2-4416-a063-b1dc8ef51bf&title=&width=1639.9999348322576)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750236295-57eaec3e-e0da-4fb2-86f2-1de7a473d62c.png#averageHue=%23fcfcfc&clientId=u1f7bbf76-80a8-4&from=paste&height=999&id=ud5624510&originHeight=1199&originWidth=1900&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=369924&status=done&style=none&taskId=uc2015aaf-115a-4251-bcb1-2dd65ea5155&title=&width=1583.333270417322)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750309114-507c6629-cbf0-4020-9c99-ef2321376330.png#averageHue=%23fcfcfb&clientId=u1f7bbf76-80a8-4&from=paste&height=1036&id=u168e2e08&originHeight=1243&originWidth=1959&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=419632&status=done&style=none&taskId=uac45f2f6-aec7-45f1-b50c-156ff57bb90&title=&width=1632.4999351302808)
```java
package com.yupi.springbootinit.model.dto.chart;

import lombok.Data;

import java.io.Serializable;

/**
 * åˆ›å»ºè¯·æ±‚
 *
 * @author <a href="https://github.com/liyupi">ç¨‹åºå‘˜é±¼çš®</a>
 * @from <a href="https://yupi.icu">ç¼–ç¨‹å¯¼èˆªçŸ¥è¯†æ˜Ÿçƒ</a>
 */
@Data
public class ChartAddRequest implements Serializable {

    /**
     * åˆ†æç›®æ ‡
     */
    private String goal;

    /**
     * å›¾è¡¨æ•°æ®
     */
    private String chartData;

    /**
     * å›¾è¡¨ç±»å‹
     */
    private String chartType;

    private static final long serialVersionUID = 1L;
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750326519-1df051e0-53d8-46a8-b626-c3b25d81ee0e.png#averageHue=%23fcfcfb&clientId=u1f7bbf76-80a8-4&from=paste&height=1049&id=u3de3beab&originHeight=1259&originWidth=1951&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=418815&status=done&style=none&taskId=ub6e88d27-245a-4051-ae91-9adcc0bfac0&title=&width=1625.8332687285238)
```java
package com.yupi.springbootinit.model.dto.chart;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableLogic;
import lombok.Data;

import java.io.Serializable;
import java.util.Date;
import java.util.List;

/**
 * ç¼–è¾‘è¯·æ±‚
 *
 * @author <a href="https://github.com/liyupi">ç¨‹åºå‘˜é±¼çš®</a>
 * @from <a href="https://yupi.icu">ç¼–ç¨‹å¯¼èˆªçŸ¥è¯†æ˜Ÿçƒ</a>
 */
@Data
public class ChartEditRequest implements Serializable {
    /**
     * id
     */
    private Long id;

    /**
     * åˆ†æç›®æ ‡
     */
    private String goal;

    /**
     * å›¾è¡¨æ•°æ®
     */
    private String chartData;

    /**
     * å›¾è¡¨ç±»å‹
     */
    private String chartType;

    private static final long serialVersionUID = 1L;
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750337081-8f188a64-b9c3-40af-9fac-90293846040b.png#averageHue=%23fcfbfb&clientId=u1f7bbf76-80a8-4&from=paste&height=1103&id=u48d47b09&originHeight=1324&originWidth=1948&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=435442&status=done&style=none&taskId=u1b093a50-b6c0-4197-9eba-85e6594be37&title=&width=1623.3332688278647)
```java
package com.yupi.springbootinit.model.dto.chart;

import com.yupi.springbootinit.common.PageRequest;
import lombok.Data;
import lombok.EqualsAndHashCode;

import java.io.Serializable;

/**
 * æŸ¥è¯¢è¯·æ±‚
 *
 * @author <a href="https://github.com/liyupi">ç¨‹åºå‘˜é±¼çš®</a>
 * @from <a href="https://yupi.icu">ç¼–ç¨‹å¯¼èˆªçŸ¥è¯†æ˜Ÿçƒ</a>
 */
@EqualsAndHashCode(callSuper = true)
@Data
public class ChartQueryRequest extends PageRequest implements Serializable {

    private Long id;

    /**
     * åˆ†æç›®æ ‡
     */
    private String goal;

    /**
     * å›¾è¡¨ç±»å‹
     */
    private String chartType;

    /**
     * ç”¨æˆ· id
     */
    private Long userId;

    private static final long serialVersionUID = 1L;
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750350531-14764b2a-733c-4265-a49d-0709196af63a.png#averageHue=%23fbfbfb&clientId=u1f7bbf76-80a8-4&from=paste&height=1087&id=uc91d0dad&originHeight=1304&originWidth=1922&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=583324&status=done&style=none&taskId=ufacd1cdc-6ca4-441e-baac-93b441f3a63&title=&width=1601.666603022154)
```java
package com.yupi.springbootinit.model.dto.chart;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableLogic;
import lombok.Data;

import java.io.Serializable;
import java.util.Date;
import java.util.List;

/**
 * æ›´æ–°è¯·æ±‚
 *
 * @author <a href="https://github.com/liyupi">ç¨‹åºå‘˜é±¼çš®</a>
 * @from <a href="https://yupi.icu">ç¼–ç¨‹å¯¼èˆªçŸ¥è¯†æ˜Ÿçƒ</a>
 */
@Data
public class ChartUpdateRequest implements Serializable {

    /**
     * id
     */
    @TableId(type = IdType.ASSIGN_ID)
    private Long id;

    /**
     * åˆ†æç›®æ ‡
     */
    private String goal;

    /**
     * å›¾è¡¨æ•°æ®
     */
    private String chartData;

    /**
     * å›¾è¡¨ç±»å‹
     */
    private String chartType;

    /**
     * ç”Ÿæˆçš„å›¾è¡¨æ•°æ®
     */
    private String genChart;

    /**
     * ç”Ÿæˆçš„åˆ†æç»“è®º
     */
    private String genResult;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private Date createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    private Date updateTime;

    /**
     * æ˜¯å¦åˆ é™¤
     */
    @TableLogic
    private Integer isDelete;

    private static final long serialVersionUID = 1L;
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717750363970-f3732347-93dd-4a23-b1c9-28f8678940d5.png#averageHue=%23f9f9f8&clientId=u1f7bbf76-80a8-4&from=paste&height=1117&id=u1c659d3f&originHeight=1341&originWidth=1981&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=582884&status=done&style=none&taskId=ub39f25a5-3acb-4676-8a7a-f8fd48a2c33&title=&width=1650.833267735113)
```java
package com.yupi.springbootinit.controller;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.google.gson.Gson;
import com.yupi.springbootinit.annotation.AuthCheck;
import com.yupi.springbootinit.common.BaseResponse;
import com.yupi.springbootinit.common.DeleteRequest;
import com.yupi.springbootinit.common.ErrorCode;
import com.yupi.springbootinit.common.ResultUtils;
import com.yupi.springbootinit.constant.CommonConstant;
import com.yupi.springbootinit.constant.UserConstant;
import com.yupi.springbootinit.exception.BusinessException;
import com.yupi.springbootinit.exception.ThrowUtils;
import com.yupi.springbootinit.model.dto.chart.ChartAddRequest;
import com.yupi.springbootinit.model.dto.chart.ChartEditRequest;
import com.yupi.springbootinit.model.dto.chart.ChartQueryRequest;
import com.yupi.springbootinit.model.dto.chart.ChartUpdateRequest;
import com.yupi.springbootinit.model.entity.Chart;
import com.yupi.springbootinit.model.entity.User;
import com.yupi.springbootinit.service.ChartService;
import com.yupi.springbootinit.service.UserService;
import com.yupi.springbootinit.utils.SqlUtils;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.ObjectUtils;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.BeanUtils;
import org.springframework.web.bind.annotation.*;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import java.util.List;

/**
 * å¸–å­æ¥å£
 *
 */
@RestController
@RequestMapping("/chart")
@Slf4j
public class ChartController {

    @Resource
    private ChartService chartService;

    @Resource
    private UserService userService;

    private final static Gson GSON = new Gson();

    // region å¢åˆ æ”¹æŸ¥

    /**
     * åˆ›å»º
     *
     * @param chartAddRequest
     * @param request
     * @return
     */
    @PostMapping("/add")
    public BaseResponse<Long> addChart(@RequestBody ChartAddRequest chartAddRequest, HttpServletRequest request) {
        if (chartAddRequest == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Chart chart = new Chart();
        BeanUtils.copyProperties(chartAddRequest, chart);
        User loginUser = userService.getLoginUser(request);
        chart.setUserId(loginUser.getId());
        boolean result = chartService.save(chart);
        ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
        long newChartId = chart.getId();
        return ResultUtils.success(newChartId);
    }

    /**
     * åˆ é™¤
     *
     * @param deleteRequest
     * @param request
     * @return
     */
    @PostMapping("/delete")
    public BaseResponse<Boolean> deleteChart(@RequestBody DeleteRequest deleteRequest, HttpServletRequest request) {
        if (deleteRequest == null || deleteRequest.getId() <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User user = userService.getLoginUser(request);
        long id = deleteRequest.getId();
        // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
        Chart oldChart = chartService.getById(id);
        ThrowUtils.throwIf(oldChart == null, ErrorCode.NOT_FOUND_ERROR);
        // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯åˆ é™¤
        if (!oldChart.getUserId().equals(user.getId()) && !userService.isAdmin(request)) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        boolean b = chartService.removeById(id);
        return ResultUtils.success(b);
    }

    /**
     * æ›´æ–°ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
     *
     * @param chartUpdateRequest
     * @return
     */
    @PostMapping("/update")
    @AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
    public BaseResponse<Boolean> updateChart(@RequestBody ChartUpdateRequest chartUpdateRequest) {
        if (chartUpdateRequest == null || chartUpdateRequest.getId() <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Chart chart = new Chart();
        BeanUtils.copyProperties(chartUpdateRequest, chart);
        long id = chartUpdateRequest.getId();
        // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
        Chart oldChart = chartService.getById(id);
        ThrowUtils.throwIf(oldChart == null, ErrorCode.NOT_FOUND_ERROR);
        boolean result = chartService.updateById(chart);
        return ResultUtils.success(result);
    }

    /**
     * æ ¹æ® id è·å–
     *
     * @param id
     * @return
     */
    @GetMapping("/get")
    public BaseResponse<Chart> getChartById(long id, HttpServletRequest request) {
        if (id <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Chart chart = chartService.getById(id);
        if (chart == null) {
            throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);
        }
        return ResultUtils.success(chart);
    }

    /**
     * åˆ†é¡µè·å–åˆ—è¡¨ï¼ˆå°è£…ç±»ï¼‰
     *
     * @param chartQueryRequest
     * @param request
     * @return
     */
    @PostMapping("/list/page")
    public BaseResponse<Page<Chart>> listChartByPage(@RequestBody ChartQueryRequest chartQueryRequest,
            HttpServletRequest request) {
        long current = chartQueryRequest.getCurrent();
        long size = chartQueryRequest.getPageSize();
        // é™åˆ¶çˆ¬è™«
        ThrowUtils.throwIf(size > 20, ErrorCode.PARAMS_ERROR);
        Page<Chart> chartPage = chartService.page(new Page<>(current, size),
                getQueryWrapper(chartQueryRequest));
        return ResultUtils.success(chartPage);
    }

    /**
     * åˆ†é¡µè·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„èµ„æºåˆ—è¡¨
     *
     * @param chartQueryRequest
     * @param request
     * @return
     */
    @PostMapping("/my/list/page")
    public BaseResponse<Page<Chart>> listMyChartByPage(@RequestBody ChartQueryRequest chartQueryRequest,
            HttpServletRequest request) {
        if (chartQueryRequest == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User loginUser = userService.getLoginUser(request);
        chartQueryRequest.setUserId(loginUser.getId());
        long current = chartQueryRequest.getCurrent();
        long size = chartQueryRequest.getPageSize();
        // é™åˆ¶çˆ¬è™«
        ThrowUtils.throwIf(size > 20, ErrorCode.PARAMS_ERROR);
        Page<Chart> chartPage = chartService.page(new Page<>(current, size),
                getQueryWrapper(chartQueryRequest));
        return ResultUtils.success(chartPage);
    }

    // endregion

    /**
     * ç¼–è¾‘ï¼ˆç”¨æˆ·ï¼‰
     *
     * @param chartEditRequest
     * @param request
     * @return
     */
    @PostMapping("/edit")
    public BaseResponse<Boolean> editChart(@RequestBody ChartEditRequest chartEditRequest, HttpServletRequest request) {
        if (chartEditRequest == null || chartEditRequest.getId() <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Chart chart = new Chart();
        BeanUtils.copyProperties(chartEditRequest, chart);
        User loginUser = userService.getLoginUser(request);
        long id = chartEditRequest.getId();
        // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
        Chart oldChart = chartService.getById(id);
        ThrowUtils.throwIf(oldChart == null, ErrorCode.NOT_FOUND_ERROR);
        // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯ç¼–è¾‘
        if (!oldChart.getUserId().equals(loginUser.getId()) && !userService.isAdmin(loginUser)) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        boolean result = chartService.updateById(chart);
        return ResultUtils.success(result);
    }

    /**
     * è·å–æŸ¥è¯¢åŒ…è£…ç±»
     *
     * @param chartQueryRequest
     * @return
     */
    private QueryWrapper<Chart> getQueryWrapper(ChartQueryRequest chartQueryRequest) {
        QueryWrapper<Chart> queryWrapper = new QueryWrapper<>();
        if (chartQueryRequest == null) {
            return queryWrapper;
        }
        Long id = chartQueryRequest.getId();
        String goal = chartQueryRequest.getGoal();
        String chartType = chartQueryRequest.getChartType();
        Long userId = chartQueryRequest.getUserId();
        String sortField = chartQueryRequest.getSortField();
        String sortOrder = chartQueryRequest.getSortOrder();

        queryWrapper.eq(id != null && id > 0, "id", id);
        queryWrapper.eq(StringUtils.isNotBlank(goal), "goal", goal);
        queryWrapper.eq(StringUtils.isNotBlank(chartType), "chartType", chartType);
        queryWrapper.eq(ObjectUtils.isNotEmpty(userId), "userId", userId);
        queryWrapper.eq("isDelete", false);
        queryWrapper.orderBy(SqlUtils.validSortField(sortField), sortOrder.equals(CommonConstant.SORT_ORDER_ASC),
                sortField);
        return queryWrapper;
    }

}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717753690207-6beb96e7-8ce7-47fd-af8a-45af3ad140f9.png#averageHue=%23c3b18a&clientId=u1f7bbf76-80a8-4&from=paste&height=862&id=u19c6aa34&originHeight=1034&originWidth=1910&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=126650&status=done&style=none&taskId=uc4103943-f828-43c7-af83-5e08b1b40b4&title=&width=1591.6666034195184)
```java
{
  "chartData": "[{\"æœˆä»½\":6}]",
  "chartType": "æŸ±çŠ¶å›¾",
  "goal": "æˆ‘æƒ³è¦åˆ†æç½‘ç«™è¿‘ä¸€å¹´çš„ç”¨æˆ·å¢é•¿è¶‹åŠ¿"
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717753735676-6e475832-f801-4429-829d-54af5b49c14d.png#averageHue=%23c2ae86&clientId=u1f7bbf76-80a8-4&from=paste&height=812&id=ua688309d&originHeight=975&originWidth=1901&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=139608&status=done&style=none&taskId=uc66dc2e9-3c6b-4e22-af38-50250995d78&title=&width=1584.1666037175416)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717753791848-3f7c96b3-0a31-4431-9234-93563cf9c47e.png#averageHue=%23c3b28b&clientId=u1f7bbf76-80a8-4&from=paste&height=812&id=ub770a7aa&originHeight=974&originWidth=1910&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=120985&status=done&style=none&taskId=u3d0225e0-5300-4511-9c6b-7a0724b16ac&title=&width=1591.6666034195184)
## 4ã€å‰åç«¯è”è°ƒ
### 4.1 å‰ç«¯

1. åœ¨config.tsä¸­çš„é…ç½®åç«¯çš„æ¥å£æ–‡æ¡£åœ°å€
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717754197885-6f51fb85-87db-4aae-8b5c-61c816655147.png#averageHue=%23cbb791&clientId=u1f7bbf76-80a8-4&from=paste&height=813&id=u94c9aa2a&originHeight=976&originWidth=1910&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=85047&status=done&style=none&taskId=u902986ec-cf22-41b9-9ea2-dc9c1a0478d&title=&width=1591.6666034195184)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717754308464-24a1bb6d-52d7-4233-a4c9-a2e2e9981c30.png#averageHue=%23fdfdfd&clientId=u1f7bbf76-80a8-4&from=paste&height=847&id=ua826971d&originHeight=1016&originWidth=1905&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=71861&status=done&style=none&taskId=ub85381be-f0b9-488d-a603-fde6bb537c2&title=&width=1587.4999369184202)
```json
  openAPI: [
    {
      requestLibPath: "import { request } from '@umijs/max'",
      // åç«¯é¡¹ç›®Swaggeræ¥å£åœ°å€ï¼Œæ‹¿åˆ°åç«¯JSONæ ¼å¼çš„æ•°æ®
      schemaPath: 'http://localhost:8080/api/v2/api-docs',
      // é¡¹ç›®åç§°
      projectName: 'yubi',  
      // ä¸ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
      mock: false,
    },
  ],
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717754397351-3c560e9e-d15b-4f9e-92df-0ea36abe1424.png#averageHue=%23222327&clientId=u1f7bbf76-80a8-4&from=paste&height=884&id=u46b36dde&originHeight=1061&originWidth=1757&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=217174&status=done&style=none&taskId=uecbd81b2-03da-4d82-94e9-ee5f9b10b01&title=&width=1464.166608485913)

2. ç„¶åç‚¹å‡»openapiï¼Œè¿è¡Œä¹‹åï¼Œå°±ä¼šå¾—åˆ°ä¸‹é¢è¿™ä¸ªç›®å½•

![](https://gitee.com/kcsen/img/raw/master/picGo/image-20230515090702712.png#id=sG9RC&originHeight=318&originWidth=339&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
è¿™ä¸ªç›®å½•ä¸‹é¢çš„å°±æ˜¯å¯¹åº”åç«¯çš„æ¥å£
ç„¶åå°†`requestErrorConfig.ts`æ”¹å => `requestConfig.ts`ï¼Œåœ¨é‡Œé¢æ·»åŠ è¯·æ±‚åç«¯çš„åœ°å€ï¼š 
```typescript
// é“¾æ¥åç«¯åœ°å€
baseURL: 'http://localhost:8080',
// è·å–cookie
withCredentials: true,
```
![](https://gitee.com/kcsen/img/raw/master/picGo/image-20230515092108487.png#id=vGwUJ&originHeight=633&originWidth=1153&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
å°†app.tsx ä¸­çš„requestä¿®æ”¹ä¸‹å¦‚ä¸‹ï¼š
```typescript
export const request = requestConfig
```
ä¸Šé¢çš„ä¿®æ”¹æœ‰äº›éº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š
ä½¿ç”¨ant design proè‡ªå¸¦çš„openapiå·¥å…·ï¼Œæ ¹æ®åç«¯çš„swaggeræ¥å£æ–‡æ¡£æ•°æ®è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„è¯·æ±‚serviceä»£ç ã€‚
æ³¨æ„ï¼šå‰ç«¯é¡»æ›´æ”¹å¯¹åº”çš„è¯·æ±‚åœ°å€ä¸ºä½ çš„åç«¯åœ°å€ï¼Œæ–¹æ³•ï¼šåœ¨app.tsxé‡Œä¿®æ”¹request.baseURL
![](https://gitee.com/kcsen/img/raw/master/picGo/image-20230515092547498.png#id=CHNj5&originHeight=574&originWidth=1026&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
å®Œæˆè¯·æ±‚åç«¯åœ°å€ï¼š
![](https://gitee.com/kcsen/img/raw/master/picGo/image-20230515094844832.png#id=oaOf3&originHeight=238&originWidth=608&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

# ç¬¬äºŒæœŸç›´æ’­ - å‰ç«¯ç™»å½•ã€æ™ºèƒ½åˆ†æä¸šåŠ¡æµç¨‹è®²è§£
å­¦ä¹ ä»»åŠ¡ï¼š

1. å‰ç«¯æ¨¡æ¿ä¼˜åŒ–
2. å‰ç«¯ç™»å½•åŠŸå¼€å‘
3. æ™ºèƒ½åˆ†æä¸šåŠ¡æµç¨‹è®²è§£
4. æ™ºèƒ½åˆ†ææ¥å£å¼€å‘(Exclæ•°æ®å¤„ç†ã€AIç½‘ç«™ã€ç©æ³•æŠ€å·§åˆ†äº«)

## 1ã€å‰ç«¯
### 1.1 å‰ç«¯ç›®å½•ä»‹ç»
ä¿®æ”¹ç«¯å£ï¼ˆç¬¬ä¸€æ¬¡ç›´æ’­çš„æ—¶å€™é‡åˆ°ç«¯å£å†²çªï¼‰
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717833874283-659834c1-a34b-410a-b943-cc33ee548bca.png#averageHue=%23fafafa&clientId=ua095d19c-0831-4&from=paste&height=520&id=u0ef1a073&originHeight=624&originWidth=844&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=109597&status=done&style=none&taskId=ub7d0d665-86c6-4232-aeed-8e0b0bf2683&title=&width=703.3333053853788)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717833054428-e8114c0c-8ea5-426a-a938-ea6556bcaf4c.png#averageHue=%23bbcdc3&clientId=u35cba382-74c2-4&from=paste&height=722&id=Rma7x&originHeight=867&originWidth=1384&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=260263&status=done&style=none&taskId=u53e2a570-3e25-44c0-861e-e41d474d1e5&title=&width=1153.333287503986)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717833088732-14dfc658-0153-4d09-a88d-4be26cc8f2ed.png#averageHue=%23f9f9f9&clientId=u35cba382-74c2-4&from=paste&height=574&id=uc6b641aa&originHeight=689&originWidth=1029&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=119672&status=done&style=none&taskId=ubd4fe5ca-f57a-45ce-a23b-7cea2089d53&title=&width=857.4999659260128)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717833108052-01fba2eb-9037-4b86-bca8-744fc40555c2.png#averageHue=%23f9f9f9&clientId=u35cba382-74c2-4&from=paste&height=572&id=u8585e0fc&originHeight=687&originWidth=1042&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=112753&status=done&style=none&taskId=u4802f683-deb3-4296-95dc-efa9b6ee1e4&title=&width=868.3332988288681)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717833120675-b2a99e9a-583f-4dc2-a9dd-75bf30eaa81f.png#averageHue=%23f9f9f9&clientId=u35cba382-74c2-4&from=paste&height=354&id=u51dfa2f2&originHeight=425&originWidth=1028&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=80025&status=done&style=none&taskId=ue7e880a3-f6e0-46a3-b1bf-6709a3d8353&title=&width=856.6666326257931)

2. .husky æäº¤ä»£ç æ—¶ï¼Œæ£€æŸ¥ä»£ç æ˜¯å¦è§„èŒƒ
3. åˆ é™¤mockæ¨¡æ‹Ÿæ•°æ®ï¼ˆå› ä¸ºæœ¬åœ°æœ‰åç‘ï¼‰
4. è©æ¢Logo,å»[https:/www.iconfont..cn/](https://www.iconfont.cn/)æº²ç´¢ï¼Œæ›¿æ¢faviconï¼Œä½¿ç”¨http://libowen.com/tool/ico/ç”Ÿæˆ
5. åˆ é™¤å›½é™…åŒ–localesç›®å½•
6. åˆ é™¤æµ‹è¯•ç›¸å…³ç›®å½•ï¼štestsã€types
7. prettierã€eslintã€editorConfigã€stylelint,éœ€è¦å¼€å¯prettierç¾åŒ–ç½®
8. æ›¿æ¢ç½‘ç«™æ ‡é¢˜åä½ ï¼šå…¨å±€æ›¿æ¢Ant Design Proå’ŒAnt Design ï¼ˆCtrl + Shift + Rï¼‰
### 1.2 æ¨¡æ¿ä¼˜åŒ–
#### æ›¿æ¢logo
åœ¨publicç›®å½•ä¸‹æœ‰ä¸€äº›å°å›¾æ ‡å’Œ logoï¼ŒæŠŠè¿™ä¸‰ä¸ªå›¾ç‰‡åˆ æ‰ï¼Œæ¢æˆåˆ«çš„ 
[https://iconfont.cn/](https://iconfont.cn/)
[https://libowen.com/tool/ico/](https://libowen.com/tool/ico/)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717834987067-4ce1f349-8af9-4590-be4c-4ae22539fcc3.png#averageHue=%23fdfcfc&clientId=ua095d19c-0831-4&from=paste&height=193&id=ud5db3273&originHeight=232&originWidth=631&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=32675&status=done&style=none&taskId=uc0e5fa7b-bb78-4045-bc73-b0e30ec2ac2&title=&width=525.8333124385948)
æ›¿æ¢ favicon.icoï¼š
ps.favicon.ico æ˜¯ç½‘ç«™ä½œä¸Šè§’çš„å°å›¾æ ‡ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717835071366-5b98d44e-afe2-488f-866f-5c7c7cc7a456.png#averageHue=%23f2f1ee&clientId=ua095d19c-0831-4&from=paste&height=175&id=ue648aebf&originHeight=210&originWidth=353&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=39637&status=done&style=none&taskId=ub11869a8-8ae9-4802-b069-806414ac414&title=&width=294.166654977534)
åˆ¶ä½œ favicon.ico åªéœ€ä¸€ä¸ª .png çš„å›¾ç‰‡ï¼Œåˆ©ç”¨ç½‘ç«™å·¥å…·è¿›è¡Œè½¬æ¢ã€‚
ç‚¹å‡»PNGä¸‹è½½æŒ‰é’®ã€‚
æŠŠå›¾ç‰‡é‡å‘½åæˆfavicon.icoæˆ–è€…åˆ©ç”¨ç½‘ç«™å·¥å…·è½¬æ¢ã€‚
#### æ›¿æ¢æ ‡é¢˜
ç™»å½•é¡µçš„æ ‡é¢˜å…¨æ˜¯ Ant Designã€Ant Design Proï¼Œä¿®æ”¹ä¸€ä¸‹
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717835519969-664c6fc4-a0c7-412d-b711-2e6836c03513.png#averageHue=%23e9f0d2&clientId=ua095d19c-0831-4&from=paste&height=793&id=u9dd7c979&originHeight=952&originWidth=893&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=141088&status=done&style=none&taskId=ue1d7252b-8ace-43f9-a419-17017c72743&title=&width=744.1666370961412)
vscodeæˆ–webstormæŒ‰[Ctrl + Shift + F]ï¼›
å…¨å±€æœç´¢Ant Design Proå’ŒAnt Designã€èš‚èšé›†å›¢ä½“éªŒæŠ€æœ¯éƒ¨å‡ºå“ã€‚
webstormï¼šè¾“å…¥å®Œåï¼ŒæŒ‰[Ctrl + Shift + R]å…¨å±€æ›¿æ¢ï¼Œè¾“å…¥æ›¿æ¢çš„å†…å®¹ï¼šé±¼æ™ºèƒ½BIã€‚
vscodeï¼šè¾“å…¥å®Œåï¼Œç‚¹å‡»å·¦ä¾§âˆ¨æŒ‰é’®ï¼Œè¾“å…¥æ›¿æ¢å†…å®¹ï¼šé±¼æ™ºèƒ½BIã€‚
æŠŠé¡µé¢åº•ä¸‹çš„æ–‡å­—ä¹Ÿä¿®æ”¹ä¸€ä¸‹ï¼Œæ›¿æ¢æˆç¼–ç¨‹å¯¼èˆªçŸ¥è¯†æ˜Ÿçƒå‡ºå“ã€‚
### 1.2 å¼€å‘ç™»å½•æ³¨å†Œç•Œé¢
#### åˆ é™¤å¤šä½™éƒ¨åˆ†(æ—¶é—´ç‚¹ 33:39-41:38)
åˆ é™¤_snapshots_ç›®å½•ã€login.test.tsxã€‚
æŸ¥çœ‹è·¯ç”±é‡Œé¢çš„path
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717835818519-bffc160c-ca93-4e90-b9ba-efe2e7cb534c.png#averageHue=%23222428&clientId=ua095d19c-0831-4&from=paste&height=582&id=u2d0c4fe4&originHeight=699&originWidth=1485&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=118221&status=done&style=none&taskId=u0e242c07-a2bb-4327-bcae-11f0a245559&title=&width=1237.49995082617)
åˆ é™¤_snapshots_ç›®å½•ã€login.test.tsx
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717836050081-f2099827-0d0b-4fd9-af36-ba4cf382b328.png#averageHue=%2323262b&clientId=ua095d19c-0831-4&from=paste&height=542&id=u5701c210&originHeight=651&originWidth=1454&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=117176&status=done&style=none&taskId=u4089a2f5-e11b-49ef-8caa-51a5f5849e3&title=&width=1211.666618519361)
ç‚¹å‡»index.tsxï¼Œçœ‹è§137è¡Œçš„<Lang />çˆ†çº¢äº†ï¼Œé€‰ä¸­å®ƒï¼ŒæŒ‰Ctrl+é¼ æ ‡å·¦é”®ï¼Œç‚¹è¿›æ¥çœ‹
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717836351820-f3f090ee-b742-4c6c-b56d-cb6ee059a45f.png#averageHue=%2324272b&clientId=ua095d19c-0831-4&from=paste&height=695&id=u9efe530e&originHeight=834&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=171189&status=done&style=none&taskId=u328d8238-7a01-453b-8049-627d5689465&title=&width=1039.9999586741146)
è¿™é‡Œéƒ½æ²¡æœ‰ç”¨åˆ°ï¼Œåˆ æ‰ï¼Œç„¶åæŠŠ<Lang />ä¹Ÿåˆ æ‰ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717836396811-67213897-af67-45bf-a82f-93c65cc76f19.png#averageHue=%23232529&clientId=ua095d19c-0831-4&from=paste&height=297&id=u0c31b2a6&originHeight=356&originWidth=1057&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=71970&status=done&style=none&taskId=ub52a2b91-1c5b-4ad8-b02c-11b2d8c2c58&title=&width=880.8332983321627)
æŠŠé±¼æ™ºèƒ½BI æ˜¯è¥¿æ¹–åŒºæœ€å…·å½±å“åŠ›çš„Webè®¾è®¡è§„èŒƒæ”¹ä¸ºåŸåˆ›é¡¹ç›®ã€‚
```
subTitle={
  <a href="https://blog.csdn.net/qq_43157097?spm=1000.2115.3001.5343" target="_blank">
    YuBI æ˜¯ğŸŸç å†œè¿›é˜¶ä¹‹è·¯ <a/>
}
```
åˆ æ‰æ‰‹æœºå·ç™»å½•ã€è‡ªåŠ¨ç™»å½•çš„ä»£ç ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717836865437-e323bab8-8438-47c8-9a96-bea6acae1862.png#averageHue=%23252e40&clientId=ua095d19c-0831-4&from=paste&height=297&id=u5493d20d&originHeight=357&originWidth=1011&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=69196&status=done&style=none&taskId=ubb472d3f-e684-451a-bf5f-81668b5d3f3&title=&width=842.4999665220591)
```
initialValues={{
  autoLogin: true,
}}
actions={['å…¶ä»–ç™»å½•æ–¹å¼ :', <ActionIcons key="icons" />]}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717836951749-1b4fca31-abc7-4cdf-943f-8b021c188315.png#averageHue=%2323272e&clientId=ua095d19c-0831-4&from=paste&height=566&id=u3ebd1650&originHeight=679&originWidth=1182&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=116221&status=done&style=none&taskId=u00d5b330-a75c-4ab2-9fa6-2e6b4b34d8d&title=&width=984.9999608596181)
```
{
  key: 'mobile',
  label: 'æ‰‹æœºå·ç™»å½•',
},
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837041677-e215ce8e-9e33-40d7-9e16-0a71a160ee5e.png#averageHue=%23232528&clientId=ua095d19c-0831-4&from=paste&height=548&id=ue860d765&originHeight=658&originWidth=1181&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=112123&status=done&style=none&taskId=ud0886707-c73c-47a1-967b-a478dbafc3c&title=&width=984.1666275593985)
```
{status === 'error' && loginType === 'mobile' && <LoginMessage content="éªŒè¯ç é”™è¯¯" />}
{type === 'mobile' && (
  <>
    <ProFormText
      fieldProps={{
        size: 'large',
        prefix: <MobileOutlined />,
      }}
      name="mobile"
      placeholder={'è¯·è¾“å…¥æ‰‹æœºå·ï¼'}
      rules={[
        {
          required: true,
          message: 'æ‰‹æœºå·æ˜¯å¿…å¡«é¡¹ï¼',
        },
        {
          pattern: /^1\d{10}$/,
          message: 'ä¸åˆæ³•çš„æ‰‹æœºå·ï¼',
        },
      ]}
    />
    <ProFormCaptcha
      fieldProps={{
        size: 'large',
        prefix: <LockOutlined />,
      }}
      captchaProps={{
        size: 'large',
      }}
      placeholder={'è¯·è¾“å…¥éªŒè¯ç ï¼'}
      captchaTextRender={(timing, count) => {
        if (timing) {
          return `${count} ${'ç§’åé‡æ–°è·å–'}`;
        }
        return 'è·å–éªŒè¯ç ';
      }}
      name="captcha"
      rules={[
        {
          required: true,
          message: 'éªŒè¯ç æ˜¯å¿…å¡«é¡¹ï¼',
        },
      ]}
      onGetCaptcha={async (phone) => {
        const result = await getFakeCaptcha({
          phone,
        });
        if (!result) {
          return;
        }
        message.success('è·å–éªŒè¯ç æˆåŠŸï¼éªŒè¯ç ä¸ºï¼š1234');
      }}
    />
  </>
)}
```
```
<ProFormCheckbox noStyle name="autoLogin">
  è‡ªåŠ¨ç™»å½•
</ProFormCheckbox>
```
ä¿®æ”¹å¿˜è®°å¯†ç ä¸ºæ³¨å†Œã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837097416-2a667d19-d83c-468f-8ef9-32cd4720220b.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=803&id=u86819c19&originHeight=964&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=156173&status=done&style=none&taskId=ua6129867-fb71-4bd1-bec3-ab402ba625e&title=&width=1039.9999586741146)
```
<a
  style={{
    float: 'right',
  }}
>
  å¿˜è®°å¯†ç  ?
</a>
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837294095-cb5f4324-69a7-4ae4-a4d4-e45901fc494d.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=803&id=u6f346a86&originHeight=964&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=159701&status=done&style=none&taskId=ua359b3bf-e411-4de0-95fe-21276a427a8&title=&width=1039.9999586741146)
```
<div
  style={{
    float: 'right',
  }}
>
  <Link to="/user/register">æ³¨å†Œ</Link>
    
</div>
```
```
<div
  style={{
    // float: 'right',
      marginBottom:24
  }}
>
  <Link to="/user/register">æ³¨å†Œ</Link>

</div>
```
ä¿®æ”¹åé¡µé¢
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837390315-f224188e-1fb9-4e35-a706-078d54a1cd47.png#averageHue=%23dee8cc&clientId=ua095d19c-0831-4&from=paste&height=669&id=ue753ba87&originHeight=803&originWidth=1184&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=145604&status=done&style=none&taskId=u85a39614-db55-4c2d-9aea-37dc21f2a80&title=&width=986.6666274600574)
æ‰¾åˆ°ç™»å½•çš„è¡¨å•ï¼Œè¿™ä¸ªæ˜¯ç”¨ Ant Design Pro æä¾›çš„ç»„ä»¶LoginFormå®ç°çš„ï¼Œæˆ‘ä»¬åªéœ€æŠŠç”¨æˆ·è¾“å…¥çš„å†…å®¹(key)ï¼Œå’Œæˆ‘ä»¬åç«¯å¯¹åº”å³å¯ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837625766-62352a27-d32c-4b89-b18a-d6f16263eed7.png#averageHue=%231f2125&clientId=ua095d19c-0831-4&from=paste&height=229&id=u7068555a&originHeight=275&originWidth=587&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=22349&status=done&style=none&taskId=ud29d1935-d523-4b26-b39d-fad0968af8e&title=&width=489.1666472289305)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837553722-c309d7ac-0ec4-4a38-95e6-ba984ffd79fd.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=785&id=u928780ae&originHeight=942&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=170429&status=done&style=none&taskId=ufca8600c-499b-4462-a2a7-69e8b6ad7b1&title=&width=1039.9999586741146)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837577927-f522c3f1-2b22-4f61-81c9-2b5d323fcc3e.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=785&id=u9b426388&originHeight=942&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=177402&status=done&style=none&taskId=u66e6b74c-a194-43d4-bff3-190fe78bbff&title=&width=1039.9999586741146)
æŠŠåç«¯é¡¹ç›®å¯åŠ¨ï¼Œæ‰“å¼€åç«¯çš„æ¥å£æ–‡æ¡£ï¼Œè®¿é—® [http://localhost:8080/api/doc.html](http://localhost:8080/api/doc.html)ï¼›
æ‰¾åˆ°ç”¨æˆ·ç™»å½•æ¥å£userLoginï¼Œçœ‹ä¸€ä¸‹è¯·æ±‚ï¼Œç”¨æˆ·ç™»å½•æ¥æ”¶çš„è¯·æ±‚æ˜¯userAccount(è´¦å·)ã€userPassword(å¯†ç )ã€‚
```typescript
{
  "userAccount": "ZKYAAA",
  "userPassword": "12345678"
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837709322-8eabddde-2d73-4de8-8b43-d7eedc2ea7f6.png#averageHue=%23bbb190&clientId=ua095d19c-0831-4&from=paste&height=1356&id=ub0dc2c64&originHeight=1627&originWidth=2888&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=323886&status=done&style=none&taskId=ud213fb58-4af6-4eeb-adc3-039e0d9dbe1&title=&width=2406.666571034329)
æŠŠnameæ”¹ä¸ºuserAccount(è´¦å·)ã€userPassword(å¯†ç )ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837782398-cb3fedcf-58ce-456e-b3aa-1e6857640c81.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=785&id=udf5049f8&originHeight=942&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=177535&status=done&style=none&taskId=u8bc35a19-202a-4897-b593-79237f309d3&title=&width=1039.9999586741146)
ä¿®æ”¹åï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837816752-8cd7cf5f-8b6b-40b7-baaa-9cfc7168e150.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=785&id=u7a8814ee&originHeight=942&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=179420&status=done&style=none&taskId=u53fb7cff-adf3-4316-85d6-10a47502792&title=&width=1039.9999586741146)
ä¿®æ”¹å ä½ç¬¦æç¤ºæ–‡æœ¬ä¿¡æ¯ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837847415-505368c6-a4af-4f5f-bf34-7e14387bdfe5.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=785&id=u4cb36ebb&originHeight=942&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=179481&status=done&style=none&taskId=u099c7aae-af12-40dd-a932-c09a4bcf867&title=&width=1039.9999586741146)
ä¿®æ”¹åï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837925349-f42e96d3-6435-4eac-8a9b-e765a6caa0b2.png#averageHue=%23232529&clientId=ua095d19c-0831-4&from=paste&height=739&id=u2eb95ada&originHeight=887&originWidth=1195&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=153665&status=done&style=none&taskId=u0bb4e3b0-263a-4eb7-a339-d498fb615c9&title=&width=995.8332937624735)
åˆ é™¤é”™è¯¯å¡«å†™ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837963505-0c1ea5f6-7f60-4e45-a0c3-82630cbc6465.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=785&id=ue83da008&originHeight=942&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=175600&status=done&style=none&taskId=uf5d9ecea-05eb-49f3-b331-e13e7981cfb&title=&width=1039.9999586741146)
```
{status === 'error' && loginType === 'account' && (
  <LoginMessage content={'é”™è¯¯çš„ç”¨æˆ·åå’Œå¯†ç (admin/ant.design)'} />
)}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717837999082-5f910095-e717-4595-ab3b-74cc344cfcdd.png#averageHue=%2324272c&clientId=ua095d19c-0831-4&from=paste&height=785&id=u24585e53&originHeight=942&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=196560&status=done&style=none&taskId=ubce60c38-7bbf-427b-89b2-719b9a61a13&title=&width=1039.9999586741146)
```typescript
  const { status, type: loginType } = userLoginState;
```
#### æ ¹æ®åç«¯åšå‡ºè°ƒæ•´(æ—¶é—´ç‚¹ 41:40-59:20)
å‰ç«¯è¿˜æ²¡æœ‰å’Œåç«¯å¯¹æ¥ï¼Œç°åœ¨å‰ç«¯è¯·æ±‚çš„åœ°å€ä¸æ˜¯æˆ‘ä»¬è‡ªå·±çš„åç«¯ã€‚
æ‰¾åˆ°onFinshâ†’ å½“ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®ä¹‹åï¼Œä¼šæ‰§è¡ŒhandleSubmitæäº¤å‡½æ•°ã€‚
```
onFinish={async (values) => {
  await handleSubmit(values as API.LoginParams);
}}
```
æŠŠ ts ç±»å‹æ”¹æˆåç«¯è‡ªå·±çš„ç±»å‹UserLoginRequest(ç”¨æˆ·ç™»å½•è¯·æ±‚)ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717838529258-f7f03cae-53df-4423-859f-879921e6a763.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=785&id=ucd54846a&originHeight=942&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=177215&status=done&style=none&taskId=u6d609f79-56d3-4a6e-84d7-bb8dceef320&title=&width=1039.9999586741146)
é€‰ä¸­handleSubmitï¼ŒæŒ‰Ctrl+é¼ æ ‡å·¦é”®ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717839126953-d7c6af31-a443-4c09-a978-9298251c5d1c.png#averageHue=%2324272b&clientId=ua095d19c-0831-4&from=paste&height=785&id=u975bf0de&originHeight=942&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=208454&status=done&style=none&taskId=ub6514c67-0ec4-4407-83e5-fa6ce6fcb44&title=&width=1039.9999586741146)
æŠŠæ¥æ”¶çš„å‚æ•°ç±»å‹æ”¹æˆUserLoginRequest(ç”¨æˆ·ç™»å½•è¯·æ±‚)ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717839158983-a17e8467-987a-4b5b-98bd-d80e1d5236d5.png#averageHue=%2324262b&clientId=ua095d19c-0831-4&from=paste&height=551&id=u76651ee1&originHeight=661&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=143909&status=done&style=none&taskId=uc37cdbd8-bba2-4b85-b43f-abee1cb12c6&title=&width=1039.9999586741146)
è¿™é‡Œå®é™…ä¸Šæ˜¯è¯·æ±‚å’±ä»¬çš„åç«¯ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717839188097-0f5ec501-ffd0-4b80-8a84-b9379e873927.png#averageHue=%2324262b&clientId=ua095d19c-0831-4&from=paste&height=519&id=u23f16f71&originHeight=623&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=137510&status=done&style=none&taskId=u32505d16-1da0-42d0-be10-9fff47b134c&title=&width=1039.9999586741146)
è¦æ”¹æˆè‡ªå·±çš„åç«¯ä»£ç ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717839359472-89c4953f-fd4f-4fa9-9daf-cdd8fff186e3.png#averageHue=%2325272c&clientId=ua095d19c-0831-4&from=paste&height=439&id=u6fb25429&originHeight=527&originWidth=1248&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=124579&status=done&style=none&taskId=u56bf2da0-35de-4d94-98a3-c7699f78384&title=&width=1039.9999586741146)
çœ‹ä¸€ä¸‹åç«¯æ¥å£æ–‡æ¡£çš„è¿”å›å€¼ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717839415505-4499f9e0-bfdb-4003-9816-10a3541c31fc.png#averageHue=%23c1b089&clientId=ua095d19c-0831-4&from=paste&height=822&id=ud18f38b7&originHeight=986&originWidth=1904&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=124630&status=done&style=none&taskId=uf4521f90-a1ef-4b9e-8e44-879aa06fd44&title=&width=1586.6666036182005)
ç„¶åæŠŠè¿”å›å€¼åˆ¤æ–­æ”¹æˆè‡ªå·±çš„ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717839861037-08ec6668-0e6d-432c-8808-190309b240e8.png#averageHue=%23fbfaf9&clientId=ua095d19c-0831-4&from=paste&height=999&id=u247ef6f0&originHeight=1199&originWidth=1182&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=426474&status=done&style=none&taskId=u2a069458-05eb-4771-b6dd-cecaa19e42d&title=&width=984.9999608596181)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840085296-730d353e-d6ab-4c02-920f-72839ffc733a.png#averageHue=%2325272b&clientId=ua095d19c-0831-4&from=paste&height=785&id=u80a4ee6e&originHeight=942&originWidth=1138&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=203589&status=done&style=none&taskId=u3e6fd2d4-329e-4d83-939e-9510a99dcdb&title=&width=948.3332956499538)
è¿™é‡Œè¿˜è¦æ”¹ä¸€ä¸‹fetchUserinfoå‡½æ•°ï¼Œé€‰ä¸­fetchUserinfoï¼ŒæŒ‰Ctrl+é¼ æ ‡å·¦é”®ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840095780-d9d999ac-25bc-4159-8f91-9960180aae43.png#averageHue=%23eff0ea&clientId=ua095d19c-0831-4&from=paste&height=497&id=u9ebd573d&originHeight=597&originWidth=862&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=359734&status=done&style=none&taskId=ufd9c9026-cd4f-4983-a3e7-c1b36024b66&title=&width=718.3333047893324)
è¿™é‡Œæ”¹æˆè‡ªå·±åç«¯ç”Ÿæˆçš„ä»£ç getLoginUserUsingGETï¼Œå¯¹åº”åç«¯æ¥å£æ–‡æ¡£ä¸­çš„getLoginUserã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840130668-237a8341-4d18-452f-86ad-d7bddc0edbb8.png#averageHue=%23f2f0ea&clientId=ua095d19c-0831-4&from=paste&height=493&id=udf83a2aa&originHeight=592&originWidth=886&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=238342&status=done&style=none&taskId=ubbfe52e2-8af8-4de2-a416-33e0181d49d&title=&width=738.3333039946037)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840137149-6f3ae536-d3e7-49c4-bd5b-ac962d3a8b6d.png#averageHue=%23f5f5f0&clientId=ua095d19c-0831-4&from=paste&height=367&id=u553badf8&originHeight=440&originWidth=882&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=233204&status=done&style=none&taskId=u4af0d442-82d0-416a-9785-7dfb5658025&title=&width=734.9999707937252)
ç›´æ¥å»æ•°æ®åº“åŠ ä¸Šæ•°æ®ã€‚
æœ‰å¾ˆå¤šæœªå¼•ç”¨çš„å€¼ï¼ŒæŠŠæœªå¼•ç”¨çš„å…¨åˆ æ‰ã€‚
webstormæŒ‰Ctrl+Alt+Oä¼˜åŒ–å¯¼å…¥çš„ç±»å’ŒåŒ…ï¼›
vscodeæŒ‰Shift+Alt+Oã€‚
ps.webstorm è¿™ä¸ªå¿«æ·é”®ä¼šå…¨åˆ æ‰ï¼ŒğŸŸæœ€åæ˜¯æ‰‹åŠ¨åˆ é™¤çš„ğŸ¶
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840466062-30cdddc9-0270-4b9a-b729-505786ea7a2c.png#averageHue=%23e5eacd&clientId=ua095d19c-0831-4&from=paste&height=669&id=ucfe4636f&originHeight=803&originWidth=1034&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=137138&status=done&style=none&taskId=ua5fd771a-2b31-463a-a3e9-fb54bc969ca&title=&width=861.6666324271109)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840545671-3ddd1db8-5e12-4d4a-8dc3-4da3b1ab5c5f.png#averageHue=%23f6f6f6&clientId=ua095d19c-0831-4&from=paste&height=867&id=u79a81924&originHeight=1041&originWidth=1903&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=301461&status=done&style=none&taskId=u3b149bdf-85a2-4640-8cd6-e61f8680121&title=&width=1585.8332703179808)
ç‚¹å‡»app.tsxï¼Œæ‰¾åˆ°getInitialStateå¹¶ä¿®æ”¹**(ä¿®æ”¹æ€è·¯ æ—¶é—´ç‚¹47:27-48:09)**ã€‚
ps.getInitialState æ˜¯ Ant Design Pro ç”¨æ¥ä¿å­˜å…¨å±€çŠ¶æ€çš„ä¸€ä¸ªå‡½æ•°ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840628234-6bed7e63-2c4e-4005-81e9-00feb7d9724a.png#averageHue=%2325272c&clientId=ua095d19c-0831-4&from=paste&height=785&id=ue5848154&originHeight=942&originWidth=1138&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=212628&status=done&style=none&taskId=u1a062b68-3ba4-4a1d-82c6-eb2d10a09cd&title=&width=948.3332956499538)
```
export async function getInitialState(): Promise<{
  settings?: Partial<LayoutSettings>;
  currentUser?: API.CurrentUser;
  loading?: boolean;
  fetchUserInfo?: () => Promise<API.CurrentUser | undefined>;
}> {
```
åªç•™ä¸‹ä¸€ä¸ª
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840748108-387bf4ec-3746-4ddb-b190-8ea065cee255.png#averageHue=%2324272b&clientId=ua095d19c-0831-4&from=paste&height=498&id=u97736a72&originHeight=598&originWidth=1138&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=129291&status=done&style=none&taskId=u9eba1348-affa-4087-ad64-d07d630267f&title=&width=948.3332956499538)
```
export async function getInitialState(): Promise<{
  currentUser?: API.LoginUserVO;
}> {
```
ç»§ç»­ä¼˜åŒ–å°†queryCurrentUserä¿®æ”¹ä¸ºgetLoginUserUsingGet
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840809113-850bc473-202e-4740-87c4-c0061836e233.png#averageHue=%23232529&clientId=ua095d19c-0831-4&from=paste&height=517&id=u55152d99&originHeight=621&originWidth=1077&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=137104&status=done&style=none&taskId=ub358512a-8fc0-4ab7-9adf-d09933fef35&title=&width=897.4999643365556)
```
const fetchUserInfo = async () => {
  try {
    const msg = await queryCurrentUser({
      skipErrorHandler: true,
    });
    return msg.data;
  } catch (error) {
    history.push(loginPath);
  }
  return undefined;
};
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840911648-2d043bd0-0848-4eae-a1ea-08a3911dee58.png#averageHue=%23232529&clientId=ua095d19c-0831-4&from=paste&height=619&id=u0fd851a3&originHeight=743&originWidth=1082&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=164308&status=done&style=none&taskId=ua704c120-2569-48a1-9bea-c465d60b28e&title=&width=901.6666308376539)
```
const fetchUserInfo = async () => {
  try {
    const res = await getLoginUserUsingGet();
    return res.data;
  } catch (error) {
    history.push(loginPath);
  }
  return undefined;
};
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717840940442-75524814-3218-4e19-8451-2572c9817d37.png#averageHue=%2325272b&clientId=ua095d19c-0831-4&from=paste&height=785&id=udf203800&originHeight=942&originWidth=1138&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=216508&status=done&style=none&taskId=ue34c15d0-f38b-477c-96b8-68035ca4474&title=&width=948.3332956499538)
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659286243-5ae9973a-5bad-4178-9841-1eec3acb2b8c.png#averageHue=%23fcfbfa&from=url&id=fB5XV&originHeight=550&originWidth=797&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
#### å¤´åƒåŠ è½½(æ—¶é—´ç‚¹ 48:47-59:20)
ä¹‹å‰ç™»å½•ä¹‹åä¼šå‘ç°å³ä¸Šè§’çš„å¤´åƒä¸€ç›´åœ¨åŠ è½½çŠ¶æ€ï¼Œè¿™é‡Œä½¿ç”¨ç¼–ç¨‹å¯¼èˆªå¤´åƒï¼Œå°†é“¾æ¥ç²˜è´´è‡³åç«¯æ•°æ®åº“ä¸­
[https://yupi.icu/logo.png](https://yupi.icu/logo.png)
![12a86f552f13c666fbfc8fffba4e46a7_1.jpg](https://cdn.nlark.com/yuque/0/2024/jpeg/1389428/1717842652865-a6f02016-b778-4405-aca4-616e5a4a3ddd.jpeg#averageHue=%238f9691&clientId=ua095d19c-0831-4&from=paste&height=799&id=u72becf07&originHeight=959&originWidth=959&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=106524&status=done&style=none&taskId=u607a6db1-a502-466d-a0be-d74d6b64032&title=&width=799.1666349106378)
åœ¨å‰ç«¯çš„app.tsxç»§ç»­å¾€ä¸‹æ»‘ï¼Œè¿™é‡Œæœ‰å®šä¹‰å¤´åƒï¼Œæ¢æˆæˆ‘ä»¬åç«¯çš„å¤´åƒå±æ€§userAvatarã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717841187772-381e7a07-a5f3-4afd-95fc-1bb8002b7ac6.png#averageHue=%2325272b&clientId=ua095d19c-0831-4&from=paste&height=785&id=udab63a92&originHeight=942&originWidth=1138&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=208404&status=done&style=none&taskId=u71959690-dcfb-49c6-9f5d-4a0716c86a8&title=&width=948.3332956499538)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717841237947-86e3332d-a80f-4562-b877-c521f14f5044.png#averageHue=%2325272b&clientId=ua095d19c-0831-4&from=paste&height=785&id=u1f9fc332&originHeight=942&originWidth=1138&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=203379&status=done&style=none&taskId=u313285c2-f284-41ca-b597-255d14068ce&title=&width=948.3332956499538)
ç„¶åå› ä¸ºç”¨æˆ·åä¸å¯¹ï¼Œæ‰€ä»¥ç°åœ¨å¤´åƒè¿˜ä¸€ç›´åœ¨åŠ è½½ä¸­ã€‚
è¿›å…¥srcç›®å½•â†’commponentsâ†’RightContentâ†’AvatarDropdown.tsx(å¤´åƒä¸‹æ‹‰æ¡†)ï¼›
æŠŠnameæ”¹æˆuserNameã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659287849-6c617480-cf42-48ca-9afa-9925a32a9e0f.png#averageHue=%23f7f5f3&from=url&id=yZCZe&originHeight=663&originWidth=1000&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

#### ç™»å½•çŠ¶æ€å¤±æ•ˆ(æ—¶é—´ç‚¹ 50:07-53:55)
æ±‚åœ°å€è¿˜å¤šäº†ä¸€ä¸ª token%20=%20123ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ
é¦–å…ˆï¼Œè¦äº†è§£å‰ç«¯æ€ä¹ˆçŸ¥é“åç«¯æœ‰ç™»å½•ï¼Œå‰ç«¯æ˜¯é€šè¿‡ä»€ä¹ˆå‘Šè¯‰åç«¯çš„ï¼Ÿ**é€šè¿‡cookie**
çœ‹ä¸€ä¸‹è¯·æ±‚å¤´ï¼Œæœ‰ cookie å—ï¼Ÿæ²¡æœ‰ cookieï¼Œåç«¯å°±ä¸çŸ¥é“æ˜¯å“ªä¸ªå®¢æˆ·ç«¯æˆ–ç”µè„‘ç«¯ç™»å½•è¿‡äº†ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659291991-204acddb-38d8-4ca5-a315-06e965a4fecf.png#averageHue=%23dac7af&from=url&id=N9W2Y&originHeight=693&originWidth=1000&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
è¦æ”¹ä¸€ä¸‹å‰ç«¯çš„å…¨å±€è¯·æ±‚ï¼Œä¸Šæ¬¡åœ¨è¿™é‡Œæ”¹è¿‡å…¨å±€è¯·æ±‚çš„åœ°å€ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717842206204-b4742243-f87b-4355-8e0d-abd394c568a3.png#averageHue=%2324262a&clientId=ua095d19c-0831-4&from=paste&height=731&id=u166e6f3c&originHeight=877&originWidth=1165&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=182898&status=done&style=none&taskId=ucef4a5a6-6aa0-4917-b8b7-1e1a4dd553b&title=&width=970.8332947558843)
è¦å¸¦ä¸Š cookieï¼ŒåŠ ä¸ŠwithCredentials: trueã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717842237089-85ab23db-7420-4d27-b476-b9ae668224bb.png#averageHue=%2324262b&clientId=ua095d19c-0831-4&from=paste&height=785&id=u72ac9053&originHeight=942&originWidth=1138&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=186430&status=done&style=none&taskId=u5047f37d-02ff-4274-bbc8-a13e10174f2&title=&width=948.3332956499538)
æˆ‘ä»¬æ‰€æœ‰çš„è¯·æ±‚éƒ½å¸¦äº†ä¸Š token çš„åç¼€ï¼Œå†çœ‹çœ‹å‰ç«¯çš„å…¨å±€è¯·æ±‚ï¼Œå®ƒè¿™é‡Œè¿˜åŠ è½½äº†errorConfigã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659294193-44f37903-f1b1-4369-ba36-e9f368878f9a.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_232%2Climit_0#averageHue=%23f9f6f3&from=url&id=zMr9F&originHeight=85&originWidth=232&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
é€‰ä¸­errorConfigæŒ‰Ctrl+é¼ æ ‡å·¦é”®è¿›å…¥ï¼Œæ¥åˆ°requestErrorConfig.tsã€‚
è¯·æ±‚é…ç½®èµ·è¿™ä¸ªåå­—ï¼Œä¸æ˜¯å¾ˆå¥½ï¼Œæ”¹æˆrequestConfig.tsã€‚
è¿™ä¸ªæ–‡ä»¶é‡Œå®šä¹‰äº†è¯·æ±‚å¤„ç†ã€è¯·æ±‚æ‹¦æˆªå™¨ã€å“åº”æ‹¦æˆªå™¨ï¼Œåœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­å®ƒç»™æ‰€æœ‰çš„è¯·æ±‚éƒ½åŠ ä¸Šäº†token....å­—æ®µï¼Œæ³¨é‡Šæ‰ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659296062-eae03742-7973-4f59-8c65-9f83fe225a13.png#averageHue=%23fcfaf9&from=url&id=RUjus&originHeight=632&originWidth=811&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å†æ¬¡ç™»å½•ï¼Œå°±æ²¡æœ‰å¤šä½™çš„å­—æ®µäº†ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717842400473-dd2fe472-52e4-4a71-96cc-39678a9aebfe.png#averageHue=%2324272b&clientId=ua095d19c-0831-4&from=paste&height=785&id=ud2636d09&originHeight=942&originWidth=1138&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=175466&status=done&style=none&taskId=u64e45fee-0f7c-4c35-bf30-9ff35971ff7&title=&width=948.3332956499538)

å…ˆåˆ æ‰ä¸éœ€è¦çš„ï¼Œå†æ ¹æ®åç«¯å»æ•…è°ƒæ•´ï¼ˆå’Œåç«¯è”è°ƒï¼‰
å¦‚æœç™»å½•åè¿˜æ˜¯æ²¡æ³•è¿›å…¥ä¸»é¡µï¼Œä¿®æ”¹å…¨å±€è¯·æ±‚é…ç½®app.tsxï¼š
```typescript
export const request = {
  // è¯·æ±‚åç«¯åœ°å€
  baseURL: 'http://localhost:8103',
  // è·å–cookie
  withCredentials: true,
  ...errorConfig,
};
```
å–æ¶ˆæ³¨é‡Štokenï¼š
```typescript
// è¯·æ±‚æ‹¦æˆªå™¨
requestInterceptors: [
  (config: RequestOptions) => {
    // æ‹¦æˆªè¯·æ±‚é…ç½®ï¼Œè¿›è¡Œä¸ªæ€§åŒ–å¤„ç†ã€‚
    // const url = config?.url?.concat('?token = 123');  // æºå¸¦token
    // return { ...config, url };
    return config;
  },
],
```
å¤´åƒè½¬åœˆï¼šå»AvatarDropdown.tsxï¼Œä¿®æ”¹æˆåç«¯å¯¹åº”çš„å­—æ®µ
#### æ³¨å†Œç•Œé¢(æ–°å¢)

1. å¢åŠ è·¯ç”±
2. å¤åˆ¶ç²˜è´´ç™»å½•çš„ç•Œé¢
3. æ·»åŠ å¤šä¸€ä¸ªè¡¨å•
4. ä¿®æ”¹æˆæ³¨å†Œçš„åç«¯è¯·æ±‚
> æ›´å¤šçš„å¯ä»¥çœ‹æˆ‘çš„ç”¨æˆ·ä¸­å¿ƒé¡¹ç›®ä»£ç  ï¼šhttps://github.com/kongshier/shier-usercenter-frontendï¼ŒåŒæ—¶æˆ‘ä¹Ÿåœ¨è¿™é‡Œç”¨ä¸Šäº†ç”¨æˆ·ä¸­å¿ƒçš„åŠŸèƒ½

## 2ã€æ™ºèƒ½åˆ†æä¸šåŠ¡å¼€å‘

1. ç”¨æˆ·è¾“å…¥ 
   1. åˆ†æç›®æ ‡
   2. ä¸Šä¼ åŸå§‹æ•°æ®(excel)
   3. æ›´ç²¾ç»†åœ°æ§åˆ¶å›¾è¡¨ï¼šæ¯”å¦‚å›¾è¡¨ç±»å‹ã€å›¾è¡¨åä½ ç­‰
2. åç«¯æ ¡éªŒ 
   1. æ ¡éªŒç”¨æˆ·çš„è¾“å…¥æ˜¯å¦åˆæ³•ï¼ˆæ¯”å¦‚é•¿åº¦ï¼‰
   2. æˆæœ¬æ§åˆ¶ï¼ˆæ¬¡æ•°ç»Ÿè®¡å’Œæ ¡éªŒã€é‰´æƒç­‰
3. æŠŠå¤„ç†åçš„æ•°æ®è¾“å…¥ç»™ AI æ¨¡å‹ï¼ˆè°ƒç”¨AIæ¥å£ï¼‰ï¼Œè®© AI æ¨¡å‹ç»™æˆ‘ä»¬æä¾›å›¾è¡¨ä¿¡æ¯ã€ç»“è®ºæ–‡æœ¬
4. å›¾è¡¨ä¿¡æ¯ï¼ˆæ˜¯ä¸€æ®µ JSON é…ç½®ï¼Œæ˜¯ä¸€è®¾ä»£ç ï¼‰ã€ç»“è®ºæ–‡æœ¬åœ¨å‰ç«¯è¿›è¡Œå±•ç¤º
### 2.1 ä¸šåŠ¡æµç¨‹
#### ï¼ˆ1ï¼‰å¼€å‘æ¥å£
æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ï¼ˆæ–‡æœ¬å’Œæ–‡ä»¶ï¼‰ï¼Œæœ€åè¿”å›å›¾è¡¨ä¿¡æ¯å’Œç»“è®ºæ–‡æœ¬
> ç»™chart è¡¨æ·»åŠ ä¸€ä¸ªå­—æ®µ chartName

```sql
-- å›¾è¡¨ä¿¡æ¯è¡¨
create table if not exists chart
(
    id         bigint auto_increment comment 'id' primary key,
    goal       text                               null comment 'åˆ†æç›®æ ‡',
    chartName   varchar(256)                       null comment 'å›¾è¡¨åç§°',
    chartData  text                               null comment 'å›¾è¡¨æ•°æ®',
    chartType  varchar(256)                       null comment 'å›¾è¡¨ç±»å‹',
    genChart   text                               null comment 'ç”Ÿæˆçš„å›¾è¡¨ä¿¡æ¯',
    genResult  text                               null comment 'ç”Ÿæˆçš„åˆ†æç»“è®º',
    userId     bigint                             null comment 'åˆ›å»ºå›¾æ ‡ç”¨æˆ· id',
    createTime datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete   tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤'
) comment 'å›¾è¡¨ä¿¡æ¯è¡¨' collate = utf8mb4_unicode_ci;
```
é¦–å…ˆï¼Œè¿›å…¥åˆ°åç«¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„ excel æ–‡ä»¶æ—¶ï¼Œåœ¨è¯·æ±‚çš„å‚æ•°ä¸­å¯¹æ¥ä¸€ä¸‹æ–‡ä»¶ï¼Œèƒ½å¤Ÿæ¥æ”¶åˆ°æ–‡ä»¶ï¼Œå¯ä»¥ä»¿ç…§æ¨¡æ¿ä¸­æ–‡ä»¶ä¸Šä¼ çš„æ¥å£è¿›è¡Œç¼–å†™ã€‚
å¤åˆ¶FileController.javaçš„æ–‡ä»¶ä¸Šä¼ ä»£ç ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1717847667064-e7686685-7589-446c-bc5a-c0a4c83a7951.png#averageHue=%23272c34&clientId=ua095d19c-0831-4&from=paste&height=801&id=ude050448&originHeight=961&originWidth=1484&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=244695&status=done&style=none&taskId=u59a8916a-5a52-455f-8afc-25d3fa32dd9&title=&width=1236.6666175259504)
ç²˜è´´è‡³ChartController.javaã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659297300-784370f2-55d3-4b57-8ddf-17ebe974624b.png#averageHue=%23fbf9f7&from=url&id=BfXxn&originHeight=502&originWidth=1000&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
é€‰ä¸­UploadFileRequestï¼ŒæŒ‰Ctrl+é¼ æ ‡å·¦é”®ï¼Œè¿›å…¥åˆ°UploadFileRequest.javaæ–‡ä»¶ä¸­ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659297722-edb85f0d-6202-46a8-b3d7-b57afee373d0.png#averageHue=%23faf8f6&from=url&id=GAdBW&originHeight=548&originWidth=1000&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å¤åˆ¶è¿™ä¸ªæ–‡ä»¶ï¼Œç²˜è´´è‡³com.yupi.springbootinit.model.dto.chartä¸­ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659298322-88949321-51d3-4e58-bd20-bef41b30bd2c.png#averageHue=%23f9f8f7&from=url&id=iO5ng&originHeight=660&originWidth=1000&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å¤åˆ¶è¿™ä¸ªæ–‡ä»¶ï¼Œç²˜è´´è‡³com.yupi.springbootinit.model.dto.chartä¸­ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659298322-88949321-51d3-4e58-bd20-bef41b30bd2c.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_526%2Climit_0#averageHue=%23f9f8f7&from=url&id=pK1bS&originHeight=347&originWidth=526&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å¹¶æ”¹åä¸ºGenChartByAiRequest.javaã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659298798-a3dbf362-79c0-47b2-8cc4-e44212599a67.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_229%2Climit_0#averageHue=%23f9f7f5&from=url&id=ZvoE3&originHeight=156&originWidth=229&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
è¿™é‡Œæˆ‘ä»¬è¦è®©ç”¨æˆ·è¾“å…¥ä»€ä¹ˆå†…å®¹å‘¢ï¼Ÿæ‰¾åˆ°ä¹‹å‰çš„å›¾è¡¨è®¾è®¡(chartè¡¨)ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659299360-07018624-04fa-48bc-9525-7ad859562cba.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_528%2Climit_0#averageHue=%23fbfaf9&from=url&id=HcZdD&originHeight=386&originWidth=528&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å‘ç°å°‘äº†ä¸€ä¸ªè®©ç”¨æˆ·è¾“å…¥åç§°çš„å±æ€§ï¼Œæ‰¾åˆ°sqlç›®å½•â†’create_table.sqlï¼Œæ·»åŠ nameã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659299721-48a7df8a-0c86-4ba9-abfb-eab3b0dccf68.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_514%2Climit_0#averageHue=%23f7f6f2&from=url&id=i6cag&originHeight=225&originWidth=514&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
é¦–å…ˆåœ¨ sql æ–‡ä»¶å®šä¹‰å¥½ï¼Œå°±æœ‰ä¸€ä¸ªå½’æ¡£çš„ä½œç”¨ã€‚
ç„¶åå³é”®chartè¡¨â†’Modify Tableã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659300244-34132000-f7d1-40c7-b83d-2513c21b8a3a.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_504%2Climit_0#averageHue=%23f2eeed&from=url&id=ESji9&originHeight=250&originWidth=504&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æ·»åŠ æ–°å­—æ®µã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659300554-bede6cd8-b705-4864-911d-7cbe02144004.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_507%2Climit_0#averageHue=%23f5f3f2&from=url&id=f1Jjn&originHeight=562&originWidth=507&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ç‚¹å‡»chartè¡¨ï¼Œçœ‹çœ‹æ·»åŠ ä¸Šäº†æ²¡ï¼Œç„¶åé¼ æ ‡å·¦é”®ç‚¹å‡»nameæ‹–åˆ°idçš„å³è¾¹ã€‚				
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659300971-971e9f37-ad23-43cb-adc4-11c09f287bc6.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_537%2Climit_0#averageHue=%23f8f7f7&from=url&id=AwWfK&originHeight=164&originWidth=537&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å»åç«¯è¡¥å……å¯¹åº”çš„å­—æ®µï¼Œæ‰¾åˆ°Chart.javaï¼Œæ·»åŠ å­—æ®µã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659301415-6416b463-0bcc-4fad-a01c-553cb82478a3.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_537%2Climit_0#averageHue=%23f9f7f6&from=url&id=nSsNO&originHeight=326&originWidth=537&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æ·»åŠ ã€ç¼–è¾‘ã€æŸ¥è¯¢ã€æ›´æ–°çš„æ—¶å€™ï¼Œéœ€è¦ç”¨æˆ·è¾“å…¥åç§°ï¼Œæ‰€ä»¥è¦åŠ ä¸Šå›¾è¡¨åç§°ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659301908-eed79372-b15e-411c-90ac-42f877b754a0.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_536%2Climit_0#averageHue=%23f9f7f6&from=url&id=bTGzJ&originHeight=327&originWidth=536&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659302454-6a518cbf-8cc4-4907-9e26-dbcb1b967112.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_538%2Climit_0#averageHue=%23f9f7f6&from=url&id=ySlvV&originHeight=323&originWidth=538&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659302896-4c49cd59-a10b-4ca7-bd12-7480cfb2a921.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_538%2Climit_0#averageHue=%23f9f7f6&from=url&id=QwDm8&originHeight=323&originWidth=538&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659303351-db9fc718-922c-4ffb-af77-77825fd7ae4b.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_543%2Climit_0#averageHue=%23f9f7f5&from=url&id=ejuPM&originHeight=314&originWidth=543&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
åŒ…æ‹¬GenChartByAiRequest.javaè®© AI å¸®æˆ‘ä»¬æ™ºèƒ½åˆ†æï¼Œä¹Ÿéœ€è¦æ¥æ”¶åç§°ã€ç›®æ ‡ã€æ–‡ä»¶ã€å›¾è¡¨ç±»å‹ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659303841-ab9f12a9-c5e7-4e38-addb-08822291adee.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_574%2Climit_0#averageHue=%23faf8f7&from=url&id=BSjdf&originHeight=357&originWidth=574&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å»ChartMapperè¡¥å……å­—æ®µã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659304490-ab48ccd7-797b-4553-b0ec-ba5cddb6cdd4.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_628%2Climit_0#averageHue=%23f8f6f4&from=url&id=KN5Ic&originHeight=316&originWidth=628&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æŸ¥è¯¢æ¡ä»¶å¤šåŠ ä¸ªå­—æ®µï¼Œåç§°å¯ä»¥ç”¨æ¨¡ç³ŠæŸ¥è¯¢ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659304968-7da2f0be-892d-4bfd-bf01-17791d72f0be.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_621%2Climit_0#averageHue=%23f6f2f0&from=url&id=wwEjY&originHeight=294&originWidth=621&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ä¿®æ”¹å¯¹åº”çš„å®ç°ç±»ï¼Œåœ¨æŸ¥è¯¢æ—¶å¢åŠ ä¸Šè¿™ä¸ªå­—æ®µçš„æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶
#### ï¼ˆ2ï¼‰åŸå§‹æ•°æ®å‹ç¼©
AI æ¥å£æ™®éè€…éƒ½æœ‰è¾“å…¥å­—æ•°å¤„é™åˆ¶ï¼Œå°½å¯èƒ½å‹ç¼©æ•°æ®ï¼Œçš„å¤Ÿå…è®¸å¤šä¼ ä¸€äº›æ•°æ®
ä½¿ç”¨csvå¯¹excelæ–‡ä»¶çš„æ•°æ®è¿›è¡Œæå–å’Œå‹ç¼©
[https://easyexcel.opensource.alibaba.com/docs/current/](https://easyexcel.opensource.alibaba.com/docs/current/)
å›åˆ°æ™ºèƒ½åˆ†æï¼Œç»§ç»­ä¿®æ”¹ã€‚ 
é¦–å…ˆï¼Œæ˜¯è·å–ç”¨æˆ·çš„è¾“å…¥å’Œ excel æ–‡ä»¶ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659305497-c4424865-7f04-4d1a-ad17-0bc1b22ddfe5.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_634%2Climit_0#averageHue=%23fbfaf9&from=url&id=MiU9w&originHeight=273&originWidth=634&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```
/**
 * æ™ºèƒ½åˆ†æ
 *
 * @param multipartFile
 * @param genChartByAiRequest
 * @param request
 * @return
 */
@PostMapping("/gen")
public BaseResponse<String> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                         GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
    String name = genChartByAiRequest.getName();
    String goal = genChartByAiRequest.getGoal();
    String chartType = genChartByAiRequest.getChartType();

    // æ ¡éªŒ
    // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
    ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
    // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
    ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");

    // è¯»å–åˆ°ç”¨æˆ·ä¸Šä¼ çš„ excel æ–‡ä»¶ï¼Œè¿›è¡Œä¸€ä¸ªå¤„ç†
    User loginUser = userService.getLoginUser(request);
    // æ–‡ä»¶ç›®å½•ï¼šæ ¹æ®ä¸šåŠ¡ã€ç”¨æˆ·æ¥åˆ’åˆ†
    String uuid = RandomStringUtils.randomAlphanumeric(8);
    String filename = uuid + "-" + multipartFile.getOriginalFilename();
    File file = null;
    try {

        // è¿”å›å¯è®¿é—®åœ°å€
        return ResultUtils.success("");
    } catch (Exception e) {
        //            log.error("file upload error, filepath = " + filepath, e);
        throw new BusinessException(ErrorCode.SYSTEM_ERROR, "ä¸Šä¼ å¤±è´¥");
    } finally {
        if (file != null) {
            // åˆ é™¤ä¸´æ—¶æ–‡ä»¶
            boolean delete = file.delete();
            if (!delete) {
                //                    log.error("file delete error, filepath = {}", filepath);
            }
        }
    }
}
```

 è¯»å–åˆ°ç”¨æˆ·ä¸Šä¼ çš„ excel æ–‡ä»¶ä¹‹åï¼Œè¿›è¡Œä¸€ä¸ªå¤„ç†ï¼Œè¦è¿›è¡Œä»€ä¹ˆå¤„ç†å‘¢ï¼Ÿ
ç”¨ chatGPT ä¹Ÿå¥½ï¼Œè¿˜æ˜¯ç”¨é±¼èªæ˜ï¼Œæ— è®ºä½¿ç”¨å“ªç§ AI æ¨¡å‹ï¼Œè¾“å…¥éƒ½æ˜¯æ•°æ®è€Œéæ–‡ä»¶ã€‚é‚£æ€ä¹ˆè¾“å…¥æ•°æ®å‘¢ï¼Ÿ
ps.AI æ¥å£æ™®ééƒ½æœ‰è¾“å…¥å­—æ•°é™åˆ¶ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å°½å¯èƒ½å‹ç¼©æ•°æ®ï¼Œèƒ½å¤Ÿå…è®¸å¤šä¼ ä¸€äº›æ•°æ®ã€‚
```
Alæè¯æŠ€å·§1:æŒç»­è¾“å…¥,æŒç»­ä¼˜åŒ–

ç¬¬ä¸€æ¬¡é—®:
æˆ‘ç»™ä½ ä¸‰è¡Œæ•°æ®ï¼Œè¯·å¸®æˆ‘åˆ†æç½‘ç«™çš„å¢é•¿è¶‹åŠ¿ï¼Œæ•°æ®å¦‚ä¸‹:
ç¬¬ä¸€è¡Œ:æ—¥æœŸ: 1å·, ç”¨æˆ·æ•°: 10äºº
ç¬¬äºŒè¡Œ:æ—¥æœŸ: 2å·ï¼Œç”¨æˆ·æ•°: 20äºº
ç¬¬ä¸‰è¡Œ:æ—¥æœŸ: 3å·ï¼Œç”¨æˆ·æ•°: 30äºº

Alç­”:
æ ¹æ®ç»™å‡ºçš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™ä¸ªç½‘ç«™çš„ç”¨æˆ·æ•°åœ¨ä¸‰å¤©å†…å‘ˆç°å¿«é€Ÿå¢é•¿çš„è¶‹åŠ¿ã€‚
å…·ä½“æ¥è¯´,è¯¥ç½‘ç«™ç”¨æˆ·æ•°ä»ç¬¬ä¸€å¤©çš„10äººå¢é•¿åˆ°ç¬¬äºŒå¤©çš„20äººï¼Œå¢åŠ äº†10äººï¼Œ
å¢é•¿ç‡ä¸º100%;ç›¸æ¯”ä¹‹ä¸‹,ç¬¬ä¸‰å¤©ç”¨æˆ·æ•°ä»ç¬¬äºŒå¤©çš„20äººå¢é•¿åˆ°ç¬¬ä¸‰å¤©çš„30äººï¼Œ
å¢åŠ äº†åŒæ ·çš„10äººï¼Œå¢é•¿ç‡é™è‡³50%ã€‚å¦‚æœè¿™ç§å¢é•¿è¶‹åŠ¿æŒç»­ä¸‹å»,æˆ‘ä»¬å¯ä»¥
é¢„æœŸè¯¥ç½‘ç«™åœ¨æœªæ¥å‡ å¤©å†…è¿˜ä¼šç»§ç»­å¸å¼•æ›´å¤šç”¨æˆ·ã€‚å½“ç„¶ï¼Œè‹¥è¦å¾—å‡ºæ›´åŠ å‡†ç¡®
çš„ç»“è®º,éœ€è¦æ›´å¤šæ•°æ®çš„æ”¯æŒã€‚
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
AIæè¯æŠ€å·§2:æ•°æ®å‹ç¼©(å†…å®¹å‹ç¼©ï¼Œæ¯”å¦‚æŠŠå¾ˆé•¿çš„å†…å®¹æå–å…³é”®è¯,ä¹Ÿå¯ä»¥è®©Alæ¥åš)

ç¬¬äºŒæ¬¡é—®:
æˆ‘ç»™ä½ ä¸‰è¡Œæ•°æ®ï¼Œè¯·å¸®æˆ‘åˆ†æç½‘ç«™çš„å¢é•¿è¶‹åŠ¿ï¼Œæ•°æ®å¦‚ä¸‹:
è¡¨å¤´:æ—¥æœŸ,ç”¨æˆ·æ•°
1å·,10
2å·,20
3å·,30

Alå›ç­”:
æ ¹æ®ç»™å‡ºçš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºæ¯æ—¥ç”¨æˆ·å¢é•¿é‡:
â— ç¬¬ä¸€å¤©å¢é•¿äº†10ä¸ªæ–°ç”¨æˆ·;
â— ç¬¬äºŒå¤©å¢é•¿äº†20 - 10=10ä¸ªæ–°ç”¨æˆ·;
â— ç¬¬ä¸‰å¤©å¢é•¿äº†30 - 20=10ä¸ªæ–°ç”¨æˆ·ã€‚
å¯ä»¥çœ‹å‡ºï¼Œæ¯å¤©çš„ç”¨æˆ·å¢é•¿é‡éƒ½ç›¸ç­‰ï¼Œå‘ˆç°ä¸€ä¸ªçº¿æ€§å¢é•¿è¶‹åŠ¿ã€‚å¦‚æœè¿™ä¸ªç½‘ç«™
åœ¨æœªæ¥çš„æ—¶é—´é‡Œèƒ½å¤Ÿä¿æŒç°åœ¨çš„å¢é•¿é€Ÿåº¦å’Œç­–ç•¥ä¸å˜,é¢„è®¡æ¯è¿‡ä¸€å¤©ä¼šå¢åŠ 10ä¸ª
ç”¨æˆ·ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯,è¿™ä¸ªé¢„æµ‹æ˜¯åŸºäºç›®å‰çš„æ•°æ®æƒ…å†µï¼Œå®é™…æƒ…å†µå—åˆ°è®¸å¤šå› 
ç´ çš„å½±å“ï¼Œä¸èƒ½å®Œå…¨å‡†ç¡®é¢„æµ‹æœªæ¥ç”¨æˆ·å¢é•¿ã€‚
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
ä½¿ç”¨Alå‹ç¼©

ç¬¬ä¸‰æ¬¡é—®:
æˆ‘ç»™ä½ ä¸‰è¡Œæ•°æ®ï¼Œè¯·å¸®æˆ‘ç”¨æœ€å°‘çš„å­—æ•°å‹ç¼©è¿™æ®µæ•°æ®
ç¬¬ä¸€è¡Œ:æ—¥æœŸ: 1å·, ç”¨æˆ·æ•°: 10äºº
ç¬¬äºŒè¡Œ:æ—¥æœŸ: 2å·ï¼Œç”¨æˆ·æ•°: 20äºº
ç¬¬ä¸‰è¡Œ:æ—¥æœŸ: 3å·ï¼Œç”¨æˆ·æ•°: 30äºº

Alå›ç­”:
æ—¥æœŸ1-3å·,ç”¨æˆ·æ•°åˆ†åˆ«ä¸º10/20/30äººã€‚
```
æˆ‘ä»¬éœ€è¦è¯»å–excelæ–‡ä»¶ï¼Œå¹¶ä¸”æŠŠå®ƒè½¬æˆcsvã€‚
å»å†™ä¸€ä¸ªå·¥å…·ç±»(excelè½¬csv)ï¼Œåœ¨com.yupi.springbootinit.utilsä¸‹åˆ›å»ºExcelUtils.javaã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659305850-dd4592c8-f89a-4483-a7c5-345c3b3e7f52.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_157%2Climit_0#averageHue=%23e7e5e3&from=url&id=JgzRp&originHeight=54&originWidth=157&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æ€ä¹ˆå¤„ç† excelï¼Ÿä½¿ç”¨csvå¯¹excelæ–‡ä»¶çš„æ•°æ®è¿›è¡Œæå–å’Œå‹ç¼© ğŸ‘‰[å¼€æºåº“](https://easyexcel.opensource.alibaba.com/docs/current/)
æˆ‘ä»¬è¯·æ±‚æ¥æ”¶çš„æ˜¯multipartFileã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659306207-4a6bb6de-40d5-47c8-8ec2-4457f670f7fd.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_612%2Climit_0#averageHue=%23faf9f7&from=url&id=SfR4W&originHeight=266&originWidth=612&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æŠŠå®ƒæ‹¿åˆ°å·¥å…·ç±»ä¸­(ä¸æ˜¯å‰ªåˆ‡åˆ°å·¥å…·ç±»ä¸­ï¼Œæ˜¯ä½¿ç”¨å®ƒ)ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659306718-412da731-8cba-491f-abd0-32e2414e9836.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_614%2Climit_0#averageHue=%23fbf9f7&from=url&id=GNWjP&originHeight=303&originWidth=614&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æ€ä¹ˆè¯» excelï¼Ÿæ¨¡æ¿é‡Œæœ‰ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659307044-2b3bf803-ee3b-4594-8324-37dc9ef69f32.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_619%2Climit_0#averageHue=%23f9f7f6&from=url&id=Fso3y&originHeight=361&originWidth=619&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æˆ–è€…çœ‹å®˜æ–¹æ–‡æ¡£ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659307486-3dfae28c-4c20-4c55-af7b-57d14c7e0419.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_624%2Climit_0#averageHue=%23bfc8b6&from=url&id=QepUS&originHeight=408&originWidth=624&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ç›´æ¥æŠŠæ¨¡æ¿é‡Œçš„ä»£ç å¤åˆ¶ï¼Œç²˜è´´è‡³ExcelUtils.javaï¼›
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659307934-f1662103-5e9c-4f85-a2f8-119bdb8827ef.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_624%2Climit_0#averageHue=%23fbfaf8&from=url&id=lQGuk&originHeight=406&originWidth=624&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æ¨¡æ¿é‡Œè¿˜æœ‰æµ‹è¯•ç”¨çš„ excel æ–‡ä»¶ï¼Œå¤åˆ¶è¿™ä¸ªæ–‡ä»¶ï¼Œç²˜è´´è‡³resourcesä¸‹ï¼Œå¹¶é‡å‘½åä¸ºç½‘ç«™æ•°æ®.xlsxã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659308366-2b242bce-643d-4fa1-9b38-bffbc5022b2f.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_620%2Climit_0#averageHue=%23d9d4bc&from=url&id=eXm9u&originHeight=211&originWidth=620&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ç»§ç»­ä¿®æ”¹å·¥å…·ç±»ã€‚
```
package com.yupi.springbootinit.utils;

import com.alibaba.excel.EasyExcel;
import com.alibaba.excel.support.ExcelTypeEnum;
import lombok.SneakyThrows;
import org.springframework.util.ResourceUtils;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.FileNotFoundException;
import java.util.List;
import java.util.Map;

/**
 * Excel ç›¸å…³å·¥å…·ç±»
 */
public class ExcelUtils {
    public static String excelToCsv(MultipartFile multipartFile) {
        File file = null;
        try {
            file = ResourceUtils.getFile("classpath:ç½‘ç«™æ•°æ®.xlsx");
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        }

        List<Map<Integer, String>> list = EasyExcel.read(file)
        .excelType(ExcelTypeEnum.XLSX)
        .sheet()
        .headRowNumber(0)
        .doReadSync();
        System.out.println(list);
        return "";
    }

    public static void main(String[] args) {
        excelToCsv(null);
    }
}
```
æŠŠç½‘ç«™æ•°æ®ä¿®æ”¹ä¸€ä¸‹ï¼Œè¿›å…¥resourcesä¸‹çš„ç½‘ç«™æ•°æ®.xlsxã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659308738-81025ac9-1f2e-4296-8e36-50f7558ee85e.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_308%2Climit_0#averageHue=%23e1bb7c&from=url&id=FeNv2&originHeight=242&originWidth=308&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æ‰“ä¸ªæ–­ç‚¹ï¼Œè¯•ä¸€ä¸‹èƒ½ä¸èƒ½è¯»å–å‡ºæ¥ï¼Œä»¥debugæ¨¡å¼å¯åŠ¨ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659309050-81fb879e-c0f5-4ebb-b80e-904790bc87c1.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_418%2Climit_0#averageHue=%23f7f4f2&from=url&id=pdywi&originHeight=261&originWidth=418&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å‘ç°æœ‰ 4 æ¡ null çš„æ•°æ®ï¼Œè¯´æ˜è¡¨æ ¼ä¸å¹²å‡€ï¼Œè¦è¿›è¡Œè¿‡æ»¤ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659309376-456aba57-5dcb-4a84-b79c-dfad3aae4e87.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_688%2Climit_0#averageHue=%23f5f4f3&from=url&id=MTdbW&originHeight=398&originWidth=688&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

**ä»£ç æ€è·¯(æ—¶é—´ç‚¹ 01:39:20-01:45:59)**
```
package com.yupi.springbootinit.utils;

import cn.hutool.core.collection.CollUtil;
import com.alibaba.excel.EasyExcel;
import com.alibaba.excel.support.ExcelTypeEnum;
import org.apache.commons.lang3.ObjectUtils;
import org.apache.commons.lang3.StringUtils;
import org.springframework.util.ResourceUtils;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.FileNotFoundException;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

/**
 * Excel ç›¸å…³å·¥å…·ç±»
 */
public class ExcelUtils {
    public static String excelToCsv(MultipartFile multipartFile) {
        File file = null;
        try {
            file = ResourceUtils.getFile("classpath:test_excel.xlsx");
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        }
        // è¯»å–æ•°æ®
        List<Map<Integer, String>> list = EasyExcel.read(file)
                .excelType(ExcelTypeEnum.XLSX)
                .sheet()
                .headRowNumber(0)
                .doReadSync();
        // å¦‚æœæ•°æ®ä¸ºç©º
        if (CollUtil.isEmpty(list)) {
            return "";
        }
        // è½¬æ¢ä¸º csv
        StringBuilder stringBuilder = new StringBuilder();
        // è¯»å–è¡¨å¤´(ç¬¬ä¸€è¡Œ)
        LinkedHashMap<Integer, String> headerMap = (LinkedHashMap) list.get(0);
        List<String> headerList = headerMap.values().stream().filter(ObjectUtils::isNotEmpty).collect(Collectors.toList());
        stringBuilder.append(StringUtils.join(headerList,","));
//        System.out.println(StringUtils.join(headerList,","));
        // è¯»å–æ•°æ®(è¯»å–å®Œè¡¨å¤´ä¹‹åï¼Œä»ç¬¬ä¸€è¡Œå¼€å§‹è¯»å–)
        for (int i = 1; i < list.size(); i++) {
            LinkedHashMap<Integer, String> dataMap = (LinkedHashMap) list.get(i);
            List<String> dataList = dataMap.values().stream().filter(ObjectUtils::isNotEmpty).collect(Collectors.toList());
            stringBuilder.append(StringUtils.join(dataList,","));
//            System.out.println(StringUtils.join(dataList,","));
        }
//        System.out.println(list);
        System.out.println(stringBuilder.toString());
        return stringBuilder.toString();
    }

    public static void main(String[] args) {
        excelToCsv(null);
    }
}
```

è¿è¡ŒExcelUtils.javaï¼Œçœ‹ä¸€ä¸‹æ•ˆæœï¼Œæ•°æ®é‡å·²ç»å¤§å¤§åœ°å‹ç¼©äº†ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659309960-43e876b5-e145-43f1-9d71-94de6b62db1a.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_684%2Climit_0#averageHue=%23f7f4f2&from=url&id=tM9wS&originHeight=576&originWidth=684&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å·²ç»æµ‹è¯•å®Œå‹ç¼©æµç¨‹ï¼Œå†æŠŠå¾—åˆ°çš„å­—ç¬¦ä¸²å†å®Œæ•´æ‹¼æ¥èµ·æ¥å°±å¥½äº†ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659310539-46008c1d-05c2-436d-a736-1b65919b102d.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_681%2Climit_0#averageHue=%23fbf8f6&from=url&id=KHr9H&originHeight=437&originWidth=681&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ç°åœ¨è¦çœŸå®åœ°æŠŠå®ƒç§»åˆ°æˆ‘ä»¬çš„è¯·æ±‚å¤„ç†ï¼Œå’±ä»¬å‰ç«¯è¯·æ±‚ä¼ æ¥çš„æ˜¯multipartFileï¼ŒæŠŠmultipartFileä¼ è¿›æ¥ï¼Œå…¶ä»–çš„ä¸œè¥¿å…ˆæ³¨é‡Šã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659311075-f2aac514-f3af-46e4-b067-567a8766251e.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_673%2Climit_0#averageHue=%23fbfaf9&from=url&id=YupHz&originHeight=350&originWidth=673&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```
/**
     * æ™ºèƒ½åˆ†æ
     *
     * @param multipartFile
     * @param genChartByAiRequest
     * @param request
     * @return
     */
    @PostMapping("/gen")
    public BaseResponse<String> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                             GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
        String name = genChartByAiRequest.getName();
        String goal = genChartByAiRequest.getGoal();
        String chartType = genChartByAiRequest.getChartType();

        // æ ¡éªŒ
        // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
        // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");
        // æŠŠmultipartFileä¼ è¿›æ¥ï¼Œå…¶ä»–çš„ä¸œè¥¿å…ˆæ³¨é‡Š
        String result = ExcelUtils.excelToCsv(multipartFile);
        return ResultUtils.success(result);
//        // è¯»å–åˆ°ç”¨æˆ·ä¸Šä¼ çš„ excel æ–‡ä»¶ï¼Œè¿›è¡Œä¸€ä¸ªå¤„ç†
//        User loginUser = userService.getLoginUser(request);
//        // æ–‡ä»¶ç›®å½•ï¼šæ ¹æ®ä¸šåŠ¡ã€ç”¨æˆ·æ¥åˆ’åˆ†
//        String uuid = RandomStringUtils.randomAlphanumeric(8);
//        String filename = uuid + "-" + multipartFile.getOriginalFilename();
//        File file = null;
//        try {
//
//            // è¿”å›å¯è®¿é—®åœ°å€
//            return ResultUtils.success("");
//        } catch (Exception e) {
////            log.error("file upload error, filepath = " + filepath, e);
//            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "ä¸Šä¼ å¤±è´¥");
//        } finally {
//            if (file != null) {
//                // åˆ é™¤ä¸´æ—¶æ–‡ä»¶
//                boolean delete = file.delete();
//                if (!delete) {
////                    log.error("file delete error, filepath = {}", filepath);
//                }
//            }
//        }
    }
```
ç„¶åè¦æŠŠmultipartFileçœŸå®åœ°è¿ç”¨ä¸Šï¼Œä¹‹å‰è¯»çš„æ˜¯æœ¬åœ°æ–‡ä»¶ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659311556-68e5732c-e592-4d9a-be98-7c989db3943a.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_672%2Climit_0#averageHue=%23fbfaf8&from=url&id=D9VE8&originHeight=437&originWidth=672&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```
package com.yupi.springbootinit.utils;

import cn.hutool.core.collection.CollUtil;
import com.alibaba.excel.EasyExcel;
import com.alibaba.excel.support.ExcelTypeEnum;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.ObjectUtils;
import org.apache.commons.lang3.StringUtils;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;


/**
 * Excel ç›¸å…³å·¥å…·ç±»
 */
@Slf4j
public class ExcelUtils {
    /**
     * excel è½¬ csv
     *
     * @param multipartFile
     * @return
     */
    public static String excelToCsv(MultipartFile multipartFile) {
//        File file = null;
//        try {
//            file = ResourceUtils.getFile("classpath:ç½‘ç«™æ•°æ®.xlsx");
//        } catch (FileNotFoundException e) {
//            e.printStackTrace();
//        }
        // è¯»å–æ•°æ®
        List<Map<Integer, String>> list = null;
        try {
            list = EasyExcel.read(multipartFile.getInputStream())
                    .excelType(ExcelTypeEnum.XLSX)
                    .sheet()
                    .headRowNumber(0)
                    .doReadSync();
        } catch (IOException e) {
            log.error("è¡¨æ ¼å¤„ç†é”™è¯¯", e);
        }
        // å¦‚æœæ•°æ®ä¸ºç©º
        if (CollUtil.isEmpty(list)) {
            return "";
        }
        // è½¬æ¢ä¸º csv
        StringBuilder stringBuilder = new StringBuilder();
        // è¯»å–è¡¨å¤´(ç¬¬ä¸€è¡Œ)
        LinkedHashMap<Integer, String> headerMap = (LinkedHashMap) list.get(0);
        List<String> headerList = headerMap.values().stream().filter(ObjectUtils::isNotEmpty).collect(Collectors.toList());
        stringBuilder.append(StringUtils.join(headerList, ",")).append("\n");
        // è¯»å–æ•°æ®(è¯»å–å®Œè¡¨å¤´ä¹‹åï¼Œä»ç¬¬ä¸€è¡Œå¼€å§‹è¯»å–)
        for (int i = 1; i < list.size(); i++) {
            LinkedHashMap<Integer, String> dataMap = (LinkedHashMap) list.get(i);
            List<String> dataList = dataMap.values().stream().filter(ObjectUtils::isNotEmpty).collect(Collectors.toList());
            stringBuilder.append(StringUtils.join(dataList, ",")).append("\n");
        }
        return stringBuilder.toString();
    }

    public static void main(String[] args) {
            excelToCsv(null);
    }
}
```
ä»¥debugæ¨¡å¼å¯åŠ¨é¡¹ç›®ï¼Œæ‰“ä¸ªæ–­ç‚¹ï¼Œè®¿é—® [http://localhost:8080/api/doc.html](http://localhost:8080/api/doc.html)ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659312080-7b0b92e5-c021-4fa8-be4e-81d00179e71d.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_669%2Climit_0#averageHue=%23f5f4f2&from=url&id=Tvpqa&originHeight=537&originWidth=669&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
é€‰æ‹©åœ¨é¡¹ç›®é‡Œçš„ç½‘ç«™æ•°æ®.xlsxï¼Œç±»å‹è®¾ç½®ä¸ºé›·è¾¾å›¾ï¼Œç›®æ ‡è®¾ç½®ä¸ºåˆ†æç½‘ç«™ç”¨æˆ·ï¼Œå›¾è¡¨åç§°ä¸ºç½‘ç«™ç”¨æˆ·è¶‹åŠ¿ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659312500-91c6cf09-5803-4175-85e5-bb91462ac3e6.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_672%2Climit_0#averageHue=%23bfb6a6&from=url&id=b8EM5&originHeight=313&originWidth=672&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
è¯·æ±‚è¿›æ¥äº†ï¼Œå‚æ•°æ‹¿åˆ°äº†ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659312826-72fe1cb4-6d1f-4652-b856-145db17cf28c.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_675%2Climit_0#averageHue=%23f7f6f4&from=url&id=tFZoo&originHeight=354&originWidth=675&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå“åº”å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659313383-84f3fa0e-c955-4770-999b-82ba5472009d.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_680%2Climit_0#averageHue=%23fbfbfb&from=url&id=PEn2A&originHeight=430&originWidth=680&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æå®šğŸ¥³
#### ï¼ˆ3ï¼‰è°ƒç”¨AI

1. ç”¨æˆ·è¾“å…¥
2. ç³»ç»Ÿé¢„è®¾ï¼ˆæå‰å‘Šè¯‰ä¹ŸèŒè´£ã€åŠŸèƒ½ã€å›å¤æ ¼å¼è¦æ±‚ï¼‰+åˆ†æç›®æ ‡+å‹ç¼©åçš„æ•°æ®
3. æœ€ç®€å•çš„ç³»ç»Ÿé¢„è®¾ï¼šä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æåˆŠå¸ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šç»™ä½ æˆ‘çš„åˆ†æç›®æ ‡å’ŒåŸå§‹æ•°æ®ï¼Œè¯·å‘Šè¯‰æˆ‘åˆ†æç»“è®ºã€‚

ps.å»ºè®®å¬ä¸€ä¸‹å›æ”¾æ€è·¯
æ¥ä¸‹æ¥æ€ä¹ˆä½¿ç”¨ AI æ¥ç”Ÿæˆç»“è®ºã€å›¾è¡¨ï¼Ÿ
ç»“è®ºä¹‹å‰å·²ç»è®¨è®ºè¿‡äº†ï¼Œå°±æ˜¯æŠŠæ•°æ®ç»™ AIï¼Œå†æ‹¼æ¥ç”¨æˆ·çš„åˆ†æç›®æ ‡ã€‚
ç°åœ¨æŠŠç³»ç»Ÿé¢„è®¾ä»¥æ–‡æœ¬å½¢å¼æ‹¼æ¥ï¼Œå» ChartController.java ç¼–å†™ç›¸åº”ä»£ç ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659313739-9dcf5e91-6974-4264-954d-d42336655b71.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_702%2Climit_0#averageHue=%23faf7f5&from=url&id=jSMi6&originHeight=409&originWidth=702&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å¦‚æœç›´æ¥ä½¿ç”¨openAIï¼Œå¯ä»¥æŠŠå®ƒä½œä¸ºç³»ç»Ÿå‚æ•°ä¼ è¿›æ¥ï¼Œç°åœ¨è¿™ä¸ªæ¨¡å‹æ˜¯ğŸŸå°è£…å¥½çš„ï¼Œä¹‹åéœ€è¦åšè¿™æ ·ä¸€ä¸ªæ¨¡å‹ï¼Œç›´æ¥æŠŠé¢„è®¾å†™åœ¨è¿™é‡Œï¼Œå»è°ƒç”¨å¯¹åº”çš„æ¨¡å‹å³å¯(å¦‚ä¸‹å›¾æ‰€ç¤º)ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659314196-9739a357-1da4-476a-a5dd-324529086211.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_702%2Climit_0#averageHue=%23fafafa&from=url&id=oeKJL&originHeight=293&originWidth=702&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

```
/**
     * æ™ºèƒ½åˆ†æ
     *
     * @param multipartFile
     * @param genChartByAiRequest
     * @param request
     * @return
     */
    @PostMapping("/gen")
    public BaseResponse<String> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                             GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
        String name = genChartByAiRequest.getName();
        String goal = genChartByAiRequest.getGoal();
        String chartType = genChartByAiRequest.getChartType();

        // æ ¡éªŒ
        // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
        // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");

        // ç”¨æˆ·è¾“å…¥
        StringBuilder userInput = new StringBuilder();
        userInput.append("ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šç»™ä½ æˆ‘çš„åˆ†æç›®æ ‡å’ŒåŸå§‹æ•°æ®ï¼Œè¯·å‘Šè¯‰æˆ‘åˆ†æç»“è®ºã€‚").append("\n");
        userInput.append("åˆ†æç›®æ ‡ï¼š").append(goal).append("\n");

        // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼Œå…¶ä»–çš„ä¸œè¥¿å…ˆæ³¨é‡Šï¼‰
        String result = ExcelUtils.excelToCsv(multipartFile);
        userInput.append("æ•°æ®ï¼š").append(result).append("\n");
        return ResultUtils.success(userInput.toString());
//        // è¯»å–åˆ°ç”¨æˆ·ä¸Šä¼ çš„ excel æ–‡ä»¶ï¼Œè¿›è¡Œä¸€ä¸ªå¤„ç†
//        User loginUser = userService.getLoginUser(request);
//        // æ–‡ä»¶ç›®å½•ï¼šæ ¹æ®ä¸šåŠ¡ã€ç”¨æˆ·æ¥åˆ’åˆ†
//        String uuid = RandomStringUtils.randomAlphanumeric(8);
//        String filename = uuid + "-" + multipartFile.getOriginalFilename();
//        File file = null;
//        try {
//
//            // è¿”å›å¯è®¿é—®åœ°å€
//            return ResultUtils.success("");
//        } catch (Exception e) {
////            log.error("file upload error, filepath = " + filepath, e);
//            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "ä¸Šä¼ å¤±è´¥");
//        } finally {
//            if (file != null) {
//                // åˆ é™¤ä¸´æ—¶æ–‡ä»¶
//                boolean delete = file.delete();
//                if (!delete) {
////                    log.error("file delete error, filepath = {}", filepath);
//                }
//            }
//        }
    }
```
å†æ¬¡å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—® http://localhost:8080/api/doc.htmlï¼Œè¿”å›ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659314499-40f8b372-23e6-4077-afa3-3a3ba786e93c.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_700%2Climit_0#averageHue=%23b9b1a0&from=url&id=K1fFF&originHeight=377&originWidth=700&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
é±¼èªæ˜é¢„è®¾æ•ˆæœé¢„è§ˆï¼š
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684659315109-748ef826-bb7b-4a3a-b133-1e4d09035db0.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_696%2Climit_0#averageHue=%23b5bab8&from=url&id=QmdEc&originHeight=365&originWidth=696&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
### 2.2 AI æè¯æŠ€å·§
#### 1ã€Aæè¯æŠ€å·§1ï¼šæŒç»­è¾“å…¥ï¼ŒæŒç»­ä¼˜åŒ–
ç¬¬ä¸€æ¬¡é—®ï¼š
æˆ‘ç»™ä½ ä¸‰è¡Œæ•°æ®ï¼Œè¯·å¸®æˆ‘åˆ†æç½‘ç«™çš„å¢é•¿è¶‹åŠ¿ï¼Œæ•°æ®å¦‚ä¸‹ï¼š
ç¬¬ä¸€è¡Œï¼šæ—¥æœŸï¼š1å·ï¼Œç”¨æˆ·æ•°ï¼š10äºº
ç¬¬äºŒè¡Œï¼šæ—¥æœŸï¼š2å·ï¼Œç”¨æˆ·æ•°ï¼š20äºº
ç¬¬ä¸‰è¡Œï¼šæ—¥æœŸï¼š3å·ï¼Œç”¨æˆ·æ•°ï¼š30äºº
AIç­”ï¼š
æ ¹æ®ç»™å‡ºçš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™ä¸ªç½‘ç«™çš„ç”¨æˆ·æ•°åœ¨ä¸‰å¤©å†…å‘ˆç°å¿«é€Ÿå¢é•¿çš„è¶‹åŠ¿ã€‚å…·ä½“æ¥è¯´ï¼Œè¯¥ç½‘ç«™ç”¨æˆ·æ•°ä»ç¬¬ä¸€å¤©çš„10äººå¢é•¿åˆ°ç¬¬äºŒå¤©çš„20äººï¼Œå¢å‹–åŠ äº†10äººï¼Œå¢é•¿ç‡100%ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼Œç¬¬ä¸‰å¤©ç”¨æˆ·æ•°ä»ç¬¬äºŒå¤©çš„20äººå¢é•¿åˆ°ç¬¬ä¸‰å¤©çš„30äººï¼Œå¢åŠ äº†åŒæ ·çš„10äººï¼Œå¢é•¿ç‡é™è‡³50%ã€‚å¦‚æœè¿™ç§å¢é•¿è¶‹åŠ¿ç‰¹ç»­ä¸‹å»ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æœŸè¯¥ç½‘ç«™åœ¨æœªæ¥å‡ å¤©å†…è¿˜ä¼šç»§ç»­å¸å¼•æ›´å¤šç”¨æˆ·ã€‚å½“ç„¶ï¼Œè‹¥è¦å¾—å‡ºæ›´åŠ å‡†ç¡®çš„ç»“è®ºï¼Œéœ€è¦æ›´å¤šæ•°æ®çš„æ”¯æŒã€‚

#### 2ã€AIæè¯æŠ€å·§2ï¼šæ•°æ®å‹ç¼©ï¼ˆå†…å®¹å‹ç¼©ï¼Œæ¯”å¦‚æŠŠå¾ˆé•¿çš„å†…å®¹æå–å…³é”®è¯ï¼Œä¹Ÿå¯ä»¥è®©AIæ¥æ•…ï¼‰
æˆ‘ç»™ä½ ä¸‰è¡Œæ•°æ®ï¼Œè¯·å¸®æˆ‘åˆ†æç½‘ç«™çš„å¢é•¿è¶‹åŠ¿ï¼Œæ•°æ®å¦‚ä¸‹ï¼š
è¡¨å¤´ï¼šæ—¥æœŸï¼Œç”¨æˆ·æ•°
1å·ï¼Œ10
2å·ï¼Œ20
3å·ï¼Œ30

AIå›ç­”ï¼š
æ ¹æ®ç»™å‡ºçš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºæ¯æ—¥ç”¨æˆ·å¢é•¿é‡ï¼š

- ç¬¬ä¸€å¤©å¢é•¿äº†10ä¸ªæ–°ç”¨æˆ·ï¼›
- ç¬¬äºŒå¤©å¢é•¿äº†20-10=10ä¸ªæ–°ç”¨æˆ·ï¼›
- ç¬¬ä¸‰å¤©å¢é•¿äº†30-20=10ä¸ªæ–°ç”¨æˆ·ã€‚

å¯ä»¥çœ‹å‡ºï¼Œæ¯å¤©çš„ç”¨æˆ·å¢é•¿é‡éƒ½ç›¸ç­‰ï¼Œå‘ˆç°ä¸€ä¸ªçº¿æ€§å¢é•¿è¶‹åŠ¿ã€‚å¦‚æœè¿™ä¸ªç½‘ç«™åœ¨æœªæ¥çš„æ—¶é—´é‡Œèƒ½å¤Ÿä¿æŒç°åœ¨çš„å¢é•¿é€Ÿåº¦å’Œç­–ç•¥ä¸å˜ï¼Œé¢„è®¡æ¯è¿‡ä¸€å¤©ä¼šå¢å‹–åŠ 10ä¸ªç”¨æˆ·ã€‚ä½†éœ€è¦æ³¨æ„
çš„æ˜¯ï¼Œè¿™ä¸ªé¢„æµ‹æ˜¯åŸºäºç›®å‰çš„æ•°æ®æƒ…å†µï¼Œå®é™…æƒ…å†µä¼šå—åˆ°è®¸å¤šå› ç´ çš„å“ï¼Œä¸å®Œå…¨å‡†ç¡®é¢„æµ‹æœªæ¥ç”¨æˆ·å¢é•¿ã€‚
ä½¿ç”¨AIæ¥å‹ç¼©ï¼š
é—®ï¼šæˆ‘ç»™ä½ ä¸‰è¡Œæ•°æ®ï¼Œè¯·å¸®æˆ‘ç”¨æœ€å°‘çš„å­—æ•°å‹ç¼©è¿™è®¾æ•°æ®
ç¬¬ä¸€è¡Œï¼šæ—¥æœŸï¼š1å·ï¼Œç”¨æˆ·æ•°ï¼š10äººç¬¬äºŒè¡Œï¼šæ—¥æœŸï¼š2å·ï¼Œç”¨æˆ·æ•°ï¼š20äººç¬¬ä¸‰è¡Œï¼šæ—¥æœŸï¼š3å·ï¼Œç”¨æˆ·æ•°ï¼š30äºº
ç­”ï¼šæ—¥æœŸ1-3å·ï¼Œç”¨æˆ·æ•°åˆ†åˆ«ä¸º10/20/30äººã€‚
#### 3ã€AI æè¯æŠ€å·§3ï¼šåœ¨ç³»ç»Ÿï¼ˆæ¨¡å‹ï¼‰å±‚é¢åšå¦¤é¢„è®¾æ•ˆæœä¸€è‚¡æ¥è¯´ï¼Œä¼šæ¯”ç›´æ¥æ‹¼æ¥åœ¨ç”¨æˆ·æ¶ˆæ¯é‡Œæ•ˆæœæ›´å¥½ä¸€äº›ã€‚

#### 4ã€AIæè¯æŠ€å·§4ï¼šé™¤äº†ç³»ç»Ÿé¢„è®¾å¤–ï¼Œé¢å¤–å…³è”ä¸€é—®ä¸€ç­”ä¸¤æ¡æ¶ˆæ¯ï¼Œç›¸å½“äºç»™A!ä¸€ä¸ªæç¤ºã€‚
# ç¬¬ä¸‰æœŸç›´æ’­ - æ™ºèƒ½åˆ†æä¸šåŠ¡æµç¨‹å¼€å‘
## 1ã€AIç”Ÿæˆå†…å®¹
[é±¼èªæ˜](https://www.yucongming.com/)
å®ä¾‹ï¼š
> ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆï¼Œè¯·å¸®æˆ‘åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿è¶‹åŠ¿
åŸå§‹æ•°æ®å¦‚ä¸‹ï¼š
æ—¥æœŸï¼Œç”¨æˆ·æ•°
1å·ï¼Œ10
2å·ï¼Œ20
3å·ï¼Œ30

AIå›ç­”ï¼šï¼ˆå›¾ç‰‡åŠ è½½ä¸å‡ºæ¥çš„ï¼‰
### 1.1 AIç”Ÿæˆå›¾è¡¨
AIæ— æ³•ç›´æ¥ç”Ÿæˆç°æˆçš„å›¾è¡¨ï¼Œä½†æ˜¯A!å¯ä»¥ç”Ÿæˆå›¾è¡¨ä»£ç =>å¯ä»¥æŠŠä»£ç åˆ©ç”¨å‰ç«¯çš„ç»„ä»¶åº“([Echarts](https://echarts.apache.org/zh/index.html))åœ¨ç½‘é¡µè¿›è¡Œå±•ç¤º
[Echartsåœ¨çº¿è°ƒç”¨](https://echarts.apache.org/examples/zh/editor.html?c=line-simple)
#### 1.1.1 AIæé—®æŠ€å·§
å¦‚æœå¾—è¦è®© AI æ›´å¥½åœ°ç†è§£æˆ‘ä»¬çš„è¾“å…¥ï¼Œç»™æˆ‘ä»¬é¢„æœŸçš„ã€ç²¾ç¡®æ ¼å¼çš„è¾“å‡ºï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸¥æ ¼æ§åˆ¶å’±ä»¬çš„æé—®è¯ã€‚

1.  ä½¿ç”¨ç³»ç»Ÿé¢„è®¾ + æ§åˆ¶è¾“å…¥æ ¼å¼(ä¾¿äºAlç²¾ç¡®åœ°ç†è§£æˆ‘ä»¬çš„éœ€æ±‚)
2.  æ§åˆ¶è¾“å…¥æ ¼å¼ï¼ˆä¾¿äºA!ç²¾ç¡®åœ°ç†è§£æˆ‘ä»¬çš„éœ€æ±‚ï¼‰ 


ç”¨æˆ·æé—®ï¼š 
```java
åˆ†æéœ€æ±‚ï¼š
åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
åŸå§‹æ•°æ®ï¼š
æ—¥æœŸ,ç”¨æˆ·æ•°
1å·,10
2å·,20
3å·,30
```

3.  æ§åˆ¶è¾“å‡ºæ ¼å¼ï¼ˆä¾¿äºAIè¿”å›çš„å†…å®¹èƒ½å¤Ÿæ›´åŠ æ–¹ä¾¿åœ°ä¸ºæˆ‘ä»¬æ‰€ç”¨ï¼‰
Prompté¢„è®¾ï¼š 
```
ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆå’Œå‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§ä»¥ä¸‹å›ºå®šæ ¼å¼ç»™ä½ æä¾›å†…å®¹ï¼š
åˆ†æéœ€æ±‚ï¼š
{æ•°æ®åˆ†æçš„éœ€æ±‚æˆ–è€…ç›®æ ‡}
åŸå§‹æ•°æ®ï¼š
{csvæ ¼å¼çš„åŸå§‹æ•°æ®ï¼Œç”¨,ä½œä¸ºåˆ†éš”ç¬¦}
è¯·æ ¹æ®è¿™ä¸¤éƒ¨åˆ†å†…å®¹ï¼ŒæŒ‰ç…§ä»¥ä¸‹æŒ‡å®šæ ¼å¼ç”Ÿæˆå†…å®¹ï¼ˆæ­¤å¤–ä¸è¦è¾“å‡ºä»»ä½•å¤šä½™çš„å¼€å¤´ã€ç»“å°¾ã€æ³¨é‡Šï¼‰
ã€ã€ã€ã€ã€
{å‰ç«¯ Echarts V5 çš„ option é…ç½®å¯¹è±¡çš„jsonæ ¼å¼ä»£ç ï¼Œåˆç†åœ°å°†æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œä¸è¦ç”Ÿæˆä»»ä½•å¤šä½™çš„å†…å®¹ï¼Œæ¯”å¦‚æ³¨é‡Š}
ã€ã€ã€ã€ã€
{æ˜ç¡®çš„æ•°æ®åˆ†æç»“è®ºã€è¶Šè¯¦ç»†è¶Šå¥½ï¼Œä¸è¦ç”Ÿæˆå¤šä½™çš„æ³¨é‡Š}
```
```java
ã€ã€ã€ã€ã€
{
    title: {
        text: 'ç½‘ç«™ç”¨æˆ·å¢é•¿æƒ…å†µ',
        subtext: ''
        },
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            type: 'shadow'
            }
    },
    legend: {
        data: ['ç”¨æˆ·æ•°']
        },
    xAxis: {
        data: ['1å·', '2å·', '3å·']
    },
    yAxis: {},
    series: [{
        name: 'ç”¨æˆ·æ•°',
        type: 'bar',
        data: [10, 20, 30]
    }]
}
ã€ã€ã€ã€ã€
æ ¹æ®æ•°æ®åˆ†æå¯å¾—ï¼Œè¯¥ç½‘ç«™ç”¨æˆ·æ•°é‡é€æ—¥å¢é•¿ï¼Œæ—¶é—´è¶Šé•¿ï¼Œç”¨æˆ·æ•°é‡å¢é•¿è¶Šå¤šã€‚
```

ç”¨æˆ·è¾“å…¥ï¼š 
```
åˆ†æéœ€æ±‚ï¼š
åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
åŸå§‹æ•°æ®ï¼š
æ—¥æœŸï¼Œç”¨æˆ·æ•°
1å·ï¼Œ10
2å·ï¼Œ20
3å·ï¼Œ30
```
ç”Ÿæˆçš„å†…å®¹ï¼š 
å°†ä¸Šé¢çš„ä»£ç å¤åˆ¶åˆ°Echartsæ‰§è¡Œï¼š
![](http://picgo.kongshier.top/typoraImages/image-20230521100605786.png#id=xsK9t&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

4.  æŒ‡å®šä¸€ä¸ªç¤ºä¾‹é—®ç­”ï¼Œone-shotæˆ–è€…few-shot
### 1.2 è°ƒç”¨ AI æ–¹å¼
```java
final String prompt = "ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆå’Œå‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§ä»¥ä¸‹å›ºå®šæ ¼å¼ç»™ä½ æä¾›å†…å®¹ï¼š\n" +
                "åˆ†æéœ€æ±‚ï¼š\n" +
                "{æ•°æ®åˆ†æçš„éœ€æ±‚æˆ–è€…ç›®æ ‡}\n" +
                "åŸå§‹æ•°æ®ï¼š\n" +
                "{csvæ ¼å¼çš„åŸå§‹æ•°æ®ï¼Œç”¨,ä½œä¸ºåˆ†éš”ç¬¦}\n" +
                "è¯·æ ¹æ®è¿™ä¸¤éƒ¨åˆ†å†…å®¹ï¼ŒæŒ‰ç…§ä»¥ä¸‹æŒ‡å®šæ ¼å¼ç”Ÿæˆå†…å®¹ï¼ˆæ­¤å¤–ä¸è¦è¾“å‡ºä»»ä½•å¤šä½™çš„å¼€å¤´ã€ç»“å°¾ã€æ³¨é‡Šï¼‰\n" +
                "ã€ã€ã€ã€ã€\n" +
                "{å‰ç«¯ Echarts V5 çš„ option é…ç½®å¯¹è±¡çš„jsonæ ¼å¼ä»£ç ï¼Œåˆç†åœ°å°†æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œä¸è¦ç”Ÿæˆä»»ä½•å¤šä½™çš„å†…å®¹ï¼Œæ¯”å¦‚æ³¨é‡Š}\n" +
                "ã€ã€ã€ã€ã€\n" +
                "{æ˜ç¡®çš„æ•°æ®åˆ†æç»“è®ºã€è¶Šè¯¦ç»†è¶Šå¥½ï¼Œä¸è¦ç”Ÿæˆå¤šä½™çš„æ³¨é‡Š}";
```
```java
/**
 * æ™ºèƒ½åˆ†æ
 *
 * @param multipartFile
 * @param genChartByAiRequest
 * @param request
 * @return
 */
@PostMapping("/gen")
public BaseResponse<String> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                         GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
    String name = genChartByAiRequest.getName();
    String goal = genChartByAiRequest.getGoal();
    String chartType = genChartByAiRequest.getChartType();

    // æ ¡éªŒ
    // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
    ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
    // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
    ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");

    final String prompt = "ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆå’Œå‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§ä»¥ä¸‹å›ºå®šæ ¼å¼ç»™ä½ æä¾›å†…å®¹ï¼š\n" +
            "åˆ†æéœ€æ±‚ï¼š\n" +
            "{æ•°æ®åˆ†æçš„éœ€æ±‚æˆ–è€…ç›®æ ‡}\n" +
            "åŸå§‹æ•°æ®ï¼š\n" +
            "{csvæ ¼å¼çš„åŸå§‹æ•°æ®ï¼Œç”¨,ä½œä¸ºåˆ†éš”ç¬¦}\n" +
            "è¯·æ ¹æ®è¿™ä¸¤éƒ¨åˆ†å†…å®¹ï¼ŒæŒ‰ç…§ä»¥ä¸‹æŒ‡å®šæ ¼å¼ç”Ÿæˆå†…å®¹ï¼ˆæ­¤å¤–ä¸è¦è¾“å‡ºä»»ä½•å¤šä½™çš„å¼€å¤´ã€ç»“å°¾ã€æ³¨é‡Šï¼‰\n" +
            "ã€ã€ã€ã€ã€\n" +
            "{å‰ç«¯ Echarts V5 çš„ option é…ç½®å¯¹è±¡çš„jsonæ ¼å¼ä»£ç ï¼Œåˆç†åœ°å°†æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œä¸è¦ç”Ÿæˆä»»ä½•å¤šä½™çš„å†…å®¹ï¼Œæ¯”å¦‚æ³¨é‡Š}\n" +
            "ã€ã€ã€ã€ã€\n" +
            "{æ˜ç¡®çš„æ•°æ®åˆ†æç»“è®ºã€è¶Šè¯¦ç»†è¶Šå¥½ï¼Œä¸è¦ç”Ÿæˆå¤šä½™çš„æ³¨é‡Š}";


    // ç”¨æˆ·è¾“å…¥
    StringBuilder userInput = new StringBuilder();
    userInput.append("ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šç»™ä½ æˆ‘çš„åˆ†æç›®æ ‡å’ŒåŸå§‹æ•°æ®ï¼Œè¯·å‘Šè¯‰æˆ‘åˆ†æç»“è®ºã€‚").append("\n");
    userInput.append("åˆ†æç›®æ ‡ï¼š").append(goal).append("\n");

    // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼Œå…¶ä»–çš„ä¸œè¥¿å…ˆæ³¨é‡Šï¼‰
    String result = ExcelUtils.excelToCsv(multipartFile);
    userInput.append("æ•°æ®ï¼š").append(result).append("\n");
    return ResultUtils.success(userInput.toString());
//        // è¯»å–åˆ°ç”¨æˆ·ä¸Šä¼ çš„ excel æ–‡ä»¶ï¼Œè¿›è¡Œä¸€ä¸ªå¤„ç†
//        User loginUser = userService.getLoginUser(request);
//        // æ–‡ä»¶ç›®å½•ï¼šæ ¹æ®ä¸šåŠ¡ã€ç”¨æˆ·æ¥åˆ’åˆ†
//        String uuid = RandomStringUtils.randomAlphanumeric(8);
//        String filename = uuid + "-" + multipartFile.getOriginalFilename();
//        File file = null;
//        try {
//
//            // è¿”å›å¯è®¿é—®åœ°å€
//            return ResultUtils.success("");
//        } catch (Exception e) {
////            log.error("file upload error, filepath = " + filepath, e);
//            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "ä¸Šä¼ å¤±è´¥");
//        } finally {
//            if (file != null) {
//                // åˆ é™¤ä¸´æ—¶æ–‡ä»¶
//                boolean delete = file.delete();
//                if (!delete) {
////                    log.error("file delete error, filepath = {}", filepath);
//                }
//            }
//        }
}
```
#### 1ã€ç›´æ¥è°ƒç”¨OpenAIæˆ–è€…å…¶ä»– AI åŸå§‹æ¨¡å‹å®˜ç½‘çš„æ¥å£
æ¯”å¦‚OpenAlæˆ–è€…å…¶ä»–AlåŸå§‹å¤§æ¨¡å‹å®˜ç½‘çš„æ¥å£
å®˜æ–¹æ–‡æ¡£ï¼š[https://platform.openai.com/docs/api-reference](https://platform.openai.com/docs/api-reference)
ä¼˜ç‚¹ï¼šä¸ç»å°è£…ï¼Œæœ€çµæ´»ï¼Œæœ€åŸå§‹
ç¼ºç‚¹ï¼šè¦é’±ã€è¦é­”æ³•
æœ¬è´¨ä¸ŠOpenAlå°±æ˜¯æä¾›äº†HTTPæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»»ä½•è¯­è¨€å»è°ƒç”¨

1.  åœ¨è¯·æ±‚å¤´ä¸­æŒ‡å®š OPENAI_API_KEY â†’ Authorization: Bearer OPENAI_API_KEY

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684931399566-570ae31f-99ac-43fb-8d60-91d6515e9209.png#averageHue=%23ececeb&from=url&id=QIny9&originHeight=452&originWidth=1263&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å¦åˆ™å®ƒä¼šæç¤ºä½ æ²¡æœ‰æƒé™è°ƒç”¨ã€‚

2.  æ‰¾åˆ°ä½ è¦ä½¿ç”¨çš„æ¥â˜ï¼Œæ¯”å¦‚Alå¯¹è¯æ¥å£ï¼š[https://platform.openai.com/docs/api-reference/chat/create](https://platform.openai.com/docs/api-reference/chat/create) 

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1718092065473-96426a9a-3009-4296-b5b4-c251e4b5f41a.png#averageHue=%23d5d5d5&clientId=u3d84c29e-7367-4&from=paste&height=813&id=u912018a4&originHeight=976&originWidth=1903&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=181961&status=done&style=none&taskId=u22342763-6c4f-48bf-85cd-7d4735c7b03&title=&width=1585.8332703179808)

3.  æŒ‰ç…§æ¥å£æ–‡æ¡£çš„ç¤ºä¾‹ï¼Œæ„é€ HTTPè¯·æ±‚ï¼Œæ¯”å¦‚ç”¨Hutoolå·¥å…·ç±»ã€æˆ–è€…HTTPClient 
```java
/**
 * AI å¯¹è¯ï¼ˆéœ€è¦è‡ªå·±åˆ›å»ºè¯·æ±‚å“åº”å¯¹è±¡ï¼‰
 *
 * @param request
 * @param openAiApiKey
 * @return
 */
public CreateChatCompletionResponse createChatCompletion(CreateChatCompletionRequest request, String openAiApiKey) { 
    if (StringUtils.isBlank(openAiApiKey)) {
     	throw new BusinessException(ErrorCode.PARAMS_ERROR, "æœªä¼  openAiApiKey");
     }
     String url = "https://api.openai.com/v1/chat/completions";
     String json = JSONUtil.toJsonStr(request);
     String result = HttpRequest.post(url)
                                 .header("Authorization", "Bearer " + openAiApiKey)
                                 .body(json)
                                 .execute()
                                 .body();
     return JSONUtil.toBean(result, CreateChatCompletionResponse.class);
}
```
æœ€ç»ˆç»“æœå¯èƒ½è¿”å›ä»¥ä¸‹å†…å®¹ï¼š
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684931619992-c0e6f326-93c9-43f5-8010-9ab1d863271c.png#averageHue=%23222527&from=url&id=n3u7b&originHeight=576&originWidth=645&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
#### 2ã€ä½¿ç”¨äº‘æœåŠ¡å•†æä¾›çš„å°è£…æ¥å£
æ¯”å¦‚ï¼šAzureäº‘
ä¼˜ç‚¹ï¼šæœ¬åœ°éƒ½ç”¨
ç¼ºç‚¹ï¼šä¾ç„¶è¦é’±ï¼Œè€Œä¸”å¯èƒ½æ¯”ç›´æ¥è°ƒç”¨åŸå§‹çš„æ¥å£æ›´è´µ
#### 3ã€é±¼èªæ˜AIå¼€æ”¾å¹³å°
é±¼èªæ˜ AI æä¾›äº†ç°æˆçš„SDKæ¥è®©å¤§å®¶æ›´æ–¹ä¾¿åœ°ä½¿ç”¨AIèƒ½åŠ›
é±¼èªæ˜ Al ç½‘ç«™ï¼š[https://yucongming.com/](https://yucongming.com/) (ä¹Ÿå¯ä»¥ç›´æ¥å…¬ä¼—å·æœç´¢ã€é±¼èªæ˜Alã€‘ç§»åŠ¨ç«¯ä½¿ç”¨)
ä¼˜ç‚¹ï¼šç›®å‰ä¸è¦é’±ï¼Œè€Œä¸”æœ‰å¾ˆå¤šç°æˆçš„æ¨¡å‹(promptç³»ç»Ÿé¢„è®¾)ç»™å¤§å®¶ç”¨
ç¼ºç‚¹ï¼šä¸å®Œå…¨çµæ´»ï¼Œä½†æ˜¯å¯ä»¥å®šä¹‰è‡ªå·±çš„æ¨¡å‹
å‚è€ƒæ–‡ç« è¿›è¡Œæ“ä½œï¼š[https://github.com/liyupi/yucongming-java-sdk](https://github.com/liyupi/yucongming-java-sdk)
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684931619992-c0e6f326-93c9-43f5-8010-9ab1d863271c.png#averageHue=%23222527&from=url&id=ia9B4&originHeight=576&originWidth=645&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
##### ç”¨æµç¨‹ï¼š
å³ä¸Šè§’ç‚¹å‡»å¤´åƒ â†’ å¼€å‘å¹³å°ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684675698257-7a8692b3-5d77-46d0-ad38-70597be5c2a9.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1239%2Climit_0#averageHue=%23eaf1f1&from=url&id=f0YNs&originHeight=407&originWidth=1239&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å¾—åˆ°å¼€å‘è€…å¯†é’¥ï¼Œç„¶åç‚¹å‡» Java SDKã€‚
[https://www.yucongming.com/dev](https://www.yucongming.com/dev)
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684675968355-0db825f1-10c3-496a-800e-50d5a6b23924.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1233%2Climit_0#averageHue=%23eed8a4&from=url&id=pxWVL&originHeight=486&originWidth=1233&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ğŸŸå¼€æºåˆ° github ä¸Šäº†ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684676000598-ce256fb4-3f76-498d-95d7-0c569a731783.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1230%2Climit_0#averageHue=%23eed7aa&from=url&id=Twecp&originHeight=939&originWidth=1230&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å¾€ä¸‹æ»‘ï¼Œæœ‰ä¸€ä¸ªå®˜æ–¹æ–‡æ¡£ï¼Œç¬¬ä¸€æ­¥å¼•å…¥sdkã€‚	
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684676094003-8e06bac1-92cd-441c-a3b6-ef9c0a6a83c3.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_800%2Climit_0#averageHue=%23dcba86&from=url&id=r1SGo&originHeight=810&originWidth=800&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```java
<dependency>
  <groupId>com.yucongming</groupId>
  <artifactId>yucongming-java-sdk</artifactId>
  <version>0.0.2</version>
</dependency>
```
ç²˜è´´è‡³pom.xmlï¼Œç„¶åç‚¹å‡»åˆ·æ–°æŒ‰é’®![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684676342985-dddf5644-bb17-4eb6-aa7e-a3ab78d7f0d6.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_33%2Climit_0#averageHue=%23e0e0e0&from=url&id=ATjeP&originHeight=30&originWidth=33&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684932154610-e7118bd2-0df4-4d72-8ed9-d11fe261370e.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1238%2Climit_0#averageHue=%23fbf8f6&from=url&id=mCQBr&originHeight=723&originWidth=1238&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ç¬¬äºŒæ­¥ï¼Œåˆå§‹åŒ– YuCongMingClient å¯¹è±¡ï¼›
è¿›å…¥application.ymlï¼Œé€šè¿‡é…ç½®æ³¨å…¥å¯¹è±¡ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684718614419-f8205d5b-fd7b-4678-8b09-63e74a5da240.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_803%2Climit_0#averageHue=%23f9f7f6&from=url&id=LKlwD&originHeight=639&originWidth=803&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

åœ¨managerç›®å½•ä¸‹åˆ›å»ºAiManager.java(ç”¨æ¥å¯¹æ¥ç¬¬ä¸‰æ–¹æ¥å£)ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684719790081-2444aa7c-45e8-4cdf-aa5e-f8169737f986.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_354%2Climit_0#averageHue=%23fbfaf9&from=url&id=p3Mqa&originHeight=399&originWidth=354&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å»é±¼èªæ˜ AI éšä¾¿æ‰¾ä¸€ä¸ª AI æ¨¡å‹ï¼Œç‚¹å‡»è¿›å…¥å¯¹è¯ï¼Œå¤åˆ¶æ¨¡å‹ idã€‚
å…ˆç‚¹å‡»åˆ†äº«å¾—ä¼šå‘˜ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1692844557569-12afbeb9-4dc6-4a45-b973-66dd5e10c497.png?x-oss-process=image%2Fformat%2Cwebp#averageHue=%23fcfbfb&from=url&id=WFXLY&originHeight=361&originWidth=1200&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ç‚¹å‡»å¤åˆ¶é“¾æ¥ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1692844584220-eb00f3fa-f2fc-492f-a336-3f36482cbcac.png?x-oss-process=image%2Fformat%2Cwebp#averageHue=%23ad9146&from=url&id=K7A1w&originHeight=890&originWidth=521&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ä»é“¾æ¥ä¸­æˆ‘ä»¬å¯ä»¥å¾—åˆ°æ¨¡å‹ id ä¸º 1651468516836098050ã€‚
åœ¨AiManager.javaç¼–å†™å…·ä½“çš„ç¤ºä¾‹ä»£ç ï¼š
```java
package com.yupi.springbootinit.manager;

import com.yupi.springbootinit.common.ErrorCode;
import com.yupi.springbootinit.exception.BusinessException;
import com.yupi.yucongming.dev.client.YuCongMingClient;
import com.yupi.yucongming.dev.common.BaseResponse;
import com.yupi.yucongming.dev.model.DevChatRequest;
import com.yupi.yucongming.dev.model.DevChatResponse;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;

/**
 * ç”¨äºå¯¹æ¥ AI å¹³å°
 */
@Service
public class AiManager {

    @Resource
    private YuCongMingClient yuCongMingClient;

    /**
     * AI å¯¹è¯
     *
     * @param message
     * @return
     */
    public String doChat(String message) {
        // ç¬¬ä¸‰æ­¥ï¼Œæ„é€ è¯·æ±‚å‚æ•°
        DevChatRequest devChatRequest = new DevChatRequest();
        // æ¨¡å‹idï¼Œå°¾ååŠ Lï¼Œè½¬æˆlongç±»å‹
        devChatRequest.setModelId(1651468516836098050L);
        devChatRequest.setMessage(message);
        // ç¬¬å››æ­¥ï¼Œè·å–å“åº”ç»“æœ
        BaseResponse<DevChatResponse> response = yuCongMingClient.doChat(devChatRequest);
        // å¦‚æœå“åº”ä¸ºnullï¼Œå°±æŠ›å‡ºç³»ç»Ÿå¼‚å¸¸ï¼Œæç¤ºâ€œAI å“åº”é”™è¯¯â€
        if (response == null) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "AI å“åº”é”™è¯¯");
        }
        return response.getData().getContent();
    }
}
```
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684720172476-40020dd4-0a41-4bf2-afe7-42e46c297776.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_990%2Climit_0#averageHue=%23fbfaf8&from=url&id=W4gMY&originHeight=808&originWidth=990&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ç„¶åå»ç”Ÿæˆæµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼›
é€‰ä¸­AiManagerï¼ŒæŒ‰Alt + Enteré”®ï¼Œé€‰æ‹©Create Testã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684720578282-cef424aa-8c29-4886-a5a4-88413860ac42.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_598%2Climit_0#averageHue=%23f7f4f1&from=url&id=daOET&originHeight=231&originWidth=598&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å‹¾é€‰åç‚¹å‡» OKã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684720779589-5cc2e549-c540-43a7-a6dd-faf4d89d2dad.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_734%2Climit_0#averageHue=%23f2f0ef&from=url&id=CMEDU&originHeight=443&originWidth=734&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ç”Ÿæˆæµ‹è¯•æ–¹æ³•ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684720936020-0411727c-173d-4a48-87fa-c9c7a3ed2326.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1056%2Climit_0#averageHue=%23faf9f7&from=url&id=E8Rig&originHeight=655&originWidth=1056&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ç¼–å†™æµ‹è¯•ç±»ï¼Œè®© AI æ‰¾å’Œé‚“ç´«æ£‹ç›¸ä¼¼çš„æ›²é£ã€‚
```java
package com.yupi.springbootinit.manager;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import javax.annotation.Resource;

import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest
class AiManagerTest {

    @Resource
    private AiManager aiManager;

    @Test
    void doChat() {
        String answer = aiManager.doChat("é‚“ç´«æ£‹");
        System.out.println(answer);
    }
}
```

ç‚¹å‡»å·¦ä¾§![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684721384415-0e369f9f-c864-4bdc-bac5-af3f120d0bea.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_19%2Climit_0#averageHue=%23f1f1f1&from=url&id=pByxn&originHeight=19&originWidth=19&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æŒ‰é’®ï¼Œè¿è¡Œã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684721350352-f85e0b8f-ca97-4bc2-b5dc-21c1d52e4651.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_747%2Climit_0#averageHue=%23faf9f8&from=url&id=uZAuk&originHeight=393&originWidth=747&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æµ‹è¯•æˆåŠŸâ•°(ï¿£â–½ï¿£)â•­
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684727878725-ca5cef2a-9fb0-4e29-a948-7d2bf6750fca.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1021%2Climit_0#averageHue=%23f7f6f4&from=url&id=CEXFg&originHeight=908&originWidth=1021&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å¯ä»¥æŠŠæ¨¡å‹ id æ¢æˆæˆ‘ä»¬åˆ›å»ºçš„ AIã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1692844831304-f99c90bd-aab5-4bd4-9638-626970908609.png?x-oss-process=image%2Fformat%2Cwebp#averageHue=%23e3c89a&from=url&id=GYmfw&originHeight=262&originWidth=1172&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684730136013-f161378d-fed2-4eb0-ada2-4694720847ed.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_886%2Climit_0#averageHue=%23faf9f7&from=url&id=rjjKC&originHeight=558&originWidth=886&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

æŠŠæµ‹è¯•ç±»çš„åˆ†æè¯‰æ±‚æ¢ä¸€ä¸‹ï¼š
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684730303451-b4ed1b64-ca66-4806-afec-093e7cd081d4.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_784%2Climit_0#averageHue=%23fbfaf8&from=url&id=tVK6k&originHeight=561&originWidth=784&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

è¿”å›ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684730374726-f3c37649-e237-4593-a702-235258b579c6.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1007%2Climit_0#averageHue=%23fbfbfb&from=url&id=M9hNS&originHeight=850&originWidth=1007&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ä¿®æ”¹ä»£ç ï¼Œåœ¨å¤–å±‚æŒ‡å®šæ¨¡å‹ idï¼š
```java
package com.yupi.springbootinit.manager;

import com.yupi.springbootinit.common.ErrorCode;
import com.yupi.springbootinit.exception.BusinessException;
import com.yupi.yucongming.dev.client.YuCongMingClient;
import com.yupi.yucongming.dev.common.BaseResponse;
import com.yupi.yucongming.dev.model.DevChatRequest;
import com.yupi.yucongming.dev.model.DevChatResponse;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;

/**
 * ç”¨äºå¯¹æ¥ AI å¹³å°
 */
@Service
public class AiManager {

    @Resource
    private YuCongMingClient yuCongMingClient;

    /**
     * AI å¯¹è¯
     *
     * @param modelId
     * @param message
     * @return
     */
    // åœ¨å¤–å±‚æŒ‡å®šæ¨¡å‹idï¼Œè¿™æ ·ä¼šä¼˜é›…ä¸€ç‚¹
    public String doChat(long modelId, String message) {
        // ç¬¬ä¸‰æ­¥ï¼Œæ„é€ è¯·æ±‚å‚æ•°
        DevChatRequest devChatRequest = new DevChatRequest();
        // æ¨¡å‹idï¼Œå°¾ååŠ Lï¼Œè½¬æˆlongç±»å‹
        devChatRequest.setModelId(modelId);
        devChatRequest.setMessage(message);
        // ç¬¬å››æ­¥ï¼Œè·å–å“åº”ç»“æœ
        BaseResponse<DevChatResponse> response = yuCongMingClient.doChat(devChatRequest);
        // å¦‚æœå“åº”ä¸ºnullï¼Œå°±æŠ›å‡ºç³»ç»Ÿå¼‚å¸¸ï¼Œæç¤ºâ€œAI å“åº”é”™è¯¯â€
        if (response == null) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "AI å“åº”é”™è¯¯");
        }
        return response.getData().getContent();
    }
}
```
åœ¨æµ‹è¯•ç±»ï¼Œè¡¥å……ä¸‹æ¨¡å‹ id çš„å€¼ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684731072429-08138ded-4b7e-4a3a-8d7a-a786979fc22f.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1031%2Climit_0#averageHue=%23fcfbfa&from=url&id=C75S0&originHeight=648&originWidth=1031&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```java
package com.yupi.springbootinit.manager;


import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import javax.annotation.Resource;

import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest
class AiManagerTest {

    @Resource
    private AiManager aiManager;

    @Test
    void doChat() {
        String prompt = "ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆå’Œå‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§ä»¥ä¸‹å›ºå®šæ ¼å¼ç»™ä½ æä¾›å†…å®¹ï¼š\n" +
                "åˆ†æéœ€æ±‚ï¼š\n" +
                "{æ•°æ®åˆ†æçš„éœ€æ±‚æˆ–è€…ç›®æ ‡}\n" +
                "åŸå§‹æ•°æ®ï¼š\n" +
                "{csvæ ¼å¼çš„åŸå§‹æ•°æ®ï¼Œç”¨,ä½œä¸ºåˆ†éš”ç¬¦}\n" +
                "è¯·æ ¹æ®è¿™ä¸¤éƒ¨åˆ†å†…å®¹ï¼ŒæŒ‰ç…§ä»¥ä¸‹æŒ‡å®šæ ¼å¼ç”Ÿæˆå†…å®¹ï¼ˆæ­¤å¤–ä¸è¦è¾“å‡ºä»»ä½•å¤šä½™çš„å¼€å¤´ã€ç»“å°¾ã€æ³¨é‡Šï¼‰\n" +
                "ã€ã€ã€ã€ã€\n" +
                "{å‰ç«¯ Echarts V5 çš„ option é…ç½®å¯¹è±¡çš„jsonæ ¼å¼ä»£ç ï¼Œåˆç†åœ°å°†æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œä¸è¦ç”Ÿæˆä»»ä½•å¤šä½™çš„å†…å®¹ï¼Œæ¯”å¦‚æ³¨é‡Š}\n" +
                "ã€ã€ã€ã€ã€\n" +
                "{æ˜ç¡®çš„æ•°æ®åˆ†æç»“è®ºã€è¶Šè¯¦ç»†è¶Šå¥½ï¼Œä¸è¦ç”Ÿæˆå¤šä½™çš„æ³¨é‡Š}";
//        https://www.yucongming.com/model/1654785040361893889?inviteUser=1800423670920454145
        String answer = aiManager.doChat(1654785040361893889L, prompt);
        System.out.println(answer);
    }
}
```

æ€ä¹ˆå»å¤„ç†è¿”å›ç»“æœå‘¢ï¼Ÿ	
åœ¨voç›®å½•ä¸‹åˆ›å»ºBiResponse.javaï¼Œå»å®šä¹‰BIçš„è¿”å›ç»“æœã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684804009577-00049795-52a8-4456-8575-ed48be669d28.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_876%2Climit_0#averageHue=%23f8f6f5&from=url&id=wZBfJ&originHeight=708&originWidth=876&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```java
package com.yupi.springbootinit.model.vo;

import lombok.Data;

/**
 * Bi çš„è¿”å›ç»“æœ
 */
@Data
public class BiResponse {

    private String genChart;

    private String genResult;
    // æ–°ç”Ÿæˆçš„å›¾æ ‡id
    private Long chartId;
}
```

ğŸ’¡ ä¹‹å‰æˆ‘ä»¬æ˜¯æ‹¼æ¥ç”¨æˆ·çš„è¾“å…¥ï¼Œç°åœ¨å¯ä»¥å¯¹ä¹‹å‰çš„è¾“å…¥æ–¹å¼è¿›è¡Œä¼˜åŒ–ï¼›
é€šè¿‡è®¾å®šä¸€ä¸ªæç¤ºè¯­(prompt)çš„æ–¹å¼æ¥è¾“å…¥ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä¸å¿…è‡ªå·±ç¼–å†™æç¤ºè¯­ã€‚
è¿™ç§ä¼˜åŒ–æ–¹å¼ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨ç°æœ‰æ¨¡å‹æ¥è¿›è¡Œå¤„ç†ã€‚
æ‰¾åˆ°controllerç›®å½•ä¸‹çš„ChartController.javaï¼Œç›´æ¥è°ƒç”¨AiManagerçš„æ–¹æ³•ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684764587287-c58da5f6-a11c-4361-9b2d-4d9b59fc163f.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1044%2Climit_0#averageHue=%23faf9f8&from=url&id=u9cok&originHeight=684&originWidth=1044&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å›åˆ°genChartByAiæ–¹æ³•(æ™ºèƒ½åˆ†æ)ç¼–å†™ä»£ç ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684764825038-057156d1-997b-48fd-bf14-bfff8d285b1d.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1012%2Climit_0#averageHue=%23faf8f6&from=url&id=XppHj&originHeight=905&originWidth=1012&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```java
    /**
     * æ™ºèƒ½åˆ†æ
     *
     * @param multipartFile
     * @param genChartByAiRequest
     * @param request
     * @return
     */
    @PostMapping("/gen")
    public BaseResponse<BiResponse> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                             GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
        String name = genChartByAiRequest.getName();
        String goal = genChartByAiRequest.getGoal();
        String chartType = genChartByAiRequest.getChartType();

        // æ ¡éªŒ
        // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
        // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");

        // æŒ‡å®šä¸€ä¸ªæ¨¡å‹id(æŠŠidå†™æ­»ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æˆä¸€ä¸ªå¸¸é‡)
        long biModelId = 1659171950288818178L;
        /*
        * ç”¨æˆ·çš„è¾“å…¥(å‚è€ƒ)
          åˆ†æéœ€æ±‚ï¼š
          åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
          åŸå§‹æ•°æ®ï¼š
          æ—¥æœŸ,ç”¨æˆ·æ•°
          1å·,10
          2å·,20
          3å·,30
        * */

        // æ„é€ ç”¨æˆ·è¾“å…¥
        StringBuilder userInput = new StringBuilder();
        userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");

        // æ‹¼æ¥åˆ†æç›®æ ‡
        String userGoal = goal;
        // å¦‚æœå›¾è¡¨ç±»å‹ä¸ä¸ºç©º
        if (StringUtils.isNotBlank(chartType)) {
            // å°±å°†åˆ†æç›®æ ‡æ‹¼æ¥ä¸Šâ€œè¯·ä½¿ç”¨â€+å›¾è¡¨ç±»å‹
            userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
        }
        userInput.append(userGoal).append("\n");
        userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");
        // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼‰
        String csvData = ExcelUtils.excelToCsv(multipartFile);
        userInput.append(csvData).append("\n");

        // æ‹¿åˆ°è¿”å›ç»“æœ
        String result = aiManager.doChat(biModelId,userInput.toString());
        // å¯¹è¿”å›ç»“æœåšæ‹†åˆ†,æŒ‰ç…§5ä¸ªä¸­æ‹¬å·è¿›è¡Œæ‹†åˆ†
        String[] splits = result.split("ã€ã€ã€ã€ã€");
        // æ‹†åˆ†ä¹‹åè¿˜è¦è¿›è¡Œæ ¡éªŒ
        if (splits.length < 3) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
        }

        String genChart = splits[1].trim();
        String genResult = splits[2].trim();
        // æ’å…¥åˆ°æ•°æ®åº“
//        Chart chart = new Chart();
//        chart.setName(name);
//        chart.setGoal(goal);
//        chart.setChartData(csvData);
//        chart.setChartType(chartType);
//        chart.setGenChart(genChart);
//        chart.setGenResult(genResult);
//        chart.setUserId(loginUser.getId());
//        boolean saveResult = chartService.save(chart);
//        ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");
        BiResponse biResponse = new BiResponse();
        biResponse.setGenChart(genChart);
        biResponse.setGenResult(genResult);
//        biResponse.setChartId(chart.getId());
        return ResultUtils.success(biResponse);
        
    }
```

ç°åœ¨è¦æŠŠ AI è¿”å›çš„ç»“æœè¿›è¡Œæ‹†åˆ†ï¼Œæœ€ç»ˆè¿”å›ç»™å‰ç«¯ã€‚
æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‹†åˆ†å‡ºæ¥çš„æƒ…å†µæ˜¯æœ‰ä¸‰éƒ¨åˆ†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
ç¬¬ä¸€å—åˆ‡å‰²åçš„ç©ºç™½éƒ¨åˆ†ï¼Œç¬¬äºŒå—æ˜¯ä¸­é—´çš„ä»£ç éƒ¨åˆ†ï¼Œç¬¬ä¸‰å—æ˜¯æœ€åçš„æ–‡å­—éƒ¨åˆ†ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684804749298-68ee6808-ac2b-48ee-a72e-ce6af306dbee.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1192%2Climit_0#averageHue=%23eff2f6&from=url&id=wK9dl&originHeight=464&originWidth=1192&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

**ä»£ç å®ç°ï¼š**
**æ³¨æ„ä¿®æ”¹**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1718096846327-f0ff1d19-437e-4bbe-8a66-7d8b95bb7ef3.png#averageHue=%23272b33&clientId=u3d84c29e-7367-4&from=paste&height=430&id=u7228caf0&originHeight=1032&originWidth=1920&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=249749&status=done&style=none&taskId=u997929c5-543f-4065-8bbe-94cd67e3069&title=&width=799.9999682108573)
```java
/**
 * æ™ºèƒ½åˆ†æ
 *
 * @param multipartFile
 * @param genChartByAiRequest
 * @param request
 * @return
 */
@PostMapping("/gen")
// æŠŠè¿”å›å€¼æ”¹æˆBiResponse
public BaseResponse<BiResponse> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                         GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
    String name = genChartByAiRequest.getName();
    String goal = genChartByAiRequest.getGoal();
    String chartType = genChartByAiRequest.getChartType();

    // æ ¡éªŒ
    // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
    ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
    // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
    ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");
    // é€šè¿‡responseå¯¹è±¡æ‹¿åˆ°ç”¨æˆ·id(å¿…é¡»ç™»å½•æ‰èƒ½ä½¿ç”¨)
    User loginUser = userService.getLoginUser(request);

    // æŒ‡å®šä¸€ä¸ªæ¨¡å‹id(æŠŠidå†™æ­»ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æˆä¸€ä¸ªå¸¸é‡)
    long biModelId = 1659171950288818178L;
    /*
    * ç”¨æˆ·çš„è¾“å…¥(å‚è€ƒ)
      åˆ†æéœ€æ±‚ï¼š
      åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
      åŸå§‹æ•°æ®ï¼š
      æ—¥æœŸ,ç”¨æˆ·æ•°
      1å·,10
      2å·,20
      3å·,30
    * */

    // æ„é€ ç”¨æˆ·è¾“å…¥
    StringBuilder userInput = new StringBuilder();
    userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");

    // æ‹¼æ¥åˆ†æç›®æ ‡
    String userGoal = goal;
    // å¦‚æœå›¾è¡¨ç±»å‹ä¸ä¸ºç©º
    if (StringUtils.isNotBlank(chartType)) {
        // å°±å°†åˆ†æç›®æ ‡æ‹¼æ¥ä¸Šâ€œè¯·ä½¿ç”¨â€+å›¾è¡¨ç±»å‹
        userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
    }
    userInput.append(userGoal).append("\n");
    userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");
    // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼‰
    String csvData = ExcelUtils.excelToCsv(multipartFile);
    userInput.append(csvData).append("\n");

    // æ‹¿åˆ°è¿”å›ç»“æœ
    String result = aiManager.doChat(biModelId,userInput.toString());
    // å¯¹è¿”å›ç»“æœåšæ‹†åˆ†,æŒ‰ç…§5ä¸ªä¸­æ‹¬å·è¿›è¡Œæ‹†åˆ†
    String[] splits = result.split("ã€ã€ã€ã€ã€");
    // æ‹†åˆ†ä¹‹åè¿˜è¦è¿›è¡Œæ ¡éªŒ
    if (splits.length < 3) {
        throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
    }

    String genChart = splits[1].trim();
    String genResult = splits[2].trim();
    // æ’å…¥åˆ°æ•°æ®åº“
    Chart chart = new Chart();
    chart.setName(name);
    chart.setGoal(goal);
    chart.setChartData(csvData);
    chart.setChartType(chartType);
    chart.setGenChart(genChart);
    chart.setGenResult(genResult);
    chart.setUserId(loginUser.getId());
    boolean saveResult = chartService.save(chart);
    ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");
    BiResponse biResponse = new BiResponse();
    biResponse.setGenChart(genChart);
    biResponse.setGenResult(genResult);
    biResponse.setChartId(chart.getId());
    return ResultUtils.success(biResponse);
}
```
ä»¥debugæ¨¡å¼å¯åŠ¨é¡¹ç›®ï¼Œåœ¨è¿”å› biResponse å¤„æ‰“ä¸ªæ–­ç‚¹ï¼Œè®¿é—® http://localhost:8080/api/doc.htmlã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684805239851-d42943cf-e1c3-4d65-86fd-c8ab47d96f5b.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1137%2Climit_0#averageHue=%23f7f5f2&from=url&id=SWOJ3&originHeight=567&originWidth=1137&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å…ˆç™»å½•ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684933622365-eb270019-8d5f-45bc-806e-f44a8dfedc5d.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1404%2Climit_0#averageHue=%23b1aa9c&from=url&id=uhgdo&originHeight=653&originWidth=1404&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
ç„¶åå»æµ‹è¯•genChartByAiæ¥å£ï¼Œå›¾è¡¨ç±»å‹å…ˆä¸æŒ‡å®šã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684823488313-fc3d343b-7c73-4200-ae07-80df31f26eea.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1396%2Climit_0#averageHue=%23d1bd98&from=url&id=EQP6x&originHeight=630&originWidth=1396&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1718095853174-b0dafb36-eebe-44df-a622-91f1417b7cde.png#averageHue=%23c2b088&clientId=u3d84c29e-7367-4&from=paste&height=407&id=ude3ef5a5&originHeight=978&originWidth=1909&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=152870&status=done&style=none&taskId=u81f67eb4-6eef-478d-bf8b-c443d030f0f&title=&width=795.4166350596494)
å›åˆ° ideaï¼Œå¤åˆ¶è¿”å›ç»“æœçš„å›¾è¡¨ä»£ç ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684933658391-1a182889-bb58-4f2b-adf1-dfcb9bbd7f05.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1339%2Climit_0#averageHue=%23f4f1f0&from=url&id=dv2Dw&originHeight=653&originWidth=1339&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æ¥åˆ° [Echarts æ”¯æŒåœ¨çº¿è°ƒè¯•](https://echarts.apache.org/examples/zh/editor.html?c=line-simple)ï¼Œå°†ä»£ç ç²˜è´´è¿›å»ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684823901599-147ae4d4-d836-4d14-b271-8e51b908163c.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1331%2Climit_0#averageHue=%23d4bb6c&from=url&id=NPwEl&originHeight=864&originWidth=1331&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684823985153-22935c04-818f-4dfa-b6f2-9fe09543e871.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1348%2Climit_0#averageHue=%23fdfdfc&from=url&id=yZViS&originHeight=888&originWidth=1348&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

è¿”å›ç»“æœçš„å›¾è¡¨ä»£ç 
```java
{
  "title": {
    "text": "ç½‘ç«™ç”¨æˆ·å¢é•¿æƒ…å†µ"
  },
  "xAxis": {
    "type": "category",
    "data": ["1å·", "2å·", "3å·"]
  },
  "yAxis": {
    "type": "value"
  },
  "series": [{
    "data": [10, 20, 30],
    "type": "line"
  }]
}
```
åç«¯æŒ‰F9ï¼Œç»§ç»­æ‰§è¡Œï¼Œå“åº”å†…å®¹ä¹Ÿæ­£å¸¸è¿”å›äº†ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684824287841-bf2f2782-d08e-4a2a-a3b7-75eed0898dff.png?x-oss-process=image%2Fresize%2Cw_478%2Climit_0%2Fformat%2Cwebp%2Fresize%2Cw_478%2Climit_0#averageHue=%23b3b0a8&from=url&id=qUuVZ&originHeight=309&originWidth=478&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
æ•°æ®åº“ä¹ŸæˆåŠŸæ·»åŠ äº†æ•°æ®ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684824425094-a4649d32-0ad4-4ac3-8aab-2625ffa539de.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1276%2Climit_0#averageHue=%23f7f5f4&from=url&id=RbPqk&originHeight=542&originWidth=1276&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
åç«¯ç»“æŸå’¯~å–æ¯æ°´ï¼Œèµ°åŠ¨èµ°åŠ¨(ï½oï¿£â–½ï¿£)ï½o ~ã€‚ã€‚ã€‚ 
**1.3 æ€»ç»“ï¼šæ™ºèƒ½æ¥å£å®ç°(æ—¶é—´ç‚¹ 01:15:50-01:17:10)**
`AiManager` ç±»
```java
/**
 * @author Shier
 * CreateTime 2023/5/21 10:42
 */
@Service
public class AiManager {

    @Resource
    private YuCongMingClient congMingClient;

    public String doChat(String message) {
        DevChatRequest devChatRequest = new DevChatRequest();
        // é±¼èªæ˜å¹³å°æ¨¡å‹ID
        devChatRequest.setModelId(1660118603963301890L);
        devChatRequest.setMessage(message);
        BaseResponse<DevChatResponse> response = congMingClient.doChat(devChatRequest);
        if (response == null) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "AI å“åº”é”™è¯¯");
        }
        return response.getData().getContent();
    }
}
```
æµ‹è¯•ç±»ï¼š
```java
/**
 * @author Shier
 * CreateTime 2023/5/21 10:48
 */
@SpringBootTest
class AiManagerTest {

    @Resource
    private AiManager aiManager;

    @Test
    void doChat() {
        String doChat = aiManager.doChat("æ¹–å—é•¿æ²™");
        System.out.println(doChat);
    }
}
```
æœ€åçš„ç»“æœï¼š
## 2ã€å¼€å‘å›¾è¡¨ç®¡ç†åŠŸèƒ½
### 2.1 åç«¯å¼€æ”¾æµç¨‹

1. æ„é€ ç”¨æˆ·è¯·æ±‚ï¼ˆç”¨æˆ·æ¶ˆæ¯ã€CSVæ•°æ®ã€å›¾è¡¨ç±»å‹ï¼‰
2. è°ƒç”¨é±¼èªæ˜SDKï¼Œå¾—åˆ° AI å“åº”ç»“æœ
3. ä» AI å“åº”ç»“æœä¸­ï¼Œå–å‡ºéœ€è¦çš„ä¿¡å¯æ¯
4. ä¿å­˜å›¾è¡¨åˆ°æ•°æ®åº“

BIåˆ†ææ¥å£ï¼š
```java
	/**
     * æ–‡ä»¶ä¸Šä¼ 
     */
    @PostMapping("/gen")
    public BaseResponse<BiResponse> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                                 GenChartByAiRequest chartByAiRequest, HttpServletRequest request) {
        String chartName = chartByAiRequest.getChartName();
        String goal = chartByAiRequest.getGoal();
        String chartType = chartByAiRequest.getChartType();
        User loginUser = userService.getLoginUser(request);
        // æ ¡éªŒ
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "å›¾è¡¨åˆ†æç›®æ ‡ä¸ºç©º");
        ThrowUtils.throwIf(StringUtils.isNotBlank(chartName) && chartName.length() > 200, ErrorCode.PARAMS_ERROR, "å›¾è¡¨åç§°è¿‡é•¿");
        ThrowUtils.throwIf(StringUtils.isBlank(chartType), ErrorCode.PARAMS_ERROR, "å›¾è¡¨ç±»å‹ä¸ºç©º");

        // æ— éœ€Promptï¼Œç›´æ¥è°ƒç”¨ç°æœ‰æ¨¡å‹
        // æ¨¡å‹ID
        long biModelId = 1659171950288818178L;

        // åˆ†æéœ€æ±‚ï¼š
        // åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
        // åŸå§‹æ•°æ®ï¼š
        // æ—¥æœŸï¼Œç”¨æˆ·æ•°
        // 1å·ï¼Œ10
        // 2å·ï¼Œ20
        // 3å·ï¼Œ30

        // æ„é€ ç”¨æˆ·è¾“å…¥
        StringBuilder userInput = new StringBuilder();
        userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
        // æ‹¼æ¥åˆ†æç›®æ ‡
        String userGoal = goal;
        if (StringUtils.isNotBlank(chartType)) {
            userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
        }
        userInput.append(goal).append("\n");
        userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");

        // å‹ç¼©åçš„æ•°æ®
        String csvData = ExcelUtils.excelToCsv(multipartFile);
        userInput.append(csvData).append("\n");

        // è°ƒç”¨AI
        String chartResult = aiManager.doChat(biModelId, userInput.toString());
        String[] splits = chartResult.split("ã€ã€ã€ã€ã€");
        if (splits.length < 3) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "AI ç”Ÿæˆé”™è¯¯");
        }
        // å»æ‰æ¢è¡Œã€ç©ºæ ¼ç­‰
		String genChart = splits[1].trim();
        String genResult = splits[2].trim();
        // æ’å…¥æ•°æ®åˆ°æ•°æ®åº“
        Chart chart = new Chart();
        chart.setGoal(goal);
        chart.setChartData(csvData);
        chart.setChartName(chartName);
        chart.setChartType(chartType);
        chart.setGenChart(genChart);
        chart.setGenResult(genResult);
        chart.setUserId(loginUser.getId());
        boolean saveResult = chartService.save(chart);
        ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");
        // è¿”å›åˆ°å‰ç«¯
        BiResponse biResponse = new BiResponse();
        biResponse.setGenChart(genChart);
        biResponse.setGenResult(genResult);
        return ResultUtils.success(biResponse);
    }
```
æŸ¥çœ‹æ•°æ®ï¼ŒæˆåŠŸæ’å…¥æ•°æ®åº“è¡¨
### 2.2 å‰ç«¯å¼€å‘
å‰ç«¯å¼€å‘(æ—¶é—´ç‚¹ 01:25:36-02:21:36)
#### å¼€å‘ç”¨æˆ·è¡¨å•(æ—¶é—´ç‚¹ 01:25:36-01:38:55)
å¯¹ç…§ä¹‹å‰é¢„è®¾çš„é¡µé¢ï¼Œæ¥è¿›è¡Œå¼€å‘ã€‚
å·¦ä¾§æ˜¯ç”¨æˆ·çš„è¡¨å•ï¼Œå³ä¾§æ˜¯ç”Ÿæˆçš„å›¾è¡¨ï¼Œä»¥åŠæ•°æ®åˆ†æçš„æ€»ç»“ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684934122644-53c78567-4632-4142-bc05-a229fb29bad3.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1221%2Climit_0#averageHue=%23e1e6eb&from=url&id=y7yje&originHeight=641&originWidth=1221&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
å¯¹ä¸»é¡µè¿›è¡Œä¿®æ”¹ï¼Œä¸»é¡µåº”è¯¥æ˜¯å·²ç»å»ºå¥½çš„å›¾è¡¨ã€‚
æŠŠä¸»é¡µé‡å®šå‘è‡³/add_chartï¼Œå°†/add_chartæŒ‡å®šåˆ°/AddChartã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684830628113-051f7fb6-0b60-426e-8a60-35211c10c122.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_984%2Climit_0#averageHue=%23eceae8&from=url&id=efi0F&originHeight=618&originWidth=984&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```javascript
{path: '/', redirect: '/add_chart'},
{ name: 'æ·»åŠ å›¾è¡¨é¡¹', path: '/add_chart', icon: 'smile', component: './AddChart' },
```

å¤åˆ¶Userç›®å½•ï¼Œç²˜è´´è‡³srcâ†’pagesç›®å½•ä¸‹ï¼›
å¹¶æ”¹åä¸ºAddChartï¼ŒæŠŠå…¶ä»–æ–‡ä»¶åˆ æ‰ï¼Œç•™ä¸‹index.tsxã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684934294426-1775e47d-2831-4bf9-9565-232854ed253a.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_915%2Climit_0#averageHue=%23ebe8e6&from=url&id=uIWkS&originHeight=496&originWidth=915&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å¯¹index.tsxè¿›è¡Œä¿®æ”¹ï¼Œåˆ æ‰å¤šä½™çš„å†…å®¹ã€‚(æ¯”å¦‚ï¼šï¼šè·å–ç”¨æˆ·ä¿¡æ¯ã€å¤„ç†æäº¤.....)
```javascript
import { listChartByPageUsingPOST } from '@/services/yubi/chartController';
import { useModel } from '@umijs/max';
import React, { useEffect, useState } from 'react';

const Login: React.FC = () => {
  const [type, setType] = useState<string>('account');
  const { setInitialState } = useModel('@@initialState');

  useEffect(() => {
    listChartByPageUsingPOST({}).then((res) => {
      console.error('res', res);
    });
  });

  return (
    // æŠŠé¡µé¢å†…å®¹æŒ‡å®šä¸€ä¸ªç±»åadd-chart
    <div className="add-chart">

    </div>
  );
};
export default Login;
```

æ€ä¹ˆå»å¼€å‘è¡¨å•ï¼Ÿå» [ant.design ç»„ä»¶åº“](https://ant.design/index-cn) æ‰¾ä¸€ä¸ªè¡¨å•ç»„ä»¶ï¼›
æˆ‘ä»¬éœ€è¦ç”¨åˆ°å¤šè¡Œè¾“å…¥ã€ä¸‹æ‹‰è¾“å…¥ã€æ–‡ä»¶ä¸Šä¼ ä¸‰ä¸ªç»„ä»¶ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684832249825-4e7d3648-0ed7-4960-a425-59829e6095e3.png?x-oss-process=image%2Fresize%2Cw_377%2Climit_0%2Fformat%2Cwebp%2Fresize%2Cw_377%2Climit_0#averageHue=%23d4dad4&from=url&id=K99by&originHeight=321&originWidth=377&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

æ‰¾ä¸€ä¸ªæ¯”è¾ƒå…¨çš„è¡¨å•ç»„ä»¶ï¼Œç‚¹å‡»![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684832439563-0db1f0ac-c6b4-422b-b5f7-16f32e7d090a.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_30%2Climit_0#averageHue=%23fafafa&from=url&id=tOUti&originHeight=26&originWidth=30&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)æ˜¾ç¤ºä»£ç æŒ‰é’®ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684832408396-fff14886-ab52-4544-ab4c-d9f5d9192146.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_966%2Climit_0#averageHue=%23fcfafa&from=url&id=g1bNv&originHeight=978&originWidth=966&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1718106812078-fb1085ba-a291-42f7-949d-65e9d3732c67.png#averageHue=%23fcfcfc&clientId=u3d84c29e-7367-4&from=paste&height=408&id=uebf6451d&originHeight=979&originWidth=1913&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=144994&status=done&style=none&taskId=ub7319b55-4fad-4a3d-bd4a-fe167c8f618&title=&width=797.0833016600886)

æŠŠFormç»„ä»¶å…¨å¤åˆ¶ä¸‹æ¥ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
```javascript
<Form
  <Radio.Button value="a">item 1</Radio.Button>
  <Radio.Button value="b">item 2</Radio.Button>
  <Radio.Button value="c">item 3</Radio.Button>
  </Radio.Group>
  </Form.Item>

  <Form.Item name="checkbox-group" label="Checkbox.Group">
  <Checkbox.Group>
  <Row>
  <Col span={8}>
  <Checkbox value="A" style={{ lineHeight: '32px' }}>
A
  </Checkbox>
  </Col>
  <Col span={8}>
  <Checkbox value="B" style={{ lineHeight: '32px' }} disabled>
  B
  </Checkbox>
  </Col>
  <Col span={8}>
  <Checkbox value="C" style={{ lineHeight: '32px' }}>
  C
  </Checkbox>
  </Col>
  <Col span={8}>
  <Checkbox value="D" style={{ lineHeight: '32px' }}>
  D
  </Checkbox>
  </Col>
  <Col span={8}>
  <Checkbox value="E" style={{ lineHeight: '32px' }}>
  E
  </Checkbox>
  </Col>
  <Col span={8}>
  <Checkbox value="F" style={{ lineHeight: '32px' }}>
  F
  </Checkbox>
  </Col>
  </Row>
  </Checkbox.Group>
  </Form.Item>

  <Form.Item name="rate" label="Rate">
  <Rate />
  </Form.Item>

  <Form.Item
  name="upload"
  label="Upload"
  valuePropName="fileList"
  getValueFromEvent={normFile}
  extra="longgggggggggggggggggggggggggggggggggg"
  >
  <Upload name="logo" action="/upload.do" listType="picture">
  <Button icon={<UploadOutlined />}>Click to upload</Button>
  </Upload>
  </Form.Item>

  <Form.Item label="Dragger">
  <Form.Item name="dragger" valuePropName="fileList" getValueFromEvent={normFile} noStyle>
  <Upload.Dragger name="files" action="/upload.do">
  <p className="ant-upload-drag-icon">
  <InboxOutlined />
  </p>
  <p className="ant-upload-text">Click or drag file to this area to upload</p>
  <p className="ant-upload-hint">Support for a single or bulk upload.</p>
  </Upload.Dragger>
  </Form.Item>
  </Form.Item>

  <Form.Item wrapperCol={{ span: 12, offset: 6 }}>
  <Space>
  <Button type="primary" htmlType="submit">
  Submit
  </Button>
  <Button htmlType="reset">reset</Button>
  </Space>
  </Form.Item>
  </Form>
```

ç²˜è´´è‡³index.tsxã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684832755550-e695ccf5-b431-42f7-92bd-b51139c8cfbc.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_706%2Climit_0#averageHue=%23fbfaf9&from=url&id=CvnRp&originHeight=706&originWidth=706&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

è¿˜æœ‰æäº¤ä»£ç åï¼Œè¦æ‰§è¡Œä»€ä¹ˆæ–¹æ³•ï¼ŒæŠŠè¿™ä¸ªä¹Ÿå¤åˆ¶è¿›æ¥ã€‚
```javascript
onFinishconst onFinish = (values: any) => {
  console.log('Received values of form: ', values);
};
```

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684833049908-743a9321-18ba-4598-9225-b94e0952cccf.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_891%2Climit_0#averageHue=%23eceae8&from=url&id=sl3vC&originHeight=599&originWidth=891&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684833086491-87127f05-3d4b-4284-a60e-738f38a5f510.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_912%2Climit_0#averageHue=%23eceae8&from=url&id=OlHMP&originHeight=634&originWidth=912&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ç®€åŒ–å†…å®¹ï¼Œåˆ é™¤ä¸å¿…è¦çš„ä»£ç ã€‚
(æ¯”å¦‚ï¼šè¡¨æ ¼å¸ƒå±€ã€æ ·å¼ï¼Œæœ€å¤§å®½åº¦ï¼Œæ™®é€šè¾“å…¥æ¡†ã€slider æ»šåŠ¨é€‰é¡¹...)
ç²¾ç®€åçš„index.tsx
```javascript
import { listChartByPageUsingPOST } from '@/services/yubi/chartController';
import { UploadOutlined } from '@ant-design/icons';
import { useModel } from '@umijs/max';
import { Button, Form, Select, Space, Upload } from 'antd';
import TextArea from 'antd/es/input/TextArea';
import React, { useEffect, useState } from 'react';

const Login: React.FC = () => {
  const [type, setType] = useState<string>('account');
  const { setInitialState } = useModel('@@initialState');

  useEffect(() => {
    listChartByPageUsingPOST({}).then((res) => {
      console.error('res', res);
    });
  });

  const onFinish = (values: any) => {
    console.log('Received values of form: ', values);
  };

  return (
    // æŠŠé¡µé¢å†…å®¹æŒ‡å®šä¸€ä¸ªç±»åadd-chart
    <div className="add-chart">
      <Form
        // è¡¨å•åç§°æ”¹ä¸ºaddChart
        name="addChart"
        onFinish={onFinish}
        // åˆå§‹åŒ–æ•°æ®å•¥éƒ½ä¸å¡«ï¼Œä¸ºç©º
        initialValues={{  }}
  >
  <Form.Item name="rate" label="Rate">
      <TextArea />
  </Form.Item>
  
  <Form.Item
    name="select"
    label="Select"
    hasFeedback
    rules={[{ required: true, message: 'Please select your country!' }]}
    >
    <Select placeholder="Please select a country">
      <Option value="china">China</Option>
      <Option value="usa">U.S.A</Option>
    </Select>
  </Form.Item>
  
  <Form.Item
      name="upload"
      label="Upload"
      valuePropName="fileList"
      extra="longgggggggggggggggggggggggggggggggggg"
    >
      <Upload name="logo" action="/upload.do" listType="picture">
        <Button icon={<UploadOutlined />}>Click to upload</Button>
      </Upload>
    </Form.Item>

    
    <Form.Item wrapperCol={{ span: 12, offset: 6 }}>
      <Space>
        <Button type="primary" htmlType="submit">
          Submit
        </Button>
        <Button htmlType="reset">reset</Button>
      </Space>
    </Form.Item>
  </Form>
    </div>
  );
};
export default Login;
```
æˆ‘çš„ä»£ç 
```javascript
import { UploadOutlined } from '@ant-design/icons';
import {
  AlipayCircleOutlined,
  TaobaoCircleOutlined,
  WeiboCircleOutlined,
} from '@ant-design/icons';
import {useModel} from '@umijs/max';
import {
  Alert,
  Button,
  Form,
  Select,
  Space,
  Upload,
} from 'antd';
import TextArea from 'antd/es/input/TextArea';
import { createStyles } from 'antd-style';
import React, {useEffect, useState} from 'react';
import {listChartByPageUsingPost} from "@/services/yubi/chartController";

const { Option } = Select;

const normFile = (e: any) => {
  console.log('Upload event:', e);
  if (Array.isArray(e)) {
    return e;
  }
  return e?.fileList;
};


const useStyles = createStyles(({ token }) => {
  return {
    action: {
      marginLeft: '8px',
      color: 'rgba(0, 0, 0, 0.2)',
      fontSize: '24px',
      verticalAlign: 'middle',
      cursor: 'pointer',
      transition: 'color 0.3s',
      '&:hover': {
        color: token.colorPrimaryActive,
      },
    },
    lang: {
      width: 42,
      height: 42,
      lineHeight: '42px',
      position: 'fixed',
      right: 16,
      borderRadius: token.borderRadius,
      ':hover': {
        backgroundColor: token.colorBgTextHover,
      },
    },
    container: {
      display: 'flex',
      flexDirection: 'column',
      height: '100vh',
      overflow: 'auto',
      backgroundImage:
        "url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')",
      backgroundSize: '100% 100%',
    },
  };
});

const Login: React.FC = () => {
  const [userLoginState, setUserLoginState] = useState<API.LoginResult>({});
  const [type, setType] = useState<string>('account');
  const { initialState, setInitialState } = useModel('@@initialState');
  const { styles } = useStyles();

  useEffect(()=>{
    listChartByPageUsingPost({}).then(res =>{
      console.error('res', res)
    })
  })

  const onFinish = (values: any) => {
    console.log('Received values of form: ', values);
  };

  return (
    // æŠŠé¡µé¢å†…å®¹æŒ‡å®šä¸€ä¸ªç±»åadd-chart
    <div className="add-chart">
      <Form
        // è¡¨å•åç§°æ”¹ä¸ºaddChart
        name="addChart"
        onFinish={onFinish}
        // åˆå§‹åŒ–æ•°æ®å•¥éƒ½ä¸å¡«ï¼Œä¸ºç©º
        initialValues={{
        }}
        style={{ maxWidth: 600 }}
      >

        <Form.Item name="rate" label="Rate">
          <TextArea />
        </Form.Item>

        <Form.Item
          name="select"
          label="Select"
          hasFeedback
          rules={[{ required: true, message: 'Please select your country!' }]}
        >
          <Select placeholder="Please select a country">
            <Option value="china">China</Option>
            <Option value="usa">U.S.A</Option>
          </Select>
        </Form.Item>



        <Form.Item
          name="upload"
          label="Upload"
          valuePropName="fileList"
          getValueFromEvent={normFile}
          extra="longgggggggggggggggggggggggggggggggggg"
        >
          <Upload name="logo" action="/upload.do" listType="picture">
            <Button icon={<UploadOutlined />}>Click to upload</Button>
          </Upload>
        </Form.Item>


        <Form.Item wrapperCol={{ span: 12, offset: 6 }}>
          <Space>
            <Button type="primary" htmlType="submit">
              Submit
            </Button>
            <Button htmlType="reset">reset</Button>
          </Space>
        </Form.Item>
      </Form>
    </div>
  );
};
export default Login;
```

ç„¶ååœ¨ç»ˆç«¯ä½¿ç”¨yarn run startä»¥æ¨¡æ‹Ÿæ•°æ®çš„æ–¹å¼è¿è¡Œï¼›
è¾“å…¥è´¦å·å¯†ç ï¼Œè¿›è¡Œç™»å½•ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684934713314-bf7e3e2f-a7ea-4492-86ce-8627ce756ff1.png?x-oss-process=image%2Fformat%2Cwebp#averageHue=%23b0ccbc&from=url&id=ZjxRG&originHeight=441&originWidth=788&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

çœ‹çœ‹é¡µé¢èƒ½ä¸èƒ½å±•ç¤ºå‡ºæ¥ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684834681155-3a1de8d3-eef6-4025-b28c-611128d0d463.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1284%2Climit_0#averageHue=%23f6f6f6&from=url&id=MehIP&originHeight=664&originWidth=1284&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å·²ç»ç¡®å®šäº†æœ‰å“ªäº›ç»„ä»¶ï¼Œå°±å¼€å§‹ç»†åŒ–ä¸€ä¸‹ã€‚
ç»†åŒ–åçš„index.tsx
```javascript
import { listChartByPageUsingPOST } from '@/services/yubi/chartController';
import { UploadOutlined } from '@ant-design/icons';
import { useModel } from '@umijs/max';
import { Button, Form, Input, Select, Space, Upload } from 'antd';
import TextArea from 'antd/es/input/TextArea';
import React, { useEffect, useState } from 'react';

const Login: React.FC = () => {
  const [type, setType] = useState<string>('account');
  const { setInitialState } = useModel('@@initialState');

  useEffect(() => {
    listChartByPageUsingPOST({}).then((res) => {
      console.error('res', res);
    });
  });

  const onFinish = (values: any) => {
    // çœ‹çœ‹èƒ½å¦å¾—åˆ°ç”¨æˆ·çš„è¾“å…¥
    console.log('è¡¨å•å†…å®¹: ', values);
  };

  return (
    // æŠŠé¡µé¢å†…å®¹æŒ‡å®šä¸€ä¸ªç±»åadd-chart
    <div className="add-chart">
      <Form
        // è¡¨å•åç§°æ”¹ä¸ºaddChart
        name="addChart"
        onFinish={onFinish}
        // åˆå§‹åŒ–æ•°æ®å•¥éƒ½ä¸å¡«ï¼Œä¸ºç©º
        initialValues={{  }}
  >
  {/* å‰ç«¯è¡¨å•çš„nameï¼Œå¯¹åº”åç«¯æ¥å£è¯·æ±‚å‚æ•°é‡Œçš„å­—æ®µï¼Œ
  æ­¤å¤„nameå¯¹åº”åç«¯åˆ†æç›®æ ‡goal,labelæ˜¯å·¦ä¾§çš„æç¤ºæ–‡æœ¬ï¼Œ
  rules=....æ˜¯å¿…å¡«é¡¹æç¤º*/}
  <Form.Item name="goal" label="åˆ†æç›®æ ‡" rules={[{ required: true, message: 'è¯·è¾“å…¥åˆ†æç›®æ ‡!' }]}>
      {/* placeholderæ–‡æœ¬æ¡†å†…çš„æç¤ºè¯­ */}
      <TextArea placeholder="è¯·è¾“å…¥ä½ çš„åˆ†æéœ€æ±‚ï¼Œæ¯”å¦‚ï¼šåˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ"/>
  </Form.Item>

  {/* è¿˜è¦è¾“å…¥å›¾è¡¨åç§° */}
  <Form.Item name="name" label="å›¾è¡¨åç§°">
      <Input placeholder="è¯·è¾“å…¥å›¾è¡¨åç§°" />
  </Form.Item>

  {/* å›¾è¡¨ç±»å‹æ˜¯éå¿…å¡«ï¼Œæ‰€ä»¥ä¸åšæ ¡éªŒ */}
  <Form.Item
    name="selchartTypeect"
    label="å›¾è¡¨ç±»å‹"
    >
    <Select
    options={[
      { value: 'æŠ˜çº¿å›¾', label: 'æŠ˜çº¿å›¾' },
      { value: 'æŸ±çŠ¶å›¾', label: 'æŸ±çŠ¶å›¾' },
      { value: 'å †å å›¾', label: 'å †å å›¾' },
      { value: 'é¥¼å›¾', label: 'é¥¼å›¾' },
      { value: 'é›·è¾¾å›¾', label: 'é›·è¾¾å›¾' },
    ]}
    />
  </Form.Item>

  {/* æ–‡ä»¶ä¸Šä¼  */}
  <Form.Item
      name="file"
      label="åŸå§‹æ•°æ®"
    >
      {/* action:å½“ä½ æŠŠæ–‡ä»¶ä¸Šä¼ ä¹‹åï¼Œä»–ä¼šæŠŠæ–‡ä»¶ä¸Šä¼ è‡³å“ªä¸ªæ¥å£ã€‚
      è¿™é‡Œè‚¯å®šæ˜¯è°ƒç”¨è‡ªå·±çš„åç«¯ï¼Œå…ˆä¸ç”¨è¿™ä¸ª */}
      <Upload name="file">
        <Button icon={<UploadOutlined />}>ä¸Šä¼  CSV æ–‡ä»¶</Button>
      </Upload>
    </Form.Item>
    
    <Form.Item wrapperCol={{ span: 12, offset: 6 }}>
      <Space>
        <Button type="primary" htmlType="submit">
          æäº¤
        </Button>
        <Button htmlType="reset">é‡ç½®</Button>
      </Space>
    </Form.Item>
  </Form>
    </div>
  );
};
export default Login;
```

å½“ç‚¹å‡»æäº¤åï¼Œèƒ½å¦å¾—åˆ°ç”¨æˆ·çš„è¾“å…¥ï¼Ÿæ¥æµ‹è¯•ä¸€ä¸‹ã€‚
é¼ æ ‡å³é”®é€‰æ‹©æ£€æŸ¥ï¼Œæˆ–æŒ‰F12é”®ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684839580254-f61de2de-ffac-43f3-97e4-822bd302f3cc.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_973%2Climit_0#averageHue=%23f6f6f6&from=url&id=p6Cmh&originHeight=763&originWidth=973&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ç‚¹å‡»![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684839734917-15738e30-a7d6-4dea-a50d-7141445c3909.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_29%2Climit_0#averageHue=%23e7e8e9&from=url&id=R7475&originHeight=21&originWidth=29&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)æ¸…é™¤æ§åˆ¶å°æŒ‰é’®ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684934885604-12f362c3-5c3d-481b-ac02-26541870b4b0.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1296%2Climit_0#averageHue=%23f7f1f1&from=url&id=GFfVn&originHeight=490&originWidth=1296&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å¡«å†™åˆ†æç›®æ ‡ã€å›¾è¡¨åç§°ã€å›¾è¡¨ç±»å‹ã€åŸå§‹æ•°æ®åï¼Œå¹¶ç‚¹å‡»æäº¤ï¼›
å‘ç° file é‡Œé¢è¿˜å¥—äº†ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦å…ˆå–å‡ºè¿™ä¸€å±‚å¯¹è±¡ï¼Œå†ä¼ ç»™åç«¯å¤„ç†ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684934924162-a3239036-f832-46ba-98b6-634a524e6316.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1296%2Climit_0#averageHue=%23f8f5f5&from=url&id=bXHwZ&originHeight=401&originWidth=1296&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ç°åœ¨åªéœ€è¦æŠŠè¡¨å•å†…å®¹æäº¤ç»™åç«¯ï¼Œä¸åç«¯å¯¹æ¥å³å¯ã€‚
#### ![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1718108837221-297dadce-8277-45ac-b6f5-bb5c1562a422.png#averageHue=%23f2f4f4&clientId=u3d84c29e-7367-4&from=paste&height=408&id=u9e4f6154&originHeight=980&originWidth=1911&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=345948&status=done&style=none&taskId=u900a86cc-ebb7-45c7-b33e-334272d51d4&title=&width=796.249968359869)
å¯¹æ¥åç«¯(æ—¶é—´ç‚¹ 01:38:55-01:47:20)

æ€ä¹ˆå»è°ƒç”¨åç«¯æ¥å£ï¼Ÿå‰ç«¯æ€ä¹ˆå»å†™è¿™ä¸ªè¯·æ±‚ï¼ŒæŠŠæ–‡ä»¶ä¸Šä¼ è‡³åç«¯ã€‚

ä¹‹å‰æåˆ°è¿‡ï¼Œå¯ä»¥åˆ©ç”¨ openapi è‡ªåŠ¨ç”Ÿæˆå‰ç«¯è°ƒç”¨ä»£ç ï¼›
å¯åŠ¨package.jsonä¸­çš„openapiå‘½ä»¤ï¼Œç”Ÿæˆå®Œæ¯•åï¼Œçœ‹ä¸€ä¸‹ç”Ÿæˆçš„ä»£ç ã€‚
![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684935147490-cc013b18-be64-42ca-9c54-0f3e5fbb86c6.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_945%2Climit_0#averageHue=%23eeeceb&from=url&id=l72nx&originHeight=811&originWidth=945&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ç°åœ¨å¯ä»¥æŠŠsrcâ†’servicesç›®å½•ä¸‹çš„ant-design-proç›®å½•åˆ æ‰ï¼Œè¿˜æœ‰å¼•ç”¨åˆ°çš„åœ°æ–¹ä¹Ÿåˆ æ‰ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684841327760-af610103-8323-4a18-aa06-a19d39727aba.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_242%2Climit_0#averageHue=%23f0edea&from=url&id=BsLCQ&originHeight=333&originWidth=242&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684841255299-b32f77dc-1d89-4bf3-9cc2-e501114b9ce1.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_961%2Climit_0#averageHue=%23ebe7e5&from=url&id=lun1J&originHeight=440&originWidth=961&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684841402982-375dc27e-9329-4531-820e-8a058a698161.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_676%2Climit_0#averageHue=%23faf8f6&from=url&id=LYODH&originHeight=602&originWidth=676&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684841490311-d40b5cc8-eb23-40a1-bf56-28abd59c1611.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_253%2Climit_0#averageHue=%23f2eceb&from=url&id=i6eLw&originHeight=147&originWidth=253&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684841949229-dd59eed1-9431-4710-89ab-71c030559de0.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_861%2Climit_0#averageHue=%23f8f4f2&from=url&id=hlIiN&originHeight=381&originWidth=861&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å¼€å§‹ç¼–å†™è°ƒç”¨åç«¯æ¥å£çš„ä»£ç ã€‚
index.tsx
```javascript
import { genChartByAiUsingPOST } from '@/services/yubi/chartController';
import { UploadOutlined } from '@ant-design/icons';
import { Button, Form, Input, message, Select, Space, Upload } from 'antd';
import TextArea from 'antd/es/input/TextArea';
import React from 'react';

/**
 * æ·»åŠ å›¾è¡¨é¡µé¢
 * @constructor
 */
// æŠŠå¤šä½™çš„çŠ¶æ€åˆ æ‰ï¼Œé¡µé¢åç§°æ”¹ä¸ºAddChart
const AddChart: React.FC = () => {
  /**
   * æäº¤
   * @param values
   */
    const onFinish = async (values: any) => {
      // å¯¹æ¥åç«¯ï¼Œä¸Šä¼ æ•°æ®
      const params = {
        ...values,
        file: undefined,
      };
      try {
        // éœ€è¦å–åˆ°ä¸Šä¼ çš„åŸå§‹æ•°æ®fileâ†’fileâ†’originFileObj(åŸå§‹æ•°æ®)
        const res = await genChartByAiUsingPOST(params, {}, values.file.file.originFileObj);
        // æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼å°±åˆ†æå¤±è´¥ï¼Œæœ‰ï¼Œå°±åˆ†ææˆåŠŸ
        if (!res?.data) {
          message.error('åˆ†æå¤±è´¥');
        } else {
          message.success('åˆ†ææˆåŠŸ');  
        }  
      // å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæç¤ºåˆ†æå¤±è´¥+å…·ä½“å¤±è´¥åŸå› 
      } catch (e: any) {
        message.error('åˆ†æå¤±è´¥,' + e.message);
      }
    };  
  
.....æ­¤å¤„çœç•¥ï¼Œä»£ç ä¸å˜.....

export default AddChart;
```

æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨ç»ˆç«¯ä½¿ç”¨yarn run devå¯åŠ¨å‰ç«¯é¡¹ç›®(æ³¨æ„ï¼šåç«¯é¡¹ç›®ä¹Ÿæ˜¯å¯åŠ¨çŠ¶æ€)ï¼›
è®¿é—®[http://localhost:8000/](http://localhost:8000/)ï¼Œç™»å½•ä¸€ä¸‹ï¼›

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684846025679-e27e142b-b3b3-47d1-b99a-ba314ded086f.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1346%2Climit_0#averageHue=%23dfc093&from=url&id=ce6KR&originHeight=341&originWidth=1346&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

è°ƒç”¨æˆåŠŸï¼Œåç«¯debugçŠ¶æ€ä¸‹ä¹Ÿæ‹¿åˆ°äº†æ•°æ®ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684935312076-8352c703-5673-4bed-8370-3eaf7fb772d5.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1329%2Climit_0#averageHue=%23f7f6f5&from=url&id=h4HYs&originHeight=603&originWidth=1329&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

åœ¨åç«¯æŒ‰F9 ï¼Œæ¥åˆ°å‰ç«¯é¡µé¢ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684846333142-26c8fbf7-4b86-4386-8b32-df1024f071e3.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1142%2Climit_0#averageHue=%23f7f7f7&from=url&id=vtwSH&originHeight=342&originWidth=1142&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```typescript
import {genChartByAiUsingPost, listChartByPageUsingPost} from "@/services/yubi/chartController";
import { UploadOutlined } from '@ant-design/icons';
import { useModel } from '@umijs/max';
import {Button, Form, Input, message, Select, Space, Upload} from 'antd';
import TextArea from 'antd/es/input/TextArea';
import React, { useEffect, useState } from 'react';

const AddChart: React.FC = () => {
    const [type, setType] = useState<string>('account');
    const { setInitialState } = useModel('@@initialState');

    useEffect(() => {
        listChartByPageUsingPost({}).then((res) => {
            console.error('res', res);
        });
    });

    /**
     * æäº¤
     * @param values
     */
    const onFinish = async (values: any) => {
        // å¯¹æ¥åç«¯ï¼Œä¸Šä¼ æ•°æ®
        const params = {
            ...values,
            file: undefined,
        };
        try {
            // éœ€è¦å–åˆ°ä¸Šä¼ çš„åŸå§‹æ•°æ®fileâ†’fileâ†’originFileObj(åŸå§‹æ•°æ®)
            const res = await genChartByAiUsingPost(params, {}, values.file.file.originFileObj);
            // æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼å°±åˆ†æå¤±è´¥ï¼Œæœ‰ï¼Œå°±åˆ†ææˆåŠŸ
            if (!res?.data) {
                message.error('åˆ†æå¤±è´¥');
            } else {
                message.success('åˆ†ææˆåŠŸ');
            }
            // å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæç¤ºåˆ†æå¤±è´¥+å…·ä½“å¤±è´¥åŸå› 
        } catch (e: any) {
            message.error('åˆ†æå¤±è´¥,' + e.message);
        }
    };

    return (
        // æŠŠé¡µé¢å†…å®¹æŒ‡å®šä¸€ä¸ªç±»åadd-chart
        <div className="add-chart">
            <Form
                // è¡¨å•åç§°æ”¹ä¸ºaddChart
                name="addChart"
                onFinish={onFinish}
                // åˆå§‹åŒ–æ•°æ®å•¥éƒ½ä¸å¡«ï¼Œä¸ºç©º
                initialValues={{  }}
            >
                {/* å‰ç«¯è¡¨å•çš„nameï¼Œå¯¹åº”åç«¯æ¥å£è¯·æ±‚å‚æ•°é‡Œçš„å­—æ®µï¼Œ
  æ­¤å¤„nameå¯¹åº”åç«¯åˆ†æç›®æ ‡goal,labelæ˜¯å·¦ä¾§çš„æç¤ºæ–‡æœ¬ï¼Œ
  rules=....æ˜¯å¿…å¡«é¡¹æç¤º*/}
                <Form.Item name="goal" label="åˆ†æç›®æ ‡" rules={[{ required: true, message: 'è¯·è¾“å…¥åˆ†æç›®æ ‡!' }]}>
                    {/* placeholderæ–‡æœ¬æ¡†å†…çš„æç¤ºè¯­ */}
                    <TextArea placeholder="è¯·è¾“å…¥ä½ çš„åˆ†æéœ€æ±‚ï¼Œæ¯”å¦‚ï¼šåˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ"/>
                </Form.Item>

                {/* è¿˜è¦è¾“å…¥å›¾è¡¨åç§° */}
                <Form.Item name="name" label="å›¾è¡¨åç§°">
                    <Input placeholder="è¯·è¾“å…¥å›¾è¡¨åç§°" />
                </Form.Item>

                {/* å›¾è¡¨ç±»å‹æ˜¯éå¿…å¡«ï¼Œæ‰€ä»¥ä¸åšæ ¡éªŒ */}
                <Form.Item
                    name="selchartTypeect"
                    label="å›¾è¡¨ç±»å‹"
                >
                    <Select
                        options={[
                            { value: 'æŠ˜çº¿å›¾', label: 'æŠ˜çº¿å›¾' },
                            { value: 'æŸ±çŠ¶å›¾', label: 'æŸ±çŠ¶å›¾' },
                            { value: 'å †å å›¾', label: 'å †å å›¾' },
                            { value: 'é¥¼å›¾', label: 'é¥¼å›¾' },
                            { value: 'é›·è¾¾å›¾', label: 'é›·è¾¾å›¾' },
                        ]}
                    />
                </Form.Item>

                {/* æ–‡ä»¶ä¸Šä¼  */}
                <Form.Item
                    name="file"
                    label="åŸå§‹æ•°æ®"
                >
                    {/* action:å½“ä½ æŠŠæ–‡ä»¶ä¸Šä¼ ä¹‹åï¼Œä»–ä¼šæŠŠæ–‡ä»¶ä¸Šä¼ è‡³å“ªä¸ªæ¥å£ã€‚
      è¿™é‡Œè‚¯å®šæ˜¯è°ƒç”¨è‡ªå·±çš„åç«¯ï¼Œå…ˆä¸ç”¨è¿™ä¸ª */}
                    <Upload name="file">
                        <Button icon={<UploadOutlined />}>ä¸Šä¼  CSV æ–‡ä»¶</Button>
                    </Upload>
                </Form.Item>

                <Form.Item wrapperCol={{ span: 12, offset: 6 }}>
                    <Space>
                        <Button type="primary" htmlType="submit">
                            æäº¤
                        </Button>
                        <Button htmlType="reset">é‡ç½®</Button>
                    </Space>
                </Form.Item>
            </Form>
        </div>
    );
};
export default AddChart;
```

çœ‹ä¸‹è¿”å›å€¼ï¼Œåˆ†ææˆåŠŸã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684846410727-b821964e-941e-423e-af95-0445d0789782.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1012%2Climit_0#averageHue=%23f4d090&from=url&id=MFIcm&originHeight=532&originWidth=1012&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
#### 
ç”Ÿæˆå›¾è¡¨(æ—¶é—´ç‚¹ 01:47:20-02:21:36)
ä½¿ç”¨åº“ â€”â€” [ECharts](https://git.hust.cc/echarts-for-react/)
ps.å¦‚æœå¤§å®¶ç”¨çš„æ˜¯ reast é¡¹ç›®ï¼Œæ¨èä½¿ç”¨è¿™ä¸ªåº“ï¼Œå®ƒå¯¹ ECharts è¿›è¡Œäº†å°è£…ï¼Œå¯ä»¥è®©ä½ åœ¨ reast ä¸­ä½¿ç”¨æ›´æ–¹ä¾¿ã€‚
æ ¹æ®æ–‡æ¡£æç¤ºï¼Œä½¿ç”¨å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684848248554-da858b8f-992d-4416-9685-07c877a125e8.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1396%2Climit_0#averageHue=%23dff5e4&from=url&id=SrBMn&originHeight=675&originWidth=1396&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„ä½¿ç”¨ä¾‹å­ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684848509163-e39a4f93-7d95-469a-9f7a-d5d9328c54be.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1046%2Climit_0#averageHue=%23b1ced5&from=url&id=IVuJX&originHeight=952&originWidth=1046&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

åœ¨ç»ˆç«¯æ‰§è¡Œè¿™æ¡å‘½ä»¤ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1718179795416-d3835823-630c-4ea9-a669-86a1ea7f34e3.png#averageHue=%23222428&clientId=ua88b7536-e72c-4&from=paste&height=347&id=uff662d6a&originHeight=417&originWidth=1066&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=58712&status=done&style=none&taskId=uca2bba71-d441-44b3-841a-55028f7df68&title=&width=888.3332980341396)
```javascript
npm install echarts-for-react
```


![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684848406826-6ba1d586-9e92-44fe-90ac-d8cd35fff2a7.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_917%2Climit_0#averageHue=%23f0efee&from=url&id=dgo1I&originHeight=306&originWidth=917&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å…ˆæ ¹æ®å®˜æ–¹æ–‡æ¡£ç¤ºä¾‹ï¼Œå†™ä¸€äº›ç¤ºä¾‹ä»£ç ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ¥å…¥ã€‚
```javascript
import { genChartByAiUsingPOST } from '@/services/yubi/chartController';
import { UploadOutlined } from '@ant-design/icons';
import { Button, Form, Input, message, Select, Space, Upload } from 'antd';
import TextArea from 'antd/es/input/TextArea';
import React, { useState } from 'react';
import ReactECharts from 'echarts-for-react';

/**
 * æ·»åŠ å›¾è¡¨é¡µé¢
 * @constructor
 */
// æŠŠå¤šä½™çš„çŠ¶æ€åˆ æ‰ï¼Œé¡µé¢åç§°æ”¹ä¸ºAddChart
const AddChart: React.FC = () => {
  const options = {
    grid: { top: 8, right: 8, bottom: 24, left: 36 },
    xAxis: {
      type: 'category',
      data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
    },
    yAxis: {
      type: 'value',
    },
    series: [
      {
        data: [820, 932, 901, 934, 1290, 1330, 1320],
        type: 'line',
        smooth: true,
      },
    ],
    tooltip: {
      trigger: 'axis',
    },
  };
  // å®šä¹‰çŠ¶æ€ï¼Œç”¨æ¥æ¥æ”¶åç«¯çš„è¿”å›å€¼ï¼Œè®©å®ƒå®æ—¶å±•ç¤ºåœ¨é¡µé¢ä¸Š
  const [chart, setChart] = useState<API.BiResponse>();

  /**
   * æäº¤
   * @param values
   */
  const onFinish = async (values: any) => {

    .....æ­¤å¤„çœç•¥ï¼Œä»£ç ä¸å˜.....
    
     <div>
     åˆ†æç»“è®ºï¼š{chart?.genResult}
     </div>
     <div>
     ç”Ÿæˆå›¾è¡¨ï¼š
     <ReactECharts option={options} />
     </div>
   </div>
   );
   };
   export default AddChart;
```
```javascript
import {genChartByAiUsingPost, listChartByPageUsingPost} from "@/services/yubi/chartController";
import { UploadOutlined } from '@ant-design/icons';
import {useModel} from '@umijs/max';
import {
  Input,
  Button,
  Form,
  Select,
  Space,
  Upload, message,
} from 'antd';
import TextArea from 'antd/es/input/TextArea';
import { createStyles } from 'antd-style';
import React, {useEffect, useState} from 'react';
const { Option } = Select;
import ReactECharts from 'echarts-for-react';
const normFile = (e: any) => {
  console.log('Upload event:', e);
  if (Array.isArray(e)) {
    return e;
  }
  return e?.fileList;
};


const useStyles = createStyles(({ token }) => {
  return {
    action: {
      marginLeft: '8px',
      color: 'rgba(0, 0, 0, 0.2)',
      fontSize: '24px',
      verticalAlign: 'middle',
      cursor: 'pointer',
      transition: 'color 0.3s',
      '&:hover': {
        color: token.colorPrimaryActive,
      },
    },
    lang: {
      width: 42,
      height: 42,
      lineHeight: '42px',
      position: 'fixed',
      right: 16,
      borderRadius: token.borderRadius,
      ':hover': {
        backgroundColor: token.colorBgTextHover,
      },
    },
    container: {
      display: 'flex',
      flexDirection: 'column',
      height: '100vh',
      overflow: 'auto',
      backgroundImage:
        "url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')",
      backgroundSize: '100% 100%',
    },
  };
});

/**
 * æ·»åŠ å›¾è¡¨é¡µé¢
 * @constructor
 */
// æŠŠå¤šä½™çš„çŠ¶æ€åˆ æ‰ï¼Œé¡µé¢åç§°æ”¹ä¸ºAddChart
const AddChart: React.FC = () => {
  const options = {
    grid: { top: 8, right: 8, bottom: 24, left: 36 },
    xAxis: {
      type: 'category',
      data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
    },
    yAxis: {
      type: 'value',
    },
    series: [
      {
        data: [820, 932, 901, 934, 1290, 1330, 1320],
        type: 'line',
        smooth: true,
      },
    ],
    tooltip: {
      trigger: 'axis',
    },
  };
  // å®šä¹‰çŠ¶æ€ï¼Œç”¨æ¥æ¥æ”¶åç«¯çš„è¿”å›å€¼ï¼Œè®©å®ƒå®æ—¶å±•ç¤ºåœ¨é¡µé¢ä¸Š
  const [chart, setChart] = useState<API.BiResponse>();

  const onFinish = async (values: any) => {
    // å¯¹æ¥åç«¯ï¼Œä¸Šä¼ æ•°æ®
    const params = {
      ...values,
      file: undefined,
    };
    try {
      // éœ€è¦å–åˆ°ä¸Šä¼ çš„åŸå§‹æ•°æ®fileâ†’fileâ†’originFileObj(åŸå§‹æ•°æ®)
      const res = await genChartByAiUsingPost(params, {}, values.file.file.originFileObj);
      // æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼å°±åˆ†æå¤±è´¥ï¼Œæœ‰ï¼Œå°±åˆ†ææˆåŠŸ
      if (!res?.data) {
        message.error('åˆ†æå¤±è´¥');
      } else {
        message.success('åˆ†ææˆåŠŸ');
      }
      // å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæç¤ºåˆ†æå¤±è´¥+å…·ä½“å¤±è´¥åŸå› 
    } catch (e: any) {
      message.error('åˆ†æå¤±è´¥,' + e.message);
    }
  };

  return (
    // æŠŠé¡µé¢å†…å®¹æŒ‡å®šä¸€ä¸ªç±»åadd-chart
    <div className="add-chart">
      <Form
        // è¡¨å•åç§°æ”¹ä¸ºaddChart
        name="addChart"
        onFinish={onFinish}
        // åˆå§‹åŒ–æ•°æ®å•¥éƒ½ä¸å¡«ï¼Œä¸ºç©º
        initialValues={{
        }}
        style={{ maxWidth: 600 }}
      >

        {/* å‰ç«¯è¡¨å•çš„nameï¼Œå¯¹åº”åç«¯æ¥å£è¯·æ±‚å‚æ•°é‡Œçš„å­—æ®µï¼Œæ­¤å¤„nameå¯¹åº”åç«¯åˆ†æç›®æ ‡goal,labelæ˜¯å·¦ä¾§çš„æç¤ºæ–‡æœ¬ï¼Œrules=....æ˜¯å¿…å¡«é¡¹æç¤º*/}
        <Form.Item name="goal" label="åˆ†æç›®æ ‡" rules={[{ required: true, message: 'è¯·è¾“å…¥åˆ†æç›®æ ‡!' }]}>
          {/* placeholderæ–‡æœ¬æ¡†å†…çš„æç¤ºè¯­ */}
          <TextArea placeholder="è¯·è¾“å…¥ä½ çš„åˆ†æéœ€æ±‚ï¼Œæ¯”å¦‚ï¼šåˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ"/>
        </Form.Item>

        {/* è¿˜è¦è¾“å…¥å›¾è¡¨åç§° */}
        <Form.Item name="name" label="å›¾è¡¨åç§°">
          <Input placeholder="è¯·è¾“å…¥å›¾è¡¨åç§°" />
        </Form.Item>

        {/* å›¾è¡¨ç±»å‹æ˜¯éå¿…å¡«ï¼Œæ‰€ä»¥ä¸åšæ ¡éªŒ */}
        <Form.Item
          name="selchartTypeect"
          label="å›¾è¡¨ç±»å‹"
        >
          <Select
            options={[
              { value: 'æŠ˜çº¿å›¾', label: 'æŠ˜çº¿å›¾' },
              { value: 'æŸ±çŠ¶å›¾', label: 'æŸ±çŠ¶å›¾' },
              { value: 'å †å å›¾', label: 'å †å å›¾' },
              { value: 'é¥¼å›¾', label: 'é¥¼å›¾' },
              { value: 'é›·è¾¾å›¾', label: 'é›·è¾¾å›¾' },
            ]}
          />
        </Form.Item>

        {/* æ–‡ä»¶ä¸Šä¼  */}
        <Form.Item
          name="file"
          label="åŸå§‹æ•°æ®"
        >
          <Upload name="file" action="/upload.do" listType="picture">
            <Button icon={<UploadOutlined />}>ä¸Šä¼  CSV æ–‡ä»¶</Button>
          </Upload>
        </Form.Item>


        <Form.Item wrapperCol={{ span: 12, offset: 6 }}>
          <Space>
            <Button type="primary" htmlType="submit">
              æäº¤
            </Button>
            <Button htmlType="reset">é‡ç½®</Button>
          </Space>
        </Form.Item>
      </Form>

      <div>
        åˆ†æç»“è®ºï¼š{chart?.genResult}
      </div>
      <div>
        ç”Ÿæˆå›¾è¡¨ï¼š
        <ReactECharts option={options} />
      </div>

    </div>
  );
};
export default AddChart;
```

é‡æ–°ä»¥devæ–¹å¼å¯åŠ¨å‰ç«¯é¡¹ç›®ï¼Œè®¿é—® [http://localhost:8000/](http://localhost:8000/)ï¼Œç™»å½•ä¸€ä¸‹ã€‚
å›¾è¡¨æ˜¾ç¤ºå‡ºæ¥äº†ï¼Œæ¥å…¥æˆåŠŸã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1718179957382-7fd46df7-b021-4549-825c-2ecb16f3fc10.png#averageHue=%23e3ddd5&clientId=ua88b7536-e72c-4&from=paste&height=1336&id=u86fa992a&originHeight=1603&originWidth=2876&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=672858&status=done&style=none&taskId=u178d39f9-ceb3-41ef-9331-7ba1630ba66&title=&width=2396.6665714316937)

ç»§ç»­å®Œå–„ä»£ç ï¼Œçœ‹çœ‹ç”¨è‡ªå·±çš„èƒ½ä¸èƒ½å±•ç¤ºå‡ºå›¾è¡¨ã€‚
```javascript
import { genChartByAiUsingPOST } from '@/services/yubi/chartController';
import { UploadOutlined } from '@ant-design/icons';
import { Button, Form, Input, message, Select, Space, Upload } from 'antd';
import TextArea from 'antd/es/input/TextArea';
import React, { useState } from 'react';
import ReactECharts from 'echarts-for-react';

/**
 * æ·»åŠ å›¾è¡¨é¡µé¢
 * @constructor
 */
// æŠŠå¤šä½™çš„çŠ¶æ€åˆ æ‰ï¼Œé¡µé¢åç§°æ”¹ä¸ºAddChart
const AddChart: React.FC = () => {
  // å®šä¹‰çŠ¶æ€ï¼Œç”¨æ¥æ¥æ”¶åç«¯çš„è¿”å›å€¼ï¼Œè®©å®ƒå®æ—¶å±•ç¤ºåœ¨é¡µé¢ä¸Š
  const [chart, setChart] = useState<API.BiResponse>();
  const [option, setOption] = useState<any>();
  // æäº¤ä¸­çš„çŠ¶æ€ï¼Œé»˜è®¤æœªæäº¤
  const [submitting, setSubmitting] = useState<boolean>(false);

  /**
   * æäº¤
   * @param values
   */
    const onFinish = async (values: any) => {
      // å¦‚æœå·²ç»æ˜¯æäº¤ä¸­çš„çŠ¶æ€(è¿˜åœ¨åŠ è½½)ï¼Œç›´æ¥è¿”å›ï¼Œé¿å…é‡å¤æäº¤
    if (submitting) {
      return;
    }
    // å½“å¼€å§‹æäº¤ï¼ŒæŠŠsubmittingè®¾ç½®ä¸ºtrue
    setSubmitting(true);

      // å¯¹æ¥åç«¯ï¼Œä¸Šä¼ æ•°æ®
      const params = {
        ...values,
        file: undefined,
      };
      try {
        // éœ€è¦å–åˆ°ä¸Šä¼ çš„åŸå§‹æ•°æ®fileâ†’fileâ†’originFileObj(åŸå§‹æ•°æ®)
        const res = await genChartByAiUsingPOST(params, {}, values.file.file.originFileObj);
        // æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼å°±åˆ†æå¤±è´¥ï¼Œæœ‰ï¼Œå°±åˆ†ææˆåŠŸ
        if (!res?.data) {
          message.error('åˆ†æå¤±è´¥');
        } else {
          message.success('åˆ†ææˆåŠŸ');  
          // è§£ææˆå¯¹è±¡ï¼Œä¸ºç©ºåˆ™è®¾ä¸ºç©ºå­—ç¬¦ä¸²
          const chartOption = JSON.parse(res.data.genChart ?? '');
          // å¦‚æœä¸ºç©ºï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶æç¤º'å›¾è¡¨ä»£ç è§£æé”™è¯¯'
          if (!chartOption) {
            throw new Error('å›¾è¡¨ä»£ç è§£æé”™è¯¯')
          // å¦‚æœæˆåŠŸ
          } else {
            // ä»åç«¯å¾—åˆ°å“åº”ç»“æœä¹‹åï¼ŒæŠŠå“åº”ç»“æœè®¾ç½®åˆ°å›¾è¡¨çŠ¶æ€é‡Œ
            setChart(res.data);
            setOption(chartOption);
          }
        }  
      // å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæç¤ºåˆ†æå¤±è´¥+å…·ä½“å¤±è´¥åŸå› 
      } catch (e: any) {
        message.error('åˆ†æå¤±è´¥,' + e.message);
      }
      // å½“ç»“æŸæäº¤ï¼ŒæŠŠsubmittingè®¾ç½®ä¸ºfalse
      setSubmitting(false);
    };  

.....æ­¤å¤„çœç•¥ï¼Œä»£ç ä¸å˜.....
  <div>
    åˆ†æç»“è®ºï¼š{chart?.genResult}
  </div>
  <div>
    ç”Ÿæˆå›¾è¡¨ï¼š
    {/* å¦‚æœå®ƒå­˜åœ¨ï¼Œæ‰æ¸²æŸ“è¿™ä¸ªç»„ä»¶ */}
    {
      // åç«¯è¿”å›çš„ä»£ç æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯å¯¹è±¡ï¼Œç”¨JSON.parseè§£ææˆå¯¹è±¡
      option && <ReactECharts option={option} />
    }
  </div>
    </div>
  );
};
export default AddChart;
```
```javascript
import {genChartByAiUsingPost, listChartByPageUsingPost} from "@/services/yubi/chartController";
import { UploadOutlined } from '@ant-design/icons';
import {useModel} from '@umijs/max';
import {
  Input,
  Button,
  Form,
  Select,
  Space,
  Upload, message,
} from 'antd';
import TextArea from 'antd/es/input/TextArea';
import { createStyles } from 'antd-style';
import React, {useEffect, useState} from 'react';
const { Option } = Select;
import ReactECharts from 'echarts-for-react';
const normFile = (e: any) => {
  console.log('Upload event:', e);
  if (Array.isArray(e)) {
    return e;
  }
  return e?.fileList;
};


const useStyles = createStyles(({ token }) => {
  return {
    action: {
      marginLeft: '8px',
      color: 'rgba(0, 0, 0, 0.2)',
      fontSize: '24px',
      verticalAlign: 'middle',
      cursor: 'pointer',
      transition: 'color 0.3s',
      '&:hover': {
        color: token.colorPrimaryActive,
      },
    },
    lang: {
      width: 42,
      height: 42,
      lineHeight: '42px',
      position: 'fixed',
      right: 16,
      borderRadius: token.borderRadius,
      ':hover': {
        backgroundColor: token.colorBgTextHover,
      },
    },
    container: {
      display: 'flex',
      flexDirection: 'column',
      height: '100vh',
      overflow: 'auto',
      backgroundImage:
        "url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')",
      backgroundSize: '100% 100%',
    },
  };
});

/**
 * æ·»åŠ å›¾è¡¨é¡µé¢
 * @constructor
 */
// æŠŠå¤šä½™çš„çŠ¶æ€åˆ æ‰ï¼Œé¡µé¢åç§°æ”¹ä¸ºAddChart
const AddChart: React.FC = () => {
  // å®šä¹‰çŠ¶æ€ï¼Œç”¨æ¥æ¥æ”¶åç«¯çš„è¿”å›å€¼ï¼Œè®©å®ƒå®æ—¶å±•ç¤ºåœ¨é¡µé¢ä¸Š
  const [chart, setChart] = useState<API.BiResponse>();
  const [option, setOption] = useState<any>();
  // æäº¤ä¸­çš„çŠ¶æ€ï¼Œé»˜è®¤æœªæäº¤
  const [submitting, setSubmitting] = useState<boolean>(false);

  /**
   * æäº¤
   * @param values
   */
  const onFinish = async (values: any) => {
    // å¦‚æœå·²ç»æ˜¯æäº¤ä¸­çš„çŠ¶æ€(è¿˜åœ¨åŠ è½½)ï¼Œç›´æ¥è¿”å›ï¼Œé¿å…é‡å¤æäº¤
    if (submitting) {
      return;
    }
    // å½“å¼€å§‹æäº¤ï¼ŒæŠŠsubmittingè®¾ç½®ä¸ºtrue
    setSubmitting(true);

    // å¯¹æ¥åç«¯ï¼Œä¸Šä¼ æ•°æ®
    const params = {
      ...values,
      file: undefined,
    };
    try {
      // éœ€è¦å–åˆ°ä¸Šä¼ çš„åŸå§‹æ•°æ®fileâ†’fileâ†’originFileObj(åŸå§‹æ•°æ®)
      const res = genChartByAiUsingPost(params, {}, values.file.file.originFileObj);
      // æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼å°±åˆ†æå¤±è´¥ï¼Œæœ‰ï¼Œå°±åˆ†ææˆåŠŸ
      if (!res?.data) {
        message.error('åˆ†æå¤±è´¥');
      } else {
        message.success('åˆ†ææˆåŠŸ');
        // è§£ææˆå¯¹è±¡ï¼Œä¸ºç©ºåˆ™è®¾ä¸ºç©ºå­—ç¬¦ä¸²
        const chartOption = JSON.parse(res.data.genChart ?? '');
        // å¦‚æœä¸ºç©ºï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶æç¤º'å›¾è¡¨ä»£ç è§£æé”™è¯¯'
        if (!chartOption) {
          throw new Error('å›¾è¡¨ä»£ç è§£æé”™è¯¯')
          // å¦‚æœæˆåŠŸ
        } else {
          // ä»åç«¯å¾—åˆ°å“åº”ç»“æœä¹‹åï¼ŒæŠŠå“åº”ç»“æœè®¾ç½®åˆ°å›¾è¡¨çŠ¶æ€é‡Œ
          setChart(res.data);
          setOption(chartOption);
        }
      }
      // å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæç¤ºåˆ†æå¤±è´¥+å…·ä½“å¤±è´¥åŸå› 
    } catch (e: any) {
      message.error('åˆ†æå¤±è´¥,' + e.message);
    }
    // å½“ç»“æŸæäº¤ï¼ŒæŠŠsubmittingè®¾ç½®ä¸ºfalse
    setSubmitting(false);
  };

  return (
    // æŠŠé¡µé¢å†…å®¹æŒ‡å®šä¸€ä¸ªç±»åadd-chart
    <div className="add-chart">
      <Form
        // è¡¨å•åç§°æ”¹ä¸ºaddChart
        name="addChart"
        onFinish={onFinish}
        // åˆå§‹åŒ–æ•°æ®å•¥éƒ½ä¸å¡«ï¼Œä¸ºç©º
        initialValues={{
        }}
        style={{ maxWidth: 600 }}
      >

        {/* å‰ç«¯è¡¨å•çš„nameï¼Œå¯¹åº”åç«¯æ¥å£è¯·æ±‚å‚æ•°é‡Œçš„å­—æ®µï¼Œæ­¤å¤„nameå¯¹åº”åç«¯åˆ†æç›®æ ‡goal,labelæ˜¯å·¦ä¾§çš„æç¤ºæ–‡æœ¬ï¼Œrules=....æ˜¯å¿…å¡«é¡¹æç¤º*/}
        <Form.Item name="goal" label="åˆ†æç›®æ ‡" rules={[{ required: true, message: 'è¯·è¾“å…¥åˆ†æç›®æ ‡!' }]}>
          {/* placeholderæ–‡æœ¬æ¡†å†…çš„æç¤ºè¯­ */}
          <TextArea placeholder="è¯·è¾“å…¥ä½ çš„åˆ†æéœ€æ±‚ï¼Œæ¯”å¦‚ï¼šåˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ"/>
        </Form.Item>

        {/* è¿˜è¦è¾“å…¥å›¾è¡¨åç§° */}
        <Form.Item name="name" label="å›¾è¡¨åç§°">
          <Input placeholder="è¯·è¾“å…¥å›¾è¡¨åç§°" />
        </Form.Item>

        {/* å›¾è¡¨ç±»å‹æ˜¯éå¿…å¡«ï¼Œæ‰€ä»¥ä¸åšæ ¡éªŒ */}
        <Form.Item
          name="selchartTypeect"
          label="å›¾è¡¨ç±»å‹"
        >
          <Select
            options={[
              { value: 'æŠ˜çº¿å›¾', label: 'æŠ˜çº¿å›¾' },
              { value: 'æŸ±çŠ¶å›¾', label: 'æŸ±çŠ¶å›¾' },
              { value: 'å †å å›¾', label: 'å †å å›¾' },
              { value: 'é¥¼å›¾', label: 'é¥¼å›¾' },
              { value: 'é›·è¾¾å›¾', label: 'é›·è¾¾å›¾' },
            ]}
          />
        </Form.Item>

        {/* æ–‡ä»¶ä¸Šä¼  */}
        <Form.Item
          name="file"
          label="åŸå§‹æ•°æ®"
        >
          <Upload name="file" action="/upload.do" listType="picture">
            <Button icon={<UploadOutlined />}>ä¸Šä¼  CSV æ–‡ä»¶</Button>
          </Upload>
        </Form.Item>


        <Form.Item wrapperCol={{ span: 12, offset: 6 }}>
          <Space>
            <Button type="primary" htmlType="submit">
              æäº¤
            </Button>
            <Button htmlType="reset">é‡ç½®</Button>
          </Space>
        </Form.Item>
      </Form>

      <div>
        åˆ†æç»“è®ºï¼š{chart?.genResult}
      </div>
      <div>
        ç”Ÿæˆå›¾è¡¨ï¼š
        {/* å¦‚æœå®ƒå­˜åœ¨ï¼Œæ‰æ¸²æŸ“è¿™ä¸ªç»„ä»¶ */}
        {
          // åç«¯è¿”å›çš„ä»£ç æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯å¯¹è±¡ï¼Œç”¨JSON.parseè§£ææˆå¯¹è±¡
          option && <ReactECharts option={option} />
        }
      </div>

    </div>
  );
};
export default AddChart;
```

æ¥åˆ°å‰ç«¯é¡µé¢ï¼Œè¾“å…¥å®Œä¿¡æ¯ï¼Œç‚¹å‡»æäº¤ï¼Œå›¾è¡¨å±•ç¤ºå‡ºæ¥äº†ã€‚
ps.æ²¡å±•ç¤ºå‡ºæ¥ï¼Œå†æäº¤å‡ æ¬¡ï¼Œå¯èƒ½ AI è¿”å›çš„ç»“æœåœ¨ä»£ç å‰å¤šäº†å‡ å¥ä¸­æ–‡ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684893640993-bcec197b-6887-4656-9c76-74f62261870a.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1077%2Climit_0#averageHue=%23f4f4f4&from=url&id=CkvCq&originHeight=788&originWidth=1077&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ç°åœ¨å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹ç•Œé¢çš„æ ·å¼äº†(å¯å»[ant.design ç»„ä»¶åº“](https://ant.design/index-cn)å‚è€ƒ)ï¼š
**æ¯”å¦‚ï¼š**

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684912361994-0a9ba2a4-d0e3-4134-9e5a-0746cf411ab3.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1351%2Climit_0#averageHue=%23debf91&from=url&id=vNiDN&originHeight=756&originWidth=1351&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)
```javascript
import {genChartByAiUsingPost, listChartByPageUsingPost} from "@/services/yubi/chartController";
import { UploadOutlined } from '@ant-design/icons';
import {useModel} from '@umijs/max';
import {
  Divider,
  Spin,
  Card,
  Col,
  Row,
  Input,
  Button,
  Form,
  Select,
  Space,
  Upload, message,
} from 'antd';
import TextArea from 'antd/es/input/TextArea';
import { createStyles } from 'antd-style';
import React, {useEffect, useState} from 'react';
const { Option } = Select;
import ReactECharts from 'echarts-for-react';
const normFile = (e: any) => {
  console.log('Upload event:', e);
  if (Array.isArray(e)) {
    return e;
  }
  return e?.fileList;
};


const useStyles = createStyles(({ token }) => {
  return {
    action: {
      marginLeft: '8px',
      color: 'rgba(0, 0, 0, 0.2)',
      fontSize: '24px',
      verticalAlign: 'middle',
      cursor: 'pointer',
      transition: 'color 0.3s',
      '&:hover': {
        color: token.colorPrimaryActive,
      },
    },
    lang: {
      width: 42,
      height: 42,
      lineHeight: '42px',
      position: 'fixed',
      right: 16,
      borderRadius: token.borderRadius,
      ':hover': {
        backgroundColor: token.colorBgTextHover,
      },
    },
    container: {
      display: 'flex',
      flexDirection: 'column',
      height: '100vh',
      overflow: 'auto',
      backgroundImage:
        "url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')",
      backgroundSize: '100% 100%',
    },
  };
});

/**
 * æ·»åŠ å›¾è¡¨é¡µé¢
 * @constructor
 */
// æŠŠå¤šä½™çš„çŠ¶æ€åˆ æ‰ï¼Œé¡µé¢åç§°æ”¹ä¸ºAddChart
const AddChart: React.FC = () => {
  // å®šä¹‰çŠ¶æ€ï¼Œç”¨æ¥æ¥æ”¶åç«¯çš„è¿”å›å€¼ï¼Œè®©å®ƒå®æ—¶å±•ç¤ºåœ¨é¡µé¢ä¸Š
  const [chart, setChart] = useState<API.BiResponse>();
  const [option, setOption] = useState<any>();
  // æäº¤ä¸­çš„çŠ¶æ€ï¼Œé»˜è®¤æœªæäº¤
  const [submitting, setSubmitting] = useState<boolean>(false);

  /**
   * æäº¤
   * @param values
   */
  const onFinish = async (values: any) => {
    // å¦‚æœå·²ç»æ˜¯æäº¤ä¸­çš„çŠ¶æ€(è¿˜åœ¨åŠ è½½)ï¼Œç›´æ¥è¿”å›ï¼Œé¿å…é‡å¤æäº¤
    if (submitting) {
      return;
    }
    // å¦‚æœæäº¤äº†ï¼ŒæŠŠå›¾è¡¨æ•°æ®å’Œå›¾è¡¨ä»£ç æ¸…ç©ºæ‰ï¼Œé˜²æ­¢å’Œä¹‹å‰æäº¤çš„å›¾æ ‡å †å åœ¨ä¸€èµ·
    // å¦‚æœoptionæ¸…ç©ºäº†ï¼Œç»„ä»¶å°±ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œå°±ä¸ä¼šä¿ç•™ä¹‹å‰çš„å†å²è®°å½•
    setChart(undefined);
    setOption(undefined);

    // å¯¹æ¥åç«¯ï¼Œä¸Šä¼ æ•°æ®
    const params = {
      ...values,
      file: undefined,
    };
    try {
      // éœ€è¦å–åˆ°ä¸Šä¼ çš„åŸå§‹æ•°æ®fileâ†’fileâ†’originFileObj(åŸå§‹æ•°æ®)
      const res = genChartByAiUsingPost(params, {}, values.file.file.originFileObj);
      // æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼å°±åˆ†æå¤±è´¥ï¼Œæœ‰ï¼Œå°±åˆ†ææˆåŠŸ
      if (!res?.data) {
        message.error('åˆ†æå¤±è´¥');
      } else {
        message.success('åˆ†ææˆåŠŸ');
        // è§£ææˆå¯¹è±¡ï¼Œä¸ºç©ºåˆ™è®¾ä¸ºç©ºå­—ç¬¦ä¸²
        const chartOption = JSON.parse(res.data.genChart ?? '');
        // å¦‚æœä¸ºç©ºï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶æç¤º'å›¾è¡¨ä»£ç è§£æé”™è¯¯'
        if (!chartOption) {
          throw new Error('å›¾è¡¨ä»£ç è§£æé”™è¯¯')
          // å¦‚æœæˆåŠŸ
        } else {
          // ä»åç«¯å¾—åˆ°å“åº”ç»“æœä¹‹åï¼ŒæŠŠå“åº”ç»“æœè®¾ç½®åˆ°å›¾è¡¨çŠ¶æ€é‡Œ
          setChart(res.data);
          setOption(chartOption);
        }
      }
      // å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæç¤ºåˆ†æå¤±è´¥+å…·ä½“å¤±è´¥åŸå› 
    } catch (e: any) {
      message.error('åˆ†æå¤±è´¥,' + e.message);
    }
    // å½“ç»“æŸæäº¤ï¼ŒæŠŠsubmittingè®¾ç½®ä¸ºfalse
    setSubmitting(false);
  };

  return (
    // æŠŠé¡µé¢å†…å®¹æŒ‡å®šä¸€ä¸ªç±»åadd-chart
    <div className="add-chart">
      {/* å˜æˆä¸¤åˆ— gutteråˆ—ä¸åˆ—ä¹‹é—´çš„é—´éš”*/}
      <Row gutter={24}>
        {/* è¡¨å•æ”¾åœ¨ç¬¬ä¸€åˆ—,å¡ç‰‡ç»„ä»¶é‡Œ */}
        <Col span={12}>
          <Card title="æ™ºèƒ½åˆ†æ">
            <Form
                // è¡¨å•åç§°æ”¹ä¸ºaddChart
                name="addChart"
                // labelæ ‡ç­¾çš„æ–‡æœ¬å¯¹é½æ–¹å¼
                labelAlign="left"
                // labelæ ‡ç­¾å¸ƒå±€ï¼ŒåŒ<Col>ç»„ä»¶ï¼Œè®¾ç½® span offset å€¼ï¼Œå¦‚ {span: 3, offset: 12}
                labelCol={{ span: 4 }}
                // è®¾ç½®æ§ä»¶å¸ƒå±€æ ·å¼
                wrapperCol={{ span: 16 }}
                onFinish={onFinish}
                // åˆå§‹åŒ–æ•°æ®å•¥éƒ½ä¸å¡«ï¼Œä¸ºç©º
                initialValues={{  }}
            >

              {/* å‰ç«¯è¡¨å•çš„nameï¼Œå¯¹åº”åç«¯æ¥å£è¯·æ±‚å‚æ•°é‡Œçš„å­—æ®µï¼Œæ­¤å¤„nameå¯¹åº”åç«¯åˆ†æç›®æ ‡goal,labelæ˜¯å·¦ä¾§çš„æç¤ºæ–‡æœ¬ï¼Œrules=....æ˜¯å¿…å¡«é¡¹æç¤º*/}
              <Form.Item name="goal" label="åˆ†æç›®æ ‡" rules={[{ required: true, message: 'è¯·è¾“å…¥åˆ†æç›®æ ‡!' }]}>
                {/* placeholderæ–‡æœ¬æ¡†å†…çš„æç¤ºè¯­ */}
                <TextArea placeholder="è¯·è¾“å…¥ä½ çš„åˆ†æéœ€æ±‚ï¼Œæ¯”å¦‚ï¼šåˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ"/>
              </Form.Item>

              {/* è¿˜è¦è¾“å…¥å›¾è¡¨åç§° */}
              <Form.Item name="name" label="å›¾è¡¨åç§°">
                <Input placeholder="è¯·è¾“å…¥å›¾è¡¨åç§°" />
              </Form.Item>

              {/* å›¾è¡¨ç±»å‹æ˜¯éå¿…å¡«ï¼Œæ‰€ä»¥ä¸åšæ ¡éªŒ */}
              <Form.Item
                name="chartType"
                label="å›¾è¡¨ç±»å‹"
              >
                <Select
                  options={[
                    { value: 'æŠ˜çº¿å›¾', label: 'æŠ˜çº¿å›¾' },
                    { value: 'æŸ±çŠ¶å›¾', label: 'æŸ±çŠ¶å›¾' },
                    { value: 'å †å å›¾', label: 'å †å å›¾' },
                    { value: 'é¥¼å›¾', label: 'é¥¼å›¾' },
                    { value: 'é›·è¾¾å›¾', label: 'é›·è¾¾å›¾' },
                  ]}
                />
              </Form.Item>

              {/* æ–‡ä»¶ä¸Šä¼  */}
              <Form.Item
                name="file"
                label="åŸå§‹æ•°æ®"
              >
                {/* action:å½“ä½ æŠŠæ–‡ä»¶ä¸Šä¼ ä¹‹åï¼Œå®ƒä¼šæŠŠæ–‡ä»¶ä¸Šä¼ è‡³å“ªä¸ªæ¥å£ã€‚è¿™é‡Œè‚¯å®šæ˜¯è°ƒç”¨è‡ªå·±çš„åç«¯ï¼Œå…ˆä¸ç”¨è¿™ä¸ª;maxCount={1} é™åˆ¶æ–‡ä»¶ä¸Šä¼ æ•°é‡ä¸º1 */}
                <Upload name="file" maxCount={1}>
                  <Button icon={<UploadOutlined />}>ä¸Šä¼  CSV æ–‡ä»¶</Button>
                </Upload>
              </Form.Item>

              {/* offsetè®¾ç½®å’Œlabelæ ‡ç­¾ä¸€æ ·çš„å®½åº¦ï¼Œè¿™æ ·å°±èƒ½ä¿æŒå¯¹é½ï¼›
                        å…¶ä»–å ç”¨çš„åˆ—è®¾ç½®æˆ16 */}
              <Form.Item wrapperCol={{ span: 16, offset: 4 }}>
                <Space>
                  {/* åŠ ä¸ªloadingï¼šå°±æ˜¯æŠŠsubmittingçš„çŠ¶æ€åŠ å…¥è¿›æ¥ï¼Œ
                        åŠ ä¸ªdisabledï¼šå¦‚æœæ­£åœ¨æäº¤ï¼Œå°±è®©è¿™ä¸ªæŒ‰é’®ç¦ç”¨ï¼Œä¸å…è®¸é‡å¤ç‚¹å‡»*/}
                  <Button type="primary" htmlType="submit" loading={submitting} disabled={submitting}>
                    æäº¤
                  </Button>
                  <Button htmlType="reset">é‡ç½®</Button>
                </Space>
              </Form.Item>
            </Form>
          </Card>
        </Col>

        {/* åˆ†æç»“è®ºå’Œå›¾è¡¨æ”¾åœ¨ç¬¬äºŒåˆ— */}
        <Col span={12}>
          <Card title="åˆ†æç»“è®º">
            {/* å¦‚æœåˆ†æç»“è®ºå­˜åœ¨ï¼Œå°±å±•ç¤ºåˆ†æç»“è®ºï¼›
                ä¸å­˜åœ¨åˆ™æ˜¾ç¤º'è¯·å…ˆåœ¨å·¦ä¾§è¿›è¡Œæäº¤' */}
            {chart?.genResult ?? <div>è¯·å…ˆåœ¨å·¦ä¾§è¿›è¡Œæäº¤</div>}
            {/* æäº¤ä¸­ï¼Œè¿˜æœªè¿”å›ç»“æœï¼Œåˆ†æç»“è®ºå°±æ˜¾ç¤ºåŠ è½½ä¸­çš„ç»„ä»¶ */}
            <Spin spinning={submitting}/>
          </Card>
          {/* åŠ ä¸€ä¸ªé—´è· */}
          <Divider />
          <Card title="å¯è§†åŒ–å›¾è¡¨">
            {/* å¦‚æœå®ƒå­˜åœ¨ï¼Œæ‰æ¸²æŸ“è¿™ä¸ªç»„ä»¶ */}
            {
              // åç«¯è¿”å›çš„ä»£ç æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯å¯¹è±¡ï¼Œç”¨JSON.parseè§£ææˆå¯¹è±¡
              option ? <ReactECharts option={option} /> : <div>è¯·å…ˆåœ¨å·¦ä¾§è¿›è¡Œæäº¤</div>
            }
            {/* æäº¤ä¸­ï¼Œè¿˜æœªè¿”å›ç»“æœï¼Œå›¾è¡¨å°±æ˜¾ç¤ºåŠ è½½ä¸­çš„ç»„ä»¶ */}
            <Spin spinning={submitting}/>
          </Card>
        </Col>
      </Row>
    </div>
  );
};
export default AddChart;
```

ä¿®æ”¹é¡µé¢çš„åå­—nameå’Œå›¾æ ‡iconã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684914109437-aebbb201-0ac7-425a-a875-5766de9aae50.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_835%2Climit_0#averageHue=%23f7f3f1&from=url&id=TnlML&originHeight=247&originWidth=835&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684914342950-6f3a39fa-7af4-4e18-9fe6-282d38553953.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1281%2Climit_0#averageHue=%23f7f7f7&from=url&id=tETK3&originHeight=660&originWidth=1281&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ps.å›¾æ ‡å¯ä»¥å»ç»„ä»¶åº“å†…æŒ‘é€‰ï¼Œç‚¹å‡»å›¾æ ‡å°±å¯å¤åˆ¶ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684913845394-62092da4-6763-4811-a03f-5cc095a25427.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1274%2Climit_0#averageHue=%23fcfbfb&from=url&id=BfI9i&originHeight=673&originWidth=1274&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

è¿›å…¥ç½‘ç«™æ•°æ®.xlsxã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684914681878-03ee142a-b13f-4fa7-94cd-1a00718d824b.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_886%2Climit_0#averageHue=%23f4f2ef&from=url&id=jovlf&originHeight=404&originWidth=886&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

åœ¨ç½‘ç«™æ•°æ®.xlsxä¸­å¤šæ·»åŠ å‡ æ¡æ•°æ®ï¼Œç„¶åä¿å­˜ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684914832389-eeff193d-7901-4591-b6bc-c8f2e92ddedb.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_516%2Climit_0#averageHue=%23d9ad6d&from=url&id=Ow0lr&originHeight=605&originWidth=516&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

æµ‹è¯•ä¸€ä¸‹ã€‚
ps.ä¸æˆåŠŸï¼Œå¯ä»¥è¯•ç€åˆ·æ–°é¡µé¢ï¼Œé‡æ–°æäº¤ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684915929934-07067427-5bc9-45f5-803d-9cc61f4ae71c.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1394%2Climit_0#averageHue=%23fafafa&from=url&id=lH6iG&originHeight=448&originWidth=1394&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

å›¾è¡¨å±•ç¤ºå‡ºæ¥äº†ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684916113463-fe361072-630f-4849-802a-02e3553fa0a9.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1372%2Climit_0#averageHue=%23f8f8f8&from=url&id=MyTqp&originHeight=715&originWidth=1372&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ç„¶åæ¢æˆé›·è¾¾å›¾ï¼Œçœ‹çœ‹ä¼šä¸ä¼šå †å å›¾è¡¨ï¼Œæ²¡æœ‰å †å ã€‚

![](https://cdn.nlark.com/yuque/0/2023/png/25430380/1684916268582-fce3b5e4-593b-4577-aa09-261bfee1b431.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_1377%2Climit_0#averageHue=%23f8f8f8&from=url&id=jvESA&originHeight=625&originWidth=1377&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&status=done&style=none&title=)

ç»“æŸå’¯~ä¼‘æ¯ä¼‘æ¯ï¼Œèµ°åŠ¨èµ°åŠ¨(oâ‰–â—¡â‰–) 
#### æ€»ç»“
#### ç”Ÿæˆçš„å›¾è¡¨
[https://git.hust.cc/echarts-for-react/](https://git.hust.cc/echarts-for-react/)
ä½¿ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤å®‰è£…ï¼š
```bash
npm install echarts-for-react
&& 
npm install echarts-for-react --save
```
ä½†æ˜¯å‡ºç°ä»¥ä¸‹çš„æŠ¥é”™ï¼šï¼ˆå¯èƒ½æ˜¯ç”µè„‘ç¯å¢ƒçš„é—®é¢˜ï¼‰
åœæ­¢é¡¹ç›®è¿è¡Œï¼Œå®‰è£…echartsï¼š
```
npm install echarts --save
```
å†æ¬¡è¿è¡Œç¨‹åºæˆåŠŸå¯åŠ¨
ä¿®æ”¹AIåŠ©æ‰‹è®¾å®šï¼š
```
ä½ æ˜¯ä¸€ä¸ªæ•°æ®åˆ†æå¸ˆå’Œå‰ç«¯å¼€å‘ä¸“å®¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§ä»¥ä¸‹å›ºå®šæ ¼å¼ç»™ä½ æä¾›å†…å®¹ï¼š
åˆ†æéœ€æ±‚ï¼š
{æ•°æ®åˆ†æçš„éœ€æ±‚æˆ–è€…ç›®æ ‡}
åŸå§‹æ•°æ®ï¼š
{csvæ ¼å¼çš„åŸå§‹æ•°æ®ï¼Œç”¨,ä½œä¸ºåˆ†éš”ç¬¦}
è¯·æ ¹æ®è¿™ä¸¤éƒ¨åˆ†å†…å®¹ï¼ŒæŒ‰ç…§ä»¥ä¸‹æŒ‡å®šæ ¼å¼ç”Ÿæˆå†…å®¹ï¼ˆæ­¤å¤–ä¸è¦è¾“å‡ºä»»ä½•å¤šä½™çš„å¼€å¤´ã€ç»“å°¾ã€æ³¨é‡Šï¼‰
ã€ã€ã€ã€ã€
{å‰ç«¯ Echarts V5 çš„ option é…ç½®å¯¹è±¡çš„jsonæ ¼å¼ä»£ç ï¼Œåˆç†åœ°å°†æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œä¸è¦ç”Ÿæˆä»»ä½•å¤šä½™çš„å†…å®¹ï¼Œæ¯”å¦‚æ³¨é‡Š}
ã€ã€ã€ã€ã€
{æ˜ç¡®çš„æ•°æ®åˆ†æç»“è®ºã€è¶Šè¯¦ç»†è¶Šå¥½ï¼Œä¸è¦ç”Ÿæˆå¤šä½™çš„æ³¨é‡Š}
```
#### ç”Ÿæˆå›¾è¡¨ç»“è®º
å®Œæ•´ç•Œé¢ä»£ç ï¼š
```typescript
import { genChartByAiUsingPOST } from '@/services/ShierBI/chartController';
import { Button, Card, Col, Divider, Form, message, Row, Select, Space, Spin, Upload } from 'antd';
import React, { useState } from 'react';

import { UploadOutlined } from '@ant-design/icons';
import TextArea from 'antd/es/input/TextArea';
import ReactECharts from 'echarts-for-react';

const AddChart: React.FC = () => {
  const [chart, setChart] = useState<API.BiResponse>();
  const [option, setOption] = useState<any>();
  const [submitting, setSubmitting] = useState<boolean>(false);

  /**
   * æäº¤è¡¨å•
   * @param values
   */
  const onFinish = async (values: any) => {
    // é¿å…é‡å¤æäº¤
    if (submitting) {
      return;
    }
    // å¼€å§‹æäº¤
    setSubmitting(true);
    setChart(undefined);
    setOption(undefined);
    const param = {
      ...values,
      file: undefined,
    };
    try {
      const res = await genChartByAiUsingPOST(param, {}, values.file.file.originFileObj);
      if (!res?.data) {
        message.error('åˆ†æå¤±è´¥');
      } else {
        message.success('åˆ†ææˆåŠŸ');
        const chartOption = JSON.parse(res.data.genChart ?? '');
        if (!chartOption) {
          throw new Error('å›¾è¡¨ä»£ç è§£æé”™è¯¯');
        } else {
          setChart(res.data);
          setOption(chartOption);
        }
      }
    } catch (e: any) {
      message.error('åˆ†æå¤±è´¥,' + e.message);
    }
    // æäº¤å®Œæˆ
    setSubmitting(false);
  };

  return (
    <div className="add-chart">
      <Row gutter={24}>
        <Col span={12}>
          <Card>
            <Divider style={{ fontWeight: 'bold', color: 'blue' }}>æ™ºèƒ½åˆ†æ</Divider>
            <Form
              name="addChart"
              labelAlign="left"
              labelCol={{ span: 4 }}
              wrapperCol={{ span: 16 }}
              onFinish={onFinish}
              initialValues={{}}
            >
              <Form.Item
                name="goal"
                label="åˆ†æç›®æ ‡"
                rules={[{ required: true, message: 'è¯·è¾“å…¥åˆ†æç›®æ ‡' }]}
              >
                <TextArea placeholder="è¯·è¾“å…¥ä½ çš„åˆ†æéœ€æ±‚ï¼Œæ¯”å¦‚åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ" />
              </Form.Item>

              <Form.Item
                name="chartName"
                label="å›¾è¡¨åç§°"
                rules={[{ required: true, message: 'è¯·è¾“å…¥å›¾è¡¨åç§°ï¼' }]}
              >
                <TextArea placeholder="è¯·è¾“å…¥å›¾è¡¨åç§°" />
              </Form.Item>

              <Form.Item
                name="chartType"
                label="å›¾è¡¨ç±»å‹"
                rules={[{ required: true, message: 'è¯·é€‰æ‹©å›¾è¡¨ç±»å‹ï¼' }]}
              >
                <Select
                  options={[
                    { value: 'é¥¼å›¾', label: 'é¥¼å›¾' },
                    { value: 'åœ°å›¾', label: 'åœ°å›¾' },
                    { value: 'æ ‘å›¾', label: 'æ ‘å›¾' },
                    { value: 'æŠ˜çº¿å›¾', label: 'æŠ˜çº¿å›¾' },
                    { value: 'æŸ±çŠ¶å›¾', label: 'æŸ±çŠ¶å›¾' },
                    { value: 'é›·è¾¾å›¾', label: 'é›·è¾¾å›¾' },
                    { value: 'æ¡å½¢å›¾', label: 'æ¡å½¢å›¾' },
                    { value: 'çƒ­åŠ›å›¾', label: 'çƒ­åŠ›å›¾' },
                    { value: 'æ¼æ–—å›¾', label: 'æ¼æ–—å›¾' },
                    { value: 'æ•£ç‚¹å›¾', label: 'æ•£ç‚¹å›¾' },
                    { value: 'ä»ªè¡¨ç›˜', label: 'ä»ªè¡¨ç›˜' },
                    { value: 'Kçº¿å›¾', label: 'Kçº¿å›¾' },
                    { value: 'é•¿å›¾è¡¨', label: 'é•¿å›¾è¡¨' },
                    { value: 'åŒºåŸŸå›¾', label: 'åŒºåŸŸå›¾' },
                    { value: 'é¢ç§¯çƒ­åŠ›å›¾', label: 'é¢ç§¯çƒ­åŠ›å›¾' },
                    { value: 'ä¸‰ç»´æ•£ç‚¹å›¾', label: 'ä¸‰ç»´æ•£ç‚¹å›¾' },
                  ]}
                ></Select>
              </Form.Item>

              <Form.Item name="file" label="åŸå§‹æ•°æ®">
                <Upload name="file" maxCount={1} accept=".csv,.xls,.xlsx,.json,.txt,.xml,.sql">
                  <Button icon={<UploadOutlined />}>ä¸Šä¼  CSV æ–‡ä»¶(Excel)</Button>
                </Upload>
              </Form.Item>

              <Form.Item wrapperCol={{ span: 16, offset: 4 }}>
                <Space>
                  <Button
                    type="primary"
                    htmlType="submit"
                    loading={submitting}
                    disabled={submitting}
                  >
                    ç¡®å®šä¸Šä¼ 
                  </Button>
                  <Button htmlType="reset">é‡ç½®å†…å®¹</Button>
                </Space>
              </Form.Item>
            </Form>
          </Card>
        </Col>

        <Col span={12}>
          <Card>
            <Divider style={{ fontWeight: 'bold', color: 'blue' }}>å¯è§†åŒ–å›¾è¡¨</Divider>
            <Card>
              {option ? (
                <ReactECharts option={option} />
              ) : (
                <div
                  style={{
                    color: 'red',
                    textAlign: 'center',
                    fontWeight: 'bold',
                    fontSize: '16px',
                  }}
                >
                  è¯·åœ¨å·¦ä¾§è¿›è¡Œæäº¤åˆ†ææ•°æ®ï¼
                </div>
              )}
              <Spin spinning={submitting} size="large" />
            </Card>

            <Divider style={{ fontWeight: 'bold', color: 'blue' }}>ç”±ä¸Šå›¾å¾—å‡ºç»“è®º</Divider>
            <Card>
              {chart?.genResult ?? (
                <div
                  style={{
                    color: 'red',
                    textAlign: 'center',
                    fontWeight: 'bold',
                    fontSize: '16px',
                  }}
                >
                  æ— å¯è§†åŒ–å›¾è¡¨ï¼Œæ— æ³•å¾—å‡ºç»“è®ºï¼
                </div>
              )}
              <Spin spinning={submitting} size="large" />
            </Card>
          </Card>
        </Col>
      </Row>
    </div>
  );
};
export default AddChart;
```
#### æŠ¥é”™
[JSON.parse: expected property name or '}'](https://stackoverflow.com/questions/8013582/json-parse-expected-property-name-or)
è§£å†³åŠæ³•ï¼š{}å†…ä¸èƒ½å‡ºç°å•å¼•å·
```typescript
const onFinish = async (values: any) => {
    // é¿å…é‡å¤æäº¤
    if (submitting) {
        return;
    }
    setSubmitting(true);
    setChart(undefined);
    setOption(undefined);
    // å¯¹æ¥åç«¯ï¼Œä¸Šä¼ æ•°æ®
    const params = {
        ...values,
        file: undefined,
    };
    try {
        const res = await genChartByAiUsingPost(params, {}, values.file.file.originFileObj);
        if (!res?.data) {
            message.error('åˆ†æå¤±è´¥');
        } else {
            message.success('åˆ†ææˆåŠŸ');
            let jsonString = res.data.genChart ?? "";
            // æ›¿æ¢å•å¼•å·ä¸ºåŒå¼•å·
            jsonString = jsonString.replace(/'/g, '"');
            // å¤„ç†ä¸ç¬¦åˆ JSON è§„èŒƒçš„å†…å®¹
            // æ¯”å¦‚æ›¿æ¢å¯èƒ½çš„é”™è¯¯æ ¼å¼ (key: value) ä¸º ("key": "value")
            jsonString = jsonString.replace(/([{,]\s*)(\w+)\s*:/g, '$1"$2":');
            jsonString = jsonString.replace(/: (\w+)/g, ': "$1"');
            const chartOption = JSON.parse(jsonString);
            // const chartOption = JSON.parse(res.data.genChart ?? "");
            if (!chartOption) {
                throw new Error('å›¾è¡¨ä»£ç è§£æé”™è¯¯')
            } else {
                setChart(res.data);
                setOption(chartOption);
            }
        }
    } catch (e: any) {
        console.log(e.message)
        message.error('åˆ†æå¤±è´¥ï¼Œ' + e.message);
    }
    setSubmitting(false);
};
```
å®Œæ•´ä»£ç pages/AddChart/index.tsxï¼š
```typescript
import { UploadOutlined } from '@ant-design/icons';
import {Button, Card, Col, Divider, Form, Input, message, Row, Select, Space, Spin, Upload} from 'antd';
import TextArea from 'antd/es/input/TextArea';
import React, { useState } from 'react';
import ReactECharts from 'echarts-for-react';
import {genChartByAiUsingPost} from "@/services/yubi/chartController";

/**
 * æ·»åŠ å›¾è¡¨é¡µé¢
 * @constructor
 */
const AddChart: React.FC = () => {
    const [chart, setChart] = useState<API.BiResponse>();
    const [option, setOption] = useState<any>();
    const [submitting, setSubmitting] = useState<boolean>(false);

    /**
     * æäº¤
     * @param values
     */
    const onFinish = async (values: any) => {
        // é¿å…é‡å¤æäº¤
        if (submitting) {
            return;
        }
        setSubmitting(true);
        setChart(undefined);
        setOption(undefined);
        // å¯¹æ¥åç«¯ï¼Œä¸Šä¼ æ•°æ®
        const params = {
            ...values,
            file: undefined,
        };
        try {
            const res = await genChartByAiUsingPost(params, {}, values.file.file.originFileObj);
            if (!res?.data) {
                message.error('åˆ†æå¤±è´¥');
            } else {
                message.success('åˆ†ææˆåŠŸ');
                let jsonString = res.data.genChart ?? "";
                // æ›¿æ¢å•å¼•å·ä¸ºåŒå¼•å·
                jsonString = jsonString.replace(/'/g, '"');
                // å¤„ç†ä¸ç¬¦åˆ JSON è§„èŒƒçš„å†…å®¹
                // æ¯”å¦‚æ›¿æ¢å¯èƒ½çš„é”™è¯¯æ ¼å¼ (key: value) ä¸º ("key": "value")
                jsonString = jsonString.replace(/([{,]\s*)(\w+)\s*:/g, '$1"$2":');
                jsonString = jsonString.replace(/: (\w+)/g, ': "$1"');
                const chartOption = JSON.parse(jsonString);
                // const chartOption = JSON.parse(res.data.genChart ?? "");
                if (!chartOption) {
                    throw new Error('å›¾è¡¨ä»£ç è§£æé”™è¯¯')
                } else {
                    setChart(res.data);
                    setOption(chartOption);
                }
            }
        } catch (e: any) {
            console.log(e.message)
            message.error('åˆ†æå¤±è´¥ï¼Œ' + e.message);
        }
        setSubmitting(false);
    };

    return (
        <div className="add-chart">
            <Row gutter={24}>
                <Col span={12}>
                    <Card title="æ™ºèƒ½åˆ†æ">
                        <Form name="addChart" labelAlign="left" labelCol={{ span: 4 }}
                              wrapperCol={{ span: 16 }} onFinish={onFinish} initialValues={{}}>
                            <Form.Item
                                name="goal"
                                label="åˆ†æç›®æ ‡"
                                rules={[{ required: true, message: 'è¯·è¾“å…¥åˆ†æç›®æ ‡' }]}
                            >
                                <TextArea placeholder="è¯·è¾“å…¥ä½ çš„åˆ†æéœ€æ±‚ï¼Œæ¯”å¦‚ï¼šåˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ" />
                            </Form.Item>
                            <Form.Item name="name" label="å›¾è¡¨åç§°">
                                <Input placeholder="è¯·è¾“å…¥å›¾è¡¨åç§°" />
                            </Form.Item>
                            <Form.Item name="chartType" label="å›¾è¡¨ç±»å‹">
                                <Select
                                    options={[
                                        { value: 'é¥¼å›¾', label: 'é¥¼å›¾' },
                                        { value: 'åœ°å›¾', label: 'åœ°å›¾' },
                                        { value: 'æ ‘å›¾', label: 'æ ‘å›¾' },
                                        { value: 'æŠ˜çº¿å›¾', label: 'æŠ˜çº¿å›¾' },
                                        { value: 'æŸ±çŠ¶å›¾', label: 'æŸ±çŠ¶å›¾' },
                                        { value: 'é›·è¾¾å›¾', label: 'é›·è¾¾å›¾' },
                                        { value: 'æ¡å½¢å›¾', label: 'æ¡å½¢å›¾' },
                                        { value: 'çƒ­åŠ›å›¾', label: 'çƒ­åŠ›å›¾' },
                                        { value: 'æ•£ç‚¹å›¾', label: 'æ•£ç‚¹å›¾' },
                                        { value: 'ä»ªè¡¨ç›˜', label: 'ä»ªè¡¨ç›˜' },
                                        { value: 'Kçº¿å›¾', label: 'Kçº¿å›¾' },
                                        { value: 'é•¿å›¾è¡¨', label: 'é•¿å›¾è¡¨' },
                                        { value: 'åŒºåŸŸå›¾', label: 'åŒºåŸŸå›¾' },
                                        { value: 'é¢ç§¯çƒ­åŠ›å›¾', label: 'é¢ç§¯çƒ­åŠ›å›¾' },
                                        { value: 'ä¸‰ç»´æ•£ç‚¹å›¾', label: 'ä¸‰ç»´æ•£ç‚¹å›¾' },
                                    ]}
                                />
                            </Form.Item>
                            <Form.Item name="file" label="åŸå§‹æ•°æ®">
                                <Upload name="file" maxCount={1}>
                                    <Button icon={<UploadOutlined />}>ä¸Šä¼  CSV æ–‡ä»¶</Button>
                                </Upload>
                            </Form.Item>

                            <Form.Item wrapperCol={{ span: 16, offset: 4 }}>
                                <Space>
                                    <Button type="primary" htmlType="submit" loading={submitting} disabled={submitting}>
                                        æäº¤
                                    </Button>
                                    <Button htmlType="reset">é‡ç½®</Button>
                                </Space>
                            </Form.Item>
                        </Form>
                    </Card>
                </Col>
                <Col span={12}>
                    <Card title="åˆ†æç»“è®º">
                        {chart?.genResult ?? <div>è¯·å…ˆåœ¨å·¦ä¾§è¿›è¡Œæäº¤</div>}
                        <Spin spinning={submitting}/>
                    </Card>
                    <Divider />
                    <Card title="å¯è§†åŒ–å›¾è¡¨">
                        {
                            option ? <ReactECharts option={option} /> : <div>è¯·å…ˆåœ¨å·¦ä¾§è¿›è¡Œæäº¤</div>
                        }
                        <Spin spinning={submitting}/>
                    </Card>
                </Col>
            </Row>
        </div>
    );
};
export default AddChart;
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723262288199-f884fb8a-c6a5-4f3d-a67d-af9b5e7659ca.png#averageHue=%23f7f7f7&clientId=u0ba0c7ad-c00f-4&from=paste&height=817&id=ucea04b26&originHeight=980&originWidth=1904&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=260426&status=done&style=none&taskId=udaad14a1-b800-4b15-8cca-ad7e82e2b5d&title=&width=1586.6666036182005)
## ç¬¬ä¸‰æœŸ TODO

1.  ç•Œé¢ä¼˜åŒ– Â âˆš 
2.  chartService å¤„ç†AIç”Ÿæˆä¸šåŠ¡ âˆš 
```java

/**
 * @author Shier
 * @description é’ˆå¯¹è¡¨ã€chart(å›¾è¡¨ä¿¡æ¯è¡¨)ã€‘çš„æ•°æ®åº“æ“ä½œServiceå®ç°
 * @createDate 2023-05-14 19:20:33
 */
@Service
public class ChartServiceImpl extends ServiceImpl<ChartMapper, Chart> implements ChartService {

    @Resource
    private UserService userService;

    @Resource
    private AiManager aiManager;

    @Override
    public BiResponse genChartByAi(MultipartFile multipartFile, GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
        String chartName = genChartByAiRequest.getChartName();
        String goal = genChartByAiRequest.getGoal();
        String chartType = genChartByAiRequest.getChartType();
        User loginUser = userService.getLoginUser(request);
        // æ ¡éªŒ
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "å›¾è¡¨åˆ†æç›®æ ‡ä¸ºç©º");
        ThrowUtils.throwIf(StringUtils.isNotBlank(chartName) && chartName.length() > 200, ErrorCode.PARAMS_ERROR, "å›¾è¡¨åç§°è¿‡é•¿");
        ThrowUtils.throwIf(StringUtils.isBlank(chartType), ErrorCode.PARAMS_ERROR, "å›¾è¡¨ç±»å‹ä¸ºç©º");
        // æ— éœ€Promptï¼Œç›´æ¥è°ƒç”¨ç°æœ‰æ¨¡å‹
        // æ„é€ ç”¨æˆ·è¾“å…¥
        StringBuilder userInput = new StringBuilder();
        userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
        // æ‹¼æ¥åˆ†æç›®æ ‡
        String userGoal = goal;
        if (StringUtils.isNotBlank(chartType)) {
            userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
        }
        userInput.append(userGoal).append("\n");
        userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");

        // å‹ç¼©åçš„æ•°æ®
        String csvData = ExcelUtils.excelToCsv(multipartFile);
        userInput.append(csvData).append("\n");
        // è°ƒç”¨AI
        String chartResult = aiManager.doChat(userInput.toString());
        // è§£æå†…å®¹
        String[] splits = chartResult.split(GEN_CONTENT_SPLITS);
        if (splits.length < GEN_ITEM_NUM) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "AIç”Ÿæˆé”™è¯¯");
        }
        // é¦–æ¬¡ç”Ÿæˆçš„å†…å®¹
        String preGenChart = splits[GEN_CHART_IDX].trim();
        String genResult = splits[GEN_RESULT_IDX].trim();
        String validGenChart = ChartUtils.getValidGenChart(preGenChart);

        // æ’å…¥æ•°æ®åˆ°æ•°æ®åº“
        Chart chart = new Chart();
        chartName = StringUtils.isBlank(chartName) ? ChartUtils.genDefaultChartName() : chartName;
        chart.setGoal(goal);
        chart.setChartData(csvData);
        chart.setChartName(chartName);
        chart.setChartType(chartType);
        chart.setGenChart(preGenChart);
        chart.setGenResult(genResult);
        chart.setUserId(loginUser.getId());
        boolean saveResult = this.save(chart);
        ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");
        // è¿”å›åˆ°å‰ç«¯
        BiResponse biResponse = new BiResponse();
        biResponse.setGenChart(preGenChart);
        biResponse.setGenResult(genResult);
        return biResponse;
    }
}
```

```java
/**
 * å›¾è¡¨æ–‡ä»¶ä¸Šä¼ 
 */
@PostMapping("/gen")
@ApiOperation(value = "å›¾è¡¨æ–‡ä»¶ä¸Šä¼ ")
public BaseResponse<BiResponse> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                             GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
    String chartName = genChartByAiRequest.getChartName();
    String goal = genChartByAiRequest.getGoal();
    String chartType = genChartByAiRequest.getChartType();
    // æ ¡éªŒ
    ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "å›¾è¡¨åˆ†æç›®æ ‡ä¸ºç©º");
    ThrowUtils.throwIf(StringUtils.isNotBlank(chartName) && chartName.length() > 200, ErrorCode.PARAMS_ERROR, "å›¾è¡¨åç§°è¿‡é•¿");
    ThrowUtils.throwIf(StringUtils.isBlank(chartType), ErrorCode.PARAMS_ERROR, "å›¾è¡¨ç±»å‹ä¸ºç©º");
    BiResponse biResponse = chartService.genChartByAi(multipartFile, genChartByAiRequest, request);
    ThrowUtils.throwIf(biResponse == null, ErrorCode.SYSTEM_ERROR, "AIç”Ÿæˆé”™è¯¯");
    return ResultUtils.success(biResponse);
}
```


3.  ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–åˆæ³•çš„ echarts é…ç½® json ä»£ç  âˆš 
4.  ç”¨æˆ·æœªå–å›¾è¡¨åç§°åˆ™ç»™å›¾è¡¨ç”Ÿæˆé»˜è®¤åå­— âˆš 
```java
/**
 * @author Shier
 * CreateTime 2023/5/21 17:41
 * å›¾è¡¨å·¥å…·ç±»
 */
public class ChartUtils {
    private static final Pattern VALID_GEN_CHART_PATTERN = Pattern.compile(GEN_CHART_REGEX, Pattern.COMMENTS);

    /**
     * ä¾ç…§æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…åˆæ³•çš„å›¾è¡¨çš„echartsé…ç½®
     *
     * @param preGenChart æå–å‰çš„åŸæ•°æ®
     * @return æå–åçš„jsonä¸²
     */
    public static String getValidGenChart(String preGenChart) {
        Matcher matcher = VALID_GEN_CHART_PATTERN.matcher(preGenChart);
        ThrowUtils.throwIf(!matcher.find(), ErrorCode.SYSTEM_ERROR, "AIç”Ÿæˆå›¾è¡¨é”™è¯¯");
        return matcher.group();
    }

    /**
     * å¦‚æœç”¨æˆ·æ²¡æœ‰ä¼ å›¾è¡¨çš„åç§°ï¼Œç”Ÿæˆé»˜è®¤çš„
     *
     * @return é»˜è®¤çš„å›¾è¡¨åç§°
     */
    public static String genDefaultChartName() {
        return DEFAULT_CHART_NAME_PREFIX + RandomStringUtils.randomAlphabetic(DEFAULT_CHART_NAME_SUFFIX_LEN);
    }
}
```


5.  å¸¸é‡æå–ï¼Œä¿è¯ä»£ç å¯è¯»æ€§ Â âˆš 
```java
package com.shier.shierbi.constant;

import java.util.Arrays;
import java.util.List;

/**
 * @author Shier
 * CreateTime 2023/5/21 17:38
 */
public interface ChartConstant {
    /**
     * AIç”Ÿæˆçš„å†…å®¹åˆ†éš”ç¬¦
     */
    String GEN_CONTENT_SPLITS = "ã€ã€ã€ã€ã€";

    /**
     * AI ç”Ÿæˆçš„å†…å®¹çš„å…ƒç´ ä¸º3ä¸ª
     */
    int GEN_ITEM_NUM = 3;

    /**
     * ç”Ÿæˆå›¾è¡¨çš„æ•°æ®ä¸‹æ ‡
     */
    int GEN_CHART_IDX = 1;

    /**
     * ç”Ÿæˆå›¾è¡¨çš„åˆ†æç»“æœçš„ä¸‹æ ‡
     */
    int GEN_RESULT_IDX = 2;

    /**
     * æå–ç”Ÿæˆçš„å›¾è¡¨çš„Echartsé…ç½®çš„æ­£åˆ™
     */
    String GEN_CHART_REGEX = "\\{(?>[^{}]*(?:\\{[^{}]*}[^{}]*)*)}";

    /**
     * å›¾è¡¨é»˜è®¤åç§°çš„å‰ç¼€
     */
    String DEFAULT_CHART_NAME_PREFIX = "åˆ†æå›¾è¡¨_";

    /**
     * å›¾è¡¨é»˜è®¤åç§°çš„åç¼€é•¿åº¦
     */
    int DEFAULT_CHART_NAME_SUFFIX_LEN = 10;
}
```


6.  æ–°å¢é…ç½®ç±»ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ä¼ å…¥æ¨¡å‹ id Â âˆš 
```java
/**
 * @author Shier
 * CreateTime 2023/5/21 18:27
 */
@Data
@Component
@ConfigurationProperties(prefix = "ai.model")
public class AiModelConfig {
    /**
     * æ¨¡å‹id
     */
    private Long modelId;
}
```

```yaml
# è¦ä½¿ç”¨çš„æ¨¡å‹ID
ai:
  model:
    model-id: 1660100329896673281
```

> å®Œæ•´ä»£ç çœ‹GitHub

# ç¬¬å››æœŸç›´æ’­ - å›¾è¡¨ç®¡ç†åŠŸèƒ½ã€ä¼˜åŒ–ç³»ç»Ÿ
å›¾è¡¨ç®¡ç†åŠŸèƒ½å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»åšè¿‡ä¼™ä¼´åŒ¹é…ã€ç”¨æˆ·ä¸­å¿ƒå’Œ API å¼€æ”¾å¹³å°çš„ç®¡ç†åŠŸèƒ½ï¼Œéƒ½æ˜¯åŸºäºå¢åˆ æ”¹æŸ¥å®ç°çš„ã€‚æˆ‘ä»¬å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼æ¥å±•ç¤ºå›¾è¡¨ä¿¡æ¯ï¼Œé¦–å…ˆéœ€è¦åšä¸€ä¸ªåˆ—è¡¨é¡µã€‚åç«¯å·²ç»åœ¨æ˜Ÿçƒæä¾›äº†ä¸€ä¸ªåŸºç¡€çš„ä¸‡èƒ½é¡¹ç›®æ¨¡æ¿ï¼ŒåŒ…å«å¢åˆ æ”¹æŸ¥æ¥å£ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œå®šåˆ¶åŒ–å¼€å‘å³å¯ã€‚æ‰€ä»¥æœ¬æœŸåç«¯çš„å¼€å‘é‡ä¸å¤šï¼Œåªéœ€è¦å¤ç”¨å³å¯ï¼Œä¸»è¦æ˜¯å‰ç«¯ã€‚ 
## 1ã€å¼€å‘å›¾è¡¨ç®¡ç†åŠŸèƒ½ - å¢åˆ æ”¹æŸ¥
### åç«¯
åç«¯ï¼šå¤ç”¨ springboot-init åˆå§‹åŒ–æ¨¡æ¿çš„å¢åˆ æ”¹æŸ¥ä»£ç ï¼Œ
æ ¸å¿ƒï¼šè·å–ä¸ªäººåˆ›å»ºçš„å›¾è¡¨åˆ—è¡¨ listMyChartByPage
### 
å‰ç«¯ï¼š

1. å¼€å‘ä¸€ä¸ªåˆ—è¡¨é¡µ
2. æ”¯ç‰¹æŒ‰ç…§å›¾è¡¨åç§°æœç´¢
> åç«¯åœ¨ç¬¬ä¸€æœŸåˆå§‹åŒ–åç«¯æ¨¡æ¿æ—¶å°±å·²ç»å®Œæˆäº†ï¼Œæ‰€ä»¥è¯´å¯ä»¥å…ˆå»å¼€å‘å‰ç«¯

## 2ã€å‰ç«¯å¼€å‘

1. åˆ›å»ºè·¯ç”±å’Œé¡µé¢ï¼Œç¡®ä¿é¡µé¢èƒ½è®¿é—®åˆ°
2. è·å–éœ€è¦çš„æ•°æ®ï¼Œå®šä¹‰ state å˜é‡æ¥å­˜å‚¨æ•°æ®ï¼Œç”¨äºç»™é¡µé¢å±•ç¤º
3. å…ˆæŠŠæœ€ç®€å•ç›´è§‚çš„æ•°æ®å±•ç¤ºç»™å‰ç«¯ï¼Œå†å»è°ƒç¥¥å¼
4. å¼•å…¥Ant Designçš„Listç»„ä»¶ï¼Œ[https://ant.design/components/list-cn](https://ant.design/components/list-cn)ï¼Œå¤åˆ¶ç¤ºä¾‹ä»£ç 
5. è°ƒæ•´ List ç»„ä»¶ä¸­çš„å†…å®¹ä¸ºè‡ªå·±çš„ï¼ˆæ³¨æ„ï¼Œè·å–ç”¨æˆ·å¤´åƒå¯ä»¥ä»åˆå§‹åŒ–çŠ¶æ€ä¸­è·å–ï¼‰
6. é’ˆå¯¹æ ·å¼ï¼Œå¯¹æ•°æ®åšä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚ç»Ÿä¸€éšè—å›¾è¡¨è‡ªèº«çš„ title
7. å¢åŠ åˆ†é¡µ
8. å¢åŠ æœç´¢æ¡†
9. å…¶ä»–ä¼˜åŒ–ï¼šæ¯”å¦‚ loading æ•ˆæœ
10. å¢åŠ åˆ é™¤çš„åŠŸèƒ½ï¼ˆè‡ªå·±è¡¥å……ï¼‰
###  2.1 åˆ›å»ºè·¯ç”±å’Œé¡µé¢(æ—¶é—´ç‚¹ 15:03-18:32)
ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè·¯ç”±ï¼Œè¿›å…¥ routes.ts ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723263950204-27328aa8-aa7c-49c3-ac1b-7a96052d6f65.png#averageHue=%23f4f3f2&clientId=u0ba0c7ad-c00f-4&from=paste&height=402&id=ub4e38856&originHeight=482&originWidth=694&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=160738&status=done&style=none&taskId=ub1b88b40-00b3-415a-a7a4-df8601708b5&title=&width=578.3333103524324)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723264078852-184579e2-8d69-472a-b94b-f7aa19e99325.png#averageHue=%23232529&clientId=u0ba0c7ad-c00f-4&from=paste&height=969&id=u0234852d&originHeight=1163&originWidth=2540&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=278263&status=done&style=none&taskId=uf055517f-4f4b-4428-b268-aa19f48faee&title=&width=2116.6665825578934)
```typescript
export default [
  { name : 'ç™»å½•', path: '/user', layout: false, routes: [{ path: '/user/login', component: './User/Login' }] },
  // { name: 'æ¬¢è¿é¡µé¢', path: '/welcome', icon: 'smile', component: './Welcome' },
  {path: '/', redirect: '/add_chart'},
  { name: 'æ™ºèƒ½åˆ†æ', path: '/add_chart', icon: 'barChart', component: './AddChart' },
  { name: 'æˆ‘çš„å›¾è¡¨', path: '/my_chart', icon: 'pieChart', component: './MyChart' },
  {
    path: '/admin',
    icon: 'crown',
    access: 'canAdmin',
    name : 'ç®¡ç†å‘˜é¡µé¢',
    routes: [
      { path: '/admin', redirect: '/admin/sub-page' },
      { path: '/admin/sub-page', component: './Admin' },
    ],
  },
  { path: '/', redirect: '/welcome' },
  { path: '*', layout: false, component: './404' },
];

```
ç¬¬äºŒæ­¥ï¼šåˆ›å»ºé¡µé¢ï¼Œå¤åˆ¶ AddChartç›®å½• ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723263973108-09678e83-9b95-4616-b69b-08eaa969ef72.png#averageHue=%23f2f0f0&clientId=u0ba0c7ad-c00f-4&from=paste&height=270&id=u68ccabf5&originHeight=324&originWidth=694&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=58104&status=done&style=none&taskId=ub6b451bd-acb2-460a-8dd6-64f94927ba7&title=&width=578.3333103524324)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723264099813-78c706bd-af44-4eca-96b8-1473de22f42e.png#averageHue=%23282b2f&clientId=u0ba0c7ad-c00f-4&from=paste&height=646&id=ue688607d&originHeight=775&originWidth=1289&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=173437&status=done&style=none&taskId=ubc6b2161-a349-4038-b07a-9a0d9160b59&title=&width=1074.16662398312)
ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨é¡µé¢(æµè§ˆå®ç°æ•ˆæœ)ï¼Œå‰ç«¯åœ¨ç»ˆç«¯ä½¿ç”¨ yarn run dev å¯åŠ¨é¡¹ç›®ã€‚
åŒæ—¶å¯åŠ¨åç«¯é¡¹ç›®ï¼Œè®¿é—® http://localhost:8000 <http://localhost:8000/> ï¼Œè¾“å…¥è´¦å·å’Œå¯†ç è¿›è¡Œç™»å½•ã€‚

1.  åˆ›å»ºè·¯ç”±å’Œé¡µé¢ï¼Œç¡®ä¿é¡µé¢èƒ½è®¿é—®åˆ° 
2.  è·å–éœ€è¦çš„æ•°æ®ï¼Œå®šä¹‰ state å˜é‡æ¥å­˜å‚¨æ•°æ®ï¼Œç”¨äºç»™é¡µé¢å±•ç¤º 
3.  å…ˆæŠŠæœ€ç®€å•ç›´è§‚çš„æ•°æ®å±•ç¤ºç»™å‰ç«¯ï¼Œå†å»è°ƒç¥¥å¼ 
```tsx
import { listMyChartByPageUsingPOST } from '@/services/ShierBI/ChartController';
import { message } from 'antd';
import React, { useEffect, useState } from 'react';

const MyChartPage: React.FC = () => {
  /**
   * åˆå§‹å€¼
   */
  const initSearchParams = {
    pageSize: 12,
  };

  const [searchParams, setSearchParams] = useState({
    ...initSearchParams,
  });
  /**
   * åˆ†é¡µè·å–å›¾è¡¨
   */
  const [chartList, setChartList] = useState<API.Chart[]>();
  const [chartTotal, setChartTotal] = useState<number>();

  /**
   * åŠ è½½å›¾è¡¨æ•°æ®
   */
  const loadData = async () => {
    try {
      let res = await listMyChartByPageUsingPOST(searchParams);
      if (res.data) {
        setChartList(res.data.records ?? []);
        setChartTotal(res.data.total ?? 0);
      } else {
        message.error('è·å–æˆ‘çš„å›¾è¡¨å¤±è´¥');
      }
    } catch (e: any) {
      message.error('è·å–æˆ‘çš„å›¾è¡¨å¤±è´¥' + e.message);
    }
  };
  /**
   * å˜åŒ–æ—¶æ‰§è¡Œæ­¤å¤„
   */
  useEffect(() => {
    loadData();
  }, [searchParams]);

  return (
    <div className="my-chart-page">
      æ•°æ®åˆ—è¡¨ï¼š
      {JSON.stringify(chartList)}
      

      æ€»æ•°ï¼š
      {chartTotal}
    </div>
  );
};
export default MyChartPage;
```

1.  å¼•å…¥Ant Designçš„Listç»„ä»¶ï¼Œhttps://ant.design/components/list-cnï¼Œå¤åˆ¶ç¤ºä¾‹ä»£ç  
2.  è°ƒæ•´ List ç»„ä»¶ä¸­çš„å†…å®¹ä¸ºè‡ªå·±çš„ï¼ˆæ³¨æ„ï¼Œè·å–ç”¨æˆ·å¤´åƒå¯ä»¥ä»åˆå§‹åŒ–çŠ¶æ€ä¸­è·å–ï¼‰ 
```jsx
const { initialState } = useModel('@@initialState');
const { currentUser } = initialState || {};
```

3.  é’ˆå¯¹æ ·å¼ï¼Œå¯¹æ•°æ®åšä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚ç»Ÿä¸€éšè—å›¾è¡¨è‡ªèº«çš„ title 
4.  å¢åŠ åˆ†é¡µ 
5.  å¢åŠ æœç´¢æ¡† 
6.  å…¶ä»–ä¼˜åŒ–ï¼šæ¯”å¦‚ loading æ•ˆæœ 
7.  å¢åŠ åˆ é™¤çš„åŠŸèƒ½ï¼ˆè‡ªå·±è¡¥å……ï¼‰ 
```typescript
import {
  deleteChartUsingPOST,
  listMyChartByPageUsingPOST,
} from '@/services/ShierBI/ChartController';
import { useModel } from '@@/exports';
import { ExclamationCircleOutlined } from '@ant-design/icons';
import { Avatar, Button, Card, Col, Divider, List, message, Modal, Row } from 'antd';
import Search from 'antd/es/input/Search';
import ReactECharts from 'echarts-for-react';
import React, { useEffect, useState } from 'react';

const MyChartPage: React.FC = () => {
  /**
   * åˆå§‹å€¼
   */
  const initSearchParams = {
    current: 1,
    pageSize: 6,
  };

  const [searchParams, setSearchParams] = useState<API.ChartQueryRequest>({
    ...initSearchParams,
  });

  // const [selectedChartId, setSelectedChartId] = useState<number | undefined>(undefined);

  /**
   * åˆ†é¡µè·å–å›¾è¡¨
   */
  const [chartList, setChartList] = useState<API.Chart[]>();
  const [chartTotal, setChartTotal] = useState<number>(0);
  const [loading, setLoading] = useState<boolean>(true);
  /**
   * è·å–å½“å‰ç”¨æˆ·
   */
  const { initialState } = useModel('@@initialState');
  const { currentUser } = initialState || {};

  /**
   * åˆ é™¤å›¾è¡¨
   * @param chartId
   */
  const handleDelete = (chartId: any) => {
    Modal.confirm({
      title: 'ç¡®è®¤åˆ é™¤',
      icon: <ExclamationCircleOutlined />,
      content: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå›¾è¡¨å—ï¼Ÿ',
      okText: 'ç¡®è®¤',
      cancelText: 'å–æ¶ˆ',
      onOk: async () => {
        try {
          const res = await deleteChartUsingPOST({ id: chartId });
          // åç«¯è¿”å› booleanå€¼
          console.log("res:",res.data);
          if (res.data) {
            message.success('åˆ é™¤æˆåŠŸ');
            // åˆ é™¤æˆåŠŸåé‡æ–°åŠ è½½å›¾è¡¨æ•°æ®
            loadData();
          } else {
            message.error('åˆ é™¤å¤±è´¥');
          }
        } catch (e: any) {
          message.error('åˆ é™¤å¤±è´¥' + e.message);
        }
      },
    });
  };

  /**
   * åŠ è½½å›¾è¡¨æ•°æ®
   */
  const loadData = async () => {
    setLoading(loading);
    try {
      let res = await listMyChartByPageUsingPOST(searchParams);
      if (res.data) {
        setChartList(res.data.records ?? []);
        setChartTotal(res.data.total ?? 0);
        // éšè—title
        if (res.data.records) {
          res.data.records.forEach((data) => {
            const chartOption = JSON.parse(data.genChart ?? '{}');
            // å–å‡ºtitleå¹¶ä¸”è®¾ç½®ä¸º undefined
            chartOption.title = undefined;
            data.genChart = JSON.stringify(chartOption);
          });
        }
      } else {
        message.error('è·å–æˆ‘çš„å›¾è¡¨å¤±è´¥');
      }
    } catch (e: any) {
      message.error('è·å–æˆ‘çš„å›¾è¡¨å¤±è´¥' + e.message);
    }
    setLoading(false);
  };
  /**
   * å˜åŒ–æ—¶æ‰§è¡Œæ­¤å¤„
   */
  useEffect(() => {
    loadData();
  }, [searchParams]);

  return (
    <div className="my-chart-page">
      <div className="margin-20">
        <Search
          placeholder="è¯·è¾“å…¥å›¾æ ‡åç§°æœç´¢"
          loading={loading}
          enterButton
          onSearch={(value) => {
            setSearchParams({
              ...initSearchParams,
              chartName: value,
            });
          }}
        />
      </div>

      <List
        grid={{
          gutter: 16,
          xs: 1,
          sm: 1,
          md: 1,
          lg: 2,
          xl: 2,
          xxl: 2,
        }}
        pagination={{
          // è®¾ç½®åˆ†é¡µ
          showTotal: () => `å…± ${chartTotal} æ¡è®°å½•`,
          showSizeChanger: true,
          showQuickJumper: true,
          pageSizeOptions: ['6', '10', '14', '20'],
          onChange: (page, pageSize) => {
            setSearchParams({
              ...searchParams,
              current: page,
              pageSize,
            });
          },
          current: searchParams.current, // å½“å‰é¡µ
          pageSize: searchParams.pageSize, // æ¯é¡µæ¡æ•°
          total: chartTotal, // æ€»æ•°
        }}
        loading={loading}
        dataSource={chartList}
        renderItem={(item) => (
          <List.Item key={item.id}>
            <Card style={{ width: '100%' }}>
              <List.Item.Meta
                avatar={<Avatar src={currentUser?.userAvatar} />}
                title={currentUser?.userName}
              />
              <p
                style={{
                  textAlign: 'center',
                  fontWeight: 'bold',
                  color: 'black',
                  fontSize: '16px',
                }}
              >
                {'åˆ†æç›®æ ‡ï¼š' + item.goal}
              </p>
              <List.Item.Meta
                style={{ textAlign: 'right' }}
                description={item.chartType ? 'å›¾è¡¨ç±»å‹ï¼š' + item.chartType : undefined}
              />
              <ReactECharts option={item.genChart && JSON.parse(item.genChart)} />
              <p
                style={{
                  textAlign: 'center',
                  fontWeight: 'bold',
                  color: '#e617ff',
                  fontSize: '16px',
                }}
              >
                {'å›¾è¡¨åç§°ï¼š' + item.chartName}
              </p>
              <Divider style={{ fontWeight: 'bold', color: 'blue', fontSize: '16px' }}>
                æ™ºèƒ½åˆ†æç»“æœ
              </Divider>
              <p style={{ fontWeight: 'bold', color: '#0b93a1' }}>{item.genResult}</p>
              <Row justify="end">
                <Col>
                  <Button danger onClick={() => handleDelete(item.id)}>
                    åˆ é™¤
                  </Button>
                </Col>
              </Row>
            </Card>
          </List.Item>
        )}
      />
    </div>
  );
};
export default MyChartPage;
```
### æŠ¥é”™
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723270525337-8c2fafee-2287-4074-86f3-58ce9a8b5968.png#averageHue=%23fafbd9&clientId=u0ba0c7ad-c00f-4&from=paste&height=439&id=u6a0133d7&originHeight=527&originWidth=1719&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=68279&status=done&style=none&taskId=u07b62b47-baeb-41f8-a8d8-f73b79de886&title=&width=1432.4999430775665)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723270387554-2df4e4e6-5d51-4c2f-83cd-8cee011b67be.png#averageHue=%23202226&clientId=u0ba0c7ad-c00f-4&from=paste&height=631&id=ue0764c33&originHeight=757&originWidth=1914&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=190093&status=done&style=none&taskId=uca5a82d6-54fe-488b-ac61-3be638be5e9&title=&width=1594.999936620397)
å®Œæ•´ä»£ç src/pages/MyChart/index.tsxï¼š
```typescript
import { useModel } from '@@/exports';
import { ExclamationCircleOutlined } from '@ant-design/icons';
import { Avatar, Button, Card, Col, Divider, List, message, Modal, Row } from 'antd';
import Search from 'antd/es/input/Search';
import ReactECharts from 'echarts-for-react';
import React, { useEffect, useState } from 'react';
import {deleteChartUsingPost, listMyChartByPageUsingPost} from "@/services/yubi/chartController";

const MyChartPage: React.FC = () => {
    /**
     * åˆå§‹å€¼
     */
    const initSearchParams = {
        current: 1,
        pageSize: 6,
    };
    // å½“å‰çš„æœç´¢å‚æ•°
    const [searchParams, setSearchParams] = useState<API.ChartQueryRequest>({
        ...initSearchParams,
    });

    // const [selectedChartId, setSelectedChartId] = useState<number | undefined>(undefined);

    /**
     * åˆ†é¡µè·å–å›¾è¡¨
     */
    // å­˜å‚¨è¿”å›çš„å›¾è¡¨åˆ—è¡¨
    const [chartList, setChartList] = useState<API.Chart[]>();
    // å›¾è¡¨æ€»æ•°
    const [chartTotal, setChartTotal] = useState<number>(0);
    // åŠ è½½çŠ¶æ€
    const [loading, setLoading] = useState<boolean>(true);
    /**
     * è·å–å½“å‰ç”¨æˆ·
     */
    const { initialState } = useModel('@@initialState');
    const { currentUser } = initialState || {};

    /**
     * åˆ é™¤å›¾è¡¨
     * @param chartId
     */
    const handleDelete = (chartId: any) => {
        Modal.confirm({
            title: 'ç¡®è®¤åˆ é™¤',
            icon: <ExclamationCircleOutlined />,
            content: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå›¾è¡¨å—ï¼Ÿ',
            okText: 'ç¡®è®¤',
            cancelText: 'å–æ¶ˆ',
            onOk: async () => {
                try {
                    // const res = await deleteChartUsingPost({ id: chartId });
                    const res = await deleteChartUsingPost({ id: chartId });
                    // åç«¯è¿”å› booleanå€¼
                    console.log("res:",res.data);
                    if (res.data) {
                        message.success('åˆ é™¤æˆåŠŸ');
                        // åˆ é™¤æˆåŠŸåé‡æ–°åŠ è½½å›¾è¡¨æ•°æ®
                        loadData();
                    } else {
                        message.error('åˆ é™¤å¤±è´¥');
                    }
                } catch (e: any) {
                    message.error('åˆ é™¤å¤±è´¥' + e.message);
                }
            },
        });
    };

    /**
     * åŠ è½½å›¾è¡¨æ•°æ®
     */
    const loadData = async () => {
        setLoading(loading);
        try {
            // let res = await listMyChartByPageUsingPOST(searchParams);
            let res = await listMyChartByPageUsingPost(searchParams);
            if (res.data) {
                setChartList(res.data.records ?? []);
                setChartTotal(res.data.total ?? 0);
                // éšè—title
                if (res.data.records) {
                    res.data.records.forEach((data) => {
                        let jsonString = data.genChart ?? '{}';
                        // æ›¿æ¢å•å¼•å·ä¸ºåŒå¼•å·
                        jsonString = jsonString.replace(/'/g, '"');
                        // å¤„ç†ä¸ç¬¦åˆ JSON è§„èŒƒçš„å†…å®¹
                        // æ¯”å¦‚æ›¿æ¢å¯èƒ½çš„é”™è¯¯æ ¼å¼ (key: value) ä¸º ("key": "value")
                        jsonString = jsonString.replace(/([{,]\s*)(\w+)\s*:/g, '$1"$2":');
                        jsonString = jsonString.replace(/: (\w+)/g, ': "$1"');

                        // const chartOption = JSON.parse(data.genChart ?? '{}');
                        const chartOption = JSON.parse(jsonString);
                        // å–å‡ºtitleå¹¶ä¸”è®¾ç½®ä¸º undefined
                        chartOption.title = undefined;
                        data.genChart = JSON.stringify(chartOption);
                    });
                }
            } else {
                message.error('è·å–æˆ‘çš„å›¾è¡¨å¤±è´¥');
            }
        } catch (e: any) {
            message.error('è·å–æˆ‘çš„å›¾è¡¨å¤±è´¥' + e.message);
        }
        setLoading(false);
    };
    /**
     * å˜åŒ–æ—¶æ‰§è¡Œæ­¤å¤„
     */
    useEffect(() => {
        loadData();
    }, [searchParams]);

    return (
        <div className="my-chart-page">
            <div className="margin-20">
                <Search
                    placeholder="è¯·è¾“å…¥å›¾æ ‡åç§°æœç´¢"
                    loading={loading}
                    enterButton
                    onSearch={(value) => {
                        setSearchParams({
                            ...initSearchParams,
                            name: value,
                        });
                    }}
                />
            </div>
            <div className="margin-16"></div>
            <List
                grid={{
                    gutter: 16,
                    xs: 1,
                    sm: 1,
                    md: 1,
                    lg: 2,
                    xl: 2,
                    xxl: 2,
                }}
                pagination={{
                    // è®¾ç½®åˆ†é¡µ
                    showTotal: () => `å…± ${chartTotal} æ¡è®°å½•`,
                    showSizeChanger: true,
                    showQuickJumper: true,
                    pageSizeOptions: ['6', '10', '14', '20'],
                    onChange: (page, pageSize) => {
                        setSearchParams({
                            ...searchParams,
                            current: page,
                            pageSize,
                        });
                    },
                    current: searchParams.current, // å½“å‰é¡µ
                    pageSize: searchParams.pageSize, // æ¯é¡µæ¡æ•°
                    total: chartTotal, // æ€»æ•°
                }}
                loading={loading}
                dataSource={chartList}
                renderItem={(item) => (
                    <List.Item key={item.id}>
                        <Card style={{ width: '100%' }}>
                            <List.Item.Meta
                                avatar={<Avatar src={currentUser?.userAvatar} />}
                                title={currentUser?.userName}
                            />
                            <p
                                style={{
                                    textAlign: 'center',
                                    fontWeight: 'bold',
                                    color: 'black',
                                    fontSize: '16px',
                                }}
                            >
                                {'åˆ†æç›®æ ‡ï¼š' + item.goal}
                            </p>
                            <List.Item.Meta
                                style={{ textAlign: 'right' }}
                                description={item.chartType ? 'å›¾è¡¨ç±»å‹ï¼š' + item.chartType : undefined}
                            />
                            <ReactECharts option={item.genChart && JSON.parse(item.genChart)} />
                            <p
                                style={{
                                    textAlign: 'center',
                                    fontWeight: 'bold',
                                    color: '#e617ff',
                                    fontSize: '16px',
                                }}
                            >
                                {'å›¾è¡¨åç§°ï¼š' + item.name}
                            </p>
                            <Divider style={{ fontWeight: 'bold', color: 'blue', fontSize: '16px' }}>
                                æ™ºèƒ½åˆ†æç»“æœ
                            </Divider>
                            <p style={{ fontWeight: 'bold', color: '#0b93a1' }}>{item.genResult}</p>
                            <Row justify="end">
                                <Col>
                                    <Button danger onClick={() => handleDelete(item.id)}>
                                        åˆ é™¤
                                    </Button>
                                </Col>
                            </Row>
                        </Card>
                    </List.Item>
                )}
            />
        </div>
    );
};
export default MyChartPage;
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723270872165-47ac6496-4b2c-4e23-8b8c-0fd9ceb10f79.png#averageHue=%23fbfbfb&clientId=u0ba0c7ad-c00f-4&from=paste&height=813&id=u406f5a67&originHeight=976&originWidth=1908&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=322248&status=done&style=none&taskId=u508992ab-d3e6-41a9-aec2-30fa7f21740&title=&width=1589.999936819079)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723271047646-1910eb54-2d9f-450d-b2aa-667fc8499eb3.png#averageHue=%23fdfafa&clientId=u0ba0c7ad-c00f-4&from=paste&height=249&id=uc644444e&originHeight=299&originWidth=695&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=63807&status=done&style=none&taskId=uf9f4d186-83f8-4d11-9411-a33450a99a1&title=&width=579.1666436526519)
è¯´æ˜æˆ‘ä»¬çš„æ•°æ®åº“ä¸­æœ‰è„æ•°æ®ï¼Œå›åˆ°åç«¯ï¼ŒæŸ¥çœ‹ chartè¡¨ã€‚
æ€ä¹ˆçŸ¥é“å“ªæ¡æ•°æ®æ˜¯è„æ•°æ®ï¼Œæš‚æ—¶æŠŠå®ƒä¸å±•ç¤ºå‘¢ï¼Ÿ

1. ç¬¨åŠæ³•ï¼š
æ‰¾åˆ° isDeleteå­—æ®µ(0-å­˜åœ¨,1-åˆ é™¤) ï¼Œç¬¬ä¸€æ¡æ•°æ®ä¸å˜ï¼Œå…¶ä½™æ”¹ä¸º 1ï¼›
å¦‚æœå‰ç«¯æŠ¥é”™ä¾æ—§å­˜åœ¨ï¼Œè¯´æ˜è¿™æ¡æ˜¯è„æ•°æ®ï¼Œå°±æŠŠè¿™æ¡æ•°æ®çš„ isDeleteå­—æ®µ æ”¹ä¸º 1ï¼›
é€ä¸ªåˆ¤æ–­ä¿®æ”¹åçš„æ¯æ¡æ•°æ®æ˜¯å¦å­˜åœ¨å‰ç«¯æŠ¥é”™ï¼Œå¦‚æœå­˜åœ¨å‰ç«¯æŠ¥é”™ï¼Œåˆ™å°†è¯¥æ¡æ•°æ®ä»¥åŠä¹‹å‰æ‰€æœ‰
è¢«æ ‡è®°ä¸ºè„æ•°æ®çš„æ•°æ®æ ‡è®°ä¸ºåˆ é™¤ã€‚
2. ä¹Ÿå¯ä»¥é€šè¿‡æ£€æŸ¥ genChartå­—æ®µ çš„æ•°æ®ï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦åˆæ³•ã€‚æ¯”å¦‚ï¼š
â— æ£€æŸ¥å¼€å¤´æ˜¯å¦æœ‰ä¸­æ–‡
-   æ£€æŸ¥å‰åæ˜¯å¦æœ‰å›è½¦ã€ç©ºè¡Œï¼› 
- æ£€æŸ¥ xAxisï¼ˆyAxisã€seriesã€typeã€dataç­‰ï¼‰æ˜¯å¦è¢«åŒå¼•å·åŒ…è£¹ã€‚ ç­‰ç­‰ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723271157263-9342d03f-a8ad-4d39-8277-b97d5635b3e3.png#averageHue=%23d1cdc4&clientId=u0ba0c7ad-c00f-4&from=paste&height=352&id=u5da26bc7&originHeight=423&originWidth=656&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=230861&status=done&style=none&taskId=u5d10fe10-e37b-4ac1-ba86-34d5f865312&title=&width=546.6666449440859)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723271173807-a599ee1d-8d08-484a-a861-8f3c49db417b.png#averageHue=%23f3f2f1&clientId=u0ba0c7ad-c00f-4&from=paste&height=860&id=uf3b368da&originHeight=1032&originWidth=1920&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=187824&status=done&style=none&taskId=u49448c48-e90a-4cd8-9c18-3e757cf523f&title=&width=1599.9999364217147)
### ç¾åŒ–
ç»§ç»­ç¾åŒ–é¡µé¢å†…å®¹ï¼Œå¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œç»Ÿä¸€éšè—å›¾è¡¨æ ‡é¢˜ã€å¢åŠ åˆ†é¡µã€æœç´¢æ¡†ã€‚
æŠŠå¸¸ç”¨çš„æ ·å¼è®¾å®šæˆå›ºå®šçš„ css æ ·å¼(ä¿—ç§°ï¼šåŸå­åŒ– css)ï¼› 
æ‰¾åˆ° global.less (å…¨å±€æ ·å¼)ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723271355987-1e27b213-2a0b-404d-a17b-615a4832f488.png#averageHue=%2323262a&clientId=u0ba0c7ad-c00f-4&from=paste&height=1420&id=ue0abdf84&originHeight=1704&originWidth=2880&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=347844&status=done&style=none&taskId=u29e4d01a-52d0-4eb9-925e-06fb5acd097&title=&width=2399.999904632572)
```typescript
html,
body,
#root {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,
    'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',
    'Noto Color Emoji';
}

.colorWeak {
  filter: invert(80%);
}

.ant-layout {
  min-height: 100vh;
}
.ant-pro-sider.ant-layout-sider.ant-pro-sider-fixed {
  left: unset;
}

canvas {
  display: block;
}

body {
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

ul,
ol {
  list-style: none;
}

@media (max-width: 768px) {
  .ant-table {
    width: 100%;
    overflow-x: auto;
    &-thead > tr,
    &-tbody > tr {
      > th,
      > td {
        white-space: pre;
        > span {
          display: block;
        }
      }
    }
  }
}

.margin-16 {
  margin-bottom: 16px;
}
```
å›åˆ° index.tsx æ‰“ä¸Šè¿™ä¸ªæ ·å¼ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723271486465-304a56a0-86c9-493c-806d-a73dea00c778.png#averageHue=%23242529&clientId=u0ba0c7ad-c00f-4&from=paste&height=1420&id=u01188587&originHeight=1704&originWidth=2880&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=404628&status=done&style=none&taskId=u852de1a5-e6dd-4812-ab3c-fe3041afd20&title=&width=2399.999904632572)
## 3ã€ç³»ç»Ÿä¼˜åŒ–
ç°åœ¨çš„ç½‘ç«™è¶³å¤Ÿå®‰å…¨ä¹ˆï¼Ÿ

1. å¦‚æœç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªè¶…å¤§çš„æ–‡ä»¶æ€ä¹ˆåŠï¼Ÿ
2. å¦‚æœç”¨æˆ·ç”¨ç§‘æŠ€ç–¯ç‹‚ç‚¹å‡»æäº¤ï¼Œæ€ä¹ˆåŠï¼Ÿ
3. å¦‚æœ AI çš„ç”Ÿæˆå¤ªæ…¢ï¼ˆæ¯”å¦‚éœ€è¦ä¸€åˆ†é’Ÿï¼‰ï¼Œåˆæœ‰å¾ˆå¤šç”¨æˆ·è¦åŒæ—¶ç”Ÿæˆï¼Œç»™ç³»ç»Ÿé€ æˆäº†å‹åŠ›ï¼Œæ€ä¹ˆå…¼é¡¾ç”¨æˆ·
4. ä½“éªŒå’Œç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Ÿ

ç°åœ¨æˆ‘ä»¬çš„ç½‘ç«™æœ‰å“ªå‡ æ–¹é¢éƒ½ä¸è¶³ï¼Ÿ

1. å®‰å…¨æ€§ï¼šå¦‚æœç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªè¶…å¤§çš„æ–‡ä»¶æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚ 1000 Gï¼Ÿ
2. æ•°æ®å­˜å‚¨ï¼šæˆ‘ä»¬å°†æ¯ä¸ªå›¾è¡¨çš„åŸå§‹æ•°æ®å…¨éƒ¨å­˜æ”¾åœ¨åŒä¸€ä¸ªæ•°æ®è¡¨(chartè¡¨)ä¸­ï¼ŒåæœŸæ•°æ®é‡å¤§
çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´æŸ¥è¯¢å›¾è¡¨æˆ–æŸ¥è¯¢ chartè¡¨ç­‰æ“ä½œå˜å¾—ç¼“æ…¢ã€‚
3. é™æµï¼šåœ¨åšçœŸæ­£ä¸Šçº¿çš„ç³»ç»Ÿä¸­ï¼Œå¦‚æœç³»ç»Ÿéœ€è¦ä»˜è´¹æ‰èƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚æ¯æ¬¡ç”¨æˆ·è°ƒç”¨èªæ˜ AI å‘é€
ä¸€æ¡æ¶ˆæ¯ï¼ŒAI ç»™å‡ºä¸€ä¸ªå›ç­”ï¼Œè¿™èƒŒåéƒ½éœ€è¦è¿›è¡Œæˆæœ¬çš„æ‰£é™¤ã€‚
### 3.1 å®‰å…¨æ€§
åªè¦æˆ‘ä»¬å…è®¸ç”¨æˆ·è‡ªè¡Œä¸Šä¼ å†…å®¹ï¼Œå°±æœ‰å¯èƒ½ä¼šå—åˆ°æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„ç½‘ç«™ä½¿ç”¨äº†ä¸€ä¸ªå›¾ç‰‡å­˜å‚¨æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå¦‚æœæŸä¸ªç”¨æˆ·æƒ³æ”»å‡»æˆ‘ä»¬ï¼Œä»–å¯èƒ½ä¼šåœ¨ä¸Šä¼ åŸå§‹æ•°æ®æ—¶é€šè¿‡ä¸Šä¼ ä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ï¼ˆå¦‚ 1000Gï¼‰æ¥åˆ©ç”¨æˆ‘ä»¬æœåŠ¡å™¨çš„å¸¦å®½å’Œå­˜å‚¨èµ„æºã€‚ 
è¿™æ ·çš„æ”»å‡»æ˜¯å¾ˆå¯æ€•çš„ï¼Œå› ä¸ºæœåŠ¡å™¨çš„è´Ÿè½½å’Œç½‘ç»œæµé‡åˆ©ç”¨ç‡ä¼šå¤§å¹…æé«˜ã€‚ç”±äºæœåŠ¡å™¨å¾ˆè´µï¼Œè€Œå®¶åº­å®½å¸¦æˆæœ¬å¾ˆä¾¿å®œï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨è‡ªå·±çš„å®¶åº­ç½‘ç»œæ”»å‡»æˆ‘ä»¬(æ”»å‡»è€…é‡‡ç”¨ä½æˆæœ¬çš„æ‰‹æ®µå¯¹æˆ‘ä»¬è¿›è¡Œæ”»å‡»ï¼Œå´è®©æˆ‘ä»¬æ‰¿æ‹…é«˜æ˜‚çš„æˆæœ¬)ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬çš„ç½‘ç«™æ¶‰åŠåˆ°ç”¨æˆ·ä¸Šä¼ æ“ä½œï¼Œä¸€å®šè¦å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œä»¥é˜²æ­¢æ”»å‡»ï¼Œå¦‚æœæˆ‘ä»¬ä¸å¯¹ä¸Šä¼ æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œæˆ‘ä»¬å°±è¦èŠ±è´¹æ›´å¤šçš„èµ„é‡‘æ¥è¿›è¡Œé˜²å¾¡ã€‚
**åªè¦æ¶‰åŠåˆ°ç”¨æˆ·è‡ªä¸»ä¸Šä¼ çš„æ“ä½œï¼Œä¸€å®šè¦æ ¡éªŒæ–‡ä»¶ï¼ˆå›¾åƒï¼‰**
æ ¡éªŒçš„ç»´åº¦ï¼š

1. æ–‡ä»¶çš„å¤§å°
2. æ–‡ä»¶çš„åç¼€
3. æ–‡ä»¶çš„å†…å®¹ï¼ˆæˆæœ¬è¦é«˜ä¸€äº›ï¼‰
4. æ–‡ä»¶çš„åˆè§„æ€§ï¼ˆæ¯”å¦‚æ•æ„Ÿå†…å®¹ï¼Œå»ºè®®ç”¨ç¬¬ä¸‰æ–¹çš„å®¡æ ¸åŠŸèƒ½ï¼‰

æ‰©å±•ç‚¹ï¼šæ¥å…¥è…¾è®¯äº‘çš„å›¾ç‰‡ä¸‡è±¡æ•°æ®å®¡æ ¸(COSå¯¹è±¡å­˜å‚¨çš„å®¡æ ¸åŠŸèƒ½)
#### 3.1.1 åç«¯æ ¡éªŒ(æ—¶é—´ç‚¹ 01:15:34-01:24:42)
æ¥åˆ°åç«¯ï¼Œæ‰¾åˆ° ChartController.java ä¸‹çš„ genChartByAiæ¥å£ ï¼Œç¼–å†™æ ¡éªŒæ–‡ä»¶ä»£ç ï¼š
```java
// æ ¡éªŒæ–‡ä»¶
long fileSize = multipartFile.getSize();
String originalFilename = multipartFile.getOriginalFilename();
// æ ¡éªŒæ–‡ä»¶å¤§å°
ThrowUtils.throwIf(fileSize > FILE_MAX_SIZE, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶å¤§å°è¶…è¿‡ 1M");
// æ ¡éªŒæ–‡ä»¶åç¼€
String suffix = FileUtil.getSuffix(originalFilename);
ThrowUtils.throwIf(!VALID_FILE_SUFFIX.contains(suffix), ErrorCode.PARAMS_ERROR, "ä¸æ”¯æŒè¯¥ç±»å‹æ–‡ä»¶");
```
```java
/**
 * æ–‡ä»¶å¤§å° 1M
 */
long FILE_MAX_SIZE = 1 * 1024 * 1024L;

/**
 * æ–‡ä»¶åç¼€ç™½åå•
 */
List<String>  VALID_FILE_SUFFIX= Arrays.asList("xlsx","csv","xls","json");
```
ChartController.java
```typescript
package com.yupi.springbootinit.controller;

import cn.hutool.core.io.FileUtil;
import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.google.gson.Gson;
import com.yupi.springbootinit.annotation.AuthCheck;
import com.yupi.springbootinit.common.BaseResponse;
import com.yupi.springbootinit.common.DeleteRequest;
import com.yupi.springbootinit.common.ErrorCode;
import com.yupi.springbootinit.common.ResultUtils;
import com.yupi.springbootinit.constant.CommonConstant;
import com.yupi.springbootinit.constant.FileConstant;
import com.yupi.springbootinit.constant.UserConstant;
import com.yupi.springbootinit.exception.BusinessException;
import com.yupi.springbootinit.exception.ThrowUtils;
import com.yupi.springbootinit.manager.AiManager;
import com.yupi.springbootinit.manager.CosManager;
import com.yupi.springbootinit.manager.OpenaiManager;
import com.yupi.springbootinit.model.dto.chart.*;
import com.yupi.springbootinit.model.dto.file.UploadFileRequest;
import com.yupi.springbootinit.model.entity.Chart;
import com.yupi.springbootinit.model.entity.User;
import com.yupi.springbootinit.model.enums.FileUploadBizEnum;
import com.yupi.springbootinit.model.vo.BiResponse;
import com.yupi.springbootinit.model.vo.OpenAIResponse;
import com.yupi.springbootinit.service.ChartService;
import com.yupi.springbootinit.service.UserService;
import com.yupi.springbootinit.utils.ExcelUtils;
import com.yupi.springbootinit.utils.SqlUtils;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.ObjectUtils;
import org.apache.commons.lang3.RandomStringUtils;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.BeanUtils;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import java.io.File;
import java.util.Arrays;
import java.util.List;

/**
 * å¸–å­æ¥å£
 *
 */
@RestController
@RequestMapping("/chart")
@Slf4j
public class ChartController {

    @Resource
    private ChartService chartService;

    @Resource
    private UserService userService;

    @Resource
    private CosManager cosManager;

    @Resource
    private AiManager aiManager;

    @Resource
    private OpenaiManager  openaiManager;

//    private final static Gson GSON = new Gson();

    // region å¢åˆ æ”¹æŸ¥
    /**
     * åˆ›å»º
     *
     * @param chartAddRequest
     * @param request
     * @return
     */
    @PostMapping("/add")
    public BaseResponse<Long> addChart(@RequestBody ChartAddRequest chartAddRequest, HttpServletRequest request) {
        if (chartAddRequest == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Chart chart = new Chart();
        BeanUtils.copyProperties(chartAddRequest, chart);
        User loginUser = userService.getLoginUser(request);
        chart.setUserId(loginUser.getId());
        boolean result = chartService.save(chart);
        ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
        long newChartId = chart.getId();
        return ResultUtils.success(newChartId);
    }

    /**
     * åˆ é™¤
     *
     * @param deleteRequest
     * @param request
     * @return
     */
    @PostMapping("/delete")
    public BaseResponse<Boolean> deleteChart(@RequestBody DeleteRequest deleteRequest, HttpServletRequest request) {
        if (deleteRequest == null || deleteRequest.getId() <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User user = userService.getLoginUser(request);
        long id = deleteRequest.getId();
        // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
        Chart oldChart = chartService.getById(id);
        ThrowUtils.throwIf(oldChart == null, ErrorCode.NOT_FOUND_ERROR);
        // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯åˆ é™¤
        if (!oldChart.getUserId().equals(user.getId()) && !userService.isAdmin(request)) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        boolean b = chartService.removeById(id);
        return ResultUtils.success(b);
    }

    /**
     * æ›´æ–°ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
     *
     * @param chartUpdateRequest
     * @return
     */
    @PostMapping("/update")
    @AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
    public BaseResponse<Boolean> updateChart(@RequestBody ChartUpdateRequest chartUpdateRequest) {
        if (chartUpdateRequest == null || chartUpdateRequest.getId() <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Chart chart = new Chart();
        BeanUtils.copyProperties(chartUpdateRequest, chart);
        long id = chartUpdateRequest.getId();
        // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
        Chart oldChart = chartService.getById(id);
        ThrowUtils.throwIf(oldChart == null, ErrorCode.NOT_FOUND_ERROR);
        boolean result = chartService.updateById(chart);
        return ResultUtils.success(result);
    }

    /**
     * æ ¹æ® id è·å–
     *
     * @param id
     * @return
     */
    @GetMapping("/get")
    public BaseResponse<Chart> getChartById(long id, HttpServletRequest request) {
        if (id <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Chart chart = chartService.getById(id);
        if (chart == null) {
            throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);
        }
        return ResultUtils.success(chart);
    }

    /**
     * åˆ†é¡µè·å–åˆ—è¡¨ï¼ˆå°è£…ç±»ï¼‰
     *
     * @param chartQueryRequest
     * @param request
     * @return
     */
    @PostMapping("/list/page")
    public BaseResponse<Page<Chart>> listChartByPage(@RequestBody ChartQueryRequest chartQueryRequest,
            HttpServletRequest request) {
        long current = chartQueryRequest.getCurrent();
        long size = chartQueryRequest.getPageSize();
        // é™åˆ¶çˆ¬è™«
        ThrowUtils.throwIf(size > 20, ErrorCode.PARAMS_ERROR);
        Page<Chart> chartPage = chartService.page(new Page<>(current, size),
                getQueryWrapper(chartQueryRequest));
        return ResultUtils.success(chartPage);
    }

    /**
     * åˆ†é¡µè·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„èµ„æºåˆ—è¡¨
     *
     * @param chartQueryRequest
     * @param request
     * @return
     */
    @PostMapping("/my/list/page")
    public BaseResponse<Page<Chart>> listMyChartByPage(@RequestBody ChartQueryRequest chartQueryRequest,
            HttpServletRequest request) {
        if (chartQueryRequest == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        User loginUser = userService.getLoginUser(request);
        chartQueryRequest.setUserId(loginUser.getId());
        long current = chartQueryRequest.getCurrent();
        long size = chartQueryRequest.getPageSize();
        // é™åˆ¶çˆ¬è™«ï¼šä¸ºäº†é˜²æ­¢æ¶æ„æŠ“å–ï¼Œé™åˆ¶æ¯é¡µè¿”å›çš„è®°å½•æ•°ä¸èƒ½è¶…è¿‡20æ¡ã€‚å¦‚æœè¶…è¿‡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸
        ThrowUtils.throwIf(size > 20, ErrorCode.PARAMS_ERROR);
        Page<Chart> chartPage = chartService.page(new Page<>(current, size),
                getQueryWrapper(chartQueryRequest));
        return ResultUtils.success(chartPage);
    }

    // endregion

    /**
     * ç¼–è¾‘ï¼ˆç”¨æˆ·ï¼‰
     *
     * @param chartEditRequest
     * @param request
     * @return
     */
    @PostMapping("/edit")
    public BaseResponse<Boolean> editChart(@RequestBody ChartEditRequest chartEditRequest, HttpServletRequest request) {
        if (chartEditRequest == null || chartEditRequest.getId() <= 0) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
        Chart chart = new Chart();
        BeanUtils.copyProperties(chartEditRequest, chart);
        User loginUser = userService.getLoginUser(request);
        long id = chartEditRequest.getId();
        // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
        Chart oldChart = chartService.getById(id);
        ThrowUtils.throwIf(oldChart == null, ErrorCode.NOT_FOUND_ERROR);
        // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯ç¼–è¾‘
        if (!oldChart.getUserId().equals(loginUser.getId()) && !userService.isAdmin(loginUser)) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        boolean result = chartService.updateById(chart);
        return ResultUtils.success(result);
    }

    /**
     * è·å–æŸ¥è¯¢åŒ…è£…ç±»
     *
     * @param chartQueryRequest
     * @return
     */
    private QueryWrapper<Chart> getQueryWrapper(ChartQueryRequest chartQueryRequest) {
        QueryWrapper<Chart> queryWrapper = new QueryWrapper<>();
        if (chartQueryRequest == null) {
            return queryWrapper;
        }
        Long id = chartQueryRequest.getId();
        String name = chartQueryRequest.getName();
        String goal = chartQueryRequest.getGoal();
        String chartType = chartQueryRequest.getChartType();
        Long userId = chartQueryRequest.getUserId();
        String sortField = chartQueryRequest.getSortField();
        String sortOrder = chartQueryRequest.getSortOrder();

        queryWrapper.eq(id != null && id > 0, "id", id);
        queryWrapper.eq(StringUtils.isNotBlank(name), "name", name);
        queryWrapper.eq(StringUtils.isNotBlank(goal), "goal", goal);
        queryWrapper.eq(StringUtils.isNotBlank(chartType), "chartType", chartType);
        queryWrapper.eq(ObjectUtils.isNotEmpty(userId), "userId", userId);
        queryWrapper.eq("isDelete", false);
        queryWrapper.orderBy(SqlUtils.validSortField(sortField), sortOrder.equals(CommonConstant.SORT_ORDER_ASC),
                sortField);
        return queryWrapper;
    }


    /**
     * æ™ºèƒ½åˆ†æ  openaiæ¥å£
     *
     * @param multipartFile
     * @param genChartByAiRequest
     * @param request
     * @return
     */
//    @PostMapping("/gen")
    public BaseResponse<OpenAIResponse> genChartByAi_V2(@RequestPart("file") MultipartFile multipartFile,
                                             GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {

        String name = genChartByAiRequest.getName();
        String goal = genChartByAiRequest.getGoal();
        String chartType = genChartByAiRequest.getChartType();
        User loginUser = userService.getLoginUser(request);

        // æ ¡éªŒ
        // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
        // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");

        // æ ¡éªŒæ–‡ä»¶
        long size = multipartFile.getSize();
        String originalFilename = multipartFile.getOriginalFilename();
        // æ ¡éªŒæ–‡ä»¶å¤§å°
        final long ONE_MB = 1024 * 1024L;
        ThrowUtils.throwIf(size > ONE_MB, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶è¶…è¿‡ 1M");
        // æ ¡éªŒæ–‡ä»¶åç¼€ aaa.png
        String suffix = FileUtil.getSuffix(originalFilename);
        final List<String> validFileSuffixList = Arrays.asList("xlsx","csv","xls","json");
        ThrowUtils.throwIf(!validFileSuffixList.contains(suffix), ErrorCode.PARAMS_ERROR, "æ–‡ä»¶åç¼€éæ³•");

        /*
        * ç”¨æˆ·çš„è¾“å…¥(å‚è€ƒ)
          åˆ†æéœ€æ±‚ï¼š
          åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
          åŸå§‹æ•°æ®ï¼š
          æ—¥æœŸ,ç”¨æˆ·æ•°
          1å·,10
          2å·,20
          3å·,30
        * */

        // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼‰
        String csvData = ExcelUtils.excelToCsv(multipartFile);

        StringBuilder userInput = new StringBuilder("æ‚¨æ˜¯ä¸€ä½æ•°æ®åˆ†æå¸ˆï¼Œæ“…äºæ ¹æ®æˆ‘ç»™çš„éœ€æ±‚æä¾›echartsæ ¸å¿ƒä»£ç å’Œç»“è®ºã€‚è¿”å›å†…å®¹è¯·åˆ†ä¸ºä»£ç å’Œç»“è®ºä¸¤å—ã€‚\n");
        userInput.append("åˆ†æç›®æ ‡ï¼š").append(goal).append("\n");
        if(StringUtils.isNotBlank(chartType)){
            userInput.append("è¯·ä½¿ç”¨"+chartType+"å›¾è¡¨ç±»å‹"+"\n");
        }
        userInput.append("åŸå§‹æ•°æ®å¦‚ä¸‹ï¼š").append('\n');
        userInput.append(csvData);

        // æ‹¿åˆ°è¿”å›ç»“æœ
        String response = openaiManager.doPost(userInput.toString());
        if(response==null||response.equals("")){
            throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
        }else{
            int option = response.indexOf("option = ");
            int result = response.indexOf("ç»“è®º");
            if(option==-1||result==-1){
                throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
            }else {
                String tempOption = response.substring(option, result);
                String Option = tempOption.substring(0, tempOption.indexOf("};") + 2);
                String ResultAI = response.substring(result, response.length());
                System.out.println(Option);
                System.out.println("--------------------------------------------");
                System.out.println(ResultAI);
                Chart chart = new Chart();
                chart.setUserId(loginUser.getId());
                chart.setChartType(chartType);
                chart.setGoal(goal);
                chart.setName(name);
                chart.setChartData(csvData);
                chart.setGenChart(Option);
                chart.setGenResult(ResultAI);
                boolean saveResult = chartService.save(chart);
                ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");
                OpenAIResponse openAIResponse = new OpenAIResponse();
                openAIResponse.setGenChart(Option);
                openAIResponse.setGenResult(ResultAI);
                openAIResponse.setChartId(chart.getId());
                return ResultUtils.success(openAIResponse);
            }
        }
    }


    //    /**
//     * æ™ºèƒ½åˆ†æ  é±¼çš®æ¥å£ V1
//     *
//     * @param multipartFile
//     * @param genChartByAiRequest
//     * @param request
//     * @return
//     */
//    @PostMapping("/gen")
//    public BaseResponse<String> genCharByAi(@RequestPart("file") MultipartFile multipartFile,
//                                            GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
//        String name = genChartByAiRequest.getName();
//        String goal = genChartByAiRequest.getGoal();
//        String chartType = genChartByAiRequest.getChartType();
//
//        // æ ¡éªŒ
//        // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
//        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
//        // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
//        ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");
//
//        // è¯»å–åˆ°ç”¨æˆ·ä¸Šä¼ çš„ excel æ–‡ä»¶ï¼Œè¿›è¡Œä¸€ä¸ªå¤„ç†
//        User loginUser = userService.getLoginUser(request);
//        // æ–‡ä»¶ç›®å½•ï¼šæ ¹æ®ä¸šåŠ¡ã€ç”¨æˆ·æ¥åˆ’åˆ†
//        String uuid = RandomStringUtils.randomAlphanumeric(8);
//        String filename = uuid + "-" + multipartFile.getOriginalFilename();
//        File file = null;
//        try {
//            // è¿”å›å¯è®¿é—®åœ°å€
//            return ResultUtils.success("");
//        } catch (Exception e) {
//            //            log.error("file upload error, filepath = " + filepath, e);
//            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "ä¸Šä¼ å¤±è´¥");
//        } finally {
//            if (file != null) {
//                // åˆ é™¤ä¸´æ—¶æ–‡ä»¶
//                boolean delete = file.delete();
//                if (!delete) {
//                    //                    log.error("file delete error, filepath = {}", filepath);
//                }
//            }
//        }
//    }

    /**
     * æ™ºèƒ½åˆ†æ é±¼çš®æ¥å£
     *
     * @param multipartFile
     * @param genChartByAiRequest
     * @param request
     * @return
     */
    @PostMapping("/gen")
    public BaseResponse<BiResponse> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                                     GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
        String name = genChartByAiRequest.getName();
        String goal = genChartByAiRequest.getGoal();
        String chartType = genChartByAiRequest.getChartType();
        // é€šè¿‡responseå¯¹è±¡æ‹¿åˆ°ç”¨æˆ·id(å¿…é¡»ç™»å½•æ‰èƒ½ä½¿ç”¨)
        User loginUser = userService.getLoginUser(request);

        // æ ¡éªŒ
        // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
        // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");

        // æŒ‡å®šä¸€ä¸ªæ¨¡å‹id(æŠŠidå†™æ­»ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æˆä¸€ä¸ªå¸¸é‡)
        long biModelId = 1821914479207112706L;
        /*
        * ç”¨æˆ·çš„è¾“å…¥(å‚è€ƒ)
          åˆ†æéœ€æ±‚ï¼š
          åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
          åŸå§‹æ•°æ®ï¼š
          æ—¥æœŸ,ç”¨æˆ·æ•°
          1å·,10
          2å·,20
          3å·,30
        * */
        // æ„é€ ç”¨æˆ·è¾“å…¥
        StringBuilder userInput = new StringBuilder();
        userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
        // æ‹¼æ¥åˆ†æç›®æ ‡
        String userGoal = goal;
        // å¦‚æœå›¾è¡¨ç±»å‹ä¸ä¸ºç©º
        if (StringUtils.isNotBlank(chartType)) {
            // å°±å°†åˆ†æç›®æ ‡æ‹¼æ¥ä¸Šâ€œè¯·ä½¿ç”¨â€+å›¾è¡¨ç±»å‹
            userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
        }
        userInput.append(userGoal).append("\n");
        userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");
        // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼‰
        String csvData = ExcelUtils.excelToCsv(multipartFile);
        userInput.append(csvData).append("\n");

        // é±¼çš®æ¥å£,æ‹¿åˆ°è¿”å›ç»“æœ
        String result = aiManager.doChat(biModelId,userInput.toString());
        //å¯¹è¿”å›ç»“æœåšæ‹†åˆ†,æŒ‰ç…§5ä¸ªä¸­æ‹¬å·è¿›è¡Œæ‹†åˆ†
        String[] splits = result.split("ã€ã€ã€ã€ã€");
        // æ‹†åˆ†ä¹‹åè¿˜è¦è¿›è¡Œæ ¡éªŒ
        if (splits.length < 3) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
        }
        String genChart = splits[1].trim();
        String genResult = splits[2].trim();

        // æ’å…¥åˆ°æ•°æ®åº“
        Chart chart = new Chart();
        chart.setName(name);
        chart.setGoal(goal);
        chart.setChartData(csvData);
        chart.setChartType(chartType);
        chart.setGenChart(genChart);
        chart.setGenResult(genResult);
        chart.setUserId(loginUser.getId());
        boolean saveResult = chartService.save(chart);
        ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");

        BiResponse biResponse = new BiResponse();
        biResponse.setGenChart(genChart);
        biResponse.setGenResult(genResult);
        biResponse.setChartId(chart.getId());
        return ResultUtils.success(biResponse);
    }

    /**
     * æ ¡éªŒæ–‡ä»¶
     *
     * @param multipartFile
     * @param fileUploadBizEnum ä¸šåŠ¡ç±»å‹
     */
    private void validFile(MultipartFile multipartFile, FileUploadBizEnum fileUploadBizEnum) {
        // æ–‡ä»¶å¤§å°
        long fileSize = multipartFile.getSize();
        // æ–‡ä»¶åç¼€
        String fileSuffix = FileUtil.getSuffix(multipartFile.getOriginalFilename());
        final long ONE_M = 1024 * 1024L;
        if (FileUploadBizEnum.USER_AVATAR.equals(fileUploadBizEnum)) {
            if (fileSize > ONE_M) {
                throw new BusinessException(ErrorCode.PARAMS_ERROR, "æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 1M");
            }
            if (!Arrays.asList("jpeg", "jpg", "svg", "png", "webp").contains(fileSuffix)) {
                throw new BusinessException(ErrorCode.PARAMS_ERROR, "æ–‡ä»¶ç±»å‹é”™è¯¯");
            }
        }
    }
}
```
> äº‹å®ä¸Šï¼Œä»…ä»…æ ¡éªŒæ–‡ä»¶åç¼€å¹¶ä¸èƒ½å®Œå…¨ä¿è¯æ–‡ä»¶çš„å®‰å…¨æ€§ï¼Œå› ä¸ºæ”»å‡»è€…å¯ä»¥é€šè¿‡å°†éæ³•å†…å®¹æ›´æ”¹åç¼€åæ¥ç»•è¿‡æ ¡éªŒã€‚é€šè¿‡ä¿®æ”¹æ–‡ä»¶åç¼€çš„æ–¹å¼æ¬ºéª—æ ¡éªŒæœºåˆ¶ï¼Œå°†ä¸€äº›æ¶æ„æ–‡ä»¶
> ä¼ªè£…æˆå®‰å…¨çš„æ–‡ä»¶ç±»å‹ã€‚ç°åœ¨è¿™ä¸ªæ ¡éªŒçš„ç»´åº¦æ˜¯ä»æµ…åˆ°æ·±ï¼Œä»…ä»…ä¾é æ ¡éªŒåç¼€æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦ç»“åˆå…¶ä»–ä¸¥æ ¼æªæ–½æ¥åŠ å¼ºæ–‡ä»¶çš„å®‰å…¨æ€§ã€‚


### 3.2 æ•°æ®å­˜å‚¨
å½“å‰ç°çŠ¶ï¼šæˆ‘ä»¬æŠŠæ¯ä¸ªå›¾è¡¨çš„åŸå§‹æ•°æ®å…¨éƒ¨å­˜æ”¾åœ¨äº†åŒä¸€ä¸ªæ•°æ®è¡¨ (chartè¡¨) çš„å­—æ®µé‡Œã€‚
å¯¼è‡´é—®é¢˜ï¼š

1. å¦‚æœç”¨æˆ·ä¸Šä¼ çš„åŸå§‹æ•°æ®é‡å¾ˆå¤§(100MB)ã€å›¾è¡¨æ•°æ—¥ç›Šå¢å¤šï¼ŒæŸ¥è¯¢Chart è¡¨å°±ä¼šå¾ˆæ…¢ã€‚
2. å¯¹äº BI å¹³å°ï¼Œç”¨æˆ·æ˜¯æœ‰æŸ¥çœ‹åŸå§‹æ•°æ®ã€å¯¹åŸå§‹æ•°æ®è¿›è¡Œç®€å•æŸ¥è¯¢çš„éœ€æ±‚çš„ã€‚ç°åœ¨å¦‚æœæŠŠæ‰€æœ‰æ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªå­—æ®µï¼ˆåˆ—ï¼‰ä¸­ï¼ŒæŸ¥è¯¢æ—¶ï¼Œåªèƒ½å–å‡ºè¿™ä¸ªåˆ—çš„æ‰€æœ‰å†…å®¹ã€‚

**è¡¥å……ï¼š**æ¯”å¦‚ä¸‹å›¾è¿™å¼ è¡¨ï¼Œæˆ‘åªæƒ³è¦ x,y è¿™ä¸¤åˆ—ï¼Œå°±è¦å…ˆæŠŠæ‰€æœ‰çš„åŸå§‹æ•°æ®æŸ¥å‡ºæ¥ï¼Œç„¶åå†å»åšè¿‡æ»¤ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723383957716-c664021f-b47d-43cc-ab6b-f1d045bcf203.png#averageHue=%23faf9f8&clientId=u310f051a-d124-4&from=paste&height=568&id=u6398ceef&originHeight=682&originWidth=700&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=162149&status=done&style=none&taskId=ube9c4d93-0037-49d3-a4f4-aa870daaf4e&title=&width=583.3333101537502)
**è§£å†³æ–¹æ¡ˆæ„æ€ï¼š**
å¦‚æœå°†åŸå§‹æ•°æ®ä»¥è¡¨æ ¼çš„å½¢å¼å­˜å‚¨åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®è¡¨ä¸­ï¼Œè€Œä¸æ˜¯æ”¾åœ¨ä¸€ä¸ªå°çš„æ ¼å­é‡Œï¼Œå®é™…ä¸Šä¼šæ›´æ–¹ä¾¿é«˜æ•ˆã€‚ç”±äºæ•°æ®è¡¨é‡‡ç”¨äº†æ ‡å‡†çš„ç»“æ„æ–¹å¼å­˜å‚¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨SQLè¯­å¥è¿›è¡Œé«˜æ•ˆçš„æ•°æ®æ£€ç´¢ï¼Œä»…æŸ¥è¯¢éœ€è¦çš„åˆ—æˆ–è¡Œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨æ•°æ®åº“çš„ç´¢å¼•ç­‰é«˜æ•ˆæŠ€æœ¯ï¼Œæ›´å¿«ã€æ›´ç²¾ç¡®åœ°å¯¹æ•°æ®è¿›è¡Œå®šä½å’ŒæŸ¥è¯¢ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡å’Œç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚

**è§£å†³æ–¹æ¡ˆ=>åˆ†åº“åˆ†è¡¨ï¼š**
æŠŠæ¯ä¸ªå›¾è¡¨å¯¹åº”çš„åŸå§‹æ•°æ®å•ç‹¬ä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„æ•°æ®è¡¨ï¼Œè€Œä¸æ˜¯éƒ½å­˜åœ¨ä¸€ä¸ªå­—æ®µé‡Œã€‚
**æ¯”å¦‚**ï¼šæˆ‘ä»¬çš„ ç½‘ç«™æ•°æ®.xlsx ï¼Œå¦‚æœè¦ä¿å­˜è¿™ä¸ªæ•°æ®ï¼Œå°±å•ç‹¬ä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„æ•°æ®è¡¨ï¼Œè¡¨å 
ä¸º chart_{å›¾è¡¨id} ã€‚ 
æ–°å»ºè¡¨ï¼Œç„¶åå¡«å…¥ä¸‹å›¾æ‰€ç¤ºçš„æ•°æ®ï¼Œåˆ†å¼€æŸ¥è¯¢æµ‹è¯•æ—¶ä¼šç”¨åˆ°
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723384283212-d6f924c0-b883-489a-8d3b-0afa77b22ce6.png#averageHue=%23acaca6&clientId=u310f051a-d124-4&from=paste&height=446&id=u37b6d573&originHeight=535&originWidth=501&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=86865&status=done&style=none&taskId=u725602ab-1c85-49ae-8a51-36579e6e414&title=&width=417.4999834100412)
ä¼˜ç‚¹ï¼š

1. å­˜å‚¨æ—¶ï¼Œèƒ½å¤Ÿåˆ†å¼€å­˜å‚¨ï¼Œäº’ä¸å½±å“ï¼ˆä¹Ÿå¢åŠ å®‰å…¨æ€§ï¼‰
2. æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å„ç§ SQL è¯­å¥çµæ´»å–å‡ºéœ€è¦çš„å­—æ®µï¼ŒæŸ¥è¯¢æ€§èƒ½æ›´å¿«

> ä¼˜ç‚¹æ„æ€ï¼š
> ä½¿ç”¨åˆ†å¼€å­˜å‚¨çš„æ–¹å¼å¯ä»¥å¸¦æ¥å¾ˆå¤šå¥½å¤„ï¼Œå…¶ä¸­ä¸€ä¸ªå¥½å¤„å°±æ˜¯å­˜å‚¨çš„å€¼ç›¸äº’ç‹¬ç«‹ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ª100Gçš„æ•°æ®ä¿å­˜åˆ°åŒä¸€ä¸ªè¡¨ä¸­ï¼Œå…¶ä»–ç”¨æˆ·åœ¨è®¿é—®è¿™ä¸ªæ•°æ®è¡¨æ—¶ä¼šå—åˆ°å¾ˆå¤§çš„å½±å“ï¼Œç”šè‡³åœ¨è¯»å–è¿™ä¸ªæ•°æ®æ—¶å¯èƒ½ä¼šéå¸¸æ…¢ã€‚
> è€Œé€šè¿‡å°†**æ¯ä¸ªè¡¨å•ç‹¬å­˜å‚¨**ï¼Œå³ä½¿ä¸€ä¸ªç”¨æˆ·ä¸Šä¼ äº†å¾ˆå¤§çš„æ•°æ®ï¼Œå…¶ä»–ç”¨æˆ·åœ¨è®¿é—®æ—¶ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚è¿™æ ·å¯ä»¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼ŒåŒæ—¶ä¹Ÿæé«˜ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›å’Œæ•ˆç‡ã€‚
> ä»¥åè¿›è¡Œå›¾è¡¨æ•°æ®æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥å…ˆæ ¹æ®å›¾è¡¨çš„IDæ¥æŸ¥æ‰¾ï¼Œç„¶åè¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ’æŸ¥é—®é¢˜ã€‚ç”šè‡³è¿”å›ç”¨æˆ·åŸå§‹æ•°æ®ï¼Œé€šè¿‡å…¨æ ‡æ‰«æçš„æ–¹å¼ç›´æ¥æå‡ºæ‰€æœ‰æ•°æ®ï¼Œè¿™æ¯”å¯¹æ•°æ®åº“æŸ¥è¯¢æ•°æ®è¿›è¡Œå¤„ç†æ›´åŠ å¿«é€Ÿå’Œé«˜æ•ˆã€‚

#### 3.2.1 å®ç°
##### åˆ†å¼€å­˜å‚¨ï¼š

- å­˜å‚¨å›¾è¡¨ä¿¡æ¯æ—¶ï¼Œä¸æŠŠæ•°æ®å­˜å‚¨ä¸ºå­—æ®µï¼Œè€Œæ˜¯æ–°å»ºä¸€ä¸ªchart_{ å›¾è¡¨id } çš„æ•°æ®è¡¨é€šè¿‡å›¾è¡¨idã€æ•°æ®åˆ—åã€æ•°æ®ç±»å‹ç­‰å­—æ®µï¼Œç”Ÿæˆä»¥ä¸‹SQLè¯­å¥ï¼Œå¹¶ä¸”æ‰§è¡Œå³å¯ã€‚
```sql
create table chart_chartId{
	å›¾è¡¨id bigint not null,
	å›¾è¡¨ç±»å‹ varchar(512) not null,
	å›¾è¡¨æ•°æ® varchart(512) null,
	...
}
```

##### åˆ†å¼€æŸ¥è¯¢ï¼š

-  ä»¥å‰ç›´æ¥æŸ¥è¯¢å›¾è¡¨ï¼Œå–chartDataå­—æ®µï¼›ç°åœ¨æ”¹ä¸ºè¯»å–chart{å›¾è¡¨id}çš„æ•°æ®è¡¨ 
```sql
select * from chart_{å›¾è¡¨id}
select æŒ‡å®šæŸ¥è¯¢å­—æ®µ from chart_{å›¾è¡¨id}
```

##### å…·ä½“å®ç°ï¼š
MyBatisçš„åŠ¨æ€SQL(æ ¹æ®ä»£ç çµæ´»åœ°åŠ¨æ€ç”Ÿæˆ)

1. æƒ³æ¸…æ¥šå“ªäº›æ˜¯éœ€è¦åŠ¨æ€æ›¿æ¢çš„ï¼Œæ¯”å¦‚è¦æŸ¥è¯¢çš„æ•°æ®è¡¨å chart_{1659210482555121666}
2. åœ¨ChartMapper.xmlä¸­å®šä¹‰sqlè¯­å¥

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723385030854-c2f70828-559d-4ef9-b32a-339f4ae0bc02.png#averageHue=%23282d35&clientId=u310f051a-d124-4&from=paste&height=1217&id=ubcc962c3&originHeight=1461&originWidth=2437&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=426516&status=done&style=none&taskId=udfc4af81-cd3e-4db6-aa13-00d0dfa1827&title=&width=2030.8332526352704)
ä»¥ä¸‹è¿™ç§æ–¹å¼æœ€çµæ´»ï¼Œä½†æ˜¯è¦å°å¿ƒSQLæ³¨å…¥é£é™©ï¼š
æ¯”å¦‚ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723385220373-058211ae-4412-41e0-9923-6852a3174f56.png#averageHue=%23282d35&clientId=u310f051a-d124-4&from=paste&height=1241&id=u1939a21b&originHeight=1489&originWidth=2443&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=481410&status=done&style=none&taskId=u2924e968-8529-4a2f-8826-3a561753d55&title=&width=2035.833252436588)
```sql
select * from chart12345 where id=1 or 1=1;    # SQLæ³¨å…¥
```
```xml
<select id="queryChartData" resultType="java.util.Map">${queryChartSql}</select>
```
å…‰æ ‡æ”¾åˆ° ChartMapper ï¼ŒæŒ‰ Ctrl+é¼ æ ‡å·¦é”® è·³è½¬åˆ° ChartMapper.java ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723385259098-9b6e7245-65d6-4a55-93f2-fc4f2034ec0c.png#averageHue=%23282d35&clientId=u310f051a-d124-4&from=paste&height=1238&id=u13fd882c&originHeight=1486&originWidth=2659&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=476453&status=done&style=none&taskId=uce7571c6-4f83-47e6-abe9-0551f967052&title=&width=2215.833245284031)
åœ¨ChartMapperä¸­å®šä¹‰æ–¹æ³•ï¼Œæ–¹æ³•åå’Œä¸Šä¸€æ­¥çš„selectçš„idç›¸åŒï¼š
```java
List<Map<String,object>> queryChartData(String querySql);
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723385352478-66c0bb22-c999-4df4-adf0-b41176c744d9.png#averageHue=%23272c34&clientId=u310f051a-d124-4&from=paste&height=1225&id=ue4919297&originHeight=1470&originWidth=2465&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=308217&status=done&style=none&taskId=ue5843d6f-bf2a-4eb7-920b-97b2bb8a1ed&title=&width=2054.16658504142)
åˆ›å»ºæµ‹è¯•ï¼ŒæŠŠå…‰æ ‡æ”¾åœ¨ ChartMapper ï¼ŒæŒ‰ Alt+å›è½¦ ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723385414230-97de17f1-37b4-41f4-9b85-b87beaf0051a.png#averageHue=%23282d36&clientId=u310f051a-d124-4&from=paste&height=1006&id=u8937e63a&originHeight=1207&originWidth=2153&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=214407&status=done&style=none&taskId=u386b0e5c-00b4-4bc6-9f18-7db850f35d6&title=&width=1794.1665953728916)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723385459548-6e52fa0c-c4a6-4f7a-91d3-cdebd97732d0.png#averageHue=%23f4f2f2&clientId=u310f051a-d124-4&from=paste&height=267&id=u07f03fd9&originHeight=321&originWidth=495&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=60664&status=done&style=none&taskId=ub8a93a25-aa3a-495e-ad3f-e0dfad55149&title=&width=412.4999836087233)
åˆ›é€ äº†æµ‹è¯•æ–¹æ³•ã€‚
æµ‹è¯•ç±»ï¼š
```java
package com.yupi.springbootinit.mapper;

import org.junit.jupiter.api.Test;

import javax.annotation.Resource;

import java.util.List;
import java.util.Map;

import static org.junit.jupiter.api.Assertions.*;

class ChartMapperTest {
    @Resource
    private ChartMapper chartMapper;

    @Test
    void queryChartData() {
        String chartId = "1659210482555121666";
        String querySql = String.format("select * from chart_%s", chartId);
        List<Map<String, Object>> resultData = chartMapper.queryChartData(querySql);
        System.out.println(resultData);
    }
}
```
> åˆ†åº“åˆ†è¡¨çš„æ€è·¯ï¼š
> åœ¨æ•°æ®åº“è®¾è®¡ä¸­è€ƒè™‘ä½¿ç”¨åˆ†åº“åˆ†è¡¨çš„æ€è·¯å¯ä»¥æœ‰æ•ˆåœ°è§£å†³å¤§æ•°æ®é‡å’Œé«˜å¹¶å‘çš„é—®é¢˜ã€‚å¯ä»¥åˆ†æ°´å¹³åˆ†è¡¨å’Œå‚ç›´åˆ†åº“ä¸¤ç§æ–¹å¼ã€‚
> æ°´å¹³åˆ†è¡¨æŒ‡åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œå°†è¡¨æŒ‰ç…§æŸä¸ªå­—æ®µçš„å€¼è¿›è¡Œæ‹†åˆ†å’Œåˆ†æ•£å­˜å‚¨ï¼Œä¾‹å¦‚æ‹†åˆ†å‡ºå‰ä¸‡ä¸ªç”¨æˆ·ä¸€ä¸ªè¡¨ï¼Œå1ä¸‡ä¸ªç”¨æˆ·ä¸€ä¸ªè¡¨ã€‚
> å‚ç›´åˆ†åº“åˆ™æ˜¯å°†ä¸åŒçš„ä¸šåŠ¡æŒ‰ç…§ç›¸å…³æ€§è¿›è¡Œåˆ’åˆ†ï¼Œä¾‹å¦‚å°†ç”¨æˆ·ä¸­å¿ƒç”¨æˆ·ç›¸å…³çš„å†…å®¹åˆ’åˆ†åˆ°ä¸€ä¸ªåº“ä¸­ï¼Œè®¢å•ã€æ”¯ä»˜ä¿¡æ¯å’Œè®¢å•ç›¸å…³çš„åˆ’åˆ†åˆ°å¦ä¸€ä¸ªåº“ä¸­ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œç¨³å®šæ€§ã€‚
> åˆ†åº“åˆ†è¡¨æ˜¯æ•°æ®åº“è®¾è®¡ä¸­é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œèƒ½æœ‰æ•ˆåœ°ä¼˜åŒ–ç³»ç»Ÿçš„æ€§èƒ½ï¼Œæé«˜ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç®€å†äº®ç‚¹ã€‚


#### 3.2.2 åˆ†åº“åˆ†è¡¨

- æ°´å¹³åˆ†è¡¨
- å‚ç›´åˆ†åº“

åœ¨å¤§å‹äº’è”ç½‘åº”ç”¨ä¸­ï¼Œä¸ºäº†åº”å¯¹é«˜å¹¶å‘ã€æµ·é‡æ•°æ®ç­‰æŒ‘æˆ˜ï¼Œå¾€å¾€éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ã€‚å¸¸è§çš„æ‹†åˆ†æ–¹å¼æœ‰æ°´å¹³åˆ†è¡¨å’Œå‚ç›´åˆ†åº“ä¸¤ç§ã€‚

##### æ°´å¹³åˆ†è¡¨(Sharding)
æ°´å¹³åˆ†è¡¨æ˜¯å°†åŒä¸€å¼ è¡¨ä¸­çš„æ•°æ®æŒ‰ä¸€å®šçš„è§„ä¾§åˆ’åˆ†åˆ°ä¸åŒçš„ç‰©ç†å­˜å‚¨ä½ç½®ä¸Šï¼Œä»¥è¾¾åˆ°åˆ†éš¾å•å¼ è¡¨çš„æ•°æ®åŠè®¿é—®å‹åŠ›çš„ç›®çš„ã€‚å¯¹äºSQLåˆ†ä¸ºä¸¤ç±»ï¼šid-basedåˆ†è¡¨å’Œrange-basedåˆ†è¡¨ã€‚
**æ°´å¹³åˆ†è¡¨çš„ä¼˜ç‚¹ï¼š**

1. å•ä¸ªè¡¨çš„æ•°æ®é‡å‡å°‘ï¼ŒæŸ¥è¯¢æ•ˆç‡æé«˜ï¼š
2. å¯ä»¥é€šè¿‡å¢åŠ èŠ‚ç‚¹ï¼Œæé«˜ç³»ç»Ÿçš„æ‰©å±•æ€§å’Œå®¹æªæ€§ã€‚

**æ°´å¹³åˆ†è¡¨çš„ç¼ºç‚¹ï¼š**

1. äº‹åŠ¡å¹¶å‘å¤„ç†å¤æ‚åº¦å¢åŠ ï¼Œéœ€è¦å¢åŠ åˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†ï¼Œæ€§èƒ½å’Œå¤æ‚åº¦éƒ½æœ‰æ‰€æ –ç‰²ï¼š
2. è·¨èŠ‚ç‚¹æŸ¥è¯¢å›°éš¾ï¼Œéœ€è¦è®¾è®¡è·¨èŠ‚ç‚¹çš„æŸ¥è¯¢æ¨¡å—ã€‚

##### å‚ç›´åˆ†åº“(Vertical Partitioning)
å‚ç›´åˆ†åº“ï¼ŒæŒ‡çš„æ˜¯æ ¹æ®ä¸šåŠ¡æ¨¡å—çš„ä¸åŒï¼Œå°†ä¸åŒçš„å­—æ®µæˆ–è¡¨åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ã€‚å‚ç›´åˆ†åº“åŸºäºæ•°æ®åº“å†…æ ¸æ”¯æŒï¼Œå¯¹åº”ç”¨é€æ˜ï¼Œæ— éœ€é¢å¤–çš„å¼€å‘ä»£ç ï¼Œæ˜“äºç»´æŠ¤å‡çº§ã€‚
**å‚ç›´åˆ†åº“çš„ä¼˜ç‚¹ï¼š**

1. å‡å°‘å•ä¸ªæ•°æ®åº“çš„æ•°æ®é‡ï¼Œæé«˜ç³»ç»Ÿçš„æŸ¥è¯¢æ•ˆç‡
2. å¢åŠ äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œæ¯”æ°´å¹³åˆ†è¡¨æ›´å®¹æ˜“å®ç°ã€‚

**å‚ç›´åˆ†åº“çš„ç¼ºç‚¹ï¼š**

1. ä¸åŒæ•°æ®åº“ä¹‹é—´çš„ç»´æŠ¤å’ŒåŒæ­¥æˆæœ¬è¾ƒé«˜
2. ç°æœ‰ç³»ç»Ÿçš„æ”¹é€ å­˜åœ¨ä¸€å®šçš„éš¾åº¦
3. ç³»ç»Ÿçš„æ€§èƒ½ä¼šå—åˆ°æ•°æ®åº“ä¹‹é—´äº’ç›¸å½±å“çš„å½±å“ã€‚

éœ€è¦æ ¹æ®å®é™…çš„ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯æ¶æ„æƒ…å†µï¼Œç»¼åˆè€ƒè™‘å„ç§å› ç´ æ¥é€‰æ‹©é€‚åˆè‡ªå·±çš„åˆ†åº“åˆ†è¡¨ç­–ç•¥ã€‚

### 3.3 é™æµ
[https://www.cnblogs.com/liqiangchn/p/14253924.html](https://www.cnblogs.com/liqiangchn/p/14253924.html)
[http://haedyfish.top](http://haedyfish.top)
> æˆ‘ä»¬éœ€è¦æ§åˆ¶ç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿçš„æ¬¡æ•°ï¼Œä»¥é¿å…è¶…æ”¯ï¼Œæ¯”å¦‚ç»™ä¸åŒç­‰çº§çš„ç”¨æˆ·åˆ†é…ä¸åŒçš„è°ƒç”¨æ¬¡æ•°ï¼Œé˜²æ­¢ç”¨æˆ·è¿‡åº¦ä½¿ç”¨ç³»ç»Ÿé€ æˆç ´äº§ï¼ˆä¾‹å¦‚é±¼èªæ˜ç›®å‰ç»™æ™®é€šç”¨æˆ·æä¾›50æ¬¡è°ƒç”¨æ¬¡æ•°ï¼Œä¼šå‘˜ç”¨æˆ·æä¾›100æ¬¡ï¼‰ã€‚ä½†é™åˆ¶ç”¨æˆ·è°ƒç”¨æ¬¡æ•°ä»å­˜åœ¨ä¸€å®šé£é™©ï¼Œç”¨æˆ·ä»æœ‰å¯é€šè¿‡ç–¯ç‹‚è°ƒç”¨æ¥åˆ·é‡ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿæˆæœ¬è¿‡åº¦æ¶ˆè€—ã€‚
>  å‡è®¾ç³»ç»Ÿå°±ä¸€å°æœåŠ¡å™¨ï¼Œèƒ½åŒæ—¶å¤„ç†çš„ç”¨æˆ·å¯¹è¯æ•°é‡æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚ç³»ç»Ÿæœ€å¤šåªèƒ½æ”¯æŒ10ä¸ªç”¨æˆ·åŒæ—¶å¯¹è¯ï¼Œå¦‚æœæŸä¸ªç”¨ä¸€ç§’å†…ä½¿ç”¨10ä¸ªè´¦å·ç™»å½•ï¼Œé‚£ä¹ˆå…¶ä»–ç”¨æˆ·å°±æ— æ³•ä½¿ç”¨ç³»ç»Ÿã€‚å°±åƒå»è‡ªåŠ©é¤å…åƒé¥­ï¼Œå¦‚æœæœ‰äººä¸€è‚¡è„‘åœ°æŠŠæ‰€æœ‰ç¾é£Ÿéƒ½æ‹¿å…‰äº†ï¼Œå…¶ä»–äººå°±æ— æ³•äº«ç”¨äº†ã€‚æ¯”å¦‚åŒ11è¿™ç§å¤§ä¿ƒæœŸé—´ï¼Œé˜¿é‡Œå·´å·´å°±è¦å»é™åˆ¶ï¼Œä¸èƒ½è¯´æ‰€æœ‰çš„ç”¨æˆ·æƒ³æŠ¢è´­éƒ½èƒ½æˆåŠŸï¼Œåœ¨å‰ç«¯éšæœºæ”¾è¡Œä¸€éƒ¨åˆ†ç”¨æˆ·ï¼Œè€Œå¯¹äºå…¶ä»–ç”¨æˆ·åˆ™è¿›è¡Œé™åˆ¶ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿä¸ä¼šè¢«æ¶æ„ç”¨æˆ·å æ»¡ã€‚
>  ç°åœ¨è¦åšä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯é™æµï¼Œæ¯”å¦‚è¯´é™åˆ¶å•ä¸ªç”¨æˆ·åœ¨æ¯ç§’åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè¿™é‡Œæˆ‘ä»¬æ€ä¹ˆå»æ€è€ƒè¿™ä¸ªé™æµçš„é˜ˆå€¼æ˜¯å¤šå°‘ï¼Ÿå¤šå°‘åˆé€‚å‘¢ï¼Ÿ

ç°åœ¨çš„é—®é¢˜ï¼šä½¿ç”¨ç³»ç»Ÿæ˜¯éœ€è¦æ¶ˆè€—æˆæœ¬çš„ï¼Œç”¨æˆ·æœ‰å¯èƒ½ç–¯ç‹‚åˆ·é‡ï¼Œè®©ä½ ç ´äº§ã€‚
**è§£å†³é—®é¢˜ï¼š**
1ã€æ§åˆ¶æˆæœ¬=>é™åˆ¶ç”¨æˆ·è°ƒç”¨æ€»æ¬¡æ•°
2ã€ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…ç–¯ç‹‚ä½¿ç”¨ï¼Œå¯¼è‡´æœåŠ¡å™¨èµ„æºè¢«å æ»¡ï¼Œå…¶ä»–ç”¨æˆ·æ— æ³•ä½¿ç”¨=>é™æµ
**æ€è€ƒï¼š**
æ€è€ƒé™æµé˜ˆå€¼å¤šå¤§åˆé€‚ï¼Ÿå‚è€ƒæ­£å¸¸ç”¨æˆ·çš„ä½¿ç”¨ï¼Œæ¯”å¦‚é™åˆ¶å•ä¸ªç”¨æˆ·åœ¨æ¯ç§’åªèƒ½ä½¿ç”¨1æ¬¡ã€‚
#### 3.3.1 é™æµç®—æ³•
[å‚è€ƒæ–‡ç« ](https://juejin.cn/post/6967742960540581918)
1ã€å›ºå®šçª—å£é™æµ
å•ä½æ—¶é—´å†…å…è®¸éƒ¨åˆ†æ“ä½œ
é™å®šï¼š1å°æ—¶åªå…è®¸10ä¸ªç”¨æˆ·æ“ä½œ
ä¼˜ç‚¹ï¼šæœ€ç®€å•
ç¼ºç‚¹ï¼šå¯å‡ºç°æµé‡çªåˆº
æ¯”å¦‚ï¼šå‰59åˆ†é’Ÿæ²¡æœ‰1ä¸ªæ“ä½œï¼Œç¬¬59åˆ†é’Ÿæ¥äº†10ä¸ªæ“ä½œï¼›ç¬¬1å°æ—¶01åˆ†é’Ÿåˆæ¥äº†10ä¸ªæ“ä½œã€‚ç›¸å½“äº2åˆ†é’Ÿå†…æ‰§è¡Œäº†20ä¸ªæ“ä½œï¼ŒæœåŠ¡å™¨ä»ç„¶æœ‰é«˜å³°å±é™©ã€‚

2ã€æ»‘åŠ¨çª—å£é™æµ
å•ä½æ—¶é—´å†…å…è®¸éƒ¨åˆ†æ“ä½œï¼Œä½†æ˜¯è¿™ä¸ªå•ä½æ—¶é—´æ˜¯æ»‘åŠ¨çš„ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæ»‘åŠ¨å•ä½ã€‚
æ¯”å¦‚æ»‘åŠ¨å•ä½ï¼š1min
å¼€å§‹å‰æ—¶é—´é™æµï¼š0s 1h 2h
ä¸€åˆ†é’Ÿé™æµæ—¶é—´åï¼š1min 1h1min 2h1min
> è§£å†³äº†å›ºå®šçª—å£é™æµå­˜åœ¨çš„é—®é¢˜

ä¼˜ç‚¹ï¼šèƒ½å¤Ÿè§£å†³ä¸Šè¿°æµé‡çªåˆºçš„é—®é¢˜ï¼Œå› ä¸ºç¬¬59åˆ†é’Ÿæ—¶ï¼Œé™æµçª—å£æ˜¯59åˆ†~1å°æ—¶59åˆ†ï¼Œè¿™ä¸ªæ—¶é—´æ®µå†…åªèƒ½æ¥å—10æ¬¡è¯·æ±‚ï¼Œåªè¦è¿˜åœ¨è¿™ä¸ªçª—å£å†…ï¼Œæ›´å¤šçš„æ“ä½œå°±ä¼šè¢«æ‹’ç»ã€‚
ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å›ºå®šçª—å£æ¥è¯´æ¯”è¾ƒå¤æ‚ï¼Œé™æµæ•ˆæœå’Œä½ çš„æ»‘åŠ¨å•ä½æœ‰å…³ï¼Œæ»‘åŠ¨å•ä½è¶Šå°ï¼Œé™æµæ•ˆæœè¶Šå¥½ï¼Œä½†å¾€å¾€å¾ˆéš¾é€‰å–åˆ°ä¸€ä¸ªç‰¹åˆ«åˆé€‚çš„æ»‘åŠ¨å•ä½ã€‚

3ã€æ¼æ¡¶é™æµ
ç‰¹ç‚¹ï¼šä»¥å›ºå®šçš„é€Ÿç‡å¤„ç†è¯·æ±‚ï¼ˆæ¼æ°´ï¼‰ï¼Œå½“è¯·æ±‚æ¡¶æ»¡äº†åï¼Œæ‹’ç»è¯·æ±‚ã€‚
ä¸¾ä¾‹ï¼šæ¯ç§’å¤„ç†10ä¸ªè¯·æ±‚ï¼Œæ¡¶çš„å®¹é‡æ˜¯10ï¼Œæ¯0.1ç§’å›ºå®šå¤„ç†ä¸€æ¬¡è¯·æ±‚ï¼Œå¦‚æœ1ç§’å†…æ¥äº†10ä¸ªè¯·æ±‚ï¼Œè¿™10æ­¤è¯·æ±‚éƒ½å¯ä»¥å¤„ç†å®Œï¼Œä½†å¦‚æœ1ç§’å†…æ¥äº†11ä¸ªè¯·æ±‚ï¼Œæœ€åé‚£ä¸ªè¯·æ±‚å°±ä¼šæº¢å‡ºæ¡¶ï¼Œè¢«æ‹’ç»è¯·æ±‚ã€‚
ä¼˜ç‚¹ï¼šèƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸Šåº”å¯¹æµé‡çªåˆºï¼Œèƒ½å¤Ÿå›ºå®šé€Ÿç‡å¤„ç†è¯·æ±‚ï¼Œä¿è¯æœåŠ¡å™¨çš„å®‰å…¨ã€‚
ç¼ºç‚¹ï¼šæ²¡æœ‰å›ºå®šé€Ÿç‡å¤„ç†ä¸€æ‰¹è¯·æ±‚ï¼Œåªèƒ½ä¸€ä¸ªä¸€ä¸ªæŒ‰é¡ºåºæ¥å¤„ç†ï¼ˆå›ºå®šé€Ÿç‡çš„ç¼ºç‚¹ï¼‰
> æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucket Algorithmï¼‰ æ¼æ¡¶ç®—æ³•å¯ä»¥çœ‹ä½œä¸€ä¸ªæ¼æ°´çš„æ¡¶ï¼Œæ°´ä»¥æ’å®šçš„é€Ÿåº¦æµå‡ºï¼Œå½“æ°´æµå…¥é€Ÿåº¦è¶…å‡ºæ¼å‡ºé€Ÿåº¦æ—¶ï¼Œå¤šä½™çš„æ°´å°†ä¼šæº¢å‡ºã€‚åœ¨æ­¤ç®—æ³•ä¸­ï¼Œè¯·æ±‚è¢«å¤„ç†ä¸ºæ°´æ»´ï¼Œæ¼æ¡¶åˆ™ä»£è¡¨ç€è¯·æ±‚è¢«å¤„ç†çš„å®¹å™¨ã€‚å¦‚æœå½“å‰æ¡¶å†…æ°´æ»´é‡å°äºç­‰äºå½“å‰è¯·æ±‚æ•°ï¼Œåˆ™å¤„ç†è¯·æ±‚ï¼›è‹¥æ°´æ»´æ•°é‡å¤§äºå½“å‰è¯·æ±‚æ•°ï¼Œåˆ™æ‹’ç»è¯¥è¯·æ±‚ã€‚
> å®ç°è¿‡ç¨‹ï¼š
> 1. åˆå§‹åŒ–æ¼æ¡¶å®¹é‡å’Œé€Ÿç‡ï¼›
> 2. ä¸æ–­å°†è¯·æ±‚æ·»åŠ è‡³æ¼æ¡¶ï¼›
> 3. å¦‚æœæ¼æ¡¶å·²æ»¡ï¼Œåˆ™æ‹’ç»è¯¥è¯·æ±‚ï¼›
> 4. å½“æ¼æ¡¶ä¸­æœ‰è¯·æ±‚æ—¶ï¼Œåœ¨ä¸€å®šæ—¶é—´é—´éš”å†…æŒ‰ç…§é€Ÿç‡æ’å®šåœ°å¤„ç†è¯·æ±‚ï¼Œå¹¶ä»æ¼æ¡¶ä¸­ç§»é™¤è¯¥è¯·æ±‚ã€‚
> 
æ¼æ¡¶ç®—æ³•åœ¨é™æµçš„è¿‡ç¨‹ä¸­ä¼šå›ºå®šå¤„ç†è¯·æ±‚çš„é€Ÿç‡ï¼Œå› æ­¤æ— æ³•åº”å¯¹çªå‘è¯·æ±‚æˆ–è®¿é—®é«˜å³°æœŸï¼Œå®¹æ˜“é€ æˆè¯·æ±‚å¤„ç†å»¶æ—¶æˆ–æ‹’ç»ã€‚åŒæ—¶ï¼Œè¯¥ç®—æ³•æ— æ³•å‡†ç¡®åœ°ä¿è¯åœ¨çŸ­æ—¶é—´å†…è¾¾åˆ°æ•´ä½“å¹³å‡é™æµé€Ÿç‡ã€‚


4ã€ä»¤ç‰Œæ¡¶é™æµ
> å¯ä»¥è§£å†³æ¼æ¡¶å­˜åœ¨çš„é—®é¢˜

ç®¡ç†å‘˜å…ˆç”Ÿæˆä¸€æ‰¹ä»¤ç‰Œï¼Œæ¯ç§’ç”Ÿæˆ10ä¸ªä»¤ç‰Œï¼›å½“ç”¨æˆ·è¦æ“ä½œå‰ï¼Œå…ˆå»æ‹¿åˆ°ä¸€ä¸ªä»¤ç‰Œï¼Œæœ‰ä»¤ç‰Œçš„äººå°±æœ‰èµ„æ ¼æ‰§è¡Œæ“ä½œã€åŒæ—¶æ‰§è¡Œæ“ä½œï¼›æ‹¿ä¸åˆ°ä»¤ç‰Œçš„å°±ç­‰ç€
ä¼˜ç‚¹ï¼šèƒ½å¤Ÿå¹¶å‘å¤„ç†åŒæ—¶çš„è¯·æ±‚ï¼Œå¹¶å‘æ€§èƒ½ä¼šæ›´é«˜
éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼šè¿˜æ˜¯å­˜åœ¨æ—¶é—´å•ä½é€‰å–çš„é—®é¢˜
> ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆToken Bucket Algorithmï¼‰ ä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥çœ‹ä½œä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œå…¶ä¸­ä»¤ç‰Œä»¥æ’å®šçš„é€Ÿç‡äº§ç”Ÿã€‚å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå¦‚æœä»¤ç‰Œæ¡¶ä¸­ä»ç„¶æœ‰ä»¤ç‰Œï¼Œåˆ™è¯¥è¯·æ±‚å¾—åˆ°å¤„ç†å¹¶ä»ä»¤ç‰Œæ¡¶ä¸­å‡å»ä¸€ä¸ªä»¤ç‰Œã€‚å¦‚æœä»¤ç‰Œæ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œï¼Œåˆ™è¯·æ±‚å°†è¢«æ‹’ç»ã€‚åœ¨æ­¤ç®—æ³•ä¸­ï¼Œä»¤ç‰Œä»£è¡¨è¯·æ±‚èƒ½å¤Ÿè¢«å¤„ç†çš„æ•°é‡ï¼Œè€Œæ¡¶åˆ™ä»£è¡¨ç€è¯·æ±‚è¢«å¤„ç†çš„å®¹å™¨ã€‚
> å®ç°è¿‡ç¨‹ï¼š
> 1. åˆå§‹åŒ–ä»¤ç‰Œæ¡¶å®¹é‡å’Œé€Ÿç‡ï¼›
> 2. ä»¥æ’å®šé€Ÿç‡å¾€ä»¤ç‰Œæ¡¶ä¸­æ·»åŠ ä»¤ç‰Œï¼›
> 3. å½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå¦‚ä»¤ç‰Œæ¡¶ä¸­ä»æœ‰ä»¤ç‰Œï¼Œåˆ™ä»æ¡¶ä¸­ç§»é™¤ä¸€ä¸ªä»¤ç‰Œï¼Œå¹¶å¤„ç†è¯¥è¯·æ±‚ï¼›
> 4. å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œï¼Œæ‹’ç»è¯¥è¯·æ±‚ã€‚
> 
ä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥ç¼“è§£æ¼æ¡¶ç®—æ³•çš„ç¼ºç‚¹ï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ä¸‹å¯èƒ½å­˜åœ¨ä¸€å®šé—®é¢˜ã€‚æ¯”å¦‚åœ¨åº”å¯¹çŸ­æ—¶é—´å†…çš„é«˜å¹¶å‘è¯·æ±‚æ—¶ï¼Œç”±äºä»¤ç‰Œæ•°æœ‰é™ï¼Œå¼•å…¥è¿‡å¤§çš„å¹¶å‘è¯·æ±‚ä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œä¹Ÿå¯èƒ½ä¼šé€ æˆè¯·æ±‚å¤±è´¥æˆ–è€…æ‹’ç»ã€‚


é™æµç²’åº¦

1. é’ˆå¯¹æŸä¸ªæ–¹æ³•é™æµï¼Œå³å•ä½æ—¶é—´å†…æœ€å¤šå…è®¸åŒæ—¶Xä¸ªæ“ä½œä½¿ç”¨è¿™ä¸ªæ–¹æ³•
2. é’ˆå¯¹æŸä¸ªç”¨æˆ·é™æµï¼Œæ¯”å¦‚å•ä¸ªç”¨æˆ·å•ä½æ—¶é—´å†…æœ€å¤šæ‰§è¡ŒXæ¬¡æ“ä½œ
3. é’ˆå¯¹æŸä¸ªç”¨æˆ·Xæ–¹æ³•é™æµï¼Œæ¯”å¦‚å•ä¸ªç”¨æˆ·å•ä½æ—¶é—´å†…æœ€å¤šæ‰§è¡ŒXæ¬¡è¿™ä¸ªæ–¹æ³•
#### 3.3.2 é™æµå®ç°
##### 1ã€æœ¬åœ°é™æµï¼ˆå•æœºé™æµï¼‰
æ¯ä¸ªæœåŠ¡å™¨å•ç‹¬é™æµï¼Œä¸€èˆ¬é€‚ç”¨äºå•ä½“é¡¹ç›®ï¼Œå°±æ˜¯ä½ çš„é¡¹ç›®åªæœ‰ä¸€ä¸ªæœåŠ¡å™¨ã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ çš„ç³»ç»Ÿæœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨é™åˆ¶ç”¨æˆ·æ¯ç§’åªèƒ½è¯·æ±‚ä¸€æ¬¡ã€‚ä½ å¯ä»¥ä¸º 
æ¯å°æœåŠ¡å™¨å•ç‹¬è®¾ç½®é™æµç­–ç•¥ï¼Œè¿™æ ·æ¯ä¸ªæœåŠ¡å™¨éƒ½èƒ½å¤Ÿç‹¬ç«‹åœ°æ§åˆ¶ç”¨æˆ·çš„è¯·æ±‚é¢‘ç‡ã€‚ä½†æ˜¯è¿™ç§é™æµæ–¹å¼å¹¶ä¸æ˜¯å¾ˆå¯é ï¼Œå› ä¸ºä½ å¹¶ä¸çŸ¥é“ç”¨æˆ·çš„è¯·æ±‚ä¼šè½åœ¨å“ªå°æœåŠ¡å™¨ä¸Šï¼Œå®ƒçš„åˆ†å¸ƒæ˜¯æœ‰ä¸€å®šçš„å¶ç„¶æ€§çš„ã€‚å³ä½¿ä½ é‡‡ç”¨è´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œè®©ç”¨æˆ·è¯·æ±‚è½®æµå‘é€åˆ°æ¯å°æœåŠ¡å™¨ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚
åœ¨ Java ä¸­ï¼Œæœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹åº“å¯ä»¥ç”¨æ¥å®ç°å•æœºé™æµï¼š 
Guava RateLimiterï¼šè¿™æ˜¯è°·æ­Œ Guava åº“æä¾›çš„é™æµå·¥å…·ï¼Œå¯ä»¥å¯¹å•ä½æ—¶é—´å†…çš„è¯·æ±‚æ•°é‡è¿›è¡Œé™åˆ¶ã€‚

##### 2ã€åˆ†å¸ƒå¼é™æµ (é›†ç¾¤é™æµ)
å¦‚æœä½ çš„é¡¹ç›®æœ‰å¤šä¸ªæœåŠ¡å™¨ï¼Œæ¯”å¦‚å¾®æœåŠ¡ï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨**åˆ†å¸ƒå¼é™æµ**ã€‚

1. æŠŠç”¨æˆ·çš„ä½¿ç”¨é¢‘ç‡ç­‰æ•°æ®æ”¾åˆ°ä¸€ä¸ªé›†ä¸­çš„å­˜å‚¨è¿›è¡Œç»Ÿè®¡ï¼Œæ¯”å¦‚Rdis,è¿™æ ·æ— è®ºç”¨æˆ·çš„è¯·æ±‚è½åˆ°äº†å“ªå°æœåŠ¡å™¨ï¼Œéƒ½ä»¥é›†ä¸­çš„æ•°æ®å­˜å‚¨å†…çš„æ•°æ®ä¸ºå‡† (Redissonï¼Œæ˜¯ä¸€ä¸ªæ“ä½œRedisçš„å·¥å…·åº“)
2. åœ¨ç½‘å…³é›†ä¸­è¿›è¡Œé™æµå’Œç»Ÿè®¡ï¼ˆæ¯”å¦‚Sentinelã€Spring Cloud Gateway)
#### 3.3.3 Redissoné™æµå®ç°
Redissonå†…ç½®äº†ä¸€ä¸ªé™æµæ±Ÿå…·ç±»ï¼Œå¯ä»¥å¸®åŠ©ä½ åˆ©ç”¨Redisæ¥å­˜å‚¨ã€æ¥ç»Ÿè®¡ã€‚
[å‚è€ƒå®˜ç½‘](https://github.com/redisson/redisson)

1. çœ‹æ–‡æ¡£
2. ä¸‹è½½æºç 

å®ç°è¿‡ç¨‹

1.  å®‰è£…Radis 
2.  å¼•å…¥RedissonåŒ… 
```
<dependency>
   <groupId>org.redisson</groupId>
   <artifactId>redisson</artifactId>
   <version>3.21.3</version>
</dependency>
```

3.  åˆ›å»ºRedissonConfigé…ç½®ç±»ï¼Œç”¨äºåˆå§‹åŒ–RedissonClientå¯¹è±¡å•ä¾‹ï¼š 

åœ¨ configç›®å½• ä¸‹æ–°å»º RedissonConfig.java
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723388177066-ade4fdfb-076b-4447-a178-1aefb84eb5f4.png#averageHue=%23fbf9f9&clientId=u310f051a-d124-4&from=paste&height=279&id=uc837afb5&originHeight=335&originWidth=694&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=83023&status=done&style=none&taskId=u3d957f95-33d4-4f7a-8ae3-f8424295502&title=&width=578.3333103524324)
```java
package com.yupi.springbootinit.config;

import lombok.Data;
import org.redisson.Redisson;
import org.redisson.api.RedissonClient;
import org.redisson.config.Config;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-12 17:51
 **/
@Data
@ConfigurationProperties(prefix = "spring.redis")
@Configuration
public class RedissonConfig {
    private Integer database;
    private String host;
    private Integer port;
    private String password;

    @Bean
    public RedissonClient redissonClient() {
        Config config = new Config();
        config.useSingleServer()
//                .setDatabase(database)
                .setAddress("redis://" + host + ":" + port)
                .setPassword(password);
//        config.useSingleServer().setAddress("redis://127.0.0.1:6380").setPassword("123456");
//        config.useSingleServer().setAddress("redis://192.168.1.100:6379").setPassword("123456");
        RedissonClient redisson = Redisson.create(config);
        return redisson;
    }
}
```
å» application.yml å–æ¶ˆ redis é…ç½®æ³¨é‡Šã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723388213222-1a14b34a-9fa4-4fe2-a220-509210df548f.png#averageHue=%23f8f7f6&clientId=u310f051a-d124-4&from=paste&height=314&id=u33965833&originHeight=377&originWidth=583&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=127229&status=done&style=none&taskId=u8c86b66d-00f2-4174-90ee-da088d07104&title=&width=485.8333140280519)
```java
  redis:
#    database: 1
#    host: 192.168.1.100
#    port: 6379
    host: 127.0.0.1
    port: 6380
    password: 123456
    timeout: 5000
    lettuce:
      pool:
        max-active: 10
        max-idle: 10
        min-idle: 1
        time-between-eviction-runs: 10s
```

4.  ç¼–å†™RedisLimiterManager

**é¢˜å¤–è¯ï¼š**æ€ä¹ˆçŸ¥é“ redis æœ‰æ²¡æœ‰å¯†ç ï¼Ÿ 
åœ¨æœ¬åœ°å®‰è£…çš„ redis ç›®å½•ä¸‹æ‰¾åˆ° redis-server.exe ï¼ŒåŒå‡»å¯åŠ¨ï¼Œæ”¾é‚£åˆ«å…³æ‰ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723388251892-05070b37-cea5-429d-ba7e-f6660fd6fbb8.png#averageHue=%231aa315&clientId=u310f051a-d124-4&from=paste&height=233&id=aoLXM&originHeight=280&originWidth=536&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=68072&status=done&style=none&taskId=u89dd0038-8cfd-428d-a4f8-8c88d46313f&title=&width=446.6666489177287)
ç„¶ååœ¨ redis ç›®å½•ä¸‹æ‰¾åˆ° redis-cli.exe ï¼Œè¾“å…¥å‘½ä»¤ config get requirepass ã€‚ 
æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ‰€ä»¥ 2) ä¸ºç©ºã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723388265947-d33334c8-10dc-465b-86fd-bfd9d7ca3eb8.png#averageHue=%2350b338&clientId=u310f051a-d124-4&from=paste&height=62&id=GDeVu&originHeight=75&originWidth=321&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=13478&status=done&style=none&taskId=u205928eb-4e38-4a7d-a860-59822b9dbbf&title=&width=267.49998937050543)
åˆ›å»ºå¥½ redis å®¢æˆ·ç«¯ï¼Œå»å†™ä¸€ä¸ªç®¡ç†ç±»ï¼› 
åœ¨ ErrorCode.java æ·»åŠ é”™è¯¯ç ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723388353094-b612e160-1ff0-4e63-ba79-0bf4b3689895.png#averageHue=%23f8f6f5&clientId=u310f051a-d124-4&from=paste&height=309&id=rITIJ&originHeight=371&originWidth=654&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=175574&status=done&style=none&taskId=u1115cf24-05e5-442a-8d6f-901fe10054d&title=&width=544.9999783436466)
```java
TOO_MANY_REQUEST(42900, "è¯·æ±‚è¿‡äºé¢‘ç¹"),
```
ç¼–å†™ RedisLimiterManagerï¼šä»€ä¹ˆæ˜¯ Managerï¼Ÿä¸“é—¨æä¾› RedisLimiter é™æµåŸºç¡€æœåŠ¡çš„**(æä¾›äº†é€šç”¨çš„èƒ½åŠ›ï¼Œå¯ä»¥æ”¾åˆ°ä»»ä½•ä¸€ä¸ªé¡¹ç›®é‡Œ)**ã€‚
åœ¨ managerç›®å½• ä¸‹åˆ›å»º RedisLimiterManager.java ã€‚
ä»€ä¹ˆæ˜¯Manager??ä¸“é—¨æä¾›RedisLimiteré™æµåŸºç¡€æœåŠ¡çš„ï¼ˆæä¾›äº†é€šç”¨çš„èƒ½åŠ›ï¼Œå¯ä»¥æ”¾åˆ°ä»»ä½•ä¸€ä¸ªé¡¹ç›®é‡Œï¼‰ 
```java
@Service
public class RedisLimiterManager {

    @Resource
    private RedissonClient redissonClient;

    /**
     * é™æµæ“ä½œ
     *
     * @param key åŒºåˆ†ä¸åŒçš„é™æµå™¨ï¼Œæ¯”å¦‚ä¸åŒçš„ç”¨æˆ· id åº”è¯¥åˆ†åˆ«ç»Ÿè®¡
     */
    public void doRateLimit(String key) {
        // åˆ›å»ºä¸€ä¸ªé™æµå™¨
        RRateLimiter rateLimiter = redissonClient.getRateLimiter(key);
        // æ¯ç§’æœ€å¤šè®¿é—® 2 æ¬¡
        // å‚æ•°1 typeï¼šé™æµç±»å‹ï¼Œå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ä»»ä½•ç±»å‹ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„é™æµç­–ç•¥ã€‚
        // å‚æ•°2 rateï¼šé™æµé€Ÿç‡ï¼Œå³å•ä½æ—¶é—´å†…å…è®¸é€šè¿‡çš„è¯·æ±‚æ•°é‡ã€‚
        // å‚æ•°3 rateIntervalï¼šé™æµæ—¶é—´é—´éš”ï¼Œå³é™æµé€Ÿç‡çš„è®¡ç®—å‘¨æœŸé•¿åº¦ã€‚
        // å‚æ•°4 unitï¼šé™æµæ—¶é—´é—´éš”å•ä½ï¼Œå¯ä»¥æ˜¯ç§’ã€æ¯«ç§’ç­‰ã€‚
        rateLimiter.trySetRate(RateType.OVERALL, 2, 1, RateIntervalUnit.SECONDS);
        // æ¯å½“ä¸€ä¸ªæ“ä½œæ¥äº†åï¼Œè¯·æ±‚ä¸€ä¸ªä»¤ç‰Œ
        boolean canOp = rateLimiter.tryAcquire(1);
        ThrowUtils.throwIf(!canOp,ErrorCode.TOO_MANY_REQUEST);
    }
}
```

5.  å•å…ƒæµ‹è¯• 
```java
@SpringBootTest
class RedisLimiterManagerTest {
    @Resource
    private RedisLimiterManager redisLimiterManager;

    @Test
    void doRateLimit() throws InterruptedException {
        String userId = "1";
        for (int i = 0; i < 2; i++) {
            redisLimiterManager.doRateLimit(userId);
            System.out.println("æˆåŠŸ");
        }
        Thread.sleep(1000);
        for (int i = 0; i < 5; i++) {
            redisLimiterManager.doRateLimit(userId);
            System.out.println("æˆåŠŸ");
        }
    }
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723519021009-2c9aa6c4-3a02-4df6-9908-6c760d6a1e9e.png#averageHue=%23282d35&clientId=u753b6bfd-32b1-4&from=paste&height=772&id=uc9a2ca35&originHeight=927&originWidth=2655&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=194405&status=done&style=none&taskId=ufa298c04-7416-4540-893f-18f21a75c9e&title=&width=2212.4999120831526)

6.  åº”ç”¨åˆ°è¦é™æµçš„æ–¹æ³•ä¸­ï¼Œæ¯”å¦‚æ™ºèƒ½åˆ†ææ¥å£ 
```java
// ç”¨æˆ·æ¯ç§’é™æµ
redisLimiterManager.doRateLimit("genChartByAi_" + loginUser.getId());
```
todo å¦‚éœ€å¼€å¯ Redisï¼Œé¡»ç§»é™¤ exclude ä¸­çš„å†…å®¹
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723471007735-ffb695a0-6f77-45be-865e-bca35a8812bb.png#averageHue=%23292d36&clientId=ueccb7181-e18c-4&from=paste&height=871&id=udeb3dfef&originHeight=1045&originWidth=2275&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=239064&status=done&style=none&taskId=u17975813-fafa-4fa1-97a7-4732d423984&title=&width=1895.8332579996882)
æŠ¥é”™ç«¯å£å ç”¨ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723517747588-53ece713-3888-42b1-84b4-35f350acd0f8.png#averageHue=%23161616&clientId=u753b6bfd-32b1-4&from=paste&height=1018&id=udc30fcb3&originHeight=1222&originWidth=2346&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=115524&status=done&style=none&taskId=u6b1fab69-ef71-49cf-b5a0-b5db5068397&title=&width=1954.9999223152827)
# ç¬¬äº”æœŸ - å¼‚æ­¥åŒ–ç”Ÿæˆå›¾è¡¨
## 1ã€å½“å‰ç³»ç»Ÿé—®é¢˜åˆ†æ
ç›¸åŒé—®é¢˜åœºæ™¯ï¼š**è°ƒç”¨çš„æœåŠ¡å¤„ç†èƒ½åŠ›æœ‰é™ï¼Œæˆ–è€…æ¥å£çš„å¤„ç†ï¼ˆæˆ–è¿”å›ï¼‰æ—¶é•¿è¾ƒé•¿æ—¶ï¼Œå°±åº”è¯¥è€ƒè™‘å¼‚æ­¥åŒ–äº†ã€‚**
> è¦å¤„ç†å¾ˆå¤§çš„æœåŠ¡ï¼Œæˆ–è€…å¤„ç†çš„ä»»åŠ¡å¾ˆé‡ï¼Œå¤„ç†çš„æ—¶é—´å¾ˆä¹…æ—¶ï¼Œå°±è€ƒè™‘å¼‚æ­¥åŒ–ã€‚
> æœ¬é¡¹ç›®ï¼š
> ä¸èƒ½è®©ç”¨æˆ·ç­‰å¾…å¤ªä¹…ç”Ÿæˆå›¾è¡¨ï¼Œæœ€åè¿˜æœ‰å¯èƒ½å‡ºç°æ— æ³•ç”Ÿæˆçš„æƒ…å†µï¼Œè¿™æ ·å°±è€ƒè™‘å¼‚æ­¥è¿›è¡Œã€‚

1. ç”¨æˆ·ç­‰å¾…æ—¶é—´æœ‰ç‚¹é•¿ï¼ˆå› ä¸ºè¦ç­‰AIç”Ÿæˆï¼‰

å¦‚æœæœ‰åŒå­¦ä¹‹å‰åšè¿‡åŒæ­¥å˜å¼‚æ­¥æ–¹é¢çš„ä¼˜åŒ–ï¼Œåº”è¯¥èƒ½çœ‹å‡ºæ¥è¿™ä¸ªå›¾è¡¨ç”Ÿæˆçš„æ—¶é—´æœ‰ç‚¹é•¿ã€‚ 
å› ä¸ºæˆ‘ä»¬èƒŒåç”¨çš„ AI èƒ½åŠ›æ˜¯éœ€è¦ä¸€å®šæ—¶é—´æ¥å®Œæˆå¤„ç†çš„ã€‚

2. ä¸šåŠ¡æœåŠ¡å™¨å¯èƒ½ä¼šæœ‰å¾ˆå¤šè¯·æ±‚åœ¨å¤„ç†ï¼Œå¯¼è‡´ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œä¸¥é‡æ—¶å¯¼è‡´æœåŠ¡å™¨å®•æœºæˆ–è€…æ— æ³•å¤„ç†æ–°çš„è¯·æ±‚

å½“ç³»ç»Ÿé¢ä¸´å¤§é‡ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå¦‚æœå¤„ç†èƒ½åŠ›æœ‰é™ï¼Œä¾‹å¦‚æœåŠ¡å™¨çš„å†…å­˜ã€CPUã€ç½‘ç»œå¸¦å®½ç­‰èµ„æºæœ‰é™ï¼Œè¿™å¯èƒ½å¯¼è‡´ç”¨æˆ·å¤„åœ¨ä¸€ä¸ªé•¿æ—¶é—´çš„ç­‰å¾…çŠ¶æ€ã€‚ç‰¹åˆ«æ˜¯åœ¨è®¸å¤šç”¨æˆ·åŒæ—¶æäº¤è¯·æ±‚çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¯èƒ½éœ€è¦è¾ƒé•¿çš„æ—¶é—´æ¥å¤„ç†ã€‚ 
æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬åç«¯çš„ AI å¤„ç†èƒ½åŠ›æœ‰é™ï¼Œä¹Ÿæœ‰å¯èƒ½å¼•å‘é—®é¢˜ã€‚æ¯”å¦‚ï¼Œä¸ºäº†ç¡®ä¿å¹³å°çš„å®‰å…¨æ€§ï¼Œ æˆ‘ä»¬å¯èƒ½ä¼šé™åˆ¶ç”¨æˆ·çš„è®¿é—®é¢‘ç‡ï¼Œå³æ¯ç§’æˆ–æ¯å‡ ç§’ç”¨æˆ·åªèƒ½è®¿é—®ä¸€æ¬¡æˆ–å‡ æ¬¡ã€‚ä¸€æ—¦ç”¨æˆ·è¿‡å¤šåœ°æäº¤è¯·æ±‚ï¼Œå°±ä¼šå¢å¤§ AI å¤„ç†çš„æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå¯¼è‡´ AI æœåŠ¡å™¨å¤„ç†ä¸äº†è¿™ä¹ˆå¤šè¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–ç”¨æˆ·åªèƒ½ç­‰å¾…ï¼Œè€Œåœ¨å‰ç«¯ç•Œé¢ä¹Ÿåªèƒ½æ˜¾ç¤ºæŒç»­ç­‰å¾…çš„çŠ¶æ€ã€‚é•¿æ—¶é—´ç­‰å¾…åï¼Œç”¨æˆ·å¯èƒ½ä¼šæ”¶åˆ°æœåŠ¡å™¨ç¹å¿™çš„é”™è¯¯ä¿¡æ¯ã€‚è¿™ä¸ä»…å½±å“äº†ç”¨æˆ·çš„ä½“éªŒï¼Œä¹Ÿå¯¹æœåŠ¡å™¨å’Œæˆ‘ä»¬ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹æœåŠ¡å¸¦æ¥å‹åŠ›ã€‚ 
æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘æœåŠ¡å™¨å¦‚ Tomcat çš„çº¿ç¨‹æ•°é™åˆ¶ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚æ¯åç§’åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œä½†å´æœ‰ 200 ä¸ªç”¨æˆ·åœ¨ä¸€ç§’é’Ÿå†…åŒæ—¶æäº¤è¯·æ±‚ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡ç”¨æˆ·è¯·æ±‚åœ¨æœåŠ¡å™¨ä¸Šç§¯å‹ï¼Œæ•°æ®ä¹Ÿæ— æ³•åŠæ—¶æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚å¦‚æœç”¨æˆ·é•¿æ—¶é—´ç­‰å¾…æœ€ç»ˆä»å¾—åˆ°è¯·æ±‚å¤±è´¥çš„ç»“æœï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿä¼šå¯¹æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚

3. è°ƒç”¨çš„ç¬¬ä¸‰æ–¹æœåŠ¡(AIèƒ½åŠ›)çš„å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚æ¯3ç§’åªå¤„ç†1ä¸ªè¯·æ±‚ï¼Œå½“å¤šä¸ªè¯·æ±‚æ—¶ä¼šå¯¼è‡´ AI å¤„ç†ä¸è¿‡æ¥ï¼Œä¸¥é‡æ—¶AIå¯èƒ½ä¼šå¯¹å’±ä»¬çš„åå°ç³»ç»Ÿæ‹’ç»æœåŠ¡ã€‚

å½“æˆ‘ä»¬è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ AI å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œå¦‚æ¯ä¸‰ç§’åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§é‡ç”¨æˆ·åŒæ—¶è¯·æ±‚å¯èƒ½å¯¼è‡´ AI è¿‡è½½ï¼Œç”šè‡³æ‹’ç»æˆ‘ä»¬çš„è¯·æ±‚ã€‚ 
å‡è®¾æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„é±¼èªæ˜å¹³å°ï¼Œè¿™æ˜¯ä¸€ä¸ªæä¾› AI å›ç­”åŠŸèƒ½çš„æœåŠ¡ã€‚åœ¨æˆ‘ä»¬çš„å¼€å‘çš„æ™ºèƒ½ BI ä¸­ï¼Œå¦‚æœæœ‰ 100 ä¸ªç”¨æˆ·åŒæ—¶è®¿é—®ï¼Œå°±éœ€è¦ 100 æ¬¡è°ƒç”¨é±¼èªæ˜ AIã€‚ç„¶è€Œï¼Œé±¼èªæ˜ AI å¯èƒ½æ— æ³•åœ¨ä¸€ç§’é’Ÿå†…æœåŠ¡ 100 ä¸ªç”¨æˆ·ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒAI æœåŠ¡ä¼šè®¤ä¸ºæˆ‘ä»¬åœ¨æ”»å‡»å®ƒï¼Œæˆ–è€…è¶…è¿‡äº†å®ƒçš„å¤„ç†èƒ½åŠ›ï¼Œå¯èƒ½ä¼šå¯¹æˆ‘ä»¬æ–½åŠ é™åˆ¶ã€‚è¿™æ„æˆäº†ä¸€ä¸ªæ½œåœ¨çš„é£é™©

## 2ã€å¼‚æ­¥åŒ–å¤„ç†å›¾è¡¨ç”Ÿæˆ
### 2.1 åŒæ­¥ä¸å¼‚æ­¥
åŒæ­¥ï¼šä¸€ä»¶äº‹æƒ…åšå®Œï¼Œå†åšå¦å¤–ä¸€ä»¶äº‹æƒ…ï¼Œä¸èƒ½åŒæ—¶è¿›è¡Œå…¶ä»–çš„ä»»åŠ¡ã€‚ï¼ˆæ¯”å¦‚ä½ åœ¨çƒ§æ°´ï¼Œå°±ä¸èƒ½å»åšå…¶ä»–çš„æ—¶é—´ã€‚ä½†æ˜¯äº‹å®å¹¶éå¦‚æ­¤ã€‚ï¼‰
å¼‚æ­¥ï¼šä¸ç”¨ç­‰ä¸€ä»¶äº‹æ•…å®Œï¼Œå°±å¯ä»¥åšå¦å¤–ä¸€ä»¶äº‹æƒ…ã€‚ç­‰ç¬¬ä¸€ä»¶äº‹å®Œæˆæ—¶ï¼Œå¯ä»¥æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œé€šçŸ¥ä½ è¿™ä»¶äº‹åšå¥½äº†ï¼Œä½ å¯ä»¥å†è¿›è¡Œåç»­å¤„ç†ã€‚ï¼ˆçƒ§æ°´çš„æ—¶å€™ï¼Œæ°´å£¶æœ‰ä¸€ä¸ªè­¦æŠ¥å™¨ï¼›çƒ§æ°´æ—¶äººå¯ä»¥åŒæ—¶å¤„ç†å·¥ä½œã€‚æ°´çƒ§å¥½åï¼Œäººå¬åˆ°å£°éŸ³ï¼Œå°±çŸ¥é“æ°´çƒ§å¥½äº†)
### 2.2 ä¸šåŠ¡æµç¨‹
#### 2.2.1 æ ‡å‡†å¼‚æ­¥åŒ–çš„ä¸šåŠ¡æµç¨‹ â­â­â­â­â­
##### æ ‡å‡†å¼‚æ­¥åŒ–ä¸šåŠ¡æµç¨‹è®²è§£
åœ¨ç”¨æˆ·éœ€è¦è¿›è¡Œé•¿æ—¶é—´çš„æ“ä½œæ—¶ï¼Œç‚¹å‡»æäº¤åä¸éœ€è¦åœ¨ç•Œé¢ç©ºç­‰ã€‚è€Œæ˜¯å…ˆä¿å­˜è‡³æ•°æ®åº“ã€‚ä»¥å¾€ æˆ‘ä»¬ä¼šç­‰å›¾è¡¨å®Œå…¨ç”Ÿæˆåå†ä¿å­˜ï¼Œä½†ç°åœ¨ï¼Œä»»åŠ¡ä¸€æäº¤ï¼Œæˆ‘ä»¬å°±ç«‹å³å­˜å‚¨ï¼Œé¿å…è®©ç”¨æˆ·åœ¨ç•Œé¢ä¸Šç­‰å¾…ã€‚
æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦å°†ç”¨æˆ·çš„æ“ä½œæˆ–ä»»åŠ¡æ·»åŠ åˆ°**ä»»åŠ¡é˜Ÿåˆ—ä¸­**ï¼Œè®©ç¨‹åºæˆ–çº¿ç¨‹æ‰§è¡Œã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå°†ç”¨æˆ·çš„æ“ä½œåŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°±åƒä¸ªå¤‡å¿˜å½•ã€‚æ¯”å¦‚æˆ‘æ˜¯å…¬å¸å”¯ä¸€çš„å‘˜å·¥ï¼Œæ­£åœ¨è¿›è¡Œä¸€ä¸ªé¡¹ç›®ï¼Œå½“æœ‰ç”¨æˆ·è¯·æ±‚ä¿®å¤ bug æ—¶ã€‚æˆ‘æ— æ³•ç«‹å³å¤„ç†ï¼Œä½†å¯ä»¥è®°ä¸‹è¿™ä¸ªä¿®å¤ bug çš„ä»»åŠ¡ï¼Œå¾…å®Œæˆé¡¹ç›®åå†å¤„ç†ã€‚è¿™ä¸ªé˜Ÿåˆ—å°±åƒæˆ‘çš„å¤‡å¿˜å½•ã€‚
ç”±äºç¨‹åºçš„å¤„ç†èƒ½åŠ›æˆ–çº¿ç¨‹æ•°æœ‰é™ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠå¾…å¤„ç†çš„ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚å½“æˆ‘ä»¬æœ‰ç©ºçš„æ—¶å€™ï¼Œå†æŒ‰é¡ºåºæ‰§è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥æ‹’ç»ã€‚å› æ­¤ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—æœ‰ç©ºä½ï¼Œæˆ‘ä»¬å¯ä»¥æ¥å—æ–°ä»»åŠ¡ï¼›å¦‚æœæœ‰ç©ºé—²çš„çº¿ç¨‹æˆ–å‘˜å·¥ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³å¼€å§‹è¿™ä¸ªä»»åŠ¡ï¼›å¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ç¢Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠä»»åŠ¡æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ï¼Œä¸”ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œé‚£æˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ
æœ‰å¾ˆå¤šç­–ç•¥ä¾›æˆ‘ä»¬é€‰æ‹©ã€‚ä¸€ç§åšæ³•æ˜¯ç›´æ¥æ‹’ç»ä»»åŠ¡ã€‚æ›´å¥½çš„æ–¹å¼æ˜¯è®°å½•ä¸‹è¿™ä¸ªä»»åŠ¡ï¼Œå¾…æœ‰ç©ºæ—¶å†å¤„ç†ã€‚æ— è®ºä»»åŠ¡æäº¤æˆåŠŸä¸å¦ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“ä¸­ä»¥å¤‡æŸ¥é˜…ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬åœ¨åæœŸæ£€æŸ¥æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å“ªäº›ä»»åŠ¡ç”±äºç¨‹åºå¤„ç†èƒ½åŠ›ä¸è¶³è€Œæœªå¾—åˆ°å¤„ç†ã€‚å³ä½¿ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥é˜…æ•°æ®åº“è®°å½•ï¼Œæ‰¾å‡ºæäº¤å¤±è´¥çš„ä»»åŠ¡ï¼Œå¹¶åœ¨ç¨‹åºç©ºé—²æ—¶å–å‡ºè¿™äº›ä»»åŠ¡ï¼Œæ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚
å½“ç”¨æˆ·éœ€è¦æ‰§è¡Œæ–°ä»»åŠ¡æ—¶ï¼Œå³ä½¿ä»»åŠ¡æäº¤å¤±è´¥ï¼Œæˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ï¼Œä¹Ÿè¦å°†å…¶è®°å½•ä¸‹æ¥ã€‚å»ºè®®**å°†è¿™ä¸ªä»»åŠ¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­è®°å½•ï¼Œæˆ–è€…è‡³å°‘æ‰“ä¸€ä¸ªæ—¥å¿—**ã€‚æˆ‘ä»¬ä¸èƒ½åªæŠŠæ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—å½“åšå”¯ä¸€çš„æµç¨‹ã€‚è¦æœ‰ä¸€äº›ä¿é™©æªæ–½ï¼Œå¦‚æ‰“æ›´å¤šçš„æ—¥å¿—ï¼Œä»¥åº”å¯¹ç½‘ç»œæˆ–ç”µåŠ›çš„çªå‘æƒ…å†µã€‚åœ¨å¼€å§‹ç¼–å†™ç¨‹åºå‰ï¼Œæˆ‘ä»¬åº”è¯¥æ¸…æ¥šè¿™äº›æµç¨‹ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘ä»¬å¯èƒ½éœ€è¦å¤„ç†çš„æƒ…å†µã€‚
åœ¨ç¬¬ä¸‰æ­¥ä¸­ï¼Œæˆ‘ä»¬çš„ç¨‹åºï¼ˆçº¿ç¨‹ï¼‰ä¼šæŒ‰ç…§ä»»åŠ¡é˜Ÿåˆ—çš„é¡ºåºé€ä¸€æ‰§è¡Œä»»åŠ¡ï¼Œè¿™å°±åƒå‘˜å·¥æŒ‰ç…§å¤‡å¿˜å½•ä¸€é¡¹æ¥ä¸€é¡¹åœ°å®Œæˆä»»åŠ¡ã€‚ä»»åŠ¡å®Œæˆåï¼Œæˆ‘ä»¬ä¼šæ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼Œå°†ç›¸å…³ä»»åŠ¡è®°å½•åœ¨æ•°æ®åº“ä¸­æ ‡è®°ä¸ºå·²å®Œæˆã€‚æ¥ä¸‹æ¥éœ€è¦è€ƒè™‘çš„é—®é¢˜æ˜¯å¦‚ä½•è®©ç”¨æˆ·çŸ¥é“ä»–ä»¬çš„ä»»åŠ¡ä½•æ—¶å®Œæˆã€‚åœ¨ç”¨æˆ·æäº¤ä»»åŠ¡åï¼Œæˆ‘ä»¬åº”è¯¥æä¾›ä¸€ä¸ªæŸ¥è¯¢ä»»åŠ¡çŠ¶æ€çš„åœ°æ–¹ï¼Œè€Œä¸æ˜¯è®©ä»–ä»¬æ— å°½åœ°ç­‰å¾…ã€‚
é€šè¿‡è¿™ä¸€ç³»åˆ—æµç¨‹ï¼Œç”¨æˆ·çš„ä½“éªŒä¼šæ¯”ç›´æ¥ç­‰å¾…ä»»åŠ¡å®Œæˆæ›´å¥½ã€‚å°¤å…¶æ˜¯åœ¨éœ€è¦è¿›è¡Œå¤æ‚åˆ†æçš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¸å¤ªå¯èƒ½åœ¨ç•Œé¢ä¸Šç­‰å¾…é‚£ä¹ˆä¹…ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–å¼‚æ­¥æ‰§è¡Œï¼Œè®©ç”¨æˆ·å…ˆå»åšå…¶ä»–äº‹æƒ…ï¼Œå¯ä»¥ç»§ç»­æäº¤æ–°ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å®æ—¶æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ã€‚è¿™æ ·çš„ä½“éªŒæ›´å¥½ï¼Œè¿œä¼˜äºç­‰å¾…é•¿æ—¶é—´åä»»åŠ¡å¤±è´¥ã€‚
â—** æ³¨æ„**ï¼šå¹¶éæ‰€æœ‰çš„æ“ä½œéƒ½éœ€è¦å¼‚æ­¥åŒ–ã€‚åªæœ‰åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„åœºæ™¯ä¸‹ï¼Œæ‰è€ƒè™‘é‡‡ç”¨å¼‚æ­¥åŒ–æ–¹å¼ã€‚å› ä¸ºå¤šçº¿ç¨‹å’Œå¼‚æ­¥å¤„ç†ä¼šå¢åŠ ä»£ç çš„å¤æ‚åº¦ï¼Œå¹¶å¯èƒ½å¸¦æ¥æ›´å¤šçš„é—®é¢˜ã€‚å¦‚æœåŒæ­¥æ–¹å¼èƒ½å¤Ÿè§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆå°±æ— éœ€ä½¿ç”¨å¼‚æ­¥ã€‚ 
å¼‚æ­¥å¤„ç†æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ã€‚åœ¨å¼‚æ­¥æ‰§è¡Œä¸­ï¼Œå¼€å‘è€…å¯èƒ½æ— æ³•æ¸…æ¥šåœ°çŸ¥é“ç¨‹åºæ‰§è¡Œåˆ°äº†å“ªä¸€æ­¥ã€‚ å¯¹äºå¤æ‚çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸€ä¸ªå°ä»»åŠ¡å®Œæˆæ—¶è®°å½•ä¸‹ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€æˆ–è¿›åº¦ï¼Œè¿™å°±åƒæˆ‘ä»¬ä¸‹è½½æ–‡ä»¶æ—¶çœ‹åˆ°çš„è¿›åº¦æ¡ä¸€æ ·ã€‚æ‰€ä»¥ï¼Œå¯¹äºå¤§å‹ã€å¤æ‚çš„ä»»åŠ¡ï¼Œä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬åº”è¯¥æä¾›è¿›åº¦æ¡ï¼Œè®©ç”¨æˆ·åœ¨æŸ¥è¯¢çŠ¶æ€æ—¶èƒ½çœ‹åˆ°ä»»åŠ¡æ‰§è¡Œåˆ°äº†å“ªä¸€æ­¥ã€‚è¿™æ˜¯ä»»ä½•å¼‚æ­¥æ“ä½œçš„é‡è¦ç¯èŠ‚ï¼Œä¹Ÿæ˜¯ä¼˜åŒ–ä¸šåŠ¡æµç¨‹çš„æ–¹æ³•ã€‚
##### æ€»ç»“ï¼š

1. å½“ç”¨æˆ·è¦è¿›è¡Œè€—æ—¶å¾ˆé•¿çš„æ“ä½œæ—¶ï¼Œç‚¹å‡»æäº¤åï¼Œä¸éœ€è¦åœ¨ç•Œé¢é•¿æ—¶é—´çš„ç­‰å¾…ï¼Œè€Œæ˜¯åº”è¯¥æŠŠè¿™ä¸ªä»»åŠ¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­è®°å½•ä¸‹æ¥
2. ç”¨æˆ·è¦æ‰§è¡Œæ–°ä»»åŠ¡æ—¶ï¼š 
   1. ä»»åŠ¡æäº¤æˆåŠŸï¼š 
      1. å¦‚æœæˆ‘ä»¬çš„ç¨‹åºè¿˜æœ‰å¤šä½™çš„ç©ºé—²çº¿ç¨‹ï¼Œå¯ä»¥ç«‹åˆ»å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚
      2. å¦‚æœæˆ‘ä»¬çš„ç¨‹åºçš„çº¿ç¨‹éƒ½åœ¨ç¹å¿™ï¼Œæ— æ³•ç»§ç»­å¤„ç†ï¼Œé‚£å°±æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—é‡Œã€‚
   2. ä»»åŠ¡æäº¤å¤±è´¥ï¼šæ¯”å¦‚æˆ‘ä»¬çš„ç¨‹åºæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ï¼Œ**ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†**ã€‚ 
      1. æ‹’ç»æ‰è¿™ä¸ªä»»åŠ¡ï¼Œå†ä¹Ÿä¸å»æ‰§è¡Œã€‚
      2. **é€šè¿‡ä¿å­˜åˆ°æ•°æ®åº“ä¸­çš„è®°å½•æ¥çœ‹åˆ°æäº¤å¤±è´¥çš„ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨ç¨‹åºç©ºé—²çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠä»»åŠ¡ä»æ•°æ®åº“ä¸­å›è°ƒåˆ°ç¨‹åºé‡Œï¼Œå†æ¬¡å»æ‰§è¡Œæ­¤ä»»åŠ¡**ã€‚
3. æˆ‘ä»¬çš„ç¨‹åºï¼ˆçº¿ç¨‹ï¼‰ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ä¾æ¬¡æ‰§è¡Œï¼Œæ¯å®Œæˆä¸€ä»¶äº‹æƒ…è¦ä¿®æ”¹ä¸€ä¸‹çš„ä»»åŠ¡çš„çŠ¶æ€ã€‚
4. ç”¨æˆ·å¯ä»¥æŸ¥è¯¢ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œæˆ–è€…åœ¨ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥æ—¶èƒ½å¾—åˆ°é€šçŸ¥ï¼ˆå‘é‚®ä»¶ã€ç³»ç»Ÿæ¶ˆæ¯æç¤ºã€çŸ­ä¿¡ï¼‰ï¼Œä»è€Œä¼˜åŒ–ä½“éªŒã€‚
5. å¦‚æœæˆ‘ä»¬è¦æ‰§è¡Œçš„ä»»åŠ¡éå¸¸å¤æ‚ï¼ŒåŒ…å«å¾ˆå¤šç¯èŠ‚ï¼Œåœ¨æ¯ä¸€ä¸ªå°ä»»åŠ¡å®Œæˆæ—¶ï¼Œè¦åœ¨ç¨‹åºï¼ˆæ•°æ®åº“ä¸­ï¼‰è®°å½•ä¸€ä¸‹ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆè¿›åº¦ï¼‰ã€‚
> ä½ ç›®å‰æ˜¯ä¸€ä¸ªå°ç»„çš„æŠ€æœ¯å¤§ç‰›ï¼Œå°å¼ŸAæ¥è¯·æ±‚ä½ å¸¦ä»–åšä¸€ä¸ªé¡¹ç›®ï¼Œäºæ­¤åŒæ—¶ï¼Œåˆæ¥äº†ä¸€ä¸ªå°å¼ŸBå«ä½ å»å¸®ä»–ä¿®æ”¹ä¸€ä¸‹bugã€‚
å› ä¸ºä½ å·²ç»ç­”åº”åˆ«äººå¸¦å°å¼ŸAå»åšé¡¹ç›®äº†ï¼Œæ‰€ä»¥è¯´ä¸èƒ½åŒæ—¶å¸®å°å¼ŸBå»çœ‹bugã€‚
> åªèƒ½å…ˆæŠŠå°å¼ŸBæ”¹bugè¿™ä¸ªä»»åŠ¡åœ¨å¤‡å¿˜å½•è®°å½•ä¸‹æ¥ï¼Œç­‰åé¢å¸¦å°å¼ŸAåšå®Œé¡¹ç›®åå†å»æŸ¥çœ‹å¤‡å¿˜å½•ï¼ˆå¤‡å¿˜å½•å¦‚æœæœ‰ä»»åŠ¡å°±å»æ‰§è¡Œå¤‡å¿˜å½•æœ€å…ˆè®°å½•çš„ä»»åŠ¡ï¼‰ï¼Œç„¶åå¸®å°å¼ŸBæ”¹bug
> å¤‡å¿˜å½• => ä»»åŠ¡é˜Ÿåˆ—ï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰

#### 2.2.2 æœ¬BIç³»ç»Ÿçš„ä¸šåŠ¡æµç¨‹ğŸŒŸğŸŒŸğŸŒŸ
##### ç³»ç»Ÿçš„ä¸šåŠ¡æµç¨‹è®²è§£
å›å½’åˆ°æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œæµç¨‹å…¶å®å¯ä»¥å¤§å¤§ç®€åŒ–ã€‚æ¯”å¦‚ï¼Œåœ¨åˆ›å»ºå›¾è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡æäº¤å¯ä»¥è§†ä¸ºä¸€ ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ç›´æ¥çœç•¥ä¸€ä¸ªæ–°çš„ä»»åŠ¡è®°å½•è¡¨ã€‚å…·ä½“æ¥è¯´ï¼Œå°†åˆ›å»ºå›¾è¡¨è¿™ä¸ªè¿‡ç¨‹è§†ä½œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ç›´æ¥åœ¨å›¾è¡¨çš„æ•°æ®åº“æˆ–æ•°æ®è¡¨ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µæ¥è¡¨ç¤ºå›¾è¡¨çš„ç”ŸæˆçŠ¶æ€æˆ–ä»»åŠ¡çŠ¶æ€ï¼Œè¿™æ ·å°±æ— éœ€å†å»ºç«‹æ–°çš„è¡¨äº†ã€‚
è¦æŸ¥è¯¢å›¾è¡¨æ˜¯å¦ç”Ÿæˆå®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸Šç»™å‡ºæç¤ºï¼Œæˆ–è€…å±•ç¤ºä¸€ä¸ªç­‰å¾…æ ‡å¿—ã€ç»™å‡ºå…¶ä»–å½¢å¼çš„åé¦ˆã€‚è¿™å°±é¿å…äº†æ–°å»ºä¸€ä¸ªä»»åŠ¡æŸ¥è¯¢é¡µé¢çš„éœ€è¦ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªç•Œé¢å®Œæˆä»»åŠ¡çŠ¶æ€çš„å±•ç¤ºã€‚

- é¦–å…ˆï¼Œç”¨æˆ·åœ¨ç‚¹å‡»æ™ºèƒ½åˆ†æé¡µçš„æäº¤æŒ‰é’®æ—¶ï¼Œç³»ç»Ÿä¼šç«‹å³å°†å›¾è¡¨ä¿å­˜åˆ°æ•°æ®åº“ä¸­ä½œä¸ºä¸€ä¸ªä»»åŠ¡ã€‚è¿™æ˜¯ç«‹å³ä¿å­˜çš„ï¼Œè€Œä¸æ˜¯ç­‰å¾… AI ç”Ÿæˆç»“æœåå†ä¿å­˜ã€‚è¿™æ ·å³ä½¿å›¾è¡¨ç”Ÿæˆå¤±è´¥ï¼Œç”¨æˆ·ä¹Ÿèƒ½æ˜äº†å…¶çŠ¶æ€ã€‚ 
- å…¶æ¬¡ï¼Œç”¨æˆ·å¯ä»¥åœ¨å›¾è¡¨ç®¡ç†é¡µé¢æŸ¥çœ‹æ‰€æœ‰å›¾è¡¨çš„ä¿¡æ¯å’ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬å·²ç”Ÿæˆçš„ã€æ­£åœ¨ç”Ÿæˆçš„å’Œ ç”Ÿæˆå¤±è´¥çš„ã€‚æ­¤å¤„ï¼Œå¦‚æœä½ æƒ³æ·»åŠ ä¸€äº›é€šçŸ¥åŠŸèƒ½ï¼Œæˆ–è€…å®šæ—¶æ›´æ–°åŠŸèƒ½ï¼Œå¦‚è®©è¿™ä¸ªé¡µé¢æ¯ä¸‰ç§’è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡æ•°æ®ï¼Œéƒ½æ˜¯å¯ä»¥çš„ã€‚ 
- æœ€åï¼Œç”¨æˆ·å¯ä»¥ä¿®æ”¹ç”Ÿæˆå¤±è´¥çš„å›¾è¡¨ä¿¡æ¯ï¼Œæˆ–è€…é€‰æ‹©é‡æ–°ç”Ÿæˆç­‰æ“ä½œã€‚è¿™ä¸ªåŠŸèƒ½ğŸŸä¸ä¸€å®šåœ¨è¿™ä¸ªç³»ç»Ÿä¸­å®ç°ï¼Œå®ƒç±»ä¼¼äºå¢åˆ æ”¹æŸ¥æ“ä½œä¸­çš„ä¿®æ”¹åŠŸèƒ½ï¼Œå¾ˆåƒé±¼èªæ˜çš„é‡æ–°ç”ŸæˆåŠŸèƒ½
##### æ€»ç»“ï¼š

1. ç”¨æˆ·ç‚¹å‡»æ™ºèƒ½åˆ†æé¡µé¢çš„æäº¤æŒ‰é’®æ—¶ï¼Œå…ˆæŠŠå›¾è¡¨ç«‹åˆ»ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼ˆä½œä¸ºä¸€ä¸ªä»»åŠ¡ï¼‰
2. ç”¨æˆ·å¯ä»¥åœ¨å›¾è¡¨ç®¡ç†ç•Œé¢æ’æŸ¥çœ‹æ‰€æœ‰çš„å›¾è¡¨çš„ä¿¡æ¯å’ŒçŠ¶æ€ 
   - å·²ç”Ÿæˆçš„
   - ç”Ÿæˆä¸­çš„
   - ç”Ÿæˆå¤±è´¥çš„
3. ç”¨æˆ·å¯ä»¥ä¿®æ”¹ç”Ÿæˆå¤±è´¥çš„å›¾è¡¨ä¿¡æ¯ï¼Œç‚¹å‡»é‡æ–°ç”Ÿæˆå›¾è¡¨
> æ­¤æ—¶å°±ä¼šç”¨åˆ°å¼‚æ­¥åŒ–æ¶ˆæ¯

å¼‚æ­¥åŒ–æµç¨‹å¦‚ä¸‹ï¼š![](https://cdn.nlark.com/yuque/0/2023/png/35417594/1686747303882-52af52b1-081b-4fa1-a3cd-9e1491fc7fcb.png#averageHue=%23fbfbfb&clientId=u928721fd-246e-4&from=paste&height=503&id=u1a9a07e3&originHeight=503&originWidth=876&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34855&status=done&style=none&taskId=u06cebe2a-c37f-4da1-9bcf-321132402df&title=&width=876#averageHue=%23fbfbfb&errorMessage=unknown%20error&id=xLmfz&originHeight=503&originWidth=876&originalType=binary&ratio=1&rotation=0&showTitle=false&status=error&style=none)
> ä½†æ˜¯ç°åœ¨ä¹Ÿä¼šå­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼š
> 1. ä»»åŠ¡é˜Ÿåˆ—çš„æœ€å¤§å®¹é‡åº”è¯¥è®¾ç½®å¤šå°‘åˆé€‚ï¼Ÿ
> 2. ç¨‹åºæ€ä¹ˆä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å»æ‰§è¡Œï¼Œè¿™ä¸ªä»»åŠ¡é˜Ÿåˆ—çš„æµç¨‹æ€ä¹ˆå®ç°çš„ï¼Œæ€ä¹ˆä¿è¯ç¨‹åºæœ€å¤šåŒæ—¶æ‰§è¡Œå¤šå°‘ä¸ªä»»åŠ¡ï¼Ÿ 
>    - é˜»å¡é˜Ÿåˆ—
>    - çº¿ç¨‹æ± 
>    - å¢åŠ æ›´å¤šçš„äººæ‰‹?

è™½ç„¶ç°åœ¨å¤§å®¶çœ‹å®Œäº†æ•´ä¸ªæµç¨‹ï¼Œä½†å¯¹äºä»æœªæ¥è§¦è¿‡å¼‚æ­¥åŒ–å¼€å‘çš„åŒå­¦ï¼Œå¯èƒ½ä¼šæœ‰ä¸¤ä¸ªç–‘é—®ã€‚é¦–å…ˆï¼Œä»»åŠ¡é˜Ÿåˆ—åº”è¯¥å¦‚ä½•è®¾ç½®æœ€å¤§å®¹é‡ï¼Œæ¯•ç«Ÿæˆ‘ä»¬çš„èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œä¸èƒ½æ— é™åˆ¶åœ°æ¥å—ä»»åŠ¡ã€‚å°±åƒæˆ‘ä»¬å…¬å¸æ¥å¤–éƒ¨å·¥ä½œä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰æ»¡è½½çš„ç“¶é¢ˆã€‚ 
å›å½’åˆ°æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•é™åˆ¶ä»»åŠ¡é˜Ÿåˆ—çš„æœ€å¤§å®¹é‡ï¼Ÿåº”è¯¥è®¾ç½®å¤šå°‘ä¸ªä»»åŠ¡ä¸ºæœ€å¤§å€¼ï¼Ÿ 
å¦ä¸€ä¸ªå…³é”®çš„å®ç°ç‚¹æ˜¯ï¼Œæˆ‘ä»¬çš„ç¨‹åºå¦‚ä½•ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­é€ä¸€å–å‡ºä»»åŠ¡è¿›è¡Œæ‰§è¡Œï¼Ÿæ›´è¿›ä¸€æ­¥çš„è¯ï¼Œ æˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°è¿™ä¸ªä»»åŠ¡é˜Ÿåˆ—çš„æµç¨‹ï¼Ÿè¿™ä¸¤ä¸ªé—®é¢˜å€¼å¾—æˆ‘ä»¬æ·±æ€ã€‚ 
é¦–å…ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•è®¾ç½®ä»»åŠ¡é˜Ÿåˆ—çš„æœ€å¤§å®¹é‡ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°ä¸€ä¸ªç¨‹åºï¼Œä½¿å…¶èƒ½è‡ªåŠ¨ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ‰§è¡Œï¼Œå¹¶ç¡®ä¿å®ƒåœ¨å–ä»»åŠ¡æ—¶ï¼Œæœ€å¤šåªèƒ½åŒæ—¶å–å‡ºå¤šå°‘ä¸ªä»»åŠ¡ï¼Œæœ€å¤šåªèƒ½æ‰§è¡Œå¤šå°‘ä¸ªä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ç”¨æˆ·æäº¤äº†å…«ä¸ªä»»åŠ¡ï¼Œä½†æˆ‘çš„ç¨‹åºæœ€å¤šåªèƒ½åŒæ—¶æ‰§è¡Œå››ä¸ªä»»åŠ¡ã€‚æˆ‘éœ€è¦ç­‰å¾…ç¬¬å››ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‰èƒ½å–å‡ºä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™åˆè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ
å®é™…ä¸Šï¼Œè¿™å¯èƒ½å¬èµ·æ¥æˆ–è€…è¯´è®©ä½ è‡ªå·±å®ç°èµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ç”¨åˆ°æ•°æ®ç»“æ„ä¸­çš„é˜Ÿåˆ—çŸ¥è¯†ï¼Œå¯èƒ½è¿˜è¦ç»“åˆä¸€äº›ç¼–ç¨‹æ€æƒ³å»å®ç°ã€‚æœ‰äº›äººå¯èƒ½ä¼šæå‡ºä½¿ç”¨é˜»å¡é˜Ÿåˆ—ï¼Œè¿™æ˜¯ä¸€ç§å®ç°æ–¹å¼ï¼Œ æˆ–è€…è¯´é€‚å½“å¢åŠ äººæ‰‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§å®ç°æ–¹å¼ã€‚ 
å¦ä¸€ç§å®ç°æ–¹å¼æ˜¯åˆ†é…å››ä¸ªçº¿ç¨‹ï¼Œç„¶åè¿™å››ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ä¹‹åï¼Œæ‰èƒ½å†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹éœ€è¦å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚ 
## 3ã€çº¿ç¨‹æ± 
### ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ?
#### çº¿ç¨‹æ± çš„è®²è§£
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®ç°çš„æµç¨‹å¿…é¡»æœ‰ä¸€ä¸ªå·¥ä½œè€…ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºçš„çº¿ç¨‹ï¼Œæ¯”å¦‚æˆ‘ä»¬ç§°ä¹‹ä¸ºçº¿ç¨‹å°æã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸­æœ‰å¾…å¤„ç†çš„ä»»åŠ¡ã€‚è®¾æƒ³ä¸€ä¸ªæƒ…æ™¯ï¼Œç”¨æˆ·æäº¤äº†ä¸€ä¸ªä»»åŠ¡ï¼Œæ¯”å¦‚æ™ºèƒ½åˆ†æï¼Œä»»åŠ¡1ä¾¿åŠ å…¥é˜Ÿåˆ—ã€‚çº¿ç¨‹å°æç°åœ¨å¯ä»¥ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡1è¿›è¡Œæ‰§è¡Œï¼Œ å…³æ³¨çš„å°±æ˜¯è¿™ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œæœ‰ä»»åŠ¡åˆ™å–å‡ºï¼Œä½†æ¯æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹çš„å·¥ä½œèƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œä¸å¯èƒ½åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚
é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåˆæ¥äº†ä¸€ä¸ªä»»åŠ¡2ï¼Œä½†çº¿ç¨‹å°ææ­£åœ¨å¤„ç†ä»»åŠ¡1ï¼Œæ²¡æœ‰åŠæ³•å¤„ç†ä»»åŠ¡2ã€‚æ­¤æ—¶ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è€ƒè™‘å†æ´¾ä¸€ä¸ªçº¿ç¨‹å°é±¼æ¥å¸®å¿™ï¼Ÿå‡å¦‚å†æœ‰ä»»åŠ¡3ï¼Œä½†æˆ‘ä»¬çš„å‘˜å·¥å·²ç»æ²¡æœ‰äº†ï¼Œåªæœ‰å°æå’Œå°é±¼ï¼Œæ­¤æ—¶åˆè¯¥æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠæ–°æ¥çš„ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…å°ææˆ–è€…å°é±¼å®Œæˆå½“å‰ä»»åŠ¡åï¼Œå†å»å–ä»»åŠ¡3ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723542023199-8c7a3202-4c29-49f0-a623-d7becb37ccdf.png#averageHue=%23f8f8f8&clientId=u6da9e890-ded5-4&from=paste&height=208&id=W49i2&originHeight=250&originWidth=491&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=21306&status=done&style=none&taskId=uffd18ab4-d057-4255-8c94-116f5baa2c9&title=&width=409.16665040784477)
ä½†æ˜¯ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—æ»¡äº†æ€ä¹ˆåŠï¼Ÿæ­¤æ—¶ï¼Œæˆ‘ä»¬å°±æ²¡åŠæ³•å†æ¥æ”¶æ–°ä»»åŠ¡äº†ã€‚è¿™æ—¶ï¼Œä¸ºäº†ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æŠŠæ–°ä»»åŠ¡è®°å½•åˆ°æ•°æ®åº“ä¸­ï¼Œä½†ä¸å†åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œç­‰æœ‰ç©ºé—²çš„çº¿ç¨‹æˆ–è€…æœ‰æ–°çš„çº¿ç¨‹åŠ å…¥æ—¶ï¼Œå†æŠŠè¿™äº›ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ã€‚
ç„¶è€Œï¼Œè¿™ä¸ªæ–¹æ¡ˆè¿˜ä¸å¤Ÿå®Œç¾ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸ä¸€å®šéè¦æ‹’ç»æ–°ä»»åŠ¡ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æœ‰å…¶ä»–ç­–ç•¥ï¼Œæ¯”å¦‚å†å¼€ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”šè‡³å†å¼€ä¸€ä¸ªå…¬å¸ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ï¼Œå½“å°ææ­£åœ¨å¤„ç†ä»»åŠ¡1 çš„æ—¶å€™ï¼Œä»»åŠ¡2 æ¥äº†ï¼Œæˆ‘ä»¬æ˜¯å¦æœ‰å¿…è¦ç«‹åˆ»è°ƒç”¨çº¿ç¨‹å°é±¼ï¼Ÿ
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723542129307-56477a1e-d71a-4e4d-9ba1-2884a52c87fd.png#averageHue=%23f7f7f7&clientId=u6da9e890-ded5-4&from=paste&height=132&id=L6jxd&originHeight=159&originWidth=458&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=13853&status=done&style=none&taskId=u560329c2-c1ce-4ff8-a093-44cf2a2ec67&title=&width=381.6666515005965)
ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å››ä¸ªä»»åŠ¡ï¼Œå¦‚æœå°æå¤„ç†ä»»åŠ¡çš„é€Ÿåº¦éå¸¸å¿«ï¼Œå¯èƒ½ä¸€ç§’é’Ÿå°±èƒ½å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œ è€Œå°é±¼å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦è¾ƒæ…¢ï¼Œéœ€è¦ä¸€ä¸ªå°æ—¶æ‰èƒ½å®Œæˆä¸€ä¸ªä»»åŠ¡ã€‚æˆ‘ä»¬æ˜¯ä¸æ˜¯å°±è®©å°æä¾æ¬¡æ‰§è¡Œè¿™å››ä¸ªä»»åŠ¡å°±å¯ä»¥äº†ã€‚å› æ­¤ï¼Œå¦‚ä½•åˆ†é…ä»»åŠ¡ï¼Œå¦‚ä½•åˆ†é…çº¿ç¨‹ï¼Œè¿™éƒ½éœ€è¦æˆ‘ä»¬åˆ¶å®šå‡ºé€‚åˆçš„ç­–ç•¥ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦çº¿ç¨‹æ± æ¥ç®¡ç†è¿™äº›çº¿ç¨‹ï¼Œä»»åŠ¡é˜Ÿåˆ—å°±åƒæ˜¯ä¸€ä¸ªå¤‡å¿˜å½•ï¼Œä»»åŠ¡å°±æ˜¯æˆ‘ä»¬éœ€è¦å®Œæˆçš„å·¥ä½œã€‚
ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹æ± ï¼Ÿå› ä¸ºçº¿ç¨‹ç®¡ç†æ¯”è¾ƒå¤æ‚ã€‚æ¯”å¦‚ï¼Œçªç„¶æ¥äº†å¾ˆå¤šä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸´æ—¶è°ƒç”¨æ›´å¤šçš„çº¿ç¨‹æ¥å¤„ç†ï¼Œä½†è¿™äº›ä»»åŠ¡å¯èƒ½åªæ˜¯æš‚æ—¶çš„ï¼Œæ­£å¸¸æƒ…å†µä¸‹å¯èƒ½æ¯å¤©åªæœ‰ä¸€ä¸ªä»»åŠ¡ã€‚å½“ä»»åŠ¡å¤„ç†å®Œæ¯•åï¼Œè¿™äº›ä¸´æ—¶çš„çº¿ç¨‹å°±æ²¡æœ‰å·¥ä½œå¯åšäº†ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬åº”è¯¥æŠŠä»–ä»¬çœ‹ä½œä¸´æ—¶å·¥ï¼Œå½“ä»»åŠ¡å¤„ç†å®Œæ¯•åï¼Œä»–ä»¬å°±å¯ä»¥ç¦»å¼€ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºï¼Œç­‰åˆ°ä¸‹ä¸€æ¬¡æœ‰å¤§é‡ä»»åŠ¡éœ€è¦å¤„ç†çš„æ—¶å€™ï¼Œå†ä¸´æ—¶æ‹›å‹Ÿä»–ä»¬ã€‚
> AI è¯´
> çº¿ç¨‹æ± æ˜¯ä¸€ç§å¹¶å‘ç¼–ç¨‹æŠ€æœ¯ï¼Œç”¨äº**ä¼˜åŒ–å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§**ã€‚å®ƒå¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ç»„å¯é‡ç”¨çš„çº¿ç¨‹ï¼Œå¹¶å°†å·¥ä½œä»»åŠ¡åˆ†é…ç»™è¿™äº›çº¿ç¨‹ï¼Œä»¥é¿å…é‡å¤åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„ååé‡ã€å“åº”æ—¶é—´å’Œèµ„æºåˆ©ç”¨ç‡ã€‚
> çº¿ç¨‹æ± é€šå¸¸ç”±ä¸¤ä¸ªä¸»è¦ç»„ä»¶ç»„æˆï¼šçº¿ç¨‹ç®¡ç†å™¨å’Œå·¥ä½œé˜Ÿåˆ—ã€‚çº¿ç¨‹ç®¡ç†å™¨ç”¨äºåˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œå¹¶ç»´æŠ¤çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹çš„æ•°é‡å’ŒçŠ¶æ€ã€‚å·¥ä½œé˜Ÿåˆ—ç”¨äºå­˜å‚¨å·¥ä½œä»»åŠ¡ï¼Œå¹¶æä¾›ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾—çº¿ç¨‹ç®¡ç†å™¨èƒ½å¤Ÿå°†å·¥ä½œä»»åŠ¡åˆ†é…ç»™ç©ºé—²çš„çº¿ç¨‹ã€‚å½“æ‰€æœ‰çš„çº¿ç¨‹éƒ½å¤„äºå¿™ç¢ŒçŠ¶æ€æ—¶ï¼Œæ–°çš„å·¥ä½œä»»åŠ¡å°†è¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œã€‚
> çº¿ç¨‹æ± çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š
> 1. å‡å°‘äº†çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€ï¼Œæé«˜äº†æ€§èƒ½å’Œæ•ˆç‡ã€‚
> 2. é¿å…äº†çº¿ç¨‹æ•°é‡è¿‡å¤šè€Œå¯¼è‡´çš„ç³»ç»Ÿèµ„æºè€—å°½å’Œçº¿ç¨‹è°ƒåº¦å¼€é”€å¢å¤§çš„é—®é¢˜ã€‚
> 3. å…è®¸è°ƒæ•´çº¿ç¨‹æ± å¤§å°ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚
> 4. å¯ä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ï¼Œé¿å…äº†çº¿ç¨‹ç›¸å…³çš„é”™è¯¯ï¼Œä½¿å¾—ä»£ç æ›´åŠ å¥å£®å’Œå¯é ã€‚
> 
æ€»ä¹‹ï¼Œçº¿ç¨‹æ± æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­éå¸¸é‡è¦çš„ä¸€ç§æŠ€æœ¯ï¼Œå¹¶ä¸”å·²ç»è¢«å¹¿æ³›åœ°åº”ç”¨äºå„ç§æœåŠ¡å™¨ã€æ¡†æ¶å’Œåº“ä¸­ã€‚å¯¹äºéœ€è¦é«˜æ€§èƒ½å’Œé«˜å¹¶å‘çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œçº¿ç¨‹æ± æ˜¯æé«˜ç¨‹åºæ€§èƒ½å’Œå¯é æ€§çš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚

> ä¸ºä»€ä¹ˆæ­¤é¡¹ç›®è¦å®éªŒçº¿ç¨‹æ± ï¼Ÿ

ç­”ï¼š

1. çº¿ç¨‹çš„ç®¡ç†æ¯”è¾ƒå¤æ‚ï¼ˆæ¯”å¦‚ï¼šä»€ä¹ˆæ—¶å€™æ–°å¢çº¿ç¨‹ã€ä»€ä¹ˆæ—¶å€™å‡å°‘ç©ºé—²çº¿ç¨‹ï¼‰
2. ä»»åŠ¡å­˜å–æ¯”è¾ƒå¤æ‚ï¼ˆä»€ä¹ˆæ—¶å€™æ¥å—ä»»åŠ¡ã€ä»€ä¹ˆæ—¶å€™æ‹’ç»ä»»åŠ¡ã€æ€ä¹ˆä¿è¯å¤§å®¶ä¸æŠ¢åˆ°åŒä¸€ä¸ªçº¿ç¨‹ï¼‰

**çº¿ç¨‹æ± çš„ä½œç”¨** ï¼šå¸®åŠ©ä½ è½»æ¾ç®¡ç†çº¿ç¨‹ã€åè°ƒä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹
> å°æå¤„ç†ä»»åŠ¡1
> å°é±¼å¤„ç†ä»»åŠ¡2
> ï¼ˆä¸ä¸€å®šè¦ä¸€ä¸ªäººå»å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªäººå¤„ç†å®Œæ‰€æœ‰çš„ä»»åŠ¡ï¼‰
> å½“æ¥äº†æ›´å¤šçš„ä»»åŠ¡æ—¶ï¼Œå°±å¿…é¡»è¦è¿›å…¥é˜»å¡é˜Ÿåˆ—
> å½“ä»»åŠ¡é˜Ÿåˆ—å æ»¡äº†ï¼Œå°±å¾—æ‹’ç»æ‰å…¶ä»–çš„ä»»åŠ¡

æ‰©å……ï¼šå¯ä»¥å‘çº¿ç¨‹æ± è¡¨è¾¾ä½ çš„éœ€æ±‚ï¼Œæ¯”å¦‚æœ€å¤šåªå…è®¸å››ä¸ªäººåŒæ—¶æ‰§è¡Œä»»åŠ¡ã€‚çº¿ç¨‹æ± å°±èƒ½è‡ªåŠ¨ä¸ºä½ è¿›è¡Œç®¡ç†ã€‚åœ¨ä»»åŠ¡ç´§æ€¥æ—¶ï¼Œå®ƒä¼šå¸®ä½ å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ã€‚è€Œåœ¨ä»»åŠ¡ä¸ç´§æ€¥æˆ–è€…è¿˜æœ‰çº¿ç¨‹ç©ºé—²æ—¶ï¼Œå®ƒä¼šç›´æ¥å°†ä»»åŠ¡äº¤ç»™ç©ºé—²çš„çº¿ç¨‹ï¼Œè€Œä¸æ˜¯æ”¾å…¥é˜Ÿåˆ—ã€‚
### 3.1 JUCçº¿ç¨‹æ± çš„å®ç°æ–¹å¼â­â­â­â­â­
åœ¨å¤§å‚é¢è¯•æ—¶ï¼Œæœ‰å¯èƒ½ä¼šè®©ä½ è‡ªè¡Œå®ç°çº¿ç¨‹æ± ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥å€ŸåŠ©ä¹‹å‰æåˆ°çš„å‡ ç§åœºæ™¯ï¼Œä¾‹å¦‚ä½•æ—¶å¢åŠ çº¿ç¨‹ï¼Œä½•æ—¶å‡å°‘çº¿ç¨‹ï¼Œæ¥é€æ­¥è§£ç­”è¿™ä¸ªé—®é¢˜ã€‚ å®é™…ä¸Šè¿™æ˜¯ä¸€é¡¹ç¹ççš„ä»»åŠ¡ã€‚æ¯”å¦‚ï¼Œæœ‰ä¸€ç§æƒ…å†µï¼Œå¦‚æœå¤§å®¶æ‰§è¡Œé€Ÿåº¦éƒ½å¾ˆå¿«ï¼Œå¯èƒ½ä¼šæŠ¢åˆ°åŒä¸€ä¸ªä»»åŠ¡ï¼Œå¦‚ä½•åè°ƒå„çº¿ç¨‹ä¸å»æŠ¢ç›¸åŒçš„ä»»åŠ¡å°±æˆäº†é—®é¢˜ï¼Œè¿™å°±æ¶‰åŠåˆ°çº¿ç¨‹çš„åè°ƒé—®é¢˜ã€‚ åœ¨ Linux ä¸­ï¼Œæœ‰ä¸€ç§ç§°ä¸ºä»»åŠ¡çªƒå–çš„æ¦‚å¿µã€‚æ¯”å¦‚ï¼Œå¦‚æœå°é±¼çš„å·¥ä½œæ•ˆç‡éå¸¸é«˜ï¼Œè€Œå°æçš„å·¥ä½œæ•ˆç‡è¾ƒä½ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŸæœ¬åˆ†é…ç»™å°æçš„ä»»åŠ¡ï¼Œè½¬äº¤ç»™å°é±¼å»åšã€‚è¿™å°±æ˜¯ä»»åŠ¡çªƒå–çš„æ¦‚å¿µã€‚è¿™ä¸ªé—®é¢˜éå¸¸å¤æ‚ï¼Œæ¶‰åŠåˆ°çš„å†…å®¹å¾ˆæ·±ã€‚ä»»åŠ¡æ˜¯å¦éœ€è¦é”ï¼Œå–å†³äºä½ ä½¿ç”¨çš„æ•°æ®ç»“æ„ç±»å‹ï¼Œä¾‹å¦‚ä½ æ˜¯å¦ä½¿ç”¨äº†é˜»å¡é˜Ÿåˆ—ç­‰æ¥å®ç°ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿™äº›ç­–ç•¥éƒ½ç›¸å½“å¤æ‚ã€‚

1. ä¸ç”¨è‡ªå·±å†™ï¼Œå¦‚æœæ˜¯åœ¨Springä¸­ï¼Œå¯ä»¥ç”¨`ThreadPoolTaskExecutor`é…åˆ`@Async`æ³¨è§£æ¥å®ç°ã€‚(ä¸å¤ªå»ºè®®ï¼šè¿›è¡Œäº†å°è£…)
2. å¦‚æœæ˜¯åœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨JUCå¹¶å‘ç¼–ç¨‹åŒ…ï¼Œä¸­çš„`ThreadPoolExecutor`æ¥å®ç°éå¸¸çµæ´»åœ°è‡ªå®šä¹‰çº¿ç¨‹æ± ã€‚
#### (1)åˆ›å»ºçº¿ç¨‹é…ç½®ç±»
å›åˆ°åç«¯ï¼Œåœ¨ configç›®å½• ä¸‹åˆ›å»º ThreadPoolExecutorConfig.java (çº¿ç¨‹æ± é…ç½®ç±»)ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723542627237-74d8ecbe-de3e-4e7a-97e2-34d8f3785b43.png#averageHue=%23272c33&clientId=u6da9e890-ded5-4&from=paste&height=947&id=uaa700bd8&originHeight=1137&originWidth=2599&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=249598&status=done&style=none&taskId=ub846a870-7045-4ca3-978e-8db42bfa800&title=&width=2165.8332472708526)
ps.æœ‰äº†è¿™ä¸ªé…ç½®ç±»ä¹‹åï¼Œå¯ä»¥åœ¨ application.yml å½“ä¸­ï¼Œå†™ä¸€ä¸‹çº¿ç¨‹æ± çš„é…ç½®ï¼Œæä¸€ä¸ªè‡ªåŠ¨æ³¨
å…¥ï¼Œå’Œä¹‹å‰å†™ redis é…ç½®ä¸€æ ·ï¼Œå°±ä¸åœ¨è¿™é‡Œå†™é…ç½®äº†ã€‚
ç›´æ¥åœ¨ ThreadPoolExecutorConfig.java å†™ä¸€ä¸ª Configurationç±» ã€‚
```java
package com.yupi.springbootinit.config;

import org.springframework.context.annotation.Configuration;

/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-13 17:49
 **/

@Configuration
public class ThreadPoolExecutorConfig {

}
```
ps.@Configuration æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªæ³¨è§£ï¼Œå®ƒç”¨äºç±»çº§åˆ«ï¼Œè¡¨æ˜è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®
ç±»ï¼Œå…¶ç›®çš„æ˜¯å…è®¸åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®šä¹‰é¢å¤–çš„ beanã€‚
ç”Ÿæˆä¸€ä¸ª ThreadPoolExecutorConfig çš„å®ä¾‹ã€‚
æŠŠå…‰æ ‡æ”¾åˆ°ä¸‹å›¾æ‰€åœ¨ä½ç½®ï¼Œç„¶åæŒ‰[Ctrl+P]æ˜¾ç¤ºå½“å‰æ–¹æ³•çš„å‚æ•°ï¼Œçœ‹ä¸€ä¸‹çº¿ç¨‹æ± çš„å‚æ•°ã€‚
æŒ‰ä¸‹å¿«æ·é”®åï¼Œæ˜¾ç¤ºä¸€ä¸ªæç¤ºæ¡†ï¼Œåˆ—å‡ºäº†æ­¤æ–¹æ³•éœ€è¦çš„æ‰€æœ‰å‚æ•°ç±»å‹å’Œåç§°ï¼› 
çº¿ç¨‹æ± çš„å‚æ•°æœ‰è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æ¥åˆ†åˆ«è§£é‡Šä¸€ä¸‹ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723547846971-2e03b3af-46db-437e-acca-5c7a51fa4a35.png#averageHue=%232a303b&clientId=u6da9e890-ded5-4&from=paste&height=1267&id=ua13a5733&originHeight=1521&originWidth=2401&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=379075&status=done&style=none&taskId=uac325c97-45f2-44ea-8f7d-e8aade7f9cb&title=&width=2000.833253827363)
JUCä¸­çš„çº¿ç¨‹æ± ï¼š
```java
public ThreadPoolExecutor(int corePoolSize,
                          int maximumPoolSize,
                          long keepAliveTime,
                          TimeUnit unit,
                          BlockingQueue<Runnable> workQueue,
                          ThreadFactory threadFactory,
                          RejectedExecutionHandler handler)
```
> æ€ä¹ˆç¡®å®šçº¿ç¨‹æ± å‚æ•°å‘¢ï¼Ÿç»“åˆå®é™…æƒ…å†µï¼ˆå®é™…ä¸šåŠ¡åœºæ™¯å’Œç³»ç»Ÿèµ„æºï¼‰æ¥æµ‹è¯•è°ƒæ•´ï¼Œä¸æ–­ä¼˜åŒ–ã€‚
> å›å½’åˆ°æœ¬BIç³»ç»Ÿçš„ä¸šåŠ¡ï¼Œè¦è€ƒè™‘ç³»ç»Ÿæœ€è„†å¼±çš„ç¯èŠ‚ï¼ˆç³»ç»Ÿçš„ç“¶é¢ˆï¼‰åœ¨å“ªé‡Œï¼Ÿ
> ç°æœ‰æ¡ä»¶ï¼šæ¯”å¦‚AIç”Ÿæˆèƒ½åŠ›çš„å¹¶å‘æ˜¯åªå…è®¸4ä¸ªä»»åŠ¡åŒæ—¶å»æ‰§è¡Œï¼ŒAIèƒ½åŠ›å…è®¸20ä¸ªä»»åŠ¡æ’é˜Ÿ

> ç»å…¸é¢è¯•é¢˜ï¼šè¯´è¯´çº¿ç¨‹æ± çš„å‚æ•°ï¼Ÿ


#### (2)AI èƒ½åŠ›çš„ç“¶é¢ˆ
æˆ‘ä»¬è¦åšçº¿ç¨‹æ± ï¼Œè‚¯å®šæ˜¯ä¸ºäº†è§£å†³é—®é¢˜ã€‚åœ¨åˆšåˆšæå‡ºçš„é—®é¢˜ä¸­ï¼Œä»»åŠ¡é˜Ÿåˆ—çš„æœ€å¤§å®¹é‡åº”è®¾ç½®ä¸ºå¤šå°‘ï¼Ÿæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å…è®¸æœ‰å¤šå°‘ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæˆ‘ä»¬çš„ BI ä»»åŠ¡ï¼Ÿè¿™ä¸ªé—®é¢˜å¦‚ä½•ç¡®å®šå‘¢ï¼Ÿæˆ‘ä»¬å¦‚ä½•ç¡®å®šçº¿ç¨‹æ± å‚æ•°ï¼Ÿæ˜¯å¦éœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯ï¼Ÿæœ‰ä½åŒå­¦ç»™å‡ºçš„ç­”æ¡ˆå¾ˆåˆ°ä½ï¼Œæ ¹æ®éœ€æ±‚è¿›è¡Œæµ‹è¯•ã€‚ çº¿ç¨‹æ± å‚æ•°åœ¨åˆæ¬¡è®¾å®šæ—¶å¹¶ä¸å¯èƒ½ä¸€æ¬¡å°±èƒ½ç™¾åˆ†ä¹‹ç™¾ç²¾å‡†ï¼Œè¦ç»“åˆ**å®é™…æµ‹è¯•æƒ…å†µï¼Œç³»ç»Ÿèµ„æºå’Œå®é™…ä¸šåŠ¡åœºæ™¯æ¥è°ƒæ•´ã€‚**
å‡è®¾å›åˆ°æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨çº¿ç¨‹ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿæ˜¯ä¸æ˜¯å› ä¸ºæˆ‘ä»¬çš„ AI æœåŠ¡å¤„ç†é€Ÿåº¦å¾ˆæ…¢ï¼ŒAI æœåŠ¡çš„å¤„ç†èƒ½åŠ›æœ‰é™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…åˆ AI æœåŠ¡ï¼Œé¿å… AI æœåŠ¡å™¨å´©æºƒã€‚å¦‚æœ AI æœåŠ¡çš„èƒ½åŠ›å¼ºå¤§ï¼Œæˆ‘ä»¬æ˜¯å¦å°±å¯ä»¥æé«˜å¹¶å‘åº¦ï¼Œè®©æ›´å¤šçš„çº¿ç¨‹åŒæ—¶å»ç”Ÿæˆ AIã€‚ä½†å¦‚æœ AI æœåŠ¡æ€§èƒ½è¾ƒå·®ï¼Œåªå…è®¸ä½ æ¯ä¸‰ç§’é’Ÿåªèƒ½è®¿é—®ä¸€æ¬¡ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶å·¥ä½œã€‚é‚£ä¹ˆçº¿ç¨‹æ± çš„å‚æ•°å°±éœ€è¦è°ƒå°ï¼Œåªèƒ½è®©ä¸€ä¸ªçº¿ç¨‹æŒ‰é¡ºåºæ‰§è¡Œä»»åŠ¡ã€‚
æˆ‘ä»¬éœ€è¦ç»“åˆå®é™…åœºæ™¯ï¼Œè€ƒè™‘ç³»ç»Ÿæœ€è„†å¼±çš„ç¯èŠ‚ï¼Œæˆ–è€…æ‰¾å‡ºç³»ç»Ÿçš„ç“¶é¢ˆåœ¨å“ªé‡Œã€‚æ¯”å¦‚ AI ç”Ÿæˆèƒ½ åŠ›çš„å¹¶å‘æ˜¯ä¸€ç§’ä¸¤æ¬¡ï¼Œæˆ–è€…å¹¶å‘ä»…å…è®¸å››ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸èƒ½åŒæ—¶ç”Ÿæˆäº”ä¸ªä»»åŠ¡ï¼Œéœ€è¦ç­‰å¾…å‰å››ä¸ªä»»åŠ¡å®Œæˆåæ‰èƒ½è¿›è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬çº¿ç¨‹æ± ä¸­çš„å·¥ä½œè€…æ•°é‡æœ€å¤šåªéœ€è¦å››ä¸ªã€‚å¦‚æœ AI æœåŠ¡å…è®¸ 20 ä¸ªçº¿ç¨‹æˆ– 20 ä¸ªä»»åŠ¡æ’é˜Ÿï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„é˜Ÿåˆ—é•¿åº¦æ˜¯ä¸æ˜¯ä¹Ÿæœ‰äº†ã€‚
å‡è®¾æœ€å¤šå…è®¸å››ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œæœ€å¤šå…è®¸20ä¸ªä»»åŠ¡æ’é˜Ÿã€‚æˆ‘ä»¬çš„ç³»ç»ŸåŒæ—¶å‘ AI æäº¤äº†å…«ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆæœ‰å››ä¸ªä»»åŠ¡ä¼šè¢«æ‰§è¡Œï¼Œå‰©ä¸‹çš„å››ä¸ªä»»åŠ¡å°±ä¼šè¿›å…¥é˜Ÿåˆ—ç­‰å¾…ã€‚å¦‚æœä½ åŒæ—¶æäº¤äº† 50 ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆæœ‰å››ä¸ªä»»åŠ¡ä¼šè¢«æ‰§è¡Œï¼Œ20 ä¸ªä»»åŠ¡æ’é˜Ÿï¼Œå‰©ä¸‹çš„ 26 ä¸ªä»»åŠ¡å°±ä¼šè¢«ä¸¢å¼ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„çº¿ç¨‹æ± å‚æ•°éœ€è¦æ ¹æ®è¿™äº›æ¡ä»¶æ¥è®¾å®šã€‚

#### (3)ThreadPoolExecutoræ„é€ æ–¹æ³•çš„å‚æ•°
```java
public ThreadPoolExecutor(int corePoolSize,
                          int maximumPoolSize,
                          long keepAliveTime,
                          TimeUnit unit,
                          BlockingQueue<Runnable> workQueue,
                          ThreadFactory threadFactory,
                          RejectedExecutionHandler handler)
```
å¦‚ä¸‹ï¼š

1.  `int corePoolSize`ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆæ­£å¼å‘˜å·¥äººæ•°ï¼‰æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥èƒ½åŒæ—¶å·¥ä½œçš„çº¿ç¨‹æ•°ï¼ˆéšæ—¶å°±ç»ªçš„çŠ¶æ€)ï¼Œçº¿ç¨‹æ± ä¸­ä¸€ç›´å­˜åœ¨çš„çº¿ç¨‹æ•°ï¼Œå³ä½¿çº¿ç¨‹é—²ç½®ã€‚ 
> è¿™äº›çº¿ç¨‹å°±å¥½æ¯”æ˜¯å…¬å¸çš„æ­£å¼å‘˜å·¥ï¼Œä»–ä»¬åœ¨æ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯éšæ—¶å¾…å‘½å¤„ç†ä»»åŠ¡çš„ã€‚å¦‚ä½•å»è®¾å®šè¿™ä¸ªå‚æ•°å‘¢ï¼Ÿæ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„ AI æœåŠ¡åªå…è®¸å››ä¸ªä»»åŠ¡åŒæ—¶è¿›è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ ¸å¿ƒçº¿ç¨‹æ•°åº”è¯¥å°±è¢«è®¾ç½®ä¸ºå››ã€‚

2.  `int maximumPoolSize`ï¼šï¼ˆæœ€å¤§çº¿ç¨‹æ•° => Â å“ªæ€•ä»»åŠ¡å†å¤šï¼Œä½ ä¹Ÿåªèƒ½æœ€å¤šæ‹›5ä¸ªäººï¼‰ï¼Œæé™æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„çº¿ç¨‹æ± æœ€å¤šæœ‰å¤šå°‘ä¸ªçº¿ç¨‹ï¼Ÿï¼Œçº¿ç¨‹æ± ä¸­å…è®¸å­˜åœ¨çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚ 
> åœ¨æé™æƒ…å†µä¸‹æˆ‘ä»¬çš„ç³»ç»Ÿæˆ–çº¿ç¨‹æ± èƒ½æœ‰å¤šå°‘ä¸ªçº¿ç¨‹åœ¨å·¥ä½œã€‚å°±ç®—ä»»åŠ¡å†å¤šï¼Œä½ æœ€å¤šä¹Ÿåªèƒ½é›‡ä½£è¿™ä¹ˆå¤šçš„äººï¼Œå› ä¸ºä½ éœ€è¦è€ƒè™‘æˆæœ¬å’Œèµ„æºçš„é—®é¢˜ã€‚å‡è®¾ AI æœåŠ¡æœ€å¤šåªå…è®¸å››ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œé‚£ä¹ˆæœ€å¤§çº¿ç¨‹æ•°åº”å½“è®¾ç½®ä¸ºå››ã€‚

3.  `long keepAliveTime`ï¼šï¼ˆç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼‰ï¼Œéæ ¸å¿ƒçº¿ç¨‹åœ¨æ²¡æœ‰ä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œè¿‡å¤šä¹…è¦åˆ é™¤ï¼ˆç†è§£ä¸ºå¼€é™¤ä¸´æ—¶å·¥ï¼‰ï¼Œä»è€Œé‡Šæ”¾æ— ç”¨çš„çº¿ç¨‹èµ„æºã€‚éæ ¸å¿ƒçº¿ç¨‹çš„ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚ 
> è¿™ä¸ªå‚æ•°å†³å®šäº†å½“ä»»åŠ¡å°‘çš„æ—¶å€™ï¼Œä¸´æ—¶é›‡ä½£çš„çº¿ç¨‹ä¼šç­‰å¾…å¤šä¹…æ‰ä¼šè¢«å‰”é™¤ã€‚è¿™ä¸ªå‚æ•°çš„è®¾å®šæ˜¯ä¸ºäº†é‡Šæ”¾æ— ç”¨çš„çº¿ç¨‹èµ„æºã€‚ä½ å¯ä»¥ç†è§£ä¸ºï¼Œå¤šä¹…ä¹‹åä¼šâ€œè§£é›‡â€æ²¡æœ‰ä»»åŠ¡åšçš„ä¸´æ—¶å·¥ã€‚

4.  `TimeUnit unit`ï¼šï¼ˆç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´çš„å•ä½ï¼‰å­˜æ´»æ—¶é—´çš„å•ä½ï¼Œå¯é€‰çš„å•ä½åŒ…æ‹¬ï¼š`TimeUnit.MILLISECONDSã€TimeUnit.SECONDSã€TimeUnit.MINUTESã€TimeUnit.HOURSã€TimeUnit.DAYS`ï¼ˆæ—¶åˆ†ç§’ï¼‰ç­‰ç­‰ã€‚ 
> å°† keepAliveTime å’Œ TimeUnit ç»„åˆåœ¨ä¸€èµ·ï¼Œå°±èƒ½æŒ‡å®šä¸€ä¸ªå…·ä½“çš„æ—¶é—´ï¼Œæ¯”å¦‚è¯´åˆ†é’Ÿã€ç§’ç­‰ç­‰ã€‚

5.  `BlockingQueue<Runnable> workQueue`ï¼šï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰ç”¨äºå­˜æ”¾ç»™çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—çš„é•¿åº¦ï¼ˆä¸€å®šè¦è®¾ç½®ï¼Œä¸è¦è¯´é˜Ÿåˆ—é•¿åº¦æ— é™ï¼Œå› ä¸ºä¹Ÿä¼šå ç”¨èµ„æº)ã€‚ 
> ç”¨äºå­˜æ”¾çº¿ç¨‹ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¾¾åˆ°äº†`corePoolSize`ï¼Œè€Œé˜»å¡é˜Ÿåˆ—ä¸­ä»»åŠ¡æ»¡äº†æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œç›´åˆ°è¾¾åˆ°`maximumPoolSize`ï¼Œæ­¤æ—¶è¾¾åˆ°çº¿ç¨‹æ± æœ€å¤§å®¹é‡ï¼Œè‹¥é˜»å¡é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œæ–°åŠ å…¥çš„ä»»åŠ¡å°†ä¼šè¢«æ‹’ç»ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®`RejectedExecutionHandler`å¤„ç†æ»¡äº†é˜»å¡é˜Ÿåˆ—å’Œé¥±å’Œçš„æƒ…å†µã€‚

6.  `ThreadFactory threadFactory`ï¼šï¼ˆçº¿ç¨‹å·¥å‚ï¼‰çº¿ç¨‹åˆ›å»ºå·¥å‚ï¼Œæ§åˆ¶æ¯ä¸ªçº¿ç¨‹çš„ç”Ÿæˆã€çº¿ç¨‹çš„å±æ€§ï¼ˆæ¯”å¦‚çº¿ç¨‹åï¼‰ï¼Œç”¨äºåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œå¯ä»¥è‡ªå®šä¹‰ThreadFactoryã€‚ 
> å®ƒè´Ÿè´£æ§åˆ¶æ¯ä¸ªçº¿ç¨‹çš„ç”Ÿæˆï¼Œå°±åƒä¸€ä¸ªç®¡ç†å‘˜ï¼Œè´Ÿè´£æ‹›è˜ã€ç®¡ç†å‘˜å·¥ï¼Œæ¯”å¦‚è®¾å®šå‘˜å·¥çš„åå­—ã€å·¥èµ„ï¼Œæˆ–è€…å…¶ä»–å±æ€§ã€‚ 

7.  `RejectedExecutionHandler handler`ï¼šï¼ˆæ‹’ç»ç­–ç•¥ï¼‰çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥ï¼Œä»»åŠ¡é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬é‡‡å–ä»€ä¹ˆæªæ–½ï¼Œæ¯”å¦‚æŠ›å¼‚å¸¸ã€ä¸æŠ›å¼‚å¸¸ã€è‡ªå®šä¹‰ç­–ç•¥ã€‚ 
> å½“ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå¤„ç†æ–°æ¥çš„ä»»åŠ¡ï¼Ÿæ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œè¿˜æ˜¯ä½¿ç”¨å…¶ä»–ç­–ç•¥ï¼Ÿæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®šä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œä¼šå‘˜çš„ä»»åŠ¡ä¼˜å…ˆçº§æ›´é«˜ã€‚å¦‚æœä½ çš„å…¬å¸æˆ–è€…äº§å“ä¸­æœ‰ä¼šå‘˜ä¸šåŠ¡ï¼Œæˆ–è€…æœ‰ä¸€äº›é‡è¦çš„ä¸šåŠ¡éœ€è¦ä¿è¯ä¸è¢«æ‰“æ‰°ï¼Œä½ å¯ä»¥è€ƒè™‘å®šä¹‰ä¸¤ä¸ªçº¿ç¨‹æ± æˆ–è€…ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸€ä¸ªç”¨äºå¤„ç†VIPä»»åŠ¡ï¼Œä¸€ä¸ªç”¨äºå¤„ç†æ™®é€šä»»åŠ¡ï¼Œä¿è¯ä»–ä»¬ä¸äº’ç›¸å¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯èµ„æºéš”ç¦»ç­–ç•¥ã€‚(å¯ä»¥å†™åˆ°ç®€å†ä¸Šçš„ç‚¹)
å½“ä»»åŠ¡æ— æ³•å¤„ç†æ—¶ï¼Œä¼šæ ¹æ®è®¾ç½®çš„æ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†ï¼Œå¯é€‰çš„ç­–ç•¥æœ‰ï¼šAbortPolicyï¼ˆç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢ç¨‹åºçš„æ‰§è¡Œï¼‰ã€CallerRunsPolicyï¼ˆè®©å½“å‰çš„çº¿ç¨‹æ¥å¤„ç†è¯¥ä»»åŠ¡ï¼‰ã€DiscardPolicyï¼ˆç›´æ¥ä¸¢å¼ƒè¯¥ä»»åŠ¡ï¼‰ï¼ŒDiscardOldestPolicyï¼ˆä¸¢å¼ƒé˜Ÿåˆ—ä¸­å·²ç»å­˜åœ¨æœ€ä¹…çš„ä»»åŠ¡ï¼Œå°†å½“å‰ä»»åŠ¡æ’å…¥é˜Ÿåˆ—å°è¯•æäº¤)ã€‚

> èµ„æºéš”ç¦»ç­–ç•¥ï¼šä¸åŒçš„ç¨‹åº¦çš„ä»»åŠ¡ï¼Œåˆ†ä¸ºä¸åŒçš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚VIPä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ™®é€šç”¨æˆ·ä¸€ä¸ªé˜Ÿåˆ—ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723549242914-5b38791a-8225-4228-b3e9-a76aec406147.png#averageHue=%23f4f2f0&clientId=u6da9e890-ded5-4&from=paste&height=267&id=u45456881&originHeight=320&originWidth=673&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=169933&status=done&style=none&taskId=u12ec37db-1e56-4af9-9954-73e158a4c8c&title=&width=560.8333110478198)
### 3.2 çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶
> å‡è®¾æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—ä¸ºä»¥ä¸‹çš„å€¼ï¼š
> corePoolSize = 2 ï¼›maximumPoolSize = 4 ï¼ŒworkQueue.size = 2

1ã€å¼€å§‹æ—¶ï¼šæ²¡æœ‰ä»»åŠ¡çš„çº¿ç¨‹ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•çš„ä»»åŠ¡ã€‚
> åˆšå¼€å§‹çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ†åˆ«å­˜åœ¨çš„æ•°é‡ä¸ºï¼š
> corePoolSize = 0 ï¼›maximumPoolSize = 0 ï¼ŒworkQueue.size = 0

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723549466743-5061bae9-847f-4dcd-9bf2-028537f42cb5.png#averageHue=%23fefefe&clientId=u6da9e890-ded5-4&from=paste&height=193&id=u766bdb83&originHeight=232&originWidth=496&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=7611&status=done&style=none&taskId=u2ea2066d-4e93-4844-8bbb-179695af4c9&title=&width=413.333316908943)
2ã€æ¥äº†ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå‘ç°æˆ‘ä»¬çš„å‘˜å·¥æ²¡æœ‰åˆ°è¾¾æ­£å¼çš„å‘˜å·¥äººæ•°(æ ¸å¿ƒçº¿ç¨‹æ•°)ï¼Œæ¥äº†ä¸€ä¸ªå‘˜å·¥ç›´æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚
> 2ã€ç¬¬ä¸€ä¸ªä»»åŠ¡åˆ°æ¥æ—¶çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ†åˆ«å­˜åœ¨çš„æ•°é‡ä¸ºï¼š
> corePoolSize = 1 ï¼›maximumPoolSize = 1 ï¼ŒworkQueue.size = 0

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723549506850-284eb661-0cb8-4b3c-90e2-c14d20f9fdee.png#averageHue=%23fefefe&clientId=u6da9e890-ded5-4&from=paste&height=237&id=u656c366c&originHeight=285&originWidth=511&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=17944&status=done&style=none&taskId=u3c3447ef-c23d-4a93-99db-a895e21ea24&title=&width=425.83331641223765)
3ã€åˆæ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œå‘ç°æˆ‘ä»¬çš„å‘˜å·¥è¿˜æ²¡æœ‰è¾¾åˆ°æ­£å¼å‘˜å·¥æ•°ï¼Œå†æ¥ä¸€ä¸ªå‘˜å·¥ç›´æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚
> 3ã€ç¬¬äºŒä¸ªä»»åŠ¡åˆ°æ¥æ—¶çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ†åˆ«å­˜åœ¨çš„æ•°é‡ä¸ºï¼š
> corePoolSize = 2 ï¼›maximumPoolSize = 2 ï¼ŒworkQueue.size = 0
> ï¼ˆä¸€ä¸ªäººå¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œä¸€çº¿ç¨‹ä¸€ä»»åŠ¡ï¼‰

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723549553389-5fb47b69-032c-4e0f-9954-f43293e9cef6.png#averageHue=%23fdfdfd&clientId=u6da9e890-ded5-4&from=paste&height=240&id=u3138e3cc&originHeight=288&originWidth=519&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=27040&status=done&style=none&taskId=uc4bee5d2-f6a8-4df7-991c-d8d947856e7&title=&width=432.4999828139948)
4ã€åˆæ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬æ­£å¼å‘˜å·¥æ•°å·²ç»æ»¡äº†ï¼ˆå½“å‰çº¿ç¨‹æ•° = corePoolSize = 2)ï¼Œå°†æœ€æ–°æ¥çš„ä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼ˆæœ€å¤§é•¿åº¦ `workQueue.size` æ˜¯ 2) é‡Œç­‰å¾…ï¼Œè€Œä¸æ˜¯å†åŠ æ–°å‘˜å·¥ã€‚
> 4ã€ç¬¬ä¸‰ã€å››ä¸ªä»»åŠ¡åˆ°æ¥æ—¶çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ†åˆ«å­˜åœ¨çš„æ•°é‡ä¸ºï¼š
> corePoolSize = 2 ï¼›maximumPoolSize = 2 ï¼ŒworkQueue.size = 2
> ï¼ˆä¸€ä¸ªäººå¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œä¸€çº¿ç¨‹ä¸€ä»»åŠ¡ï¼‰

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723549576022-60274572-1b3d-40fd-bbea-c8515321efb4.png#averageHue=%23fdfdfd&clientId=u6da9e890-ded5-4&from=paste&height=230&id=u15601f96&originHeight=276&originWidth=569&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=30365&status=done&style=none&taskId=u3fa872c2-5cad-46f3-a6e5-9169ccfbf88&title=&width=474.1666478249769)
5ã€åˆæ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ä»»åŠ¡é˜Ÿåˆ—å·²ç»æ»¡äº†ï¼ˆå½“å‰çº¿ç¨‹æ•° å¤§äºäº† corePoolSize=2ï¼Œå·±æœ‰ä»»åŠ¡æ•° = æœ€å¤§é•¿åº¦ `workQueue.size` = 2)ï¼Œæ–°å¢çº¿ç¨‹(`maximumPoolSize` = 4)æ¥å¤„ç†ä»»åŠ¡ï¼Œè€Œä¸æ˜¯ä¸¢å¼ƒä»»åŠ¡ã€‚
> 5ã€ç¬¬äº”ä¸ªä»»åŠ¡åˆ°æ¥æ—¶çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ†åˆ«å­˜åœ¨çš„æ•°é‡ä¸ºï¼š
> corePoolSize = 2 ï¼›maximumPoolSize = 3 ï¼ŒworkQueue.size = 2
> ï¼ˆæ‰¾äº†ä¸€ä¸ªä¸´æ—¶å·¥å¤„ç†è¿™ä¸ªé˜Ÿæ–°æ¥çš„è¿™ä¸ªä»»åŠ¡ï¼‰

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723549594289-1a06c628-543e-4934-9e33-f70fbd2e267a.png#averageHue=%23fdfdfd&clientId=u6da9e890-ded5-4&from=paste&height=259&id=u7cda6bb3&originHeight=311&originWidth=567&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=36607&status=done&style=none&taskId=u8d13f8ef-61c4-4faa-bfd0-089486cc05f&title=&width=472.49998122453763)
6ã€å½“åˆ°äº†ä»»åŠ¡7ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ä»»åŠ¡é˜Ÿåˆ—å·²ç»æ»¡äº†ã€ä¸´æ—¶å·¥ä¹Ÿæ‹›æ»¡äº†ï¼ˆå½“å‰çº¿ç¨‹æ•° = `maximumPoolSize` = 4ï¼Œå·²æœ‰ä»»åŠ¡æ•° = æœ€å¤§é•¿åº¦ `workQueue.size` = 2) è°ƒç”¨`RejectedExecutionHandler` æ‹’ç»ç­–ç•¥æ¥å¤„ç†å¤šä½™çš„ä»»åŠ¡ã€‚
> 6ã€ï¼ˆæ²¡æœ‰ç”»å›¾äº†ï¼Œå› ä¸ºå’Œç¬¬äº”æ­¥çš„ä¸€æ ·ï¼‰ç­‰åˆ°ç¬¬å…­ä¸ªä»»åŠ¡åˆ°æ¥æ—¶çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ†åˆ«å­˜åœ¨çš„æ•°é‡ä¸ºï¼š
> corePoolSize = 2 ï¼›maximumPoolSize = 4 ï¼ŒworkQueue.size = 2
> ï¼ˆå†æ‰¾äº†ä¸€ä¸ªä¸´æ—¶å·¥å¤„ç†è¿™ä¸ªé˜Ÿåˆ—ä»»åŠ¡ä¸­æœ€å‰é¢çš„ä»»åŠ¡4ï¼Œç„¶åè¿™ä¸ªç¬¬å…­ä¸ªæ–°æ¥çš„çº¿ç¨‹å°±è¿›å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼‰
> 7ã€ç­‰åˆ°ç¬¬ä¸ƒä¸ªä»»åŠ¡åˆ°æ¥æ—¶çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ†åˆ«å­˜åœ¨çš„æ•°é‡ä¸ºï¼š
> corePoolSize = 2 ï¼›maximumPoolSize = 4 ï¼ŒworkQueue.size = 2
> ï¼ˆæ­¤æ—¶åœ¨æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ä»¥åŠä»»åŠ¡é˜Ÿåˆ—ä¸­éƒ½å æ»¡äº†ï¼Œä»¥åŠæ— æ³•æ¥æ”¶æ–°çš„ä»»åŠ¡äº†ï¼Œæ‰€ä»¥è¯´åªèƒ½æ‹’ç»ä»»åŠ¡7ï¼‰

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723549673194-eac37f99-e7a4-48af-b815-d684fca710d7.png#averageHue=%23fdfdfd&clientId=u6da9e890-ded5-4&from=paste&height=272&id=uecf5043d&originHeight=326&originWidth=509&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=47121&status=done&style=none&taskId=u4c9d97f3-98e2-4ebe-aab6-b15ce54fa42&title=&width=424.1666498117983)
7ã€æœ€åï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ•°è¶…è¿‡ corePoolSize (æ­£å¼å‘˜å·¥æ•°)ï¼Œåˆæ²¡æœ‰æ–°çš„ä»»åŠ¡ç»™ä»–ï¼Œé‚£ä¹ˆç­‰ keepAliveTime æ—¶é—´è¾¾åˆ°åï¼Œå°±å¯ä»¥æŠŠè¿™ä¸ªçº¿ç¨‹é‡Šæ”¾ã€‚
### 3.3 çº¿ç¨‹æ± çš„å‚æ•°å¦‚ä½•è®¾ç½®ï¼ˆç»å…¸é¢è¯•é¢˜â­â­â­â­â­ï¼‰
#### (1)è®¾ç½®çº¿ç¨‹æ± å‚æ•°ï¼ˆç»“åˆå®é™…åœºæ™¯è®¾ç½®ï¼‰
> ç°æœ‰æ¡ä»¶ï¼šæ¯”å¦‚AIç”Ÿæˆèƒ½åŠ›çš„å¹¶å‘æ•°æ˜¯åªå…è®¸4ä¸ªä»»åŠ¡åŒæ—¶å»æ‰§è¡Œï¼ŒAIèƒ½åŠ›å…è®¸20ä¸ªä»»åŠ¡æ’é˜Ÿã€‚
> é‚£ä¹ˆåœ¨æœ¬é¡¹ç›®ä¸­å‚æ•°çš„è®¾ç½®å¦‚ä¸‹ï¼š

1. `corePoolSize`(æ ¸å¿ƒçº¿ç¨‹æ•°=>æ­£å¼å‘˜å·¥æ•°)ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¯ä»¥è®¾ç½®ä¸º 2 - 4
2. `maximumPoolSize`(æœ€å¤§çº¿ç¨‹æ•°)ï¼šè®¾ç½®ä¸ºæé™æƒ…å†µï¼Œè®¾ç½®ä¸º <= 4
3. `keepAliveTime`(ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´)ï¼šä¸€èˆ¬è®¾ç½®ä¸ºç§’çº§æˆ–è€…åˆ†é’Ÿçº§
4. `TimeUnit unit`(ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´çš„å•ä½)ï¼šåˆ†é’Ÿã€ç§’
5. `workQueue`(å·¥ä½œé˜Ÿåˆ—)ï¼šç»“åˆå®é™…è¯·å†µå»è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®ä¸º20 ï¼ˆ2n+1ï¼‰
6. `threadFactory`(çº¿ç¨‹å·¥å‚)ï¼šæ§åˆ¶æ¯ä¸ªçº¿ç¨‹çš„ç”Ÿæˆã€çº¿ç¨‹çš„å±æ€§ï¼ˆæ¯”å¦‚çº¿ç¨‹åï¼‰
7. `RejectedExecutionHandler`(æ‹’ç»ç­–ç•¥)ï¼šæŠ›å¼‚å¸¸ï¼Œæ ‡è®°æ•°æ®åº“çš„ä»»åŠ¡çŠ¶æ€ä¸º "ä»»åŠ¡æ»¡äº†å·²æ‹’ç»"
#### (2)**çº¿ç¨‹æ± çš„è®¾è®¡ä¸»è¦åˆ†ä¸º IO å¯†é›†å‹å’Œè®¡ç®—å¯†é›†å‹**
åœ¨é¢è¯•ä¸­ï¼Œå¦‚æœé¢è¯•å®˜é—®ä½ å…³äºçº¿ç¨‹æ± çš„è®¾ç½®ï¼Œé¦–å…ˆä½ éœ€è¦æ˜ç¡®ï¼Œè®¾ç½®çš„ä¾æ®åº”è¯¥æ˜¯å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»åŠ¡åˆ†ä¸º IO å¯†é›†å‹å’Œ CPU å¯†é›†å‹ï¼Œä¹Ÿç§°ä¸ºè®¡ç®—å¯†é›†å‹ã€‚ å¯¹äºè®¡ç®—å¯†é›†å‹çš„ä»»åŠ¡ï¼Œå®ƒä¼šå¤§é‡æ¶ˆè€— CPU èµ„æºè¿›è¡Œè®¡ç®—ï¼Œä¾‹å¦‚éŸ³è§†é¢‘å¤„ç†ã€å›¾åƒå¤„ç†ã€ ç¨‹åºè®¡ç®—å’Œæ•°å­¦è®¡ç®—ç­‰ã€‚è¦æœ€å¤§ç¨‹åº¦ä¸Šåˆ©ç”¨ CPUï¼Œé¿å…å¤šä¸ªçº¿ç¨‹é—´çš„å†²çªï¼Œä¸€èˆ¬å°†æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®ä¸º CPU çš„æ ¸æ•°åŠ ä¸€ã€‚è¿™ä¸ªâ€œåŠ ä¸€â€å¯ä»¥ç†è§£ä¸ºé¢„ç•™ä¸€ä¸ªé¢å¤–çš„çº¿ç¨‹ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå¤‡ç”¨çº¿ç¨‹ï¼Œæ¥å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚è¿™æ ·åšå¯ä»¥å……åˆ†åˆ©ç”¨æ¯ä¸ª CPU æ ¸å¿ƒï¼Œå‡å°‘çº¿ç¨‹é—´çš„é¢‘ç¹åˆ‡æ¢ï¼Œ é™ä½å¼€é”€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹ maximumPoolSize çš„è®¾å®šæ²¡æœ‰ä¸¥æ ¼çš„è§„åˆ™ï¼Œä¸€èˆ¬å¯ä»¥è®¾ä¸ºæ ¸å¿ƒçº¿ç¨‹æ•°çš„ä¸¤å€æˆ–ä¸‰å€ã€‚
è€Œå¯¹äº IO å¯†é›†å‹çš„ä»»åŠ¡ï¼Œå®ƒä¸»è¦æ¶ˆè€—çš„æ˜¯å¸¦å®½æˆ–å†…å­˜ç¡¬ç›˜çš„è¯»å†™èµ„æºï¼Œå¯¹ CPU çš„åˆ©ç”¨ç‡ä¸é«˜ã€‚æ¯”å¦‚è¯´ï¼ŒæŸ¥è¯¢æ•°æ®åº“æˆ–ç­‰å¾…ç½‘ç»œæ¶ˆæ¯ä¼ è¾“ï¼Œå¯èƒ½éœ€è¦èŠ±è´¹å‡ ç§’é’Ÿï¼Œè€Œåœ¨è¿™æœŸé—´ CPU å®é™…ä¸Šæ˜¯ç©ºé—²çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‚å½“å¢å¤§ corePoolSize çš„å€¼ï¼Œå› ä¸º CPU æœ¬æ¥å°±æ˜¯ç©ºé—²çš„ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœæ•°æ®åº“èƒ½åŒæ—¶æ”¯æŒ 20 ä¸ªçº¿ç¨‹æŸ¥è¯¢ï¼Œé‚£ä¹ˆ corePoolSize å°±å¯ä»¥è®¾ç½®å¾—ç›¸å¯¹è¾ƒå¤§ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚è™½ç„¶æœ‰ä¸€äº›ç»éªŒå€¼ï¼Œæ¯”å¦‚ 2N+1ï¼Œä¸å¤ªæ¨å´‡è¿™ç§ç»éªŒå€¼ï¼Œå»ºè®®æ ¹æ® IO çš„èƒ½åŠ›æ¥è®¾å®šã€‚
æ€»ç»“ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»»åŠ¡åˆ†ä¸ºIOå¯†é›†å‹å’Œè®¡ç®—å¯†é›†å‹ä¸¤ç§ã€‚

1. è®¡ç®—å¯†é›†å‹ï¼šåƒCPUï¼Œæ¯”å¦‚éŸ³è§†é¢‘å¤„ç†ã€å›¾åƒå¤„ç†ã€æ•°å­¦è®¡ç®—ç­‰ï¼Œä¸€èˆ¬æ˜¯è®¾ç½®corePoolSizeä¸ºCPUçš„æ ¸æ•° +1 (ç©ºä½™çº¿ç¨‹)ï¼Œå¯ä»¥è®©æ¯ä¸ªçº¿ç¨‹éƒ½åˆ©ç”¨å¥½CPUçš„æ¯ä¸ªæ ¸ï¼Œè€Œä¸”çº¿ç¨‹ä¹‹é—´ä¸ç”¨é¢‘ç¹åˆ‡æ¢ï¼ˆå‡å°‘æ‰“æ¶ã€å‡å°‘å¼€é”€ï¼‰
2. IOå¯†é›†å‹ï¼šåƒå¸¦å®½/å†…å­˜/ç¡¬ç›˜çš„è¯»å†™èµ„æºï¼ŒcorePoolSizeå¯ä»¥è®¾ç½®å¤§ä¸€ç‚¹ï¼Œä¸€èˆ¬ç»éªŒå€¼æ˜¯ 2n å·¦å³ï¼Œä½†æ˜¯å»ºè®®ä»¥ IO çš„èƒ½åŠ›ä¸ºä¸»ã€‚
#### (3)è€ƒè™‘å¯¼å…¥ç™¾ä¸‡æ•°æ®åˆ°æ•°æ®åº“
> è€ƒè™‘å¯¼å…¥ç™¾ä¸‡æ•°æ®åˆ°æ•°æ®åº“ï¼Œå±äºIOå¯†é›†å‹ä»»åŠ¡ã€è¿˜æ˜¯è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Ÿ
> ç­”ï¼šåªéœ€è¦è€ƒè™‘è¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ¶ˆè€—å“ªç§èµ„æºã€‚è€ƒè™‘å¯¼å…¥ç™¾ä¸‡æ•°æ®åˆ°æ•°æ®åº“æ˜¯ä¸€ä¸ªIOå¯†é›†å‹ä»»åŠ¡ã€‚å¯¼å…¥æ•°æ®éœ€è¦ä»å¤–éƒ¨è¯»å–å¤§é‡æ•°æ®ï¼Œç„¶åå°†å…¶å†™å…¥æ•°æ®åº“ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­è®¡ç®—çš„å·¥ä½œé‡ä¸æ˜¯å¾ˆé«˜ï¼Œç›¸å¯¹æ¥è¯´éœ€è¦æ›´å¤šçš„ç£ç›˜IOå’Œç½‘ç»œIOã€‚å› æ­¤ï¼Œè¿™ä¸ªä»»åŠ¡çš„æ€§èƒ½ç“¶é¢ˆé€šå¸¸æ˜¯åœ¨IOæ“ä½œä¸Šï¼Œè€Œéè®¡ç®—ä¸Šã€‚æ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ˜¯ IO å¯†é›†å‹çš„ã€‚


### 3.4 çº¿ç¨‹æ± å®ç°å¼€å‘
è‡ªå®šä¹‰çº¿ç¨‹æ± 
å›åˆ°åç«¯ï¼Œç»§ç»­å»è®¾ç½®çº¿ç¨‹æ± çš„å‚æ•°ï¼š 

- corePoolSize (æ ¸å¿ƒçº¿ç¨‹æ•°) ä¸º 2 â€” 2 ä¸ªæ­£å¼å‘˜å·¥ï¼› 
- maximumPoolSize (æœ€å¤§çº¿ç¨‹æ•°) ä¸º 4 â€” æœ€å¤šå…è®¸ 4 ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼› 
- keepAliveTime (ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´) ä¸º 100 â€” å¤šä½™çš„ä¸´æ—¶å·¥ä¼šç­‰å¾… 100 åï¼Œè¢«å¼€é™¤ï¼› 
- TimeUnit (ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´çš„å•ä½) ä¸º TimeUnit.SECONDS â€” ä¸ keepAliveTime ç»„åˆä½¿ç”¨ï¼ŒæŒ‡å¤šä½™ä¸´æ—¶å·¥ä¼šç­‰å¾… 100 **ç§’**åï¼Œè¢«å¼€é™¤ï¼› 
- workQueue (å·¥ä½œé˜Ÿåˆ—) ä¸º new ArrayBlockingQueue<>(10000) â€” ä½¿ç”¨æ•°ç»„é˜»å¡é˜Ÿåˆ—ï¼Œ å¹¶æŒ‡å®šé•¿åº¦ä¸º 4ï¼Œæœ€å¤šç­‰å¾… 4 ä¸ªä»»åŠ¡ï¼› 
- threadFactory (çº¿ç¨‹å·¥å‚) åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„çº¿ç¨‹å·¥å‚ï¼› 
- RejectedExecutionHandler (æ‹’ç»ç­–ç•¥) ä¸å†™ï¼Œé»˜è®¤æ‹’ç»ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723552343617-57f75bf0-99b6-408f-a41d-b4a675a731d5.png#averageHue=%23282d37&clientId=u6da9e890-ded5-4&from=paste&height=1226&id=ua94a0d9c&originHeight=1471&originWidth=2766&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=438375&status=done&style=none&taskId=u761b3819-3923-4b57-907a-99d7beb58e3&title=&width=2304.999908407533)
```java
package com.yupi.springbootinit.config;

import org.jetbrains.annotations.NotNull;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.concurrent.ArrayBlockingQueue;
import java.util.concurrent.ThreadFactory;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;

/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-13 17:49
 **/

@Configuration
public class ThreadPoolExecutorConfig {
    @Bean
    public ThreadPoolExecutor threadPoolExecutor() {
        ThreadFactory threadFactory = new ThreadFactory() {
            private int count = 1;
            @Override
            public Thread newThread(@NotNull Runnable r) {
                //ä¸€å®šè¦å°†è¿™ä¸ª r æ”¾å…¥åˆ°çº¿ç¨‹å½“ä¸­
                Thread thread = new Thread(r);
                thread.setName("çº¿ç¨‹:" + count);
                // ä»»åŠ¡++
                count ++;
                return thread;
            }
        };
        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(2, 4 ,100, TimeUnit.SECONDS,new ArrayBlockingQueue<>(100), threadFactory);
        return threadPoolExecutor;
    }
}
```
ä¸ºäº†æ–¹ä¾¿æµ‹è¯•æ•ˆæœï¼Œæ–°å»ºä¸€ä¸ª controller (æ§åˆ¶å™¨)ï¼Œä»¥æ¥å£çš„æ–¹å¼å®æ—¶æ§åˆ¶è¿™ä¸ªçº¿ç¨‹æ± ï¼ŒæŸ¥çœ‹ 
çº¿ç¨‹æ± çš„å‚æ•°ï¼› 
å¤åˆ¶ controllerç›®å½• ä¸‹çš„ ChartController ï¼Œå¹¶é‡å‘½åä¸º QueueController ï¼Œä¿®æ”¹ä¸€ 
ä¸‹ï¼Œåˆ é™¤å¤šä½™çš„å†…å®¹ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723552375824-ef375017-b917-4360-8012-99e08cdbea55.png#averageHue=%23282d36&clientId=u6da9e890-ded5-4&from=paste&height=1280&id=u80369f8c&originHeight=1536&originWidth=2761&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=490185&status=done&style=none&taskId=u5a6ade06-99d8-42e5-87d1-da57f13e98a&title=&width=2300.8332419064345)
```java
package com.yupi.springbootinit.controller;

import cn.hutool.json.JSONUtil;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Profile;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.Resource;
import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ThreadPoolExecutor;

/**
 * é˜Ÿåˆ—æµ‹è¯•
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-13 20:25
 **/
@RestController
@RequestMapping("/queue")
@Slf4j
@Profile({ "dev", "local" })
public class QueueController {

    @Resource
    private ThreadPoolExecutor threadPoolExecutor;

    // æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± 
    @GetMapping("/add")
    public void add(String name) {
        // å¼‚æ­¥è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œå°†ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œ
        CompletableFuture.runAsync(() -> {
            log.info("ä»»åŠ¡æ‰§è¡Œä¸­ï¼š" + name + "ï¼Œæ‰§è¡Œäººï¼š" + Thread.currentThread().getName());
            try {
                Thread.sleep(600000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }, threadPoolExecutor);
    }

    // æŸ¥çœ‹çº¿ç¨‹å½“å‰çŠ¶æ€
    @GetMapping("/get")
    public String get() {
        Map<String, Object> map = new HashMap<>();
        int size = threadPoolExecutor.getQueue().size();
        map.put("é˜Ÿåˆ—é•¿åº¦", size);
        long taskCount = threadPoolExecutor.getTaskCount();
        map.put("ä»»åŠ¡æ€»æ•°", taskCount);
        long completedTaskCount = threadPoolExecutor.getCompletedTaskCount();
        map.put("å·²å®Œæˆä»»åŠ¡æ•°", completedTaskCount);
        int activeCount = threadPoolExecutor.getActiveCount();
        map.put("æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹æ•°", activeCount);
        return JSONUtil.toJsonStr(map);
    }
}
```
ä»¥ debugæ¨¡å¼ é‡å¯é¡¹ç›®ï¼Œè®¿é—® http://localhost:8080/api/doc.htmlï¼Œæ‰¾åˆ° queue-controll 
er ï¼›
åœ¨addæ¥å£ï¼Œå‘é€ä¸€ä¸ªä»»åŠ¡ï¼šä»»åŠ¡1ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723554191584-83ef9336-06d0-4cc2-9f5f-55c8ec35703b.png#averageHue=%23ccb892&clientId=u6da9e890-ded5-4&from=paste&height=817&id=ua90354c2&originHeight=980&originWidth=1891&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=119909&status=done&style=none&taskId=uaaaf1a51-9801-4877-8068-80bf4bd3651&title=&width=1575.8332707153452)
ç”±äºç°åœ¨åˆšå¼€å§‹ï¼Œæ²¡æœ‰ä»»ä½•çš„çº¿ç¨‹å’Œä»»åŠ¡ï¼Œå½“æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œå‘ç°å½“å‰å‘˜å·¥æ•°é‡è¿˜æœªè¾¾åˆ°è®¾å®šçš„æ­£å¼å‘˜å·¥æ•°(corePoolSize = 2)ï¼Œåˆ™ä¼šç›´æ¥å¢è˜ä¸€åæ–°å‘˜å·¥æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ï¼Œåœ¨åç«¯æ§åˆ¶å°æŸ¥çœ‹ä¿¡æ¯ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723554407885-05727b88-0d9f-447d-9cb6-8ee3cd0baa1d.png#averageHue=%232c333c&clientId=u6da9e890-ded5-4&from=paste&height=326&id=u2df8db82&originHeight=391&originWidth=2688&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=158911&status=done&style=none&taskId=u965f1820-47ff-4562-b235-a6a72510910&title=&width=2239.9999109904006)
```java
2024-08-13 21:03:15.630  INFO 32748 --- [           çº¿ç¨‹:1] c.y.s.controller.QueueController         : ä»»åŠ¡æ‰§è¡Œä¸­ï¼šä»»åŠ¡1ï¼Œæ‰§è¡Œäººï¼šçº¿ç¨‹:1
```
åœ¨ addæ¥å£ï¼Œå‘é€ä¸€ä¸ªä»»åŠ¡2ï¼› 
åˆæ¥ä¸€ä¸ªä»»åŠ¡2ï¼Œå‘ç°å½“å‰å‘˜å·¥æ•°é‡è¿˜æœªè¾¾åˆ°è®¾å®šçš„æ­£å¼å‘˜å·¥æ•°(corePoolSize = 2)ï¼Œåˆ™ä¼šå†æ¬¡å¢è˜ä¸€åæ–°å‘˜å·¥æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ï¼Œåœ¨åç«¯æ§åˆ¶å°æŸ¥çœ‹ä¿¡æ¯ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723554467553-f68a93c7-6b1e-408f-b4cb-a03a21f5821c.png#averageHue=%23c8b38d&clientId=u6da9e890-ded5-4&from=paste&height=744&id=u2d2c9cca&originHeight=893&originWidth=1893&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=100113&status=done&style=none&taskId=udc6c7dac-ba8f-462f-b5be-713eca2d3c7&title=&width=1577.4999373157843)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723554487510-f36f1a6c-1116-419e-8584-f6fa3fb6343d.png#averageHue=%232d333c&clientId=u6da9e890-ded5-4&from=paste&height=393&id=u7261d833&originHeight=472&originWidth=2721&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=200926&status=done&style=none&taskId=u854a5b49-f7a0-4c57-91c7-7f2aab47b2c&title=&width=2267.499909897649)
åœ¨getæ¥å£æŸ¥çœ‹é˜Ÿåˆ—é•¿åº¦ä¸º 0ï¼Œä¹‹å‰çš„ä»»åŠ¡éƒ½æ²¡æœ‰è¿›å…¥é˜Ÿåˆ—é‡Œï¼Œå› ä¸ºéƒ½äº¤ç»™çº¿ç¨‹ 1ã€çº¿ç¨‹ 2äº†ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723554532204-6eebf1b3-c77f-42bb-b045-179af0e53a95.png#averageHue=%23bca87d&clientId=u6da9e890-ded5-4&from=paste&height=633&id=u539a830a&originHeight=760&originWidth=1893&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=65330&status=done&style=none&taskId=u05889e33-3f4e-4a27-8984-7c24e1a0b34&title=&width=1577.4999373157843)
åœ¨ addæ¥å£ï¼Œå‘é€ä¸€ä¸ªä»»åŠ¡3ï¼› 
åˆæ¥äº†ä¸€ä¸ªä»»åŠ¡3ï¼Œä½†æ˜¯æ­£å¼å‘˜å·¥æ•°å·²ç»è¾¾åˆ°ä¸Šé™(å½“å‰çº¿ç¨‹æ•° = corePoolSize = 2)ï¼Œè¿™ä¸ªæ–°ä»»åŠ¡å°†è¢«æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­(æœ€å¤§é•¿åº¦ workQueue.size æ˜¯ 4) ï¼Œè€Œä¸æ˜¯ç«‹å³å¢è˜æ–°å‘˜å·¥ï¼Œåœ¨åç«¯æ§åˆ¶å°æŸ¥çœ‹ä¿¡æ¯ï¼Œå‘ç°æ²¡æœ‰çº¿ç¨‹å»æ‰§è¡Œï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723554609574-44f815e4-a8b8-44d6-9020-7d00cdd72296.png#averageHue=%232c313a&clientId=u6da9e890-ded5-4&from=paste&height=397&id=uf73df408&originHeight=477&originWidth=2623&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=145586&status=done&style=none&taskId=uad9b494c-ff5a-4320-9547-2447da55dd8&title=&width=2185.833246476124)
åœ¨ addæ¥å£ï¼Œå‘é€ä»»åŠ¡4ã€ä»»åŠ¡5ã€ä»»åŠ¡6ï¼› 
åœ¨ getæ¥å£æŸ¥çœ‹é˜Ÿåˆ—é•¿åº¦ä¸º 4ï¼Œç°åœ¨é˜Ÿåˆ—æ»¡äº†ï¼Œæ­£å¼å‘˜å·¥ä¹Ÿæ»¡äº†ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723554718806-126a8cd3-a7a6-4bab-9e90-b3cf9cd5e283.png#averageHue=%23fdfdfd&clientId=u6da9e890-ded5-4&from=paste&height=427&id=u1c8588b7&originHeight=512&originWidth=1523&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=31990&status=done&style=none&taskId=uddb3c979-94a0-493a-a393-819592d0f11&title=&width=1269.1666162345164)
åœ¨ addæ¥å£ï¼Œå‘é€ä»»åŠ¡7ï¼› 
å†æ¥ä¸€ä¸ªä»»åŠ¡7ï¼Œæˆ‘ä»¬å°†å¢è®¾æ–°çº¿ç¨‹(æœ€å¤§çº¿ç¨‹æ•° maximumPoolSize = 4)æ¥å¤„ç†ä»»åŠ¡ï¼Œè€Œä¸æ˜¯é€‰æ‹©ä¸¢å¼ƒè¿™ä¸ªä»»åŠ¡ï¼Œåœ¨åç«¯çŠ¶æ€æŸ¥çœ‹ä¿¡æ¯ï¼š
å°±å¾ˆå¥½çš„è¯æ˜äº†ä¸€ç‚¹ã€‚å¦‚æœæ–°æ¥ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ—¶å€™æ˜¯å…ˆæ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—ä¸­å‰é¢çš„ï¼Œè¿˜æ˜¯è¯´å…ˆæ‰§è¡Œæ–°åŠ å…¥çš„ï¼Ÿè¿™ç§æƒ…å†µä¸‹ï¼Œä»–å°±ä¼šå…ˆæ‰§è¡Œè¿™ä¸ªä»»åŠ¡7ã€‚ 
åœ¨ addæ¥å£ï¼Œå‘é€ä»»åŠ¡8ï¼› 
å†æ¥ä¸€ä¸ªä»»åŠ¡8ï¼Œæˆ‘ä»¬å°†å¢è®¾æ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œåœ¨åç«¯çŠ¶æ€æŸ¥çœ‹ä¿¡æ¯ï¼Œè¿™ä¸ªä»»åŠ¡ç”±çº¿ç¨‹ 4 å¤„ 
ç†
ç°åœ¨é˜Ÿåˆ—æ»¡äº†ï¼Œæ­£å¼å‘˜å·¥æ»¡äº†ï¼Œä¸´æ—¶å·¥ä¹Ÿæ»¡äº†ï¼› 
å¯ä»¥åˆ° getæ¥å£æŸ¥çœ‹ï¼š
å¼€å§‹ç¼–å†™é˜Ÿåˆ—æµ‹è¯•çš„ä»£ç ã€‚
```java
/**
 * é˜Ÿåˆ—æµ‹è¯•
 *
 * @author Shier
 */
@RestController
@RequestMapping("/queue")
@Slf4j
@Profile({ "dev", "local" })
@Api(tags = "QueueController")
@CrossOrigin(origins = "http://localhost:8000", allowCredentials = "true")
public class QueueController {

    @Resource
    private ThreadPoolExecutor threadPoolExecutor;

    @GetMapping("/add")
    public void add(String name) {
        CompletableFuture.runAsync(() -> {
            log.info("ä»»åŠ¡æ‰§è¡Œä¸­ï¼š" + name + "ï¼Œæ‰§è¡Œäººï¼š" + Thread.currentThread().getName());
            try {
                Thread.sleep(60000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        },threadPoolExecutor);
    }

    @GetMapping("/get")
    public String get() {
        Map<String, Object> map = new HashMap<>();
        int size = threadPoolExecutor.getQueue().size();
        map.put("é˜Ÿåˆ—é•¿åº¦:", size);
        long taskCount = threadPoolExecutor.getTaskCount();
        map.put("ä»»åŠ¡æ€»æ•°:", taskCount);
        long completedTaskCount = threadPoolExecutor.getCompletedTaskCount();
        map.put("å·²å®Œæˆä»»åŠ¡æ•°:", completedTaskCount);
        int activeCount = threadPoolExecutor.getActiveCount();
        map.put("æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹æ•°:", activeCount);
        return JSONUtil.toJsonStr(map);
    }
}
```
åªæœ‰ä¸¤ä¸ªä»»åŠ¡æƒ…å†µçš„æ—¥å¿—ï¼š

## 4ã€æœ¬é¡¹ç›®å¼€å‘å¼‚æ­¥åŒ–å‰åç«¯
### 4.1 åç«¯å®ç°å·¥ä½œæµç¨‹

1.  ç»™chartè¡¨æ–°å¢ä»»åŠ¡çŠ¶æ€å­—æ®µï¼ˆæ¯”å¦‚æ’é˜Ÿä¸­ã€æ‰§è¡Œä¸­ã€å·²å®Œæˆã€å¤±è´¥ï¼‰ï¼Œä»»åŠ¡æ‰§è¡Œä¿¡æ¯å­—æ®µï¼ˆç”¨äºè®°å½•ä»»åŠ¡æ‰§è¡Œä¸­ã€æˆ–è€…å¤±è´¥çš„ä¸€äº›ä¿¡æ¯) 

æ¥å®ç°å·¥ä½œæµç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œåœ¨ chartè¡¨ æ–°å¢ä¸¤ä¸ªå­—æ®µï¼š
```java
status varchar(128) default 'wait'            not null comment 'wait-ç­‰å¾…,running-ç”Ÿæˆä¸­,succeed-æˆåŠŸç”Ÿæˆ,failed-ç”Ÿæˆå¤±è´¥',
execMessage text                                   null comment 'æ‰§è¡Œä¿¡æ¯',
```
```java
# å»ºè¡¨è„šæœ¬
# @author <a href="https://github.com/liyupi">ç¨‹åºå‘˜é±¼çš®</a>
# @from <a href="https://yupi.icu">ç¼–ç¨‹å¯¼èˆªçŸ¥è¯†æ˜Ÿçƒ</a>

-- åˆ›å»ºåº“
create database if not exists yubi;

-- åˆ‡æ¢åº“
use yubi;

-- ç”¨æˆ·è¡¨
create table if not exists user
(
    id           bigint auto_increment comment 'id' primary key,
    userAccount  varchar(256)                           not null comment 'è´¦å·',
    userPassword varchar(512)                           not null comment 'å¯†ç ',
    userName     varchar(256)                           null comment 'ç”¨æˆ·æ˜µç§°',
    userAvatar   varchar(1024)                          null comment 'ç”¨æˆ·å¤´åƒ',
    userRole     varchar(256) default 'user'            not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser/admin',
    createTime   datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete     tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    index idx_userAccount (userAccount)
    ) comment 'ç”¨æˆ·' collate = utf8mb4_unicode_ci;

-- å›¾è¡¨è¡¨
-- å›¾è¡¨ä¿¡æ¯è¡¨
create table if not exists chart
(
    id         bigint auto_increment comment 'id' primary key,
    goal       text                               null comment 'åˆ†æç›®æ ‡',
    chartName   varchar(256)                       null comment 'å›¾è¡¨åç§°',
    chartData  text                               null comment 'å›¾è¡¨æ•°æ®',
    chartType  varchar(256)                       null comment 'å›¾è¡¨ç±»å‹',
    genChart   text                               null comment 'ç”Ÿæˆçš„å›¾è¡¨ä¿¡æ¯',
    getResult  text                               null comment 'ç”Ÿæˆçš„åˆ†æç»“è®º',
    status varchar(128) default 'wait'            not null comment 'wait-ç­‰å¾…,running-ç”Ÿæˆä¸­,succeed-æˆåŠŸç”Ÿæˆ,failed-ç”Ÿæˆå¤±è´¥',
    execMessage text                                   null comment 'æ‰§è¡Œä¿¡æ¯',
    userId     bigint                             null comment 'åˆ›å»ºå›¾æ ‡ç”¨æˆ· id',
    createTime datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete   tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤'
) comment 'å›¾è¡¨ä¿¡æ¯è¡¨' collate = utf8mb4_unicode_ci;
```
åœ¨ create_table.sql ä¸­æ–°å¢å­—æ®µï¼Œæ–¹ä¾¿åé¢æŸ¥çœ‹æˆ–ä¿®æ”¹ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723555508449-204772f6-99e4-4bad-817d-d2382a29e30e.png#averageHue=%23292e37&clientId=u6da9e890-ded5-4&from=paste&height=994&id=u54e45b01&originHeight=1193&originWidth=2716&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=356770&status=done&style=none&taskId=u49ccd72f-7002-4f8d-9db5-cf4e40ac342&title=&width=2263.3332433965506)
ç°åœ¨å¾€ chartè¡¨ å»æ–°å¢å­—æ®µï¼šç‚¹å‡»å³ä¾§èœå•æ ä¸Šçš„ Database ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723555551162-22f5f5a5-f84f-4350-b4ba-7b582ddf2d57.png#averageHue=%23272c34&clientId=u6da9e890-ded5-4&from=paste&height=876&id=u629d9222&originHeight=1051&originWidth=2230&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=314315&status=done&style=none&taskId=ubccecec5-8fc4-4c5a-a5b9-34cec1b7085&title=&width=1858.333259489804)
å¾€ genResultå­—æ®µ åæ·»åŠ å­—æ®µï¼šç‚¹å‡» genResultå­—æ®µ â†’ +ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723555613009-ff0a798f-8c90-426c-8408-b23b488ebb79.png#averageHue=%23262b32&clientId=u6da9e890-ded5-4&from=paste&height=1244&id=uf91f9ab5&originHeight=1493&originWidth=1664&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=151553&status=done&style=none&taskId=u34319eed-817f-4ba2-9ade-b07f5973788&title=&width=1386.6666115654862)
ç›´æ¥ç”¨æ–°å¢å­—æ®µçš„ SQL è¯­å¥æ›¿æ¢ä¸‹é¢ SQL Script ä¸­ add åé¢çš„éƒ¨åˆ†ã€‚
```java
alter table chart
    add status varchar(128) default 'wait'            not null comment 'wait-ç­‰å¾…,running-ç”Ÿæˆä¸­,succeed-æˆåŠŸç”Ÿæˆ,failed-ç”Ÿæˆå¤±è´¥';
    add execMessage text                                   null comment 'æ‰§è¡Œä¿¡æ¯';
```
åŒå‡» chartè¡¨ ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°æ–°å¢çš„å­—æ®µã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723555821287-73787c37-9aa2-4d6a-8693-a4eb1b271fc5.png#averageHue=%232c3039&clientId=u6da9e890-ded5-4&from=paste&height=575&id=u4d03877b&originHeight=690&originWidth=2207&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=169468&status=done&style=none&taskId=u1881f2b8-0659-48c7-b9fa-d39629b623e&title=&width=1839.1665935847523)
ç°åœ¨æ‰€æœ‰å›¾è¡¨é»˜è®¤çŠ¶æ€éƒ½æ˜¯ wait (æ’é˜Ÿä¸­)ï¼Œå…¨æ”¹æˆ succeed (å·²å®Œæˆ)ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723555847430-d18f503a-2bbc-4030-a6a3-3851f12edd82.png#averageHue=%23f0ede1&clientId=u6da9e890-ded5-4&from=paste&height=300&id=u5a530a09&originHeight=360&originWidth=643&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=148372&status=done&style=none&taskId=ue589d85b-256e-4c2f-8c93-2bedbfdbecd&title=&width=535.8333120412306)
ç„¶åå»è¡¥å……å®ä½“ç±»çš„å­—æ®µï¼Œæ‰¾åˆ° modelæ–‡ä»¶ä¸‹çš„entityæ–‡ä»¶å¤¹ä¸‹çš„Chart.javaã€‚
```java
/**
* ä»»åŠ¡çŠ¶æ€
* å›¾è¡¨çŠ¶æ€ wait-ç­‰å¾…,running-ç”Ÿæˆä¸­,succeed-æˆåŠŸç”Ÿæˆ,failed-ç”Ÿæˆå¤±è´¥
*/
private String status;

/**
* æ‰§è¡Œä¿¡æ¯
*/
private String execMessage;
```
 å®Œæ•´å†…å®¹ï¼š
```java
package com.yupi.springbootinit.model.entity;

import com.baomidou.mybatisplus.annotation.*;
import lombok.Data;

import java.io.Serializable;
import java.util.Date;

/**
 * å›¾è¡¨ä¿¡æ¯è¡¨
 * @TableName chart
 */
@TableName(value ="chart")
@Data
public class Chart implements Serializable {
    /**
     * id
     */
    @TableId(type = IdType.ASSIGN_ID)
    private Long id;

    /**
     * å›¾è¡¨åç§°
     */
    private String name;

    /**
     * åˆ†æç›®æ ‡
     */
    private String goal;

    /**
     * å›¾è¡¨ä¿¡æ¯
     */
    private String chartData;

    /**
     * å›¾è¡¨ç±»å‹
     */
    private String chartType;

    /**
     * ç”Ÿæˆçš„å›¾è¡¨ä¿¡æ¯
     */
    private String genChart;

    /**
     * ç”Ÿæˆçš„åˆ†æç»“è®º
     */
    private String genResult;

    /**
     * ä»»åŠ¡çŠ¶æ€
     * å›¾è¡¨çŠ¶æ€ wait-ç­‰å¾…,running-ç”Ÿæˆä¸­,succeed-æˆåŠŸç”Ÿæˆ,failed-ç”Ÿæˆå¤±è´¥
     */
    private String status;

    /**
     * æ‰§è¡Œä¿¡æ¯
     */
    private String execMessage;

    /**
     * åˆ›å»ºå›¾æ ‡ç”¨æˆ· id
     */
    private Long userId;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private Date createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    private Date updateTime;

    /**
     * æ˜¯å¦åˆ é™¤
     */
    @TableLogic
    private Integer isDelete;

    @TableField(exist = false)
    private static final long serialVersionUID = 1L;
}
```

2.  ç”¨æˆ·ç‚¹å‡»æ™ºèƒ½åˆ†æé¡µçš„æäº¤æŒ‰é’®æ—¶ï¼Œå…ˆæŠŠå›¾è¡¨ç«‹åˆ»ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œç„¶åæäº¤ä»»åŠ¡ 
3.  ä»»åŠ¡ï¼šå…ˆä¿®æ”¹å›¾è¡¨ä»»åŠ¡çŠ¶æ€ä¸º"æ‰§è¡Œä¸­"ã€‚ç­‰æ‰§è¡ŒæˆåŠŸåï¼Œä¿®æ”¹ä¸º"å·²å®Œæˆ"ã€ä¿å­˜æ‰§è¡Œç»“æœï¼›æ‰§è¡Œå¤±è´¥åï¼ŒçŠ¶æ€ä¿®æ”¹ä¸º"å¤±è´¥"ï¼Œè®°å½•ä»»åŠ¡å¤±è´¥ä¿¡æ¯ã€‚ 
4.  ç”¨æˆ·å¯ä»¥åœ¨å›¾è¡¨ç®¡ç†é¡µé¢æŸ¥çœ‹æ‰€æœ‰å›¾è¡¨ï¼ˆå·²ç”Ÿæˆçš„ã€ç”Ÿæˆä¸­çš„ã€ç”Ÿæˆå¤±è´¥ï¼‰çš„ä¿¡æ¯å’ŒçŠ¶æ€
å¼‚æ­¥ç”Ÿæˆæ¥å£ï¼š 
```java
/**
 * å›¾è¡¨ç”Ÿæˆå¼‚æ­¥
 *
 * @param multipartFile       ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¿¡æ¯
 * @param genChartByAiRequest ç”¨æˆ·çš„éœ€æ±‚
 * @param request             http request
 * @return
 */
@Override
public BiResponse genChartByAiAsync(MultipartFile multipartFile, GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
    String chartName = genChartByAiRequest.getChartName();
    String goal = genChartByAiRequest.getGoal();
    String chartType = genChartByAiRequest.getChartType();
    User loginUser = userService.getLoginUser(request);
    // æ ¡éªŒ
    ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "å›¾è¡¨åˆ†æç›®æ ‡ä¸ºç©º");
    ThrowUtils.throwIf(StringUtils.isNotBlank(chartName) && chartName.length() > 200, ErrorCode.PARAMS_ERROR, "å›¾è¡¨åç§°è¿‡é•¿");
    ThrowUtils.throwIf(StringUtils.isBlank(chartType), ErrorCode.PARAMS_ERROR, "å›¾è¡¨ç±»å‹ä¸ºç©º");

    // æ ¡éªŒæ–‡ä»¶
    long fileSize = multipartFile.getSize();
    String originalFilename = multipartFile.getOriginalFilename();
    // æ ¡éªŒæ–‡ä»¶å¤§å°
    ThrowUtils.throwIf(fileSize > FILE_MAX_SIZE, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶å¤§å°è¶…è¿‡ 1M");
    // æ ¡éªŒæ–‡ä»¶åç¼€
    String suffix = FileUtil.getSuffix(originalFilename);
    ThrowUtils.throwIf(!VALID_FILE_SUFFIX.contains(suffix), ErrorCode.PARAMS_ERROR, "ä¸æ”¯æŒè¯¥ç±»å‹æ–‡ä»¶");

    // ç”¨æˆ·æ¯ç§’é™æµ
    redisLimiterManager.doRateLimit("genChartByAi_" + loginUser.getId());

    // æ— éœ€Promptï¼Œç›´æ¥è°ƒç”¨ç°æœ‰æ¨¡å‹
    // æ„é€ ç”¨æˆ·è¾“å…¥
    StringBuilder userInput = new StringBuilder();
    userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
    // æ‹¼æ¥åˆ†æç›®æ ‡
    String userGoal = goal;
    if (StringUtils.isNotBlank(chartType)) {
        userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
    }
    userInput.append(userGoal).append("\n");
    userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");

    // å‹ç¼©åçš„æ•°æ®
    String csvData = ExcelUtils.excelToCsv(multipartFile);
    userInput.append(csvData).append("\n");

    // å…ˆæ’å…¥æ•°æ®åˆ°æ•°æ®åº“
    Chart chart = new Chart();
    chartName = StringUtils.isBlank(chartName) ? ChartUtils.genDefaultChartName() : chartName;
    chart.setGoal(goal);
    chart.setChartData(csvData);
    chart.setChartName(chartName);
    chart.setChartType(chartType);
    chart.setChartStatus(ChartStatusEnum.WAIT.getValue());
    chart.setUserId(loginUser.getId());
    boolean saveResult = this.save(chart);
    ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");

    // todo ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼ŒæŠ›ä¸ªå¼‚å¸¸
    CompletableFuture.runAsync(() -> {
        // todo ç­‰å¾…å¤ªä¹…äº†ï¼ŒæŠ›å¼‚å¸¸ï¼Œè¶…æ—¶æ—¶é—´
        // ç­‰å¾…-->æ‰§è¡Œä¸­--> æˆåŠŸ/å¤±è´¥
        Chart updateChart = new Chart();
        updateChart.setId(chart.getId());
        updateChart.setChartStatus(ChartStatusEnum.RUNNING.getValue());
        boolean updateChartById = this.updateById(updateChart);
        // todo ä¿®æ”¹æ•°æ®åº“å½“ä¸­çš„å­—æ®µä¸º å¤±è´¥
        //if (!updateChartById){
        //    Chart updateChartFailed = new Chart();
        //    updateChartFailed.setId(chart.getId());
        //    updateChartFailed.setChartStatus(ChartStatusEnum.FAILED.getValue());
        //}
        if (!updateChartById) {
            handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æ‰§è¡Œä¸­çŠ¶æ€Â·å¤±è´¥");
            return;
        }

        // è°ƒç”¨AI
        String chartResult = aiManager.doChat(userInput.toString());
        // è§£æå†…å®¹
        String[] splits = chartResult.split(GEN_CONTENT_SPLITS);
        if (splits.length < GEN_ITEM_NUM) {
            //throw new BusinessException(ErrorCode.SYSTEM_ERROR, "");
            handleChartUpdateError(chart.getId(), "AIç”Ÿæˆé”™è¯¯");
            return;
        }
        // ç”Ÿæˆå‰çš„å†…å®¹
        String preGenChart = splits[GEN_CHART_IDX].trim();
        String genResult = splits[GEN_RESULT_IDX].trim();
        // ç”Ÿæˆåç«¯æ£€éªŒ
        String validGenChart = ChartUtils.getValidGenChart(preGenChart);
        // ç”Ÿæˆçš„æœ€ç»ˆç»“æœ
        Chart updateChartResult = new Chart();
        updateChartResult.setId(chart.getId());
        updateChartResult.setGenChart(validGenChart);
        updateChartResult.setGenResult(genResult);
        updateChartResult.setChartStatus(ChartStatusEnum.SUCCEED.getValue());
        // todo å¤±è´¥æƒ…å†µ
        boolean updateResult = this.updateById(updateChart);
        //if (!updateChartById){
        //    Chart updateChartFailed = new Chart();
        //    updateChartFailed.setId(chart.getId());
        //    updateChartFailed.setChartStatus(ChartStatusEnum.FAILED.getValue());
        //}
        if (!updateResult) {
            handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æˆåŠŸçŠ¶æ€Â·å¤±è´¥");
        }
    }, threadPoolExecutor);

    // è¿”å›åˆ°å‰ç«¯
    BiResponse biResponse = new BiResponse();
    biResponse.setChartId(chart.getId());
    return biResponse;
}

/**
 * å›¾è¡¨æ›´æ–°é”™è¯¯
 *
 * @param chartId
 * @param execMessage
 */
private void handleChartUpdateError(long chartId, String execMessage) {
    Chart updateChartResult = new Chart();
    updateChartResult.setId(chartId);
    updateChartResult.setChartStatus(ChartStatusEnum.FAILED.getValue());
    updateChartResult.setExecMessage("å›¾è¡¨æ›´æ–°å¤±è´¥ï¼ï¼");
    boolean updateResult = this.updateById(updateChartResult);
    if (!updateResult) {
        log.error("æ›´æ–°å›¾è¡¨å¤±è´¥çŠ¶æ€å¤±è´¥" + chartId + "," + execMessage);
    }
}
```
è‡ªå·±çš„å®ç°
```java
    @Resource
    private ThreadPoolExecutor threadPoolExecutor;

    @PostMapping("/gen")
    public BaseResponse<BiResponse> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                                     GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
        String name = genChartByAiRequest.getName();
        String goal = genChartByAiRequest.getGoal();
        String chartType = genChartByAiRequest.getChartType();
        // é€šè¿‡responseå¯¹è±¡æ‹¿åˆ°ç”¨æˆ·id(å¿…é¡»ç™»å½•æ‰èƒ½ä½¿ç”¨)
        User loginUser = userService.getLoginUser(request);

        // æ ¡éªŒ
        // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
        // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");

        // æ ¡éªŒæ–‡ä»¶
        long size = multipartFile.getSize();
        String originalFilename = multipartFile.getOriginalFilename();
        // æ ¡éªŒæ–‡ä»¶å¤§å°
        final long ONE_MB = 1024 * 1024L;
        ThrowUtils.throwIf(size > ONE_MB, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶è¶…è¿‡ 1M");
        // æ ¡éªŒæ–‡ä»¶åç¼€ aaa.png
        String suffix = FileUtil.getSuffix(originalFilename);
        final List<String> validFileSuffixList = Arrays.asList("xlsx","csv","xls","json");
        ThrowUtils.throwIf(!validFileSuffixList.contains(suffix), ErrorCode.PARAMS_ERROR, "æ–‡ä»¶åç¼€éæ³•");

        //é™æµåˆ¤æ–­ï¼Œæ¯ä¸ªç”¨æˆ·ä¸€ä¸ªé™æµå™¨
        redisLimiterManager.doRateLimit("genChartByAi_" + loginUser.getId());

        // æŒ‡å®šä¸€ä¸ªæ¨¡å‹id(æŠŠidå†™æ­»ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æˆä¸€ä¸ªå¸¸é‡)
        long biModelId = 1821914479207112706L;
        /*
        * ç”¨æˆ·çš„è¾“å…¥(å‚è€ƒ)
          åˆ†æéœ€æ±‚ï¼š
          åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
          åŸå§‹æ•°æ®ï¼š
          æ—¥æœŸ,ç”¨æˆ·æ•°
          1å·,10
          2å·,20
          3å·,30
        * */
        // æ„é€ ç”¨æˆ·è¾“å…¥
        StringBuilder userInput = new StringBuilder();
        userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
        // æ‹¼æ¥åˆ†æç›®æ ‡
        String userGoal = goal;
        // å¦‚æœå›¾è¡¨ç±»å‹ä¸ä¸ºç©º
        if (StringUtils.isNotBlank(chartType)) {
            // å°±å°†åˆ†æç›®æ ‡æ‹¼æ¥ä¸Šâ€œè¯·ä½¿ç”¨â€+å›¾è¡¨ç±»å‹
            userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
        }
        userInput.append(userGoal).append("\n");
        userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");

        // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼‰
        String csvData = ExcelUtils.excelToCsv(multipartFile);
        userInput.append(csvData).append("\n");

        // å…ˆæ’å…¥æ•°æ®åˆ°æ•°æ®åº“
        Chart chart = new Chart();
        chart.setName(name);
        chart.setGoal(goal);
        chart.setChartData(csvData);
        chart.setChartType(chartType);
        chart.setStatus("wait");   // todo è®¾ç½®æšä¸¾å€¼
        chart.setUserId(loginUser.getId());
        boolean saveResult = chartService.save(chart);
        ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");

        // todo ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼ŒæŠ›ä¸ªå¼‚å¸¸
        CompletableFuture.runAsync(()->{
            // todo ç­‰å¾…å¤ªä¹…äº†ï¼ŒæŠ›å¼‚å¸¸ï¼Œè¶…æ—¶æ—¶é—´
            // ç­‰å¾…-->æ‰§è¡Œä¸­--> æˆåŠŸ/å¤±è´¥
            //å…ˆä¿®æ”¹å›¾è¡¨ä»»åŠ¡çŠ¶æ€ä¸º"æ‰§è¡Œä¸­"ã€‚ç­‰æ‰§è¡ŒæˆåŠŸåï¼Œä¿®æ”¹ä¸º"å·²å®Œæˆ"ã€ä¿å­˜æ‰§è¡Œç»“æœï¼›
            // æ‰§è¡Œå¤±è´¥åï¼ŒçŠ¶æ€ä¿®æ”¹ä¸º"å¤±è´¥"ï¼Œè®°å½•ä»»åŠ¡å¤±è´¥ä¿¡æ¯ã€‚
            Chart updateChart = new Chart();
            updateChart.setId(chart.getId());
            updateChart.setStatus("running");  // todo  è®¾ç½®æšä¸¾å€¼
            boolean updateChartById = chartService.updateById(updateChart);
            if(!updateChartById) {
//                throw new BusinessException(ErrorCode.OPERATION_ERROR, "å›¾è¡¨çŠ¶æ€æ›´æ–°å¤±è´¥"); // todo
                handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æ‰§è¡Œä¸­çŠ¶æ€Â·å¤±è´¥");
                return;
            }
            // è°ƒç”¨é±¼çš®æ¥å£,æ‹¿åˆ°è¿”å›ç»“æœ
            String result = aiManager.doChat(biModelId,userInput.toString());
            //å¯¹è¿”å›ç»“æœåšæ‹†åˆ†,æŒ‰ç…§5ä¸ªä¸­æ‹¬å·è¿›è¡Œæ‹†åˆ†
            String[] splits = result.split("ã€ã€ã€ã€ã€");
            // æ‹†åˆ†ä¹‹åè¿˜è¦è¿›è¡Œæ ¡éªŒ
            if (splits.length < 3) {
//                throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
                handleChartUpdateError(chart.getId(), "AIç”Ÿæˆé”™è¯¯");
                return;
            }
            String genChart = splits[1].trim();
            String genResult = splits[2].trim();

            Chart updateChartResult = new Chart();
            updateChartResult.setId(chart.getId());
            updateChartResult.setGenResult(genResult);
            updateChartResult.setGenChart(genChart);
            updateChartResult.setStatus("success");  // todo  è®¾ç½®æšä¸¾å€¼
            boolean b = chartService.updateById(updateChartResult);
            if(!b) {
//                throw new BusinessException(ErrorCode.OPERATION_ERROR, "å›¾è¡¨çŠ¶æ€æ›´æ–°å¤±è´¥"); // todo
                handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æˆåŠŸçŠ¶æ€Â·å¤±è´¥");
            }

        }, threadPoolExecutor);

        // è¿”å›åˆ°å‰ç«¯
        BiResponse biResponse = new BiResponse();
        biResponse.setChartId(chart.getId());
        return ResultUtils.success(biResponse);
    }

    /**
     * å›¾è¡¨æ›´æ–°é”™è¯¯
     *
     * @param chartId
     * @param execMessage
     */
    private void handleChartUpdateError(long chartId, String execMessage) {
        Chart updateChartResult = new Chart();
        updateChartResult.setId(chartId);
        updateChartResult.setStatus("failed");
        updateChartResult.setExecMessage("execMessageï¼ï¼");
        boolean updateResult = chartService.updateById(updateChartResult);
        if (!updateResult) {
            log.error("æ›´æ–°å›¾è¡¨å¤±è´¥çŠ¶æ€å¤±è´¥" + chartId + "," + execMessage);
        }
    }
```
å°†ä¸Šé¢çš„ä»£ç åˆ†ä¸ºåŒæ­¥å’Œå¼‚æ­¥ä¸¤ä¸ªæ­¥éª¤æ¥å†™å‡ºæ¥ï¼Œä¸ºäº†åœ¨é€‰æ‹©åˆ†æçš„æ—¶å€™ï¼Œå¯ä»¥å¼‚æ­¥çš„æ›´æ–°ï¼Œåœ¨æ²¡æœ‰åˆ†æå‡ºæ¥ç»“æœçš„æ—¶å€™æ˜¾ç¤ºä¸æŠ¥é”™ï¼Œå…·ä½“çš„ä»£ç å¦‚ä¸‹æ–¹æ³•ä¸­çš„genChartByAiAsyncå’ŒgenChartByAiä¸¤ä¸ªæ–¹æ³•ï¼š
> å°†æ™ºèƒ½åˆ†ææ‹†åˆ†ä¸ºåŒæ­¥å’Œå¼‚æ­¥æ“ä½œã€‚ç”±äºå¼‚æ­¥æ“ä½œæ²¡æœ‰è¿”å›å€¼ä¿¡æ¯ï¼Œæˆ‘ä»¬æ— æ³•è§£æå¹¶è¿”å›å›¾è¡¨ä¿¡æ¯ï¼Œè¿™å¯¼è‡´å¯è§†åŒ–å›¾è¡¨å’Œåˆ†æç»“æœæ— æ³•è¢«å±•ç¤ºã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¿ç•™ä¹‹å‰çš„æ™ºèƒ½åˆ†æç»“æœï¼›å¦åˆ™ï¼Œå¤§å®¶åœ¨æ‹‰å–è¿™ä¸€æœŸçš„ä»£ç æ—¶å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚
> å¦‚æœä¸ºäº†ç»™é¢è¯•å®˜çœ‹ï¼Œå»ºè®®æŠŠè¿™ä¸¤ç§å¤„ç†æ–¹å¼éƒ½ä¿ç•™ï¼Œä½ å¯ä»¥å‘é¢è¯•å®˜è§£é‡Šä¸ºä»€ä¹ˆè¦å¼•å…¥å¼‚æ­¥æµ ç¨‹ï¼Œå¼‚æ­¥çš„ä¼˜ç‚¹ï¼Œä»¥åŠå¦‚ä½•å®ç°å¼‚æ­¥ã€‚åªè¦è°ˆåˆ°çº¿ç¨‹æ± ï¼Œæœ‰è¶…è¿‡ 50% çš„å¯èƒ½æ€§é¢è¯•å®˜ä¼šé—®ä½ å…³äºçº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ã€‚è¿™æ—¶ä½ å¯ä»¥æŠŠæœ¬æœŸä¸­ä»‹ç»çš„å†…å®¹å…¨éƒ½è®²å‡ºæ¥ï¼Œç›¸ä¿¡é¢è¯•å®˜ä¼šè®¤ä¸ºä½ çš„æ€è·¯éå¸¸æ¸…æ™°ã€‚ 
> æ¥ä¸‹æ¥éœ€è¦å»å‰ç«¯åšä¸€ä¸‹ç›¸åº”çš„ä¿®æ”¹ã€‚

```java
package com.yupi.springbootinit.controller;

import cn.hutool.core.io.FileUtil;
import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.google.gson.Gson;
import com.yupi.springbootinit.annotation.AuthCheck;
import com.yupi.springbootinit.common.BaseResponse;
import com.yupi.springbootinit.common.DeleteRequest;
import com.yupi.springbootinit.common.ErrorCode;
import com.yupi.springbootinit.common.ResultUtils;
import com.yupi.springbootinit.constant.CommonConstant;
import com.yupi.springbootinit.constant.FileConstant;
import com.yupi.springbootinit.constant.UserConstant;
import com.yupi.springbootinit.exception.BusinessException;
import com.yupi.springbootinit.exception.ThrowUtils;
import com.yupi.springbootinit.manager.AiManager;
import com.yupi.springbootinit.manager.CosManager;
import com.yupi.springbootinit.manager.OpenaiManager;
import com.yupi.springbootinit.manager.RedisLimiterManager;
import com.yupi.springbootinit.model.dto.chart.*;
import com.yupi.springbootinit.model.dto.file.UploadFileRequest;
import com.yupi.springbootinit.model.entity.Chart;
import com.yupi.springbootinit.model.entity.User;
import com.yupi.springbootinit.model.enums.FileUploadBizEnum;
import com.yupi.springbootinit.model.vo.BiResponse;
import com.yupi.springbootinit.model.vo.OpenAIResponse;
import com.yupi.springbootinit.service.ChartService;
import com.yupi.springbootinit.service.UserService;
import com.yupi.springbootinit.utils.ExcelUtils;
import com.yupi.springbootinit.utils.SqlUtils;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.ObjectUtils;
import org.apache.commons.lang3.RandomStringUtils;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.BeanUtils;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import java.io.File;
import java.util.Arrays;
import java.util.List;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ThreadPoolExecutor;

/**
 * å¸–å­æ¥å£
 *
 */
@RestController
@RequestMapping("/chart")
@Slf4j
public class ChartController {

    @Resource
    private ChartService chartService;

    @Resource
    private UserService userService;

    @Resource
    private CosManager cosManager;

    @Resource
    private AiManager aiManager;

    @Resource
    private OpenaiManager  openaiManager;

    @Resource
    private RedisLimiterManager redisLimiterManager;

    @Resource
    private ThreadPoolExecutor threadPoolExecutor;

    /**
     * æ™ºèƒ½åˆ†æ é±¼çš®æ¥å£ï¼ˆåŒæ­¥ï¼‰
     *
     * @param multipartFile
     * @param genChartByAiRequest
     * @param request
     * @return
     */
    @PostMapping("/gen")
    public BaseResponse<BiResponse> genChartByAi(@RequestPart("file") MultipartFile multipartFile,
                                                 GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
        String name = genChartByAiRequest.getName();
        String goal = genChartByAiRequest.getGoal();
        String chartType = genChartByAiRequest.getChartType();
        // é€šè¿‡responseå¯¹è±¡æ‹¿åˆ°ç”¨æˆ·id(å¿…é¡»ç™»å½•æ‰èƒ½ä½¿ç”¨)
        User loginUser = userService.getLoginUser(request);

        // æ ¡éªŒ
        // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
        // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");

        // æ ¡éªŒæ–‡ä»¶
        long size = multipartFile.getSize();
        String originalFilename = multipartFile.getOriginalFilename();
        // æ ¡éªŒæ–‡ä»¶å¤§å°
        final long ONE_MB = 1024 * 1024L;
        ThrowUtils.throwIf(size > ONE_MB, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶è¶…è¿‡ 1M");
        // æ ¡éªŒæ–‡ä»¶åç¼€ aaa.png
        String suffix = FileUtil.getSuffix(originalFilename);
        final List<String> validFileSuffixList = Arrays.asList("xlsx","csv","xls","json");
        ThrowUtils.throwIf(!validFileSuffixList.contains(suffix), ErrorCode.PARAMS_ERROR, "æ–‡ä»¶åç¼€éæ³•");

        //é™æµåˆ¤æ–­ï¼Œæ¯ä¸ªç”¨æˆ·ä¸€ä¸ªé™æµå™¨
        redisLimiterManager.doRateLimit("genChartByAi_" + loginUser.getId());

        // æŒ‡å®šä¸€ä¸ªæ¨¡å‹id(æŠŠidå†™æ­»ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æˆä¸€ä¸ªå¸¸é‡)
        long biModelId = 1821914479207112706L;
        /*
        * ç”¨æˆ·çš„è¾“å…¥(å‚è€ƒ)
          åˆ†æéœ€æ±‚ï¼š
          åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
          åŸå§‹æ•°æ®ï¼š
          æ—¥æœŸ,ç”¨æˆ·æ•°
          1å·,10
          2å·,20
          3å·,30
        * */
        // æ„é€ ç”¨æˆ·è¾“å…¥
        StringBuilder userInput = new StringBuilder();
        userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
        // æ‹¼æ¥åˆ†æç›®æ ‡
        String userGoal = goal;
        // å¦‚æœå›¾è¡¨ç±»å‹ä¸ä¸ºç©º
        if (StringUtils.isNotBlank(chartType)) {
            // å°±å°†åˆ†æç›®æ ‡æ‹¼æ¥ä¸Šâ€œè¯·ä½¿ç”¨â€+å›¾è¡¨ç±»å‹
            userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
        }
        userInput.append(userGoal).append("\n");
        userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");
        // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼‰
        String csvData = ExcelUtils.excelToCsv(multipartFile);
        userInput.append(csvData).append("\n");

        // é±¼çš®æ¥å£,æ‹¿åˆ°è¿”å›ç»“æœ
        String result = aiManager.doChat(biModelId,userInput.toString());
        //å¯¹è¿”å›ç»“æœåšæ‹†åˆ†,æŒ‰ç…§5ä¸ªä¸­æ‹¬å·è¿›è¡Œæ‹†åˆ†
        String[] splits = result.split("ã€ã€ã€ã€ã€");
        // æ‹†åˆ†ä¹‹åè¿˜è¦è¿›è¡Œæ ¡éªŒ
        if (splits.length < 3) {
            throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
        }
        String genChart = splits[1].trim();
        String genResult = splits[2].trim();

        // æ’å…¥åˆ°æ•°æ®åº“
        Chart chart = new Chart();
        chart.setName(name);
        chart.setGoal(goal);
        chart.setChartData(csvData);
        chart.setChartType(chartType);
        chart.setGenChart(genChart);
        chart.setGenResult(genResult);
        chart.setUserId(loginUser.getId());
        boolean saveResult = chartService.save(chart);
        ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");

        BiResponse biResponse = new BiResponse();
        biResponse.setGenChart(genChart);
        biResponse.setGenResult(genResult);
        biResponse.setChartId(chart.getId());
        return ResultUtils.success(biResponse);
    }

    /**
     * æ™ºèƒ½åˆ†æ é±¼çš®æ¥å£ï¼ˆå¼‚æ­¥ï¼‰
     *
     * @param multipartFile
     * @param genChartByAiRequest
     * @param request
     * @return
     */
    @PostMapping("/gen/async")
    public BaseResponse<BiResponse> genChartByAiAsync(@RequestPart("file") MultipartFile multipartFile,
                                                     GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
        String name = genChartByAiRequest.getName();
        String goal = genChartByAiRequest.getGoal();
        String chartType = genChartByAiRequest.getChartType();
        // é€šè¿‡responseå¯¹è±¡æ‹¿åˆ°ç”¨æˆ·id(å¿…é¡»ç™»å½•æ‰èƒ½ä½¿ç”¨)
        User loginUser = userService.getLoginUser(request);

        // æ ¡éªŒ
        // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
        // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
        ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");

        // æ ¡éªŒæ–‡ä»¶
        long size = multipartFile.getSize();
        String originalFilename = multipartFile.getOriginalFilename();
        // æ ¡éªŒæ–‡ä»¶å¤§å°
        final long ONE_MB = 1024 * 1024L;
        ThrowUtils.throwIf(size > ONE_MB, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶è¶…è¿‡ 1M");
        // æ ¡éªŒæ–‡ä»¶åç¼€ aaa.png
        String suffix = FileUtil.getSuffix(originalFilename);
        final List<String> validFileSuffixList = Arrays.asList("xlsx","csv","xls","json");
        ThrowUtils.throwIf(!validFileSuffixList.contains(suffix), ErrorCode.PARAMS_ERROR, "æ–‡ä»¶åç¼€éæ³•");

        //é™æµåˆ¤æ–­ï¼Œæ¯ä¸ªç”¨æˆ·ä¸€ä¸ªé™æµå™¨
        redisLimiterManager.doRateLimit("genChartByAi_" + loginUser.getId());

        // æŒ‡å®šä¸€ä¸ªæ¨¡å‹id(æŠŠidå†™æ­»ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æˆä¸€ä¸ªå¸¸é‡)
        long biModelId = 1821914479207112706L;
        /*
        * ç”¨æˆ·çš„è¾“å…¥(å‚è€ƒ)
          åˆ†æéœ€æ±‚ï¼š
          åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
          åŸå§‹æ•°æ®ï¼š
          æ—¥æœŸ,ç”¨æˆ·æ•°
          1å·,10
          2å·,20
          3å·,30
        * */
        // æ„é€ ç”¨æˆ·è¾“å…¥
        StringBuilder userInput = new StringBuilder();
        userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
        // æ‹¼æ¥åˆ†æç›®æ ‡
        String userGoal = goal;
        // å¦‚æœå›¾è¡¨ç±»å‹ä¸ä¸ºç©º
        if (StringUtils.isNotBlank(chartType)) {
            // å°±å°†åˆ†æç›®æ ‡æ‹¼æ¥ä¸Šâ€œè¯·ä½¿ç”¨â€+å›¾è¡¨ç±»å‹
            userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
        }
        userInput.append(userGoal).append("\n");
        userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");

        // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼‰
        String csvData = ExcelUtils.excelToCsv(multipartFile);
        userInput.append(csvData).append("\n");

        // å…ˆæ’å…¥æ•°æ®åˆ°æ•°æ®åº“
        Chart chart = new Chart();
        chart.setName(name);
        chart.setGoal(goal);
        chart.setChartData(csvData);
        chart.setChartType(chartType);
        chart.setStatus("wait");   // todo è®¾ç½®æšä¸¾å€¼
        chart.setUserId(loginUser.getId());
        boolean saveResult = chartService.save(chart);
        ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");

        // todo ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼ŒæŠ›ä¸ªå¼‚å¸¸
        CompletableFuture.runAsync(()->{
            // todo ç­‰å¾…å¤ªä¹…äº†ï¼ŒæŠ›å¼‚å¸¸ï¼Œè¶…æ—¶æ—¶é—´
            // ç­‰å¾…-->æ‰§è¡Œä¸­--> æˆåŠŸ/å¤±è´¥
            //å…ˆä¿®æ”¹å›¾è¡¨ä»»åŠ¡çŠ¶æ€ä¸º"æ‰§è¡Œä¸­"ã€‚ç­‰æ‰§è¡ŒæˆåŠŸåï¼Œä¿®æ”¹ä¸º"å·²å®Œæˆ"ã€ä¿å­˜æ‰§è¡Œç»“æœï¼›
            // æ‰§è¡Œå¤±è´¥åï¼ŒçŠ¶æ€ä¿®æ”¹ä¸º"å¤±è´¥"ï¼Œè®°å½•ä»»åŠ¡å¤±è´¥ä¿¡æ¯ã€‚
            Chart updateChart = new Chart();
            updateChart.setId(chart.getId());
            updateChart.setStatus("running");  // todo  è®¾ç½®æšä¸¾å€¼
            boolean updateChartById = chartService.updateById(updateChart);
            if(!updateChartById) {
//                throw new BusinessException(ErrorCode.OPERATION_ERROR, "å›¾è¡¨çŠ¶æ€æ›´æ–°å¤±è´¥"); // todo
                handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æ‰§è¡Œä¸­çŠ¶æ€Â·å¤±è´¥");
                return;
            }
            // è°ƒç”¨é±¼çš®æ¥å£,æ‹¿åˆ°è¿”å›ç»“æœ
            String result = aiManager.doChat(biModelId,userInput.toString());
            //å¯¹è¿”å›ç»“æœåšæ‹†åˆ†,æŒ‰ç…§5ä¸ªä¸­æ‹¬å·è¿›è¡Œæ‹†åˆ†
            String[] splits = result.split("ã€ã€ã€ã€ã€");
            // æ‹†åˆ†ä¹‹åè¿˜è¦è¿›è¡Œæ ¡éªŒ
            if (splits.length < 3) {
//                throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
                handleChartUpdateError(chart.getId(), "AIç”Ÿæˆé”™è¯¯");
                return;
            }
            String genChart = splits[1].trim();
            String genResult = splits[2].trim();

            Chart updateChartResult = new Chart();
            updateChartResult.setId(chart.getId());
            updateChartResult.setGenResult(genResult);
            updateChartResult.setGenChart(genChart);
            updateChartResult.setStatus("succeed");  // todo  è®¾ç½®æšä¸¾å€¼
            boolean b = chartService.updateById(updateChartResult);
            if(!b) {
//                throw new BusinessException(ErrorCode.OPERATION_ERROR, "å›¾è¡¨çŠ¶æ€æ›´æ–°å¤±è´¥"); // todo
                handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æˆåŠŸçŠ¶æ€Â·å¤±è´¥");
            }

        }, threadPoolExecutor);

        // è¿”å›åˆ°å‰ç«¯
        BiResponse biResponse = new BiResponse();
        biResponse.setChartId(chart.getId());
        return ResultUtils.success(biResponse);
    }

    /**
     * å›¾è¡¨æ›´æ–°é”™è¯¯
     *
     * @param chartId
     * @param execMessage
     */
    private void handleChartUpdateError(long chartId, String execMessage) {
        Chart updateChartResult = new Chart();
        updateChartResult.setId(chartId);
        updateChartResult.setStatus("failed");
        updateChartResult.setExecMessage("execMessageï¼ï¼");
        boolean updateResult = chartService.updateById(updateChartResult);
        if (!updateResult) {
            log.error("æ›´æ–°å›¾è¡¨å¤±è´¥çŠ¶æ€å¤±è´¥" + chartId + "," + execMessage);
        }
    }

    /**
     * æ ¡éªŒæ–‡ä»¶
     *
     * @param multipartFile
     * @param fileUploadBizEnum ä¸šåŠ¡ç±»å‹
     */
    private void validFile(MultipartFile multipartFile, FileUploadBizEnum fileUploadBizEnum) {
        // æ–‡ä»¶å¤§å°
        long fileSize = multipartFile.getSize();
        // æ–‡ä»¶åç¼€
        String fileSuffix = FileUtil.getSuffix(multipartFile.getOriginalFilename());
        final long ONE_M = 1024 * 1024L;
        if (FileUploadBizEnum.USER_AVATAR.equals(fileUploadBizEnum)) {
            if (fileSize > ONE_M) {
                throw new BusinessException(ErrorCode.PARAMS_ERROR, "æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 1M");
            }
            if (!Arrays.asList("jpeg", "jpg", "svg", "png", "webp").contains(fileSuffix)) {
                throw new BusinessException(ErrorCode.PARAMS_ERROR, "æ–‡ä»¶ç±»å‹é”™è¯¯");
            }
        }
    }
}
```
### 4.2 å‰ç«¯å¼€å‘

1.  å¤åˆ¶ä¸€ä¸ªå¼‚æ­¥åˆ›å»ºå›¾è¡¨é¡µé¢ 
2.  ä¿®æ”¹ä¸€ä¸‹è°ƒç”¨çš„æ¥å£ä¸ºå¼‚æ­¥æ¥å£ 
3.  ç§»é™¤æ— ç”¨å…ƒç´ å’Œå˜é‡ 
4.  ä¿®æ”¹æˆåŠŸåçš„æ“ä½œï¼Œæ¯”å¦‚æç¤ºè¯­å’Œé‡ç½®è¡¨å• 
5.  è°ƒæ•´æˆ‘çš„å›¾è¡¨é¡µé¢ï¼Œè¡¥å……é”™è¯¯å¤„ç† 
6.  è°ƒæ•´å›¾è¡¨çš„æŸ¥è¯¢é¡ºåºï¼ŒæŒ‰ç…§åˆ›å»ºæ—¶é—´é™åº 

æ¥åˆ°å‰ç«¯ï¼Œåœ¨ routes.ts å†…æ–°å¢ æ™ºèƒ½åˆ†æ(å¼‚æ­¥) çš„è·¯ç”±ã€‚
```java
export default [
  { name : 'ç™»å½•', path: '/user', layout: false, routes: [{ path: '/user/login', component: './User/Login' }] },
  // { name: 'æ¬¢è¿é¡µé¢', path: '/welcome', icon: 'smile', component: './Welcome' },
  {path: '/', redirect: '/add_chart'},
  { name: 'æ™ºèƒ½åˆ†æ', path: '/add_chart', icon: 'barChart', component: './AddChart' },
  { name: 'æ™ºèƒ½åˆ†æå¼‚æ­¥', path: '/add_chart_async', icon: 'barChart', component: './AddChartAsync' },
  { name: 'æˆ‘çš„å›¾è¡¨', path: '/my_chart', icon: 'pieChart', component: './MyChart' },
  {
    path: '/admin',
    icon: 'crown',
    access: 'canAdmin',
    name : 'ç®¡ç†å‘˜é¡µé¢',
    routes: [
      { path: '/admin', redirect: '/admin/sub-page' },
      { path: '/admin/sub-page', component: './Admin' },
    ],
  },
  { path: '/', redirect: '/welcome' },
  { path: '*', layout: false, component: './404' },
];
```
å¤åˆ¶ pageç›®å½• ä¸‹çš„ AddChartç›®å½• ï¼Œç²˜è´´è‡³ pageç›®å½• ä¸‹ï¼Œå¹¶é‡å‘½åä¸º AddChartAsyn 
c ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723559574682-45b361c7-e3e1-4064-b715-687564da2038.png#averageHue=%23232529&clientId=u6da9e890-ded5-4&from=paste&height=989&id=u75ae6f68&originHeight=1187&originWidth=2469&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=294390&status=done&style=none&taskId=uaf78f743-03e0-43f3-ac1c-69874e6ab16&title=&width=2057.499918242299)
ä¿®æ”¹ æ™ºèƒ½åˆ†æ(å¼‚æ­¥) é¡µé¢ï¼š 
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723559653697-317edcf4-0ee5-4a3b-a884-d2d3163ba531.png#averageHue=%23232529&clientId=u6da9e890-ded5-4&from=paste&height=993&id=u81d67da5&originHeight=1192&originWidth=2530&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=310391&status=done&style=none&taskId=uc2d5fc89-ff9a-4167-8312-f6d1e29ed59&title=&width=2108.333249555697)
ä¿®æ”¹æ³¨é‡Šå’Œé¡µé¢åç§°ã€‚
åˆ é™¤å¤šä½™çš„å¯è§†åŒ–å›¾è¡¨å’Œåˆ†æç»“è®ºã€ä¸€è¡Œä¸¤åˆ—
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723559693002-04f2dcdd-72f8-44ae-8285-4bea7469e157.png#averageHue=%23232529&clientId=u6da9e890-ded5-4&from=paste&height=966&id=u3244cdc6&originHeight=1159&originWidth=2536&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=236728&status=done&style=none&taskId=u4bf48ff9-2c72-46af-a8f0-78c13a9bcda&title=&width=2113.333249357015)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723560371257-e7cb2621-cf6e-4b61-bac6-ab8a9d25b1dd.png#averageHue=%23fdfcfb&clientId=u6da9e890-ded5-4&from=paste&height=354&id=u2f7f95a6&originHeight=425&originWidth=562&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=87268&status=done&style=none&taskId=ue6eed90f-cd96-4f93-9c4d-90d6308ec27&title=&width=468.3333147234394)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723560378983-ec73ff5a-1de5-4fa1-a77e-625b9a5d3183.png#averageHue=%23fdfcfc&clientId=u6da9e890-ded5-4&from=paste&height=402&id=uf66ee3c1&originHeight=482&originWidth=663&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=82141&status=done&style=none&taskId=ue8d2c3a1-95bb-4be7-b5d2-40b80a720e6&title=&width=552.4999780456234)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723560393933-81ea3cec-92f7-4014-8a3f-105f440ebda1.png#averageHue=%23fdfcfc&clientId=u6da9e890-ded5-4&from=paste&height=333&id=ue6e6f0ac&originHeight=400&originWidth=587&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=80780&status=done&style=none&taskId=u9cc42c3a-62a0-4b57-8a49-3fb82f40dc5&title=&width=489.1666472289305)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723560404435-617259af-c8d0-435d-8d3a-36b7df99fb13.png#averageHue=%23fdfcfc&clientId=u6da9e890-ded5-4&from=paste&height=552&id=u66161a9a&originHeight=662&originWidth=667&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=165213&status=done&style=none&taskId=u44dcf3cb-26f3-4c8e-ac12-36a1b57c73a&title=&width=555.8333112465019)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723560415015-b8546d5e-80b8-4450-890d-ebc17a3ea08e.png#averageHue=%23fcfbfb&clientId=u6da9e890-ded5-4&from=paste&height=312&id=u60102730&originHeight=375&originWidth=570&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=85100&status=done&style=none&taskId=u2a9378da-01ec-4f26-b683-1768414ae7d&title=&width=474.9999811251966)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723560430015-6dc4c4ae-cf26-4dec-b19c-1793feff62b0.png#averageHue=%23fcfcfb&clientId=u6da9e890-ded5-4&from=paste&height=547&id=u99db0bea&originHeight=657&originWidth=651&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=191384&status=done&style=none&taskId=ua5a701dd-1163-4387-9bc3-bfecdb2bb43&title=&width=542.4999784429876)
```java
import { UploadOutlined } from '@ant-design/icons';
import {Button, Card, Form, Input, message, Select, Space, Upload} from 'antd';
import TextArea from 'antd/es/input/TextArea';
import React, { useState } from 'react';
import {genChartByAiUsingPost} from "@/services/yubi/chartController";
import {useForm} from "antd/es/form/Form";

/**
 * æ·»åŠ å›¾è¡¨é¡µé¢ï¼ˆå¼‚æ­¥ï¼‰
 * @constructor
 */
const AddChartAsync: React.FC = () => {
    const [form, serForm] = useForm()
    const [submitting, setSubmitting] = useState<boolean>(false);

    /**
     * æäº¤
     * @param values
     */
    const onFinish = async (values: any) => {
        // é¿å…é‡å¤æäº¤
        if (submitting) {
            return;
        }
        setSubmitting(true);
        // å¯¹æ¥åç«¯ï¼Œä¸Šä¼ æ•°æ®
        const params = {
            ...values,
            file: undefined,
        };
        try {
            const res = await genChartByAiUsingPost(params, {}, values.file.file.originFileObj);
            if (!res?.data) {
                message.error('åˆ†æå¤±è´¥');
            } else {
                message.success('åˆ†æä»»åŠ¡æäº¤æˆåŠŸï¼Œç¨åè¯·åœ¨æˆ‘çš„å›¾è¡¨é¡µé¢æŸ¥çœ‹');
                // é‡ç½®æ‰€æœ‰å­—æ®µ
                form.resetFields();
            }
        } catch (e: any) {
            console.log(e.message)
            message.error('åˆ†æå¤±è´¥ï¼Œ' + e.message);
        }
        setSubmitting(false);
    };

    return (
        <div className="add-chart-async">
            <Card title="æ™ºèƒ½åˆ†æ">
                <Form form={form} name="addChart" labelAlign="left" labelCol={{ span: 4 }}
                      wrapperCol={{ span: 16 }} onFinish={onFinish} initialValues={{}}>
                    <Form.Item
                        name="goal"
                        label="åˆ†æç›®æ ‡"
                        rules={[{ required: true, message: 'è¯·è¾“å…¥åˆ†æç›®æ ‡' }]}
                    >
                        <TextArea placeholder="è¯·è¾“å…¥ä½ çš„åˆ†æéœ€æ±‚ï¼Œæ¯”å¦‚ï¼šåˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ" />
                    </Form.Item>
                    <Form.Item name="name" label="å›¾è¡¨åç§°">
                        <Input placeholder="è¯·è¾“å…¥å›¾è¡¨åç§°" />
                    </Form.Item>
                    <Form.Item name="chartType" label="å›¾è¡¨ç±»å‹">
                        <Select
                            options={[
                                { value: 'é¥¼å›¾', label: 'é¥¼å›¾' },
                                { value: 'åœ°å›¾', label: 'åœ°å›¾' },
                                { value: 'æ ‘å›¾', label: 'æ ‘å›¾' },
                                { value: 'æŠ˜çº¿å›¾', label: 'æŠ˜çº¿å›¾' },
                                { value: 'æŸ±çŠ¶å›¾', label: 'æŸ±çŠ¶å›¾' },
                                { value: 'é›·è¾¾å›¾', label: 'é›·è¾¾å›¾' },
                                { value: 'æ¡å½¢å›¾', label: 'æ¡å½¢å›¾' },
                                { value: 'çƒ­åŠ›å›¾', label: 'çƒ­åŠ›å›¾' },
                                { value: 'æ•£ç‚¹å›¾', label: 'æ•£ç‚¹å›¾' },
                                { value: 'ä»ªè¡¨ç›˜', label: 'ä»ªè¡¨ç›˜' },
                                { value: 'Kçº¿å›¾', label: 'Kçº¿å›¾' },
                                { value: 'é•¿å›¾è¡¨', label: 'é•¿å›¾è¡¨' },
                                { value: 'åŒºåŸŸå›¾', label: 'åŒºåŸŸå›¾' },
                                { value: 'é¢ç§¯çƒ­åŠ›å›¾', label: 'é¢ç§¯çƒ­åŠ›å›¾' },
                                { value: 'ä¸‰ç»´æ•£ç‚¹å›¾', label: 'ä¸‰ç»´æ•£ç‚¹å›¾' },
                            ]}
                        />
                    </Form.Item>
                    <Form.Item name="file" label="åŸå§‹æ•°æ®">
                        <Upload name="file" maxCount={1}>
                            <Button icon={<UploadOutlined />}>ä¸Šä¼  CSV æ–‡ä»¶</Button>
                        </Upload>
                    </Form.Item>

                    <Form.Item wrapperCol={{ span: 16, offset: 4 }}>
                        <Space>
                            <Button type="primary" htmlType="submit" loading={submitting} disabled={submitting}>
                                æäº¤
                            </Button>
                            <Button htmlType="reset">é‡ç½®</Button>
                        </Space>
                    </Form.Item>
                </Form>
            </Card>
        </div>
    );
};
export default AddChartAsync;
```
å›åˆ°å‰ç«¯é¡µé¢æµ‹è¯•ä¸€ä¸‹ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723560690405-993ccda2-268c-42ac-a081-89891be4f6ec.png#averageHue=%23f9f9f9&clientId=u6da9e890-ded5-4&from=paste&height=821&id=u6723d305&originHeight=985&originWidth=1904&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=224079&status=done&style=none&taskId=ub5a65038-1d84-4714-9a7d-9d4f80cb87c&title=&width=1586.6666036182005)
åˆ†ææˆåŠŸå¹¶ä¸”æ¸…ç©ºäº†è¡¨å•å†…å®¹ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723561083911-9ec98c6e-68e3-45be-93f6-8c729918b9ee.png#averageHue=%23f8f8f8&clientId=u6da9e890-ded5-4&from=paste&height=823&id=ueb78570a&originHeight=988&originWidth=1894&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=233798&status=done&style=none&taskId=u7fac5560-8f1e-4718-8d4b-6cb35562dc9&title=&width=1578.333270616004)
åœ¨å‰ç«¯ç»ˆç«¯æ‰§è¡Œ yarn run openapi ï¼ŒæŠŠæ•°æ®åº“æ–°å¢çš„å­—æ®µã€æ¥å£è¡¥å……ä¸Šã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723600168411-d9131219-8864-4951-bde8-e2524a9306e8.png#averageHue=%23212327&clientId=u76d1bdba-1d35-4&from=paste&height=332&id=u31e66e10&originHeight=399&originWidth=1428&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=52937&status=done&style=none&taskId=ub966789f-743d-4330-9157-bb51c854698&title=&width=1189.9999527136504)
æ™ºèƒ½åˆ†æ(å¼‚æ­¥) é¡µé¢æ”¹ä¸ºå¼‚æ­¥çš„æ¥å£ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723600474977-ccd60721-7869-41aa-b230-245fefc0312e.png#averageHue=%23232428&clientId=u76d1bdba-1d35-4&from=paste&height=926&id=u16c9ff22&originHeight=1111&originWidth=2377&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=258570&status=done&style=none&taskId=u4643005c-cbbb-45e1-ae28-000439c2d98&title=&width=1980.8332546220918)
ç°åœ¨è¦è®©ç”¨æˆ·åœ¨ æˆ‘çš„å›¾è¡¨ é¡µé¢çœ‹åˆ°ä¸€äº›ç»“æœï¼› 
å¦‚æœå›¾è¡¨ç”ŸæˆæˆåŠŸå°±å±•ç¤ºå›¾è¡¨ï¼Œæ²¡æœ‰ç”ŸæˆæˆåŠŸå°±å±•ç¤ºç°åœ¨çš„çŠ¶æ€(è¿›åº¦æ¡ã€è½¬åœˆåœˆ)ï¼› 
è®¿é—® ant.design ç»„ä»¶åº“ <[https://ant.design/components/result-cn#result-demo-error](https://ant.design/components/result-cn#result-demo-error)> æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰å¤±è´¥çš„ç»„ä»¶ ã€‚
å‘ç°è¿™ä¸ªç»„ä»¶åœ¨ Result é‡Œ
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723600547778-2452a8c4-dec2-43cb-a154-45ed85a52022.png#averageHue=%23fcfbfb&clientId=u76d1bdba-1d35-4&from=paste&height=773&id=u89ced687&originHeight=928&originWidth=1920&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=99146&status=done&style=none&taskId=ub07458a1-877c-4fe7-ad4f-b59dadeb165&title=&width=1599.9999364217147)
å»è°ƒæ•´ æˆ‘çš„å›¾è¡¨ é¡µé¢ã€‚
å»è¡¥å……é”™è¯¯å¤„ç†ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723601214139-b4e5bade-c501-495e-8bf9-d0d73dee2283.png#averageHue=%23242529&clientId=u76d1bdba-1d35-4&from=paste&height=1346&id=u00c1e2e1&originHeight=1615&originWidth=2665&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=329267&status=done&style=none&taskId=u93bdf9f1-5927-4744-aeda-a0d2e921997&title=&width=2220.833245085349)
ç„¶ååœ¨å·¦ä¸‹å›¾çš„å†…å®¹ä¸­åŠ ä¸€å±‚åˆ¤æ–­ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723601292641-d073a1b7-7bd0-4d6a-a5d6-add7c776f144.png#averageHue=%2324262a&clientId=u76d1bdba-1d35-4&from=paste&height=1190&id=u996afb00&originHeight=1428&originWidth=2490&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=385396&status=done&style=none&taskId=u53899090-b01b-49ee-a9f6-cf457d5cdcb&title=&width=2074.9999175469115)
å¦‚æœçŠ¶æ€ä¸º succeedï¼Œæ‰ä¼šè§£æå›¾è¡¨ä»£ç ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723601421741-d9fc7f35-74c7-4d41-b5ac-a23787ac3338.png#averageHue=%23242629&clientId=u76d1bdba-1d35-4&from=paste&height=1152&id=u8af31976&originHeight=1383&originWidth=2518&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=369760&status=done&style=none&taskId=ud8b1f684-175c-44b4-a171-e4c06f2a342&title=&width=2098.3332499530616)
```java
import { useModel } from '@@/exports';
import { ExclamationCircleOutlined } from '@ant-design/icons';
import { Avatar, Button, Card, Col, Divider, List, message, Modal, Row } from 'antd';
import Search from 'antd/es/input/Search';
import ReactECharts from 'echarts-for-react';
import React, { useEffect, useState } from 'react';
import {deleteChartUsingPost, listMyChartByPageUsingPost} from "@/services/yubi/chartController";

const MyChartPage: React.FC = () => {
    /**
     * åˆå§‹å€¼
     */
    const initSearchParams = {
        current: 1,
        pageSize: 6,
    };
    // å½“å‰çš„æœç´¢å‚æ•°
    const [searchParams, setSearchParams] = useState<API.ChartQueryRequest>({
        ...initSearchParams,
    });

    // const [selectedChartId, setSelectedChartId] = useState<number | undefined>(undefined);

    /**
     * åˆ†é¡µè·å–å›¾è¡¨
     */
    // å­˜å‚¨è¿”å›çš„å›¾è¡¨åˆ—è¡¨
    const [chartList, setChartList] = useState<API.Chart[]>();
    // å›¾è¡¨æ€»æ•°
    const [chartTotal, setChartTotal] = useState<number>(0);
    // åŠ è½½çŠ¶æ€
    const [loading, setLoading] = useState<boolean>(true);
    /**
     * è·å–å½“å‰ç”¨æˆ·
     */
    const { initialState } = useModel('@@initialState');
    const { currentUser } = initialState || {};

    /**
     * åˆ é™¤å›¾è¡¨
     * @param chartId
     */
    const handleDelete = (chartId: any) => {
        Modal.confirm({
            title: 'ç¡®è®¤åˆ é™¤',
            icon: <ExclamationCircleOutlined />,
            content: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå›¾è¡¨å—ï¼Ÿ',
            okText: 'ç¡®è®¤',
            cancelText: 'å–æ¶ˆ',
            onOk: async () => {
                try {
                    // const res = await deleteChartUsingPost({ id: chartId });
                    const res = await deleteChartUsingPost({ id: chartId });
                    // åç«¯è¿”å› booleanå€¼
                    console.log("res:",res.data);
                    if (res.data) {
                        message.success('åˆ é™¤æˆåŠŸ');
                        // åˆ é™¤æˆåŠŸåé‡æ–°åŠ è½½å›¾è¡¨æ•°æ®
                        loadData();
                    } else {
                        message.error('åˆ é™¤å¤±è´¥');
                    }
                } catch (e: any) {
                    message.error('åˆ é™¤å¤±è´¥' + e.message);
                }
            },
        });
    };

    /**
     * åŠ è½½å›¾è¡¨æ•°æ®
     */
    const loadData = async () => {
        setLoading(loading);
        try {
            // let res = await listMyChartByPageUsingPOST(searchParams);
            let res = await listMyChartByPageUsingPost(searchParams);
            if (res.data) {
                setChartList(res.data.records ?? []);
                setChartTotal(res.data.total ?? 0);
                // éšè—title
                if (res.data.records) {
                    res.data.records.forEach((data) => {
                        // å¦‚æœçŠ¶æ€ä¸ºsucceedï¼Œæ‰ä¼šè§£æå›¾è¡¨ä»£ç 
                        if(data.status === 'succeed'){
                          let jsonString = data.genChart ?? '{}';
                          // æ›¿æ¢å•å¼•å·ä¸ºåŒå¼•å·
                          jsonString = jsonString.replace(/'/g, '"');
                          // å¤„ç†ä¸ç¬¦åˆ JSON è§„èŒƒçš„å†…å®¹
                          // æ¯”å¦‚æ›¿æ¢å¯èƒ½çš„é”™è¯¯æ ¼å¼ (key: value) ä¸º ("key": "value")
                          jsonString = jsonString.replace(/([{,]\s*)(\w+)\s*:/g, '$1"$2":');
                          jsonString = jsonString.replace(/: (\w+)/g, ': "$1"');

                          // const chartOption = JSON.parse(data.genChart ?? '{}');
                          const chartOption = JSON.parse(jsonString);
                          // å–å‡ºtitleå¹¶ä¸”è®¾ç½®ä¸º undefined
                          chartOption.title = undefined;
                          data.genChart = JSON.stringify(chartOption);
                        }
                    });
                }
            } else {
                message.error('è·å–æˆ‘çš„å›¾è¡¨å¤±è´¥');
            }
        } catch (e: any) {
            message.error('è·å–æˆ‘çš„å›¾è¡¨å¤±è´¥' + e.message);
        }
        setLoading(false);
    };
    /**
     * å˜åŒ–æ—¶æ‰§è¡Œæ­¤å¤„
     */
    useEffect(() => {
        loadData();
    }, [searchParams]);

    return (
        <div className="my-chart-page">
            <div className="margin-20">
                <Search
                    placeholder="è¯·è¾“å…¥å›¾æ ‡åç§°æœç´¢"
                    loading={loading}
                    enterButton
                    onSearch={(value) => {
                        setSearchParams({
                            ...initSearchParams,
                            name: value,
                        });
                    }}
                />
            </div>
            <div className="margin-16"></div>
            <List
                grid={{
                    gutter: 16,
                    xs: 1,
                    sm: 1,
                    md: 1,
                    lg: 2,
                    xl: 2,
                    xxl: 2,
                }}
                pagination={{
                    // è®¾ç½®åˆ†é¡µ
                    showTotal: () => `å…± ${chartTotal} æ¡è®°å½•`,
                    showSizeChanger: true,
                    showQuickJumper: true,
                    pageSizeOptions: ['6', '10', '14', '20'],
                    onChange: (page, pageSize) => {
                        setSearchParams({
                            ...searchParams,
                            current: page,
                            pageSize,
                        });
                    },
                    current: searchParams.current, // å½“å‰é¡µ
                    pageSize: searchParams.pageSize, // æ¯é¡µæ¡æ•°
                    total: chartTotal, // æ€»æ•°
                }}
                loading={loading}
                dataSource={chartList}
                renderItem={(item) => (
                    <List.Item key={item.id}>
                        <Card style={{ width: '100%' }}>
                            <List.Item.Meta
                                avatar={<Avatar src={currentUser?.userAvatar} />}
                                // title={currentUser?.userName}
                                title={item.name}
                                description={item.chartType ? 'å›¾è¡¨ç±»å‹ï¼š' + item.chartType : undefined}
                            />
                            <>
                              {
                                item.status === 'wait' && <>
                                  <Result
                                    status="warning"
                                    title="å¾…ç”Ÿæˆ"
                                    subTitle={item.execMessage ?? 'å½“å‰å¦‚è¡¨ç”Ÿæˆé˜Ÿåˆ—ç¹å¿™ï¼Œè¯·è€å¿ƒç­‰å€™'}
                                  />
                                </>
                              }
                              {
                                item.status === 'running' && <>
                                  <Result
                                    status="info"
                                    title="å›¾è¡¨ç”Ÿæˆä¸­"
                                    subTitle={item.execMessage}
                                  />
                                </>
                              }
                              {
                                item.status === 'succeed' && <>
                                  {/*<p*/}
                                  {/*    style={{*/}
                                  {/*        textAlign: 'left',*/}
                                  {/*        fontWeight: 'bold',*/}
                                  {/*        color: 'black',*/}
                                  {/*        fontSize: '16px',*/}
                                  {/*    }}*/}
                                  {/*>*/}
                                  {/*    {'åˆ†æç›®æ ‡ï¼š' + item.goal}*/}
                                  {/*</p>*/}
                                  {/*<List.Item.Meta*/}
                                  {/*    style={{ textAlign: 'left' }}*/}
                                  {/*    description={item.chartType ? 'å›¾è¡¨ç±»å‹ï¼š' + item.chartType : undefined}*/}
                                  {/*/>*/}
                                  <ReactECharts option={item.genChart && JSON.parse(item.genChart)} />
                                  {/*<p*/}
                                  {/*    style={{*/}
                                  {/*        textAlign: 'center',*/}
                                  {/*        fontWeight: 'bold',*/}
                                  {/*        color: '#e617ff',*/}
                                  {/*        fontSize: '16px',*/}
                                  {/*    }}*/}
                                  {/*>*/}
                                  {/*    {'å›¾è¡¨åç§°ï¼š' + item.name}*/}
                                  {/*</p>*/}
                                  <Divider style={{ fontWeight: 'bold', color: 'blue', fontSize: '16px' }}>
                                    æ™ºèƒ½åˆ†æç»“æœ
                                  </Divider>
                                  <p style={{ fontWeight: 'bold', color: '#0b93a1' }}>{item.genResult}</p>
                                  <Row justify="end">
                                    <Col>
                                      <Button danger onClick={() => handleDelete(item.id)}>
                                        åˆ é™¤
                                      </Button>
                                    </Col>
                                  </Row>
                                </>
                              }
                              {
                                item.status === 'failed' && <>
                                  <Result
                                    status="error"
                                    title="å›¾è¡¨ç”Ÿæˆå¤±è´¥"
                                    subTitle={item.execMessage}
                                  />
                                </>
                              }
                            </>
                        </Card>
                    </List.Item>
                )}
            />
        </div>
    );
};
export default MyChartPage;
```
æ¥åˆ°å‰ç«¯é¡µé¢ï¼Œçœ‹ä¸€ä¸‹æ•ˆæœï¼Œå…ˆè¾“å…¥åˆ†æçš„å†…å®¹ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723601888603-4cd6529c-a979-4da0-98a8-5f7f6d1c9e17.png#averageHue=%23f9f9f9&clientId=u76d1bdba-1d35-4&from=paste&height=818&id=ud6667fe5&originHeight=982&originWidth=1909&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=223675&status=done&style=none&taskId=ud5c63eb6-05e4-40ca-a0eb-c85e06aba21&title=&width=1590.8332701192987)
ç„¶åç‚¹å‡» æ™ºèƒ½åˆ†æ(å¼‚æ­¥) é¡µé¢çš„æäº¤ æŒ‰é’®ï¼Œç„¶åç‚¹å‡»æˆ‘çš„å›¾è¡¨ é¡µé¢ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°å›¾è¡¨æ­£ 
åœ¨ç”Ÿæˆã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723601919375-44069b27-3a45-48b1-b9e3-69506202d9bb.png#averageHue=%23f7f7f7&clientId=u76d1bdba-1d35-4&from=paste&height=822&id=ua569d643&originHeight=986&originWidth=1918&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=359328&status=done&style=none&taskId=ud1a6671a-9716-461c-a5e9-d2a25d15ae6&title=&width=1598.3332698212755)
ç­‰ä¸€ä¼šï¼ŒæŒ‰ F5 åˆ·æ–°é¡µé¢ï¼Œç„¶åå°±çœ‹è§å›¾è¡¨ç”Ÿæˆå‡ºæ¥ï¼› 
åœ¨è¿™ç­‰å¾…çš„è¿‡ç¨‹ä¸­å¯ä»¥å»åšå…¶ä»–äº‹ï¼Œæ¯”å¦‚å»ç”Ÿæˆæ–°çš„å›¾è¡¨ç­‰ç­‰ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723601941644-d35681c6-fb50-46b3-b447-57ac3637a537.png#averageHue=%23f9f9f8&clientId=u76d1bdba-1d35-4&from=paste&height=821&id=uca2c56fb&originHeight=985&originWidth=1910&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=354791&status=done&style=none&taskId=uc34addd9-695f-4b26-b414-0be572853b2&title=&width=1591.6666034195184)
ç„¶åè°ƒæ•´å›¾è¡¨çš„æŸ¥è¯¢é¡ºåºï¼ŒæŒ‰ç…§åˆ›å»ºæ—¶é—´é™åºã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723602073781-95e2cd2e-fd44-43ab-901c-6b60e94595c8.png#averageHue=%2324262a&clientId=u76d1bdba-1d35-4&from=paste&height=1245&id=u9067eef9&originHeight=1494&originWidth=2787&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=325686&status=done&style=none&taskId=u38570619-c5e4-43b4-8294-4e2fad1dd9a&title=&width=2322.499907712145)
### 4.3 ä¼˜åŒ–ç‚¹

1. guava Retrying é‡è¯•æœºåˆ¶
2. æå‰è€ƒè™‘åˆ°AIç”Ÿæˆé”™è¯¯ï¼Œåœ¨åç«¯è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ˆæ¯”å¦‚AIè¯´äº†å¤šä½™çš„è¯ï¼Œæå‰æ­£ç¡®çš„å­—ç¬¦ä¸²ï¼‰
3. å¦‚æœè¯´ä»»åŠ¡æ ¹æœ¬æ²¡æäº¤åˆ°é˜Ÿåˆ—ä¸­ï¼ˆæˆ–è€…é˜Ÿåˆ—æ»¡äº†ï¼‰ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç”¨å®šæ—¶ä»»åŠ¡æŠŠå¤±è´¥çŠ¶æ€çš„å›¾è¡¨æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼ˆè¡¥å¿ï¼‰
4. å»ºè®®ç»™ä»»åŠ¡çš„æ‰§è¡Œå¢åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶è‡ªåŠ¨æ ‡è®°ä¸ºå¤±è´¥ï¼ˆè¶…æ—¶æ§åˆ¶ï¼‰
5. åå‘å‹åŠ›ï¼š[https://zhuanlan.zhihu.com/p/404993753](https://zhuanlan.zhihu.com/p/404993753) é€šè¿‡è°ƒç”¨çš„æœåŠ¡çŠ¶æ€æ¥é€‰æ‹©å½“å‰ç³»ç»Ÿçš„ç­–ç•¥ï¼ˆæ¯”å¦‚æ ¹æ®AIæœåŠ¡çš„å½“å‰ä»»åŠ¡é˜Ÿåˆ—æ•°æ¥æ§åˆ¶è¯¥ç³»ç»Ÿçš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼‰ï¼Œä»è€Œæœ€å¤§åŒ–åˆ©ç”¨ç³»ç»Ÿèµ„æº
6. æˆ‘çš„å›¾è¡¨é¡µé¢å¢åŠ ä¸€ä¸ªåˆ·æ–°ã€å®šæ—¶è‡ªåŠ¨åˆ·æ–°çš„æŒ‰é’®ï¼Œä¿è¯è·å–åˆ°å›¾è¡¨çš„æœ€æ–°çŠ¶æ€ï¼ˆå‰ç«¯è½®è¯¢ï¼‰
7. ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥ï¼Œç»™ç”¨æˆ·å‘é€å®æ—¶æ¶ˆæ¯é€šçŸ¥ï¼ˆå®æ—¶ï¼šwebsocketã€server side eventï¼‰
> è‚¯å®šæœ‰äº›åŒå­¦ä¼šå€¾å‘äºåŒæ­¥æ–¹å¼ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥éšæ—¶æŸ¥çœ‹ç»“æœï¼Œå³ä½¿å¯èƒ½éœ€è¦ç­‰å¾…åå‡ ç§’æˆ–è€…20 ç§’ã€‚ç„¶è€Œï¼Œå¦ä¸€äº›åŒå­¦å¯èƒ½ä¼šè§‰å¾—å¦‚æœéœ€è¦ç­‰å¾…ä¸€åˆ†é’Ÿæˆ–è€…äº”åˆ†é’Ÿçš„è¯ï¼Œå¼‚æ­¥æ–¹å¼å¯èƒ½ä¼šæ›´åˆé€‚ã€‚å®é™…ä¸Šï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©å®æ—¶æ›´æ–°ï¼Œæ¯”å¦‚æ¯éš”å‡ ç§’åˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼Œè‡ªåŠ¨è·å–æ–°ç»“æœã€‚æ‰¹é‡å¼‚æ­¥ä¹Ÿæ˜¯ä¸€ç§å¯è¡Œçš„æ–¹å¼ã€‚ 
> å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç­–ç•¥ã€‚ä½ å¯ä»¥æ ¹æ®ç³»ç»Ÿå½“å‰çš„è´Ÿè½½åŠ¨æ€åœ°è°ƒæ•´ç”¨æˆ·æŸ¥è¯¢çš„å¤„ç†æ–¹å¼ã€‚æ¯”å¦‚ï¼Œå¦‚æœç³»ç»Ÿå½“å‰çŠ¶æ€è‰¯å¥½ï¼Œå°±å¯ä»¥é€‰æ‹©åŒæ­¥è¿”å›ç»“æœã€‚è€Œå¦‚æœç”¨æˆ·æäº¤è¯·æ±‚åå‘ç°ç³»ç»Ÿéå¸¸ç¹å¿™ï¼Œé¢„è®¡éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©å¼‚æ­¥å¤„ç†æ–¹å¼ã€‚è¿™ç§æ€è€ƒæ–¹å¼åœ¨å®é™…çš„ä¼ä¸šé¡¹ç›®å¼€å‘ä¸­ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ã€‚ 
> é™¤äº†åˆšåˆšæåˆ°çš„ä¸€äº›ç‚¹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å®šæ—¶ä»»åŠ¡æ¥å¤„ç†å¤±è´¥çš„å›¾è¡¨ï¼Œæ·»åŠ é‡è¯•æœºåˆ¶ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ›´ç²¾ç¡®åœ°é¢„è§AIç”Ÿæˆé”™è¯¯ï¼Œå¹¶åœ¨åç«¯è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œå¦‚æå–æ­£ç¡®çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼ŒAI è¯´ä¸€äº›å¤šä½™çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦æå–å‡ºæ­£ç¡®çš„ä¿¡æ¯ã€‚åŒæ—¶ï¼Œå¦‚æœä»»åŠ¡æ²¡æœ‰æäº¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®šæ—¶ä»»åŠ¡å°†å…¶æå–å‡ºæ¥ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºä»»åŠ¡å¢åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚å¦‚æœè¶…æ—¶ï¼Œä»»åŠ¡å°†è‡ªåŠ¨æ ‡è®°ä¸ºå¤±è´¥ï¼Œè¿™å°±æ˜¯è¶…æ—¶æ§åˆ¶ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚å¯¹äº AI ç”Ÿæˆçš„è„æ•°æ®ï¼Œä¼šå¯¼è‡´æœ€åå‡ºç°é”™è¯¯ï¼Œå› æ­¤å‰ç«¯ä¹Ÿéœ€è¦è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œä¸èƒ½ä»…ä»…ä¾èµ–äºåç«¯ã€‚
> ğŸŸä¹‹å‰å†™è¿‡ä¸€ç¯‡å…³äº**åå‘å‹åŠ›çš„æ–‡ç« ** <https://zhuanlan.zhihu.com/p/404993753> ï¼Œå¯ä»¥çœ‹ ä¸€ä¸‹ã€‚åˆšåˆšæåˆ°äº†ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯åœ¨ç³»ç»Ÿå‹åŠ›å¤§çš„æ—¶å€™ï¼Œä½¿ç”¨å¼‚æ­¥ï¼Œè€Œåœ¨ç³»ç»Ÿå‹åŠ›å°çš„æ—¶å€™ï¼Œä½¿ç”¨åŒæ­¥ï¼Œè¿™å°±æ˜¯åå‘å‹åŠ›çš„æ¦‚å¿µã€‚
> è¿›ä¸€æ­¥æ‰©å±•ä¸€ä¸‹ï¼Œå…³äºæˆ‘ä»¬çš„çº¿ç¨‹æ± ï¼Œç°åœ¨çš„æ ¸å¿ƒå‚æ•°ä¸æ˜¯è®¾å®šä¸ºäºŒå˜›ã€‚å®é™…ä¸Šï¼Œå¦‚æœ AI æœ€å¤šå…è®¸å››ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥æå‰ç¡®è®¤ AI å½“å‰çš„ä¸šåŠ¡æ˜¯å¦ç¹å¿™ï¼Œå³æˆ‘ä»¬è°ƒç”¨çš„ç¬¬ä¸‰æ–¹API æ˜¯å¦è¿˜æœ‰å¤šä½™çš„èµ„æºç»™æˆ‘ä»¬ä½¿ç”¨ã€‚å¦‚æœä»–è¡¨ç¤ºèµ„æºå·²ç»è€—å°½ï¼Œæˆ‘ä»¬ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œæ˜¯å¦å¯ä»¥å°†æ ¸å¿ƒçº¿ç¨‹æ•°è°ƒå°ä¸€äº›ã€‚åä¹‹ï¼Œå¦‚æœæˆ‘ä»¬è¯¢é—® AI ç¬¬ä¸‰æ–¹å¹¶å‘ç°å®ƒçš„çŠ¶æ€æ˜¯ç©ºé—²ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥å°†æ ¸å¿ƒçº¿ç¨‹æ•°å¢åŠ ï¼Œä»¥æ­¤æ¥æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚è¿™ç§é€šè¿‡ä¸‹æ¸¸æœåŠ¡æ¥è°ƒæ•´ä½ çš„ä¸šåŠ¡ä»¥åŠæ ¸å¿ƒçº¿ç¨‹æ± å‚æ•°ï¼Œè¿›è€Œæ”¹å˜ä½ çš„ç³»ç»Ÿç­–ç•¥çš„æ–¹å¼å°±æ˜¯åå‘å‹åŠ›ã€‚
> ä¾‹å¦‚ï¼Œä½ å‘ç°å½“å‰ AI æœåŠ¡çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­æ²¡æœ‰ä»»ä½•äººæäº¤ä»»åŠ¡ï¼Œé‚£ä¹ˆä½ æ˜¯å¦å¯ä»¥æé«˜ä½¿ç”¨ç‡ã€‚è¿™å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç‚¹ï¼Œå¦‚æœä½ èƒ½åœ¨ç®€å†ä¸Šå†™åˆ°åå‘å‹åŠ›ï¼Œå°†ä¼šæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„åŠ åˆ†é¡¹ã€‚åå‘å‹åŠ›å…¶å®æ˜¯æˆ‘ä»¬åœ¨åšå¤§æ•°æ®ç³»ç»Ÿä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨åšå®æ—¶æ•°æ®æµç³»ç»Ÿæ—¶ç»å¸¸ä¼šç”¨åˆ°çš„ä¸€ä¸ªæœ¯è¯­ã€‚æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥åï¼Œç»™ç”¨æˆ·å‘é€æ¶ˆæ¯é€šçŸ¥ã€‚æ¯”å¦‚è¯´ï¼Œåœ¨å›¾è¡¨é¡µé¢å¢åŠ ä¸€ä¸ªåˆ·æ–°æˆ–è€…å®šæ—¶è‡ªåŠ¨åˆ·æ–°çš„æŒ‰é’®ï¼Œä»¥ä¿è¯ç”¨æˆ·èƒ½å¤Ÿè·å–åˆ°å›¾è¡¨çš„æœ€æ–°çŠ¶æ€ã€‚è¿™å°±æ˜¯å‰ç«¯è½®è¯¢çš„æŠ€æœ¯ã€‚è¿˜æœ‰å°±æ˜¯åœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç”¨æˆ·å‘é€æ¶ˆæ¯é€šçŸ¥ï¼Œè™½ç„¶è¿™å¯èƒ½æ¯”è¾ƒå¤æ‚ã€‚è¿™ä¸œè¥¿åé¢ğŸŸå¯èƒ½ä¼šå¸¦å¤§å®¶åšè¿™ä¸ªç³»ç»Ÿã€‚ä½†æ˜¯åœ¨çŸ­æœŸå†…ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å°è¯•å®ç°ï¼Œå¦‚é€šè¿‡æ•°æ®åº“è®°å½•æ¶ˆæ¯ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹å¼ã€‚å½“ç„¶è¿˜æœ‰å…¶ä»–çš„æ–¹å¼ï¼Œå¦‚ websocket å®æ—¶é€šçŸ¥æˆ–è€… server side eventï¼Œè¿™éƒ½æ˜¯å®æ—¶çš„ã€‚

# ç¬¬å…­ã€ä¸ƒæœŸ - æ¶ˆæ¯é˜Ÿåˆ—
## 1ã€åˆ†æå½“å‰ç³»ç»Ÿçš„ä¸è¶³
> ç³»ç»Ÿä¸è¶³ï¼šåªæ˜¯åœ¨å•æœºç³»ç»Ÿä¸Šè¿›è¡Œæ“ä½œ

é€šè¿‡ç¬¬äº”æœŸçš„ç›´æ’­ï¼Œå·²ç»ç»è¿‡äº†åŒæ­¥åˆ°å¼‚æ­¥çš„æ”¹é€ ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨é—®é¢˜ã€‚
å¼‚æ­¥å®ç°ç°çŠ¶ï¼šç›®å‰çš„å¼‚æ­¥æ˜¯é€šè¿‡æœ¬åœ°çš„çº¿ç¨‹æ± å®ç°çš„ã€‚
> é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹ç›®å‰ç³»ç»Ÿå­˜åœ¨çš„ä¸è¶³ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿå·²ç»å®Œæˆä»åŒæ­¥åˆ°å¼‚æ­¥çš„è½¬å˜ã€‚ä¸ºä»€ä¹ˆéœ€è¦æ”¹å˜å‘¢ï¼Ÿå› ä¸º AI æ¨¡å‹åˆ†æé€Ÿåº¦è¾ƒæ…¢ï¼Œç”Ÿæˆå›¾è¡¨å¯èƒ½éœ€è¦åå‡ ç§’æˆ–æ›´é•¿çš„æ—¶é—´ã€‚è™½ç„¶OpenAI æœ€è¿‘å·²ç»ä¼˜åŒ–äº†å…¶äººå·¥æ™ºèƒ½æœåŠ¡çš„æ•ˆç‡ï¼Œä½†å½“ç³»ç»Ÿç”¨æˆ·é‡å¤§æ—¶ï¼Œä»å¯èƒ½å‡ºç°ç³»ç»Ÿèµ„æºä¸è¶³æˆ– AI æœåŠ¡ç”Ÿæˆé€Ÿåº¦è·Ÿä¸ä¸Šçš„æƒ…å†µï¼Œè¿™ä¼šå¯¼è‡´ç³»ç»Ÿç“¶é¢ˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬é‡‡ç”¨å¼‚æ­¥å¤„ç†ï¼Œä»¥æé«˜ç”¨æˆ·ä½“éªŒã€åŠæ—¶åé¦ˆã€‚

### 1.1 æ— æ³•é›†ä¸­é™åˆ¶ï¼Œåªèƒ½å•æœºé™åˆ¶
å‡å¦‚ AI æœåŠ¡é™åˆ¶åªæœ‰2ä¸ªç”¨æˆ·åŒæ—¶ä½¿ç”¨ï¼Œå•ä¸ªçº¿ç¨‹æ± å¯ä»¥é™åˆ¶æœ€å¤§æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º2æ¥å®ç°ã€‚
å‡è®¾ç³»ç»Ÿç”¨é‡å¢å¤§ï¼Œæ”¹ä¸ºåˆ†å¸ƒå¼ï¼Œå¤šå°æœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½è¦æœ‰2ä¸ªçº¿ç¨‹ï¼Œå°±æœ‰å¯èƒ½æœ‰2Nä¸ªçº¿ç¨‹ï¼Œè¶…è¿‡äº†AI æœåŠ¡çš„é™åˆ¶ã€‚

- è§£å†³æ–¹æ¡ˆï¼šåœ¨ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹å»ç®¡ç†ä¸‹å‘ä»»åŠ¡ï¼ˆæ¯”å¦‚é›†ä¸­å­˜å‚¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ•°ï¼‰
### 1.2 ä»»åŠ¡ç”±äºæ˜¯æ”¾åœ¨å†…å­˜ä¸­æ‰§è¡Œçš„ï¼Œå¯èƒ½ä¼šä¸¢å¤±
è™½ç„¶å¯ä»¥äººå·¥ä»æ•°æ®åº“æå‡ºæ¥å†é‡è¯•ï¼Œä½†æ˜¯å…¶å®éœ€è¦é¢å¤–å¼€å‘ï¼ˆæ¯”å¦‚å®šæ—¶ä»»åŠ¡ï¼‰ï¼Œè¿™ç§é‡è¯•çš„åœºæ™¯æ˜¯éå¸¸å…¸å‹çš„ï¼Œå…¶å®æ˜¯ä¸éœ€è¦æˆ‘ä»¬å¼€å‘è€…è¿‡äºå…³å¿ƒã€æˆ–è€…è‡ªå·±å®ç°çš„ã€‚

- è§£å†³æ–¹æ¡ˆï¼šæŠŠä»»åŠ¡æ”¾åœ¨ä¸€ä¸ªå¯ä»¥æŒä¹…åŒ–å­˜å‚¨çš„ç¡¬ç›˜
> **ç›®å‰çš„ä»»åŠ¡æ•°æ®æ˜¯å­˜åœ¨å“ªé‡Œçš„ï¼Ÿ**å³ä½¿ä»»åŠ¡åœ¨æ•°æ®åº“å­˜å‚¨ï¼Œä½†å¦‚æœæ‰§è¡Œåˆ°ä¸€åŠï¼ŒæœåŠ¡å™¨å®•æœºï¼Œä»»åŠ¡å¯èƒ½å°±ä¼šä¸¢å¤±ã€‚è™½ç„¶å¯ä»¥ä»æ•°æ®åº“ä¸­é‡æ–°è¯»å–ï¼Œä½†è¿™éœ€è¦é¢å¤–çš„ç¼–ç å·¥ä½œï¼Œè€Œä¸”åœ¨ç³»ç»Ÿå¤æ‚åº¦å¢åŠ æ—¶ï¼Œå®ç°ä»»åŠ¡é‡è¯•æˆ–ä¸¢å¤±æ¢å¤çš„ç¼–ç å·¥ä½œæˆæœ¬è¾ƒé«˜ã€‚å› æ­¤ï¼Œç”±äºä»»åŠ¡æ˜¯åœ¨å†…å­˜ä¸­ 
> æ‰§è¡Œï¼Œå°±æœ‰å¯èƒ½ä¼šä¸¢å¤±ï¼Œå°½ç®¡å¯ä»¥ä»æ•°æ®åº“æ‰‹åŠ¨æ¢å¤å¹¶é‡è¯•ï¼Œä½†è¿™éœ€è¦é¢å¤–å¼€å‘ã€‚
> æ­¤å¤–ï¼Œéšç€ç³»ç»ŸåŠŸèƒ½çš„å¢å¤šï¼Œä¾‹å¦‚ AI å¯¹è¯å’Œ AI ç»˜ç”»ï¼Œå¦‚æœæˆ‘ä»¬è¿˜è¦å¢åŠ æ›´å¤šçš„é•¿æ—¶é—´è€—æ—¶ä»»åŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½éœ€è¦å¼€è¾Ÿæ›´å¤šçš„çº¿ç¨‹æ± ï¼Œè¿™å°†ä½¿ç³»ç»Ÿå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†ä¸€äº›è€—æ—¶çš„ä»»åŠ¡æˆ–åŠŸèƒ½å•ç‹¬æŠ½å–å‡ºæ¥ï¼Œè¿™å°±æ˜¯å¾®æœåŠ¡çš„æ€æƒ³ã€‚å°†è¿™äº›è€—æ—¶ä»»åŠ¡å•ç‹¬æå–å‡ºæ¥ï¼Œæ—¢ä¸å½±å“ä¸»ä¸šåŠ¡ï¼Œåˆå¯ä»¥ä½¿æˆ‘ä»¬çš„æ ¸å¿ƒç³»ç»Ÿæ›´åŠ å®‰å…¨ã€ç¨³å®šå’Œæ¸…æ™°ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä¼˜åŒ–çš„ä¸€ä¸ªæ–¹é¢å°±æ˜¯æœåŠ¡æ‹†åˆ†æˆ–åº”ç”¨è§£è€¦ã€‚

### 1.3 ä¼˜åŒ–
å¦‚æœä½ çš„ç³»ç»ŸåŠŸè¶Šæ¥è¶Šå¤šï¼Œé•¿è€—æ—¶ä»»åŠ¡è¶Šæ¥è¶Šå¤šï¼Œç³»ç»Ÿä¼šè¶Šæ¥è¶Šå¤æ‚ï¼ˆæ¯”å¦‚è¦å¼€å¤šä¸ªçº¿ç¨‹æ± ã€èµ„æºå¯èƒ½ä¼šå‡ºç°é¡¹ç›®æŠ¢å )ã€‚

- æœåŠ¡æ‹†åˆ†ï¼ˆåº”ç”¨è§£è€¦ï¼‰ï¼šå…¶å®æˆ‘ä»¬å¯ä»¥æŠŠé•¿è€—æ—¶ã€æ¶ˆè€—å¾ˆå¤šçš„ä»»åŠ¡æŠŠå®ƒå•ç‹¬æŠ½æˆä¸€ä¸ªç¨‹åºï¼Œä¸è¦å½±å“ä¸»ä¸šåŠ¡ã€‚
- è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥æœ‰ä¸€ä¸ªä¸­é—´äººï¼Œè®©ä¸­é—´äººå¸®æˆ‘ä»¬å»è¿æ¥ä¸¤ä¸ªç³»ç»Ÿï¼ˆæ¯”å¦‚æ ¸å¿ƒç³»ç»Ÿå’Œæ™ºèƒ½ç”Ÿæˆä¸šåŠ¡ï¼‰
## 2ã€åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—
### 2.1 ä¸­é—´ä»¶
> è¿æ¥å¤šä¸ªç³»ç»Ÿï¼Œå¸®åŠ©å¤šä¸ªç³»ç»Ÿç´§å¯†åä½œçš„æŠ€æœ¯ï¼ˆæˆ–è€…ç»„ä»¶ï¼‰ã€‚

æ¯”å¦‚ï¼šRedisã€æ¶ˆæ¯é˜Ÿåˆ—ã€åˆ†å¸ƒå¼å­˜å‚¨Etcd
**ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶ï¼Ÿ**å¯ä»¥å°†å…¶è§†ä¸ºåœ¨å¼€å‘ç³»ç»Ÿæˆ–å¤šä¸ªåº”ç”¨æ—¶ï¼Œç”¨äºè¿æ¥å¤šä¸ªç³»ç»Ÿæˆ–ä½¿å¤šä¸ªç³»ç»Ÿç´§å¯†å ä½œçš„å·¥å…·ã€‚å¸¸ç”¨çš„ä¸­é—´ä»¶åŒ…æ‹¬ Redisï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä»¥åŠåˆ†å¸ƒå¼å­˜å‚¨å¦‚ ETCD ç­‰ã€‚
äº‹å®ä¸Šï¼Œå¦‚æœéè¦å®šä¹‰ï¼Œæ•°æ®åº“ä¹Ÿå¯ä»¥è¢«è§†ä¸ºä¸€ç§ä¸­é—´ä»¶ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªç³»ç»Ÿï¼Œç³»ç»Ÿ A å’Œç³»ç»Ÿ Bï¼Œä»–ä»¬éœ€è¦å…±äº«åŒä¸€ä»½æ•°æ®ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œè¿™æ ·ï¼Œæ•°æ®åº“å°±åƒæ˜¯è¿æ¥è¿™ä¸¤ä¸ªç³»ç»Ÿçš„â€œä¸­é—´äººâ€ï¼Œå³æ»¡è¶³ä¸­é—´ä»¶çš„å®šä¹‰ã€‚
åœ¨ NodeJS ä¸­ï¼Œä¸­é—´ä»¶çš„å«ä¹‰ç¨æœ‰ä¸åŒï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨ä¸å½±å“ä¸šåŠ¡é€»è¾‘çš„å‰æä¸‹ï¼Œå¢å¼ºç³»ç»ŸåŠŸèƒ½çš„å·¥å…·ï¼Œè¿æ¥é€šç”¨åŠŸèƒ½å’Œç³»ç»Ÿã€‚
ä»¥æ™ºèƒ½ BI åå°ä¸ºä¾‹ï¼ŒåŸæœ‰çš„ç³»ç»ŸåŒ…æ‹¬ç”¨æˆ·ç®¡ç†å’Œå›¾è¡¨ç®¡ç†ç­‰ã€‚éšç€ç³»ç»Ÿåº”ç”¨é‡çš„å¢åŠ ï¼Œæ™ºèƒ½åˆ†æä¸šåŠ¡å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡èµ„æºã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè€ƒè™‘å°†æ™ºèƒ½åˆ†æä¸šåŠ¡æŠ½å‡ºï¼Œåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ™ºèƒ½åˆ†ææœåŠ¡ï¼Œä¸“é—¨è´Ÿè´£ç”Ÿæˆå›¾è¡¨ã€‚
ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Redis æ¥å­˜å‚¨å…±äº«æ•°æ®ã€‚ä¸»ç³»ç»Ÿå’Œæ™ºèƒ½åˆ†ææœåŠ¡éƒ½å¯ä»¥è¯»å– Redis ä¸­çš„æ•°æ®ã€‚è¿™æ ·ï¼ŒRedis å°±å……å½“äº†ä¸€ä¸ª"ä¸­é—´äºº"çš„è§’è‰²ï¼Œè¿æ¥äº†è¿™ä¸¤ä¸ªç³»ç»Ÿï¼Œè¿™å°±æ˜¯ä¸­é—´ä»¶çš„æ¦‚å¿µã€‚
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230618161215010.png#id=b9hDm&originHeight=376&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
### 2.2 æ¶ˆæ¯é˜Ÿåˆ—
> æ¶ˆæ¯é˜Ÿåˆ—ï¼šå­˜å‚¨æ¶ˆæ¯çš„é˜Ÿåˆ—
> æ¶ˆæ¯é˜Ÿåˆ—ï¼šä¸€ç§åœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„é€šä¿¡æœºåˆ¶ã€‚å®ƒç±»ä¼¼äºå®é™…ä¸–ç•Œä¸­çš„ä¸€ä¸ªé‚®ç®±ç³»ç»Ÿï¼Œå‘é€è€…å°†æ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶è€…ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚è¿™ç§å¼‚æ­¥çš„æ–¹å¼å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯é æ€§ï¼Œå› ä¸ºå‘é€è€…å’Œæ¥æ”¶è€…å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”ä¸éœ€è¦ç›´æ¥ç›¸äº’ä¾èµ–ã€‚
> æ¶ˆæ¯é˜Ÿåˆ—å…è®¸ä¸åŒçš„åº”ç”¨ç¨‹åºã€æœåŠ¡æˆ–ç»„ä»¶ä¹‹é—´è§£è€¦ï¼Œå®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œä¼¸ç¼©å’Œç»´æŠ¤ã€‚æ¶ˆæ¯é˜Ÿåˆ—è¿˜æä¾›äº†**å¯é æ€§å’ŒæŒä¹…æ€§**çš„ä¿è¯ï¼Œå› ä¸ºæ¶ˆæ¯å¯ä»¥åœ¨å‘é€æ—¶è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¹¶ä¸”åœ¨æ¥æ”¶è€…å¤„ç†ä¹‹å‰å¯ä»¥è¿›è¡Œå¤šæ¬¡å°è¯•ã€‚

æ¶ˆæ¯é˜Ÿåˆ—åŒ…å«çš„å…³é”®è¯ï¼šå­˜å‚¨ã€æ¶ˆæ¯ã€é˜Ÿåˆ—

- å­˜å‚¨ï¼šå­˜å‚¨æ•°æ®
- æ¶ˆæ¯ï¼šæŸç§æ•°æ®ç»“æ„ï¼šæ¯”å¦‚å­—ç¬¦ä¸²ã€å¯¹è±¡ã€äºŒè¿›åˆ¶ã€JSONç­‰ç­‰
- é˜Ÿåˆ—ï¼šä¸€ç§**å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„**
#### åº”ç”¨åœºæ™¯ï¼ˆä½œç”¨ï¼‰
åœ¨å¤šä¸ªä¸åŒçš„ç³»ç»Ÿã€åº”ç”¨ä¹‹é—´å®ç°æ¶ˆæ¯çš„ä¼ è¾“ï¼ˆä¹Ÿå¯ä»¥å­˜å‚¨ï¼‰ã€‚ä¸éœ€è¦è€ƒè™‘ä¼ è¾“åº”ç”¨çš„ç¼–ç¨‹è¯­è¨€ã€ç³»ç»Ÿã€æ¡†æ¶ç­‰ç­‰ã€‚
> ä¾‹å¦‚ï¼šå¯ä»¥è®©Javaå¼€å‘çš„åº”ç”¨å‘æ¶ˆæ¯ï¼Œè®©PHPå¼€å‘çš„åº”ç”¨æ”¶æ¶ˆæ¯ï¼Œè¿™æ ·å°±ä¸ç”¨æŠŠæ‰€æœ‰ä»£ç å†™åˆ°åŒä¸€ä¸ªé¡¹ç›®é‡Œï¼ˆåº”ç”¨è§£è€¦)

### 2.3 æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹

-  ç”Ÿäº§è€…ï¼šProducerï¼Œç±»æ¯”ä¸ºå¿«é€’å‘˜ï¼Œå‘é€æ¶ˆæ¯çš„äººï¼ˆå®¢æˆ·ç«¯ï¼‰ 
-  æ¶ˆè´¹è€…ï¼šConsumerï¼Œç±»æ¯”ä¸ºå–å¿«é€’çš„äººï¼Œæ¥å—è¯»å–æ¶ˆæ¯çš„äººï¼ˆå®¢æˆ·ç‘ï¼‰ 
-  æ¶ˆæ¯ï¼šMessageï¼Œç±»æ¯”ä¸ºä½ ä¹°çš„å¿«é€’ï¼Œå°±æ˜¯ç”Ÿäº§è€…è¦ä¼ è¾“ç»™æ¶ˆè´¹è€…çš„æ•°æ® 
-  æ¶ˆæ¯é˜Ÿåˆ—ï¼šQueueï¼šç±»æ¯”ä¸ºå¿«é€’æ¥å—æŸœ 

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230618163709919.png#id=ZlUPn&originHeight=391&originWidth=1273&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ä¸ºä»€ä¹ˆä¸æ¥ä¼ è¾“ï¼Œè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ
> ç”Ÿäº§è€…ä¸ç”¨å…³å¿ƒæ¶ˆè´¹è€…è¦ä¸è¦æ¶ˆè´¹ã€ä»€ä¹ˆæ—¶å€™æ¶ˆè´¹ï¼Œç”Ÿäº§è€…åªéœ€è¦æŠŠä¸œè¥¿ï¼ˆæ¶ˆæ¯ï¼‰ç»™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…çš„å·¥ä½œå°±ç®—å®Œæˆäº†ã€‚
> æ¯”å¦‚ä¸Šé¢è¿™ä¸ªé€å¿«é€’çš„ä¾‹å­ï¼š
> é€å¿«é€’çš„é…é€å‘˜ï¼Œåªéœ€è¦å°†å¿«é€’æ”¾åˆ°å¿«é€’æŸœï¼Œå‘ä¸ªæ¶ˆæ¯ç»™ä½ ï¼Œå¿«é€’å·²ç»æ”¾åˆ°äº†å¿«é€’æŸœï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥åœ¨æœ‰ç©ºçš„æ—¶å€™å†å»æ‹¿è¿™ä¸ªå¿«é€’ï¼Œè€Œå¿«é€’é…é€å‘˜ä¹Ÿä¸ç”¨ç®¡ä½ ä»€ä¹ˆæ—¶å€™å»æ‹¿ï¼ˆä¸å¼„ä¸¢å°±å¯ä»¥ï¼Œå¼„ä¸¢é‚£å°±å¾—å¦å¤–è¯´äº†ï¼‰

ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®ç°äº†è§£è€¦ï¼Œäº’ä¸å½±å“ã€‚è¾¾åˆ°äº†**ä¸éœ€è¦è€ƒè™‘ä¼ è¾“åº”ç”¨çš„ç¼–ç¨‹è¯­è¨€ã€ç³»ç»Ÿã€æ¡†æ¶**ç­‰ç­‰ã€‚
### 2.4 ä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—
ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦åŸå› ï¼š

1.  è§£è€¦å’Œæé«˜ç³»ç»Ÿå¯é æ€§ï¼šæ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†è§£è€¦çš„æ–¹å¼ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´ä¸ç›´æ¥è¿›è¡Œé€šä¿¡ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ä¸­è½¬ã€‚è¿™æ ·ï¼Œå³ä½¿å…¶ä¸­ä¸€ä¸ªç»„ä»¶æˆ–è€…ç³»ç»Ÿå‡ºç°æ•…éšœï¼Œä¸ä¼šå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚ 
2.  å¼‚æ­¥å¤„ç†å’Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼šæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ä½¿å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚å‘é€æ–¹å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­åï¼Œä¸éœ€è¦ç­‰å¾…æ¥æ”¶æ–¹ç«‹å³å¤„ç†ï¼Œè€Œæ˜¯å¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚è¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚ 
3.  ç¼“å†²å’Œæµé‡æ§åˆ¶ï¼šæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ä½œä¸ºç¼“å†²åŒºï¼Œç”¨äºå¤„ç†æµé‡å³°å€¼ã€‚å½“ç³»ç»Ÿé¢ä¸´çªå‘çš„è¯·æ±‚é‡å¢åŠ æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ç¼“å†²è¯·æ±‚å¹¶é€æ¸å¤„ç†ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½ã€‚ 
4.  åŒæ­¥æ•°æ®ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸åŒç»„ä»¶æˆ–è€…ç³»ç»Ÿä¹‹é—´å¯èƒ½éœ€è¦å…±äº«æ•°æ®ã€‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°æ•°æ®çš„åŒæ­¥å’Œå…±äº«ï¼Œä¿è¯å„ä¸ªç»„ä»¶ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚ 
5.  æ‰©å±•å’Œçµæ´»æ€§ï¼šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥é€šè¿‡å¢åŠ æ¶ˆè´¹è€…æ¥å®ç°ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Œå¹¶ä¸”æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®éœ€æ±‚çµæ´»åœ°è¿›è¡Œæ‰©ç¼©å®¹ã€‚è¿™æ ·å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç³»ç»Ÿçš„è°ƒæ•´å’Œä¼˜åŒ–ã€‚ 
#### 2.4.1 å¼‚æ­¥å¤„ç†
ç”Ÿäº§è€…å‘é€å®Œæ¶ˆæ¯ä¹‹åï¼Œå¯ä»¥ç»§ç»­å»å¿™åˆ«çš„ï¼Œæ¶ˆè´¹è€…æƒ³ä»€ä¹ˆæ—¶å€™æ¶ˆè´¹éƒ½å¯ä»¥ï¼Œä¸ä¼šäº§ç”Ÿé˜»å¡ã€‚æ‰€è°“çš„å¼‚æ­¥å¤„ç†ï¼Œæ„å‘³ç€ç”Ÿäº§è€…(å¦‚å°æ)åœ¨å‘é€å®Œæ¶ˆæ¯åå¯ä»¥ç«‹å³è½¬è€Œè¿›è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œæ— éœ€ç­‰å¾…æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯ã€‚è¿™æ ·ç”Ÿäº§è€…å°±æ— éœ€ç­‰å¾…æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œé¿å…äº†é˜»å¡ã€‚è¿™ä¸æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„å¼‚æ­¥åŒ–å¤„ç†éå¸¸ç±»ä¼¼ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä½¿æˆ‘ä»¬çš„ç³»ç»Ÿå…·å¤‡äº†è¿™ç§èƒ½åŠ›ã€‚
#### 2.4.2 å‰Šå³°å¡«è°·
å…ˆæŠŠç”¨æˆ·çš„è¯·æ±‚æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ï¼ˆå®é™…æ‰§è¡Œæ“ä½œçš„åº”ç”¨ï¼‰å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ï¼Œæ…¢æ…¢å»å–ã€‚
**æ²¡æœ‰ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—**ï¼š12ç‚¹æ—¶æ¥äº†10ä¸‡ä¸ªè¯·æ±‚ï¼ŒåŸæœ¬æƒ…å†µä¸‹ï¼Œ10ä¸‡ä¸ªè¯·æ±‚éƒ½åœ¨ç³»ç»Ÿå†…éƒ¨ç«‹åˆ»å¤„ç†ï¼Œå¾ˆå¿«ç³»ç»Ÿå‹åŠ›è¿‡å¤§å°±å®•æœºäº†ã€‚
**ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—**ï¼šæŠŠè¿™10ä¸‡ä¸ªè¯·æ±‚æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¤„ç†ç³»ç»Ÿä»¥è‡ªå·±çš„æ’å®šé€Ÿç‡ï¼ˆæ¯”å¦‚æ¯ç§’1ä¸ªï¼‰æ…¢æ…¢æ‰§è¡Œï¼Œä»è€Œä¿æŠ¤ç³»ç»Ÿã€ç¨³å®šå¤„ç†ã€‚
### 2.5 åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜åŠ¿

1. æ•°æ®æŒä¹…åŒ–ï¼šå®ƒå¯ä»¥æŠŠæ¶ˆæ¯é›†ä¸­å­˜å‚¨åˆ°ç¡¬ç›˜é‡Œï¼ŒæœåŠ¡å™¨é‡å¯å°±ä¸ä¼šä¸¢å¤±
2. å¯æ‰©å±•æ€§ï¼šå¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œéšæ—¶å¢åŠ ï¼ˆæˆ–å‡å°‘ï¼‰èŠ‚ç‚¹ï¼Œç»§ç»­ä¿æŒç¨³å®šçš„æœåŠ¡
3. åº”ç”¨è§£è€¦ï¼šå¯ä»¥è¿æ¥å„ä¸ªä¸åŒè¯­è¨€ã€æ¡†æ¶å¼€å‘çš„ç³»ç»Ÿï¼Œä¸Šè¿™äº›ç³»ç»Ÿèƒ½å¤Ÿçµæ´»ä¼ è¾“è¯»å–æ•°æ®
4. å‘å¸ƒè®¢é˜…ï¼šå®ƒå¯ä»¥ä½¿å‘å¸ƒè€…**å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªè®¢é˜…è€…**ï¼Œä»è€Œå®ç°è§£è€¦ã€å¯ä¼¸ç¼©æ€§å’Œå®æ—¶æ€§ç­‰ä¼˜åŠ¿ 
   1. è§£è€¦æ€§ï¼šå‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´æ˜¯æ¾è€¦åˆçš„ï¼Œå½¼æ­¤ä¸éœ€è¦ç›´æ¥é€šä¿¡ã€‚å‘å¸ƒè€…åªéœ€è¦å°†æ¶ˆæ¯å‘å¸ƒåˆ°ç‰¹å®šçš„ä¸»é¢˜æˆ–é¢‘é“ä¸­ï¼Œè€Œè®¢é˜…è€…åªéœ€è¦è®¢é˜…æ„Ÿå…´è¶£çš„ä¸»é¢˜æˆ–é¢‘é“ã€‚è¿™ç§è§£è€¦æ€§ä½¿å¾—ç³»ç»Ÿä¸­çš„ç»„ä»¶å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œå¼€å‘ã€ç»´æŠ¤å’Œæ‰©å±•ã€‚
   2. å¯ä¼¸ç¼©æ€§ï¼šå‘å¸ƒè®¢é˜…æ¨¡å¼å…è®¸å¤šä¸ªè®¢é˜…è€…åŒæ—¶æ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€åœ°æ·»åŠ æˆ–ç§»é™¤è®¢é˜…è€…ã€‚è¿™ç§å¯ä¼¸ç¼©æ€§ä½¿ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†æ›´é«˜çš„å¹¶å‘é‡ï¼Œè€Œä¸ä¼šå¯¹æ€§èƒ½å’Œå¯ç”¨æ€§äº§ç”Ÿè´Ÿé¢å½±å“ã€‚
   3. å®æ—¶æ€§ï¼šç”±äºå‘å¸ƒè®¢é˜…æ¨¡å¼æ”¯æŒå¤šä¸ªè®¢é˜…è€…åŒæ—¶æ¥æ”¶æ¶ˆæ¯ï¼Œå¯ä»¥æ›´å¿«åœ°å°†æ¶ˆæ¯ä¼ é€’ç»™è®¢é˜…è€…ã€‚è¿™ç§å®æ—¶æ€§ä½¿ç³»ç»Ÿèƒ½å¤Ÿå®ç°å³æ—¶çš„æ•°æ®ä¼ è¾“å’Œå¤„ç†ï¼Œé€‚ç”¨äºéœ€è¦å¿«é€Ÿå“åº”çš„åœºæ™¯ã€‚
   4. å¯é æ€§ï¼šåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—é€šå¸¸æä¾›äº†æ¶ˆæ¯æŒä¹…åŒ–çš„æœºåˆ¶ï¼Œå¯ä»¥å°†æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚å³ä½¿æ¶ˆè´¹è€…å‡ºç°æ•…éšœï¼Œç¨åå†å¯åŠ¨æ—¶ä¹Ÿå¯ä»¥ç»§ç»­æ¥æ”¶ä¹‹å‰æœªå¤„ç†çš„æ¶ˆæ¯ã€‚

#### 2.5.1 åº”ç”¨è§£è€¦ä¼˜ç‚¹
ä¸ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼š
> æŠŠæ‰€æœ‰çš„åŠŸèƒ½éƒ½æ”¾åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œè°ƒç”¨å¤šä¸ªå­åŠŸèƒ½æ—¶ï¼Œä¸€ä¸ªç¯èŠ‚é”™ï¼Œæ•´ä¸ªç³»ç»Ÿå°±å‡ºé”™

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230618164212956.png#id=JIdBH&originHeight=360&originWidth=642&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè§£è€¦ï¼š

1. ä¸€ä¸ªç³»ç»ŸæŒ‚äº†ï¼Œä¸å½±å“å¦ä¸€ä¸ªç³»ç»Ÿï¼šå¦‚æœå‘è´§ç³»ç»ŸæŒ‚äº†ï¼Œä½†æ˜¯ä¸å½±å“åˆ°åº“å­˜ç³»ç»Ÿè¿›è¡Œæ‰£å‡
2. ç³»ç»ŸæŒ‚äº†å¹¶æ¢å¤åï¼Œä»ç„¶å¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—å½“ä¸­å–å‡ºæ¶ˆæ¯ï¼Œç»§ç»­æ‰§è¡Œä¸šåŠ¡é€»è¾‘
3. åªè¦å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œå°±å¯ä»¥ç«‹åˆ»è¿”å›ï¼Œä¸ç”¨åŒæ­¥è°ƒç”¨æ‰€æœ‰ç³»ç»Ÿï¼Œæ€§èƒ½æ›´é«˜

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230618164518027.png#id=MM9EK&originHeight=393&originWidth=977&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
> è®¢å•ç³»ç»Ÿåªè¦å°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå³å¯è¿”å›ï¼Œå¹¶ä¸éœ€è¦è°ƒç”¨å…¶ä»–çš„ç³»ç»Ÿï¼Œè€Œå…¶ä»–çš„ç³»ç»Ÿåªè¦ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–åˆ°æ¶ˆæ¯ã€‚

å‘å¸ƒè®¢é˜…ä¼˜åŠ¿å›¾è§£ï¼š
å¦‚æœä¸€ä¸ªéå¸¸å¤§çš„ç³»ç»Ÿè¦ç»™å…¶ä»–å­ç³»ç»Ÿå‘é€é€šçŸ¥ï¼Œæœ€ç®€å•ç›´æ¥çš„æ–¹å¼æ˜¯**å¤§ç³»ç»Ÿç›´æ¥ä¾æ¬¡è°ƒç”¨å°ç³»ç»Ÿ**
> æ¯”å¦‚QQï¼šä½¿ç”¨QQæ¥å…³è”äº†å¾ˆå¤šåº”ç”¨çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚ç‹è€…ã€åƒé¸¡ã€å¾®ä¿¡ç­‰ç­‰

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230618165359369.png#id=idqJh&originHeight=689&originWidth=704&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
è¿™æ ·åšå­˜åœ¨çš„é—®é¢˜ï¼š

1. æ¯æ¬¡å‘é€šçŸ¥éƒ½è¦è°ƒç”¨å¾ˆå¤šç³»ç»Ÿï¼Œå¾ˆéº»çƒ¦ã€æœ‰å¯èƒ½å¤±è´¥
2. æ–°å‡ºç°çš„é¡¹ç›®ï¼ˆæˆ–è€…è¯´å¤§é¡¹ç›®æ„ŸçŸ¥ä¸åˆ°çš„é¡¹ç›®ï¼‰æ— æ³•å¾—åˆ°é€šçŸ¥
3. å‘å¸ƒçš„æ¶ˆæ¯ä¸çŸ¥é“å“ªä¸ªç³»ç»Ÿéœ€è¦

è§£å†³æ–¹æ¡ˆï¼šå¤§çš„æ ¸å¿ƒç³»ç»Ÿå§‹ç»ˆå¾€ä¸€ä¸ªåœ°æ–¹ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰å»å‘æ¶ˆæ¯ï¼Œå…¶ä»–çš„ç³»ç»Ÿéƒ½å»è®¢é˜…è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆè¯»å–è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯)
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230618165720318.png#id=LqXDJ&originHeight=717&originWidth=975&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
### 2.6 åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—çš„ç¼ºç‚¹

1. å¢åŠ å¤æ‚æ€§ï¼šåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—çš„éƒ¨ç½²å’Œè¿ç»´éœ€è¦ä¸€å®šçš„æŠ€æœ¯çŸ¥è¯†å’Œç»éªŒï¼Œå¯¹ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡æœ‰ä¸€å®šçš„è¦æ±‚ã€‚åŒæ—¶ï¼Œå› ä¸ºå¼•å…¥äº†é¢å¤–çš„ç»„ä»¶ï¼Œ**ç³»ç»Ÿçš„å¤æ‚åº¦ä¹Ÿä¼šå¢åŠ **ï¼Œç³»ç»Ÿä¼šæ›´å¤æ‚ã€é¢å¤–ç»´æŠ¤ä¸­é—´ä»¶ã€é¢å¤–çš„è´¹ç”¨ï¼ˆéƒ¨ç½²ï¼‰æˆæœ¬
2. æ¶ˆæ¯é˜Ÿåˆ—ï¼šæ¶ˆæ¯ä¸¢å¤±ã€é¡ºåºæ€§ã€é‡å¤æ¶ˆè´¹ã€æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆåˆ†å¸ƒå¼ç³»ç»Ÿå°±è¦è€ƒè™‘ä¸€è‡´æ€§é—®é¢˜ï¼‰
3. æ¶ˆæ¯é¡ºåºæ€§ï¼šç”±äºæ¶ˆæ¯é˜Ÿåˆ—çš„å¼‚æ­¥æ€§ï¼Œæ— æ³•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚è¿™å¯èƒ½ä¼šå¯¹ä¾èµ–æ¶ˆæ¯é¡ºåºçš„ä¸šåŠ¡åœºæ™¯é€ æˆå½±å“ï¼Œéœ€è¦é¢å¤–çš„å¤„ç†æœºåˆ¶æ¥è§£å†³æ­¤é—®é¢˜ã€‚
### 2.7 åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯

1. è€—æ—¶çš„åœºæ™¯ï¼ˆå¼‚æ­¥ï¼‰
2. åˆ†å¸ƒå¼ç³»ç»Ÿåä½œï¼ˆå°¤å…¶æ˜¯è·¨å›¢é˜Ÿã€è·¨ä¸šåŠ¡åä½œï¼Œåº”ç”¨è§£è€¦ï¼‰
3. å¼ºç¨³å®šæ€§çš„åœºæ™¯ï¼ˆæ¯”å¦‚é‡‘èä¸šåŠ¡ï¼šæ”¯ä»˜ã€è½¬è´¦ï¼Œç‰¹ä¹…åŒ–ã€å¯é æ€§ã€å‰Šå³°å¡«è°·ï¼‰
4. å¼‚æ­¥é€šä¿¡ï¼šå½“ç³»ç»Ÿéœ€è¦åœ¨**ä¸åŒæ¨¡å—ä¹‹é—´è¿›è¡Œå¼‚æ­¥é€šä¿¡**æ—¶ï¼Œåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥æä¾›ä¸€ç§å¯é çš„é€šä¿¡æœºåˆ¶ã€‚
5. è§£è€¦åº”ç”¨ï¼šå½“**å¤šä¸ªåº”ç”¨æˆ–æœåŠ¡ä¹‹é—´éœ€è¦è§£è€¦**ï¼Œä»¥é™ä½è€¦åˆåº¦ã€æé«˜çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§æ—¶ï¼Œä½¿ç”¨åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°è§£è€¦ã€‚
6. æµé‡å‰Šå³°ï¼šåœ¨**é«˜å³°æœŸæˆ–æœåŠ¡å™¨è´Ÿè½½é«˜çš„æƒ…å†µä¸‹**ï¼Œåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å°†**æµé‡å¹³æ»‘åˆ†å‘åˆ°ä¸åŒçš„æ¶ˆè´¹è€…**ä¸Šï¼Œé¿å…ç³»ç»Ÿè¿‡è½½ã€‚ï¼ˆ**é«˜å¹¶å‘åœºæ™¯ã€å¼‚æ­¥ã€å‰Šå³°å¡«è°·**ï¼‰
7. æ—¥å¿—å¤„ç†ï¼šå¯¹äº**å¤§è§„æ¨¡çš„æ—¥å¿—å¤„ç†åœºæ™¯**ï¼Œåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å¸®åŠ©å°†æ—¥å¿—æ”¶é›†ã€ä¼ è¾“å’Œå¤„ç†è¿›è¡Œè§£è€¦ï¼Œå¹¶ä¸”å¯ä»¥å®¹é”™å’ŒæŒä¹…åŒ–ã€‚
8. äº‹ä»¶é©±åŠ¨æ¶æ„ï¼šåœ¨äº‹ä»¶é©±åŠ¨çš„æ¶æ„ä¸­ï¼Œå„ä¸ªç»„ä»¶é€šè¿‡è®¢é˜…æ¶ˆæ¯å®ç°è§£è€¦ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶å‘ç”Ÿæ—¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚
### 2.8 ä¸»æµåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹
ä»¥ä¸‹æ˜¯å¯¹ä¸»æµåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹çš„ç®€è¦ä»‹ç»ï¼š

1. ActiveMQï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„ã€å®Œå…¨æ”¯æŒJMSè§„èŒƒçš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€‚å®ƒæä¾›äº†å¯é çš„æ¶ˆæ¯ä¼ é€’ã€äº‹åŠ¡ã€æ¶ˆæ¯æŒä¹…åŒ–ç­‰åŠŸèƒ½ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ä¼ä¸šçº§åº”ç”¨åœºæ™¯ã€‚
2. RabbitMQï¼šä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œå®ƒå®ç°äº†AMQPåè®®ã€‚RabbitMQå…·æœ‰é«˜å¯ç”¨æ€§ã€å¯é æ€§å’Œçµæ´»çš„è·¯ç”±ç­–ç•¥ï¼Œé€‚ç”¨äºå¤æ‚çš„æ¶ˆæ¯è·¯ç”±å’Œçµæ´»çš„æ¶ˆæ¯å¤„ç†åœºæ™¯ã€‚
3. Kafkaï¼šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†å¹³å°å’Œæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œæä¾›é«˜ååé‡ã€ä½å»¶è¿Ÿçš„æ¶ˆæ¯ä¼ é€’ã€‚Kafkaé€‚ç”¨äºå¤§æ•°æ®æµå¤„ç†åœºæ™¯ï¼Œä¾‹å¦‚æ—¥å¿—æ”¶é›†ã€å®æ—¶åˆ†æç­‰ã€‚
4. RocketMQï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œæœ€åˆç”±é˜¿é‡Œå·´å·´å¼€å‘ï¼Œç°å·²è¿›å…¥Apacheå­µåŒ–å™¨ã€‚RocketMQå…·æœ‰é«˜æ€§èƒ½ã€é«˜å¯ç”¨æ€§å’Œåˆ†å¸ƒå¼äº‹åŠ¡ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡çš„åˆ†å¸ƒå¼åº”ç”¨åœºæ™¯ã€‚
5. ZeroMQï¼šæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ¶ˆæ¯é˜Ÿåˆ—åº“ï¼Œæ”¯æŒå¤šç§é€šä¿¡æ¨¡å¼å’Œä¼ è¾“åè®®ã€‚ZeroMQçš„è®¾è®¡ç›®æ ‡æ˜¯æä¾›ç®€å•çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼Œé€‚ç”¨äºè½»é‡çº§çš„å¼‚æ­¥é€šä¿¡å’Œå¿«é€Ÿæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åœºæ™¯ã€‚
6. Pulsarï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯å’Œæµå¤„ç†å¹³å°ï¼Œç”±Apacheå­µåŒ–å™¨æ”¯æŒã€‚Pulsaræä¾›äº†é«˜å¯ä¼¸ç¼©æ€§ã€å¤šç§Ÿæˆ·ã€ä½å»¶è¿Ÿç­‰ç‰¹æ€§ï¼Œå¹¶æ”¯æŒäº‘åŸç”Ÿæ¶æ„ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡çš„æ•°æ®å¤„ç†å’Œå®æ—¶åˆ†æåœºæ™¯ã€‚
7. Apache InLong (Tube)ï¼šå‰èº«ä¸ºApache Tubeï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯å’Œæµå¼æ•°æ®ä¼ è¾“å¹³å°ã€‚å®ƒæä¾›äº†çµæ´»çš„æ¶ˆæ¯ä¼ é€’å’Œæ•°æ®ä¼ è¾“æ–¹å¼ï¼Œå¹¶é›†æˆäº†å¤§æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œé€‚ç”¨äºå®æ—¶åˆ†æã€æ•°æ®é›†æˆç­‰å¤šæ ·åŒ–åœºæ™¯ã€‚

#### 2.8.1 ä¸åŒæ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”
ä¸»è¦æ˜¯å‚è€ƒä»¥ä¸‹å‡ ä¸ªæŠ€æœ¯æŒ‡æ ‡è¿›è¡Œé€‰æ‹©å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—æ¥å¼€å‘

1.  **ååé‡**ï¼šIOã€å¹¶å‘ã€‚ï¼ˆè¡¨ç¤ºå•ä½æ—¶é—´å†…å®Œæˆçš„æ“ä½œæ¬¡æ•°ã€ä¼ è¾“çš„æ•°æ®é‡æˆ–å¤„ç†çš„ä»»åŠ¡æ•°é‡ï¼‰ 
2.  **æ—¶æ•ˆæ€§**ï¼šç±»ä»¥å»¶è¿Ÿï¼Œæ¶ˆæ¯çš„å‘é€ã€åˆ°è¾¾æ—¶é—´ 
3.  **å¯ç”¨æ€§**ï¼šç³»ç»Ÿå¯ç”¨çš„æ¯”ç‡ï¼ˆæ¯”å¦‚1å¹´365å¤©å®•æœº1sï¼Œå¯ç”¨ç‡å¤§æ¦‚Xä¸ª9ï¼‰ 
> æ¥è‡ªé±¼èªæ˜ï¼š
> å¯ç”¨æ€§çš„è®¡ç®—å…¬å¼æ˜¯ï¼šå¯ç”¨æ—¶é—´ / (æ€»æ—¶é—´ - è®¡åˆ’åœæœºæ—¶é—´)ã€‚
> æ€»æ—¶é—´ = 365 _ 24 _ 60 * 60 = 31,536,000 ç§’ã€‚
> è®¡åˆ’åœæœºæ—¶é—´ = 1 ç§’ * 365 å¤© = 365 ç§’ã€‚
> å¯ç”¨æ—¶é—´ = æ€»æ—¶é—´ - è®¡åˆ’åœæœºæ—¶é—´ = 31,536,000 - 365 = 31,535,635 ç§’ã€‚
> å¯ç”¨æ€§ = 31,535,635 / 31,536,000 â‰ˆ 0.999988 â‰ˆ 99.9988%ã€‚
> æ‰€ä»¥ï¼Œè¯¥ç³»ç»Ÿçš„å¯ç”¨æ€§ä¸ºçº¦99.9988%ã€‚

 

4.  å¯é æ€§ï¼šæ¶ˆæ¯ä¸ä¸¢å¤±ï¼ˆæ¯”å¦‚ä¸ä¸¢å¤±è®¢å•ï¼‰ã€åŠŸèƒ½æ­£å¸¸å®Œæˆ 
> - ååé‡ï¼ˆThroughputï¼‰æŒ‡çš„æ˜¯ç³»ç»Ÿåœ¨**å•ä½æ—¶é—´å†…èƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚æˆ–ä¼ è¾“çš„æ•°æ®é‡**ã€‚åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œååé‡è¡¨ç¤ºç³»ç»Ÿèƒ½å¤Ÿå¤„ç†çš„æ¶ˆæ¯æ•°é‡æˆ–ä¼ è¾“çš„æ•°æ®é‡ã€‚è¾ƒé«˜çš„ååé‡æ„å‘³ç€ç³»ç»Ÿèƒ½å¤Ÿæ›´å¿«åœ°å¤„ç†è¯·æ±‚æˆ–ä¼ è¾“æ•°æ®ã€‚
> - æ—¶æ•ˆæ€§ï¼ˆLatencyï¼‰æŒ‡çš„æ˜¯**ä»å‘å‡ºè¯·æ±‚åˆ°æ”¶åˆ°å“åº”æ‰€ç»å†çš„æ—¶é—´é—´éš”**ã€‚åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ—¶æ•ˆæ€§è¡¨ç¤ºä»æ¶ˆæ¯è¢«å‘é€åˆ°æ¶ˆæ¯è¢«æ¥æ”¶å’Œå¤„ç†çš„æ—¶é—´ã€‚è¾ƒä½çš„æ—¶æ•ˆæ€§æ„å‘³ç€æ¶ˆæ¯èƒ½å¤Ÿæ›´å¿«åœ°è¢«ä¼ è¾“ã€æ¥æ”¶å’Œå¤„ç†ã€‚

| æ¶ˆæ¯é˜Ÿåˆ— | ååé‡ï¼ˆQPSï¼‰ | æ—¶æ•ˆæ€§ | å¯ç”¨æ€§ | å¯é æ€§ | ä¼˜åŠ¿ | ç¼ºç‚¹ | åº”ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- | --- | --- | --- |
| ActiveMQ | ä¸­ç­‰ï¼šä¸‡çº§ | é«˜ | é«˜ | ä¸­ç­‰ | æˆç†Ÿçš„JMSæ”¯æŒã€ç®€å•æ˜“å­¦ | æ€§èƒ½ç›¸å¯¹è¾ƒä½ | ä¸­å°å‹ä¼ä¸šåº”ç”¨ï¼Œå¯é çš„æ¶ˆæ¯ä¼ é€’å’Œäº‹åŠ¡ |
| RabbitMQ | ä¸­ç­‰ï¼šä¸‡çº§ | æé«˜ï¼ˆå¾®ç§’å•ä½ï¼‰ | é«˜ | é«˜ | çµæ´»çš„è·¯ç”±ç­–ç•¥ã€ç”Ÿæ€å¥½ã€æ—¶æ•ˆæ€§é«˜ã€æ˜“å­¦ | å¯¹å¤§ååé‡çš„æ”¯æŒç›¸å¯¹è¾ƒå¼± | å¤æ‚çš„æ¶ˆæ¯è·¯ç”±å’Œçµæ´»çš„æ¶ˆæ¯å¤„ç†ã€é€‚ç”¨äºå¤§éƒ¨åˆ†çš„åˆ†å¸ƒå¼ç³»ç»Ÿ |
| Kafka | **é«˜ï¼šåä¸‡çº§** | é«˜ï¼ˆæ¯«ç§’ä»¥å†…ï¼‰ | æé«˜ | æé«˜ | é«˜ååé‡å’Œä½å»¶è¿Ÿã€å¯é æ€§ã€å¼ºå¤§çš„æ•°æ®æµå¤„ç†èƒ½åŠ› | å¤æ‚æ€§è¾ƒé«˜ï¼Œåˆå­¦è€…ä¸Šæ‰‹éš¾åº¦å¤§ | å¤§æ•°æ®æµå¤„ç†ï¼Œæ—¥å¿—æ”¶é›†ï¼Œå®æ—¶æ•°æ®æµä¼ è¾“ã€äº‹ä»¶æµæ”¶é›†ä¼ è¾“ç­‰ |
| RocketMQ | é«˜ï¼šåä¸‡çº§ | é«˜ï¼ˆæ¯«ç§’ï¼‰ | æé«˜ | æé«˜ | å¯é æ€§ã€å¯ç”¨æ€§ã€ååé‡å¤§ã€åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ | å¯¹å¤æ‚æ€§çš„æ”¯æŒç›¸å¯¹ä¸è¶³ | å¤§è§„æ¨¡çš„åˆ†å¸ƒå¼åº”ç”¨ï¼Œé«˜å¯ç”¨æ€§å’Œäº‹åŠ¡ä¸€è‡´æ€§è¦æ±‚
é€‚ç”¨äº**é‡‘è**ã€ç”µå•†ç­‰å¯¹å¯é æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œé€‚åˆå¤§è§„æ¨¡çš„æ¶ˆæ¯å¤„ç† |
| ZeroMQ | ä¸­ç­‰ï¼šä¸‡çº§ | é«˜ | é«˜ | ä½ | ç®€å•çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ | ç¼ºä¹å¯¹å¤æ‚æ¶ˆæ¯è·¯ç”±çš„æ”¯æŒ | è½»é‡çº§å¼‚æ­¥é€šä¿¡ï¼Œæ„å»ºå¿«é€Ÿåˆ†å¸ƒå¼ç³»ç»Ÿ |
| Pulsar | é«˜ï¼šåä¸‡çº§ | é«˜ï¼ˆæ¯«ç§’ï¼‰ | æé«˜ | æé«˜ | å¯é æ€§ã€å¯ç”¨æ€§å¾ˆé«˜ã€åŸºäºå‘å¸ƒè®¢é˜…æ¨¡å‹ã€æ–°å…´æŠ€æœ¯ç»“æ„ã€äº‘åŸç”Ÿæ¶æ„æ”¯æŒ | éƒ¨ç½²å’Œè¿ç»´ç›¸å¯¹å¤æ‚ | é€‚ç”¨å¤§è§„æ¨¡æ•°æ®å¤„ç†ï¼Œå®æ—¶åˆ†æï¼Œé«˜å¹¶å‘çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚é€‚åˆå®æ—¶åˆ†æã€äº‹ä»¶æµå¤„ç†ã€IoTæ•°æ®å¤„ç†ç­‰ã€‚ |
| Apache InLong (Tube) | é«˜ï¼šåä¸‡çº§ | é«˜ | é«˜ | é«˜ | æ•°æ®ä¼ è¾“å’Œå¤§æ•°æ®å¤„ç†é›†æˆ | ç¤¾åŒºç”Ÿæ€ç›¸å¯¹è¾ƒå° | å®æ—¶åˆ†æï¼Œæ•°æ®é›†æˆ |

## 3ã€RabbitMQ å…¥é—¨å®è·µ
[ç©ºé™å®˜ç½‘](https://www.rabbitmq.com/)
ç‰¹ç‚¹ï¼šç”Ÿæ€å¥½ï¼Œå¥½å­¦ä¹ ã€æ˜“äºç†è§£ï¼Œæ—¶æ•ˆæ€§å¼ºï¼Œæ”¯ç‰¹å¾ˆå¤šä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œæ‰©å±•æ€§ã€å¯ç”¨æ€§éƒ½å¾ˆä¸é”™ã€‚
å­¦ä¹ æ€§ä»·æ¯”éå¸¸é«˜çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€‚ç”¨äºç»å¤§å¤šæ•°ä¸­å°è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿã€‚
RabbitMQçš„â½£æ€ä¼˜ç§€ï¼Œç›Šäºå­¦ä¹ å’Œç†è§£ï¼Œä¸”å…·æœ‰è‰¯å¥½çš„å®æ•ˆæ€§ï¼ŒåŒæ—¶å®ƒâ½€æŒå¤šç§è¯­â¾”çš„å®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬Java Pythonç­‰ï¼Œè¿™ä½¿å¾—rabbit mqå…·æœ‰å‡ºâ¾Šçš„æ‰©å±•æ€§å’Œå¯â½¤æ€§ï¼Œå› æ­¤å®ƒæ˜¯â¼€ç§å­¦ä¹ æˆæœ¬â¾¼ï¼Œæ€§ä»·â½â¾¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€‚åˆâ¼¤å¤šæ•°ä¸­â¼©è§„æ¨¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å­¦ä¹ rabbit mqçš„ä¸»è¦åŸå› ã€‚
### 3.1 åŸºæœ¬æ¶ˆæ¯
AMQPåè®®ï¼ˆé«˜æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼šAdvanced Message Queuing Protocolï¼‰ï¼š
AMQPçš„å…¨ç§°æ˜¯Advanced Message Queue Protocol,å³â¾¼çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ã€‚ 
RabbitMQå°±æ˜¯æ ¹æ®è¿™ä¸ªåè®®å¼€å‘çš„ï¼ŒAMQPæ˜¯â¼€ä¸ªæ ‡å‡†çš„åè®®ï¼Œä¸ä»…RabbitMQ ï¼Œå¦‚æœä½ æƒ³â¾ƒâ¼°å®ç°â¼€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿå¾—æŒ‰ç…§è¿™ä¸ªåè®®æ¥è®¾è®¡ã€‚
[https://www.rabbitmq.com/tutorials/amqp-concepts.html](https://www.rabbitmq.com/tutorials/amqp-concepts.html)
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/hello-world-example-routing.png#id=YAtHG&originHeight=328&originWidth=700&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

- ç”Ÿäº§è€…(Publisher)ï¼šå‘æ¶ˆæ¯åˆ°æŸä¸ªäº¤æ¢æœº
- æ¶ˆè´¹è€…(Consumer)ï¼šä»æŸä¸ªé˜Ÿåˆ—ä¸­å–æ¶ˆæ¯
- äº¤æ¢æœº(Exchange)ï¼šåƒè·¯ç”±å™¨â¼€æ ·ï¼Œè´Ÿè´£æŠŠæ¶ˆæ¯è½¬å‘åˆ°å¯¹åº”çš„é˜Ÿåˆ—
- é˜Ÿåˆ—(Queue)ï¼šå­˜å‚¨æ¶ˆæ¯çš„
- è·¯ç”±(Routes)ï¼šè½¬å‘ï¼Œå°±æ˜¯æ€ä¹ˆæŠŠæ¶ˆæ¯ä»ä¸€ä¸ªåœ°æ–¹è½¬åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼ˆæ¯”å¦‚ä»ç”Ÿäº§è€…è½¬å‘åˆ°æŸä¸ªé˜Ÿåˆ—ï¼‰
### 3.2 å®‰è£… RabbitMQ
å‚è€ƒï¼š[https://blog.csdn.net/m0_37779600/article/details/136380261](https://blog.csdn.net/m0_37779600/article/details/136380261)
æ”¹å¯†ç ï¼š[https://blog.csdn.net/yuanjinshenglife/article/details/137519496](https://blog.csdn.net/yuanjinshenglife/article/details/137519496)
#### 3.2.1 Windowså®‰è£…
Windowså®˜ç½‘å®‰è£…æ•™ç¨‹ï¼š[https://www.rabbitmq.com/install-windows.html](https://www.rabbitmq.com/install-windows.html)
å®‰è£…Erlang 25.3.2 ï¼šå› ä¸ºRabbit MQ ä¾èµ–äºerlang ï¼Œå®ƒçš„æ€§èƒ½éå¸¸é«˜
Erlang ä¸‹è½½ï¼š[https://www.erlang.org/patches/otp-25.3.2](https://www.erlang.org/patches/otp-25.3.2)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723699668346-e2fd9822-4ce9-4862-b234-3d9e084a4707.png#averageHue=%23d1c7bc&clientId=u4ca622be-41e5-4&from=paste&height=411&id=u5595eb04&originHeight=493&originWidth=647&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=111532&status=done&style=none&taskId=u89a08a87-12d5-40ad-8d61-288eee953a9&title=&width=539.1666452421091)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723699687608-2cd8a6fa-f34b-47d8-8ade-200dac0e3311.png#averageHue=%23faf7f6&clientId=u4ca622be-41e5-4&from=paste&height=612&id=u3f1da8a5&originHeight=735&originWidth=677&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=225729&status=done&style=none&taskId=ud6fdb30d-e1c7-4066-afa8-ae24df08a9f&title=&width=564.1666442486984)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723699911455-50bc8c5e-c32f-4f8f-ae39-199ba15cafd1.png#averageHue=%23f7f6f5&clientId=u4ca622be-41e5-4&from=paste&height=252&id=u398e31b0&originHeight=303&originWidth=545&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=71388&status=done&style=none&taskId=u366068f5-7799-4706-906b-981210cba8d&title=&width=454.1666486197055)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723699961976-318d8468-2efa-4358-9b18-33b9994ddb31.png#averageHue=%23f2f0ef&clientId=u4ca622be-41e5-4&from=paste&height=990&id=ucb83a2d7&originHeight=1188&originWidth=2163&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=279809&status=done&style=none&taskId=ud85bc8bb-805f-4c73-9507-44f094b2df2&title=&width=1802.499928375088)
æ¥ä¸‹æ¥è¿˜éœ€è¦ç”¨åˆ°ä¸€ä¸ªä¸œè¥¿ï¼Œå¤§å®¶å¦‚æœè¯´ä»¥åå®‰è£…ä¸€äº›ç¬¬ä¸‰æ–¹çš„è¿™ç§ä¸­é—´ä»¶ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šæœ‰çš„ã€‚ å°±æ˜¯è‚¯å®šæ˜¯è¿™ç§ä¸­é—´ä»¶ä¼šæœ‰ä¸€ä¸ªç®¡ç†é¡µé¢ã€‚å›åˆ°å®˜ç½‘ï¼Œç‚¹å‡» Docs (æ–‡æ¡£)ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723700009272-660b8bbd-d462-4d16-81a8-00b8fb7c06f7.png#averageHue=%23e7e7e5&clientId=u4ca622be-41e5-4&from=paste&height=191&id=u3ac3abc0&originHeight=229&originWidth=492&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=59894&status=done&style=none&taskId=ub98b5fd0-d9af-4832-8b99-7bb32c1c02f&title=&width=409.9999837080644)
Windows å®‰è£… Rabbit MQ ç›‘æ§é¢æ¿ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š
ç”±äºæ˜¯ windows ç³»ç»Ÿï¼Œè¿™ä¸ªå‘½ä»¤ä¸èƒ½ç›´æ¥è¿è¡Œï¼› 
windows ç³»ç»Ÿæ‰€æœ‰çš„è„šæœ¬å…¨æ˜¯ bat æ–‡ä»¶ï¼Œæ‰€ä»¥è¦ç»™è¿™æ¡å‘½ä»¤åŠ ä¸Š .batï¼Œç„¶åå¤åˆ¶è¿™æ¡å‘½ä»¤ã€‚
```
rabbitmq-plugins.bat enable rabbitmq_management
```
æ‰¾åˆ°å®‰è£… RabbitMQ è·¯å¾„çš„ä½ç½®ï¼Œè¿›å…¥ sbinç›®å½• ï¼Œè¿™é‡Œé¢éƒ½æ˜¯ RabbitMQ çš„æ‰§è¡Œè„šæœ¬ã€‚ 

- rabbitmq-server.batï¼šæ“ä½œ RabbitMQ æœåŠ¡å™¨ç›¸å…³çš„å‘½ä»¤ã€‚ 
- rabbitmq-plugins.batï¼šç”¨æ¥å®‰è£… RabbitMQ çš„æ’ä»¶ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723702154953-b79fd518-2d8c-4559-bc2a-aba8e03a3edf.png#averageHue=%23131313&clientId=u4ca622be-41e5-4&from=paste&height=1018&id=ud3609e23&originHeight=1222&originWidth=2346&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=73866&status=done&style=none&taskId=ua7817d85-eb82-45f3-b46f-d5653c9b55e&title=&width=1954.9999223152827)
è¿™é‡Œæ˜¾ç¤ºè¦é‡æ–°å¯åŠ¨åæ‰ç”Ÿæ•ˆï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ã€‚
ç®¡ç†å‘˜èº«ä»½è¿è¡Œcmd
```java
net stop rabbitmq
net start rabbitmq
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723702480508-4ff28f9c-864d-43cd-b0f9-b824ee083139.png#averageHue=%23100f0f&clientId=u4ca622be-41e5-4&from=paste&height=707&id=ueb78cfe6&originHeight=849&originWidth=1828&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=93438&status=done&style=none&taskId=ufb1c869c-a6b7-40af-8590-3888de29ef9&title=&width=1523.3332728015075)
Rabbit MQ ç«¯å£ï¼š

1. 5672ï¼šç¨‹åºé“¾æ¥çš„ç«¯å£
2. 15672ï¼šWebUI
> æ–‡æ¡£è¿˜æœ‰è¯´æ˜ç«¯å£è®¿é—®çš„ç«¯å£å·ï¼Œ15672 æ˜¯ç›‘æ§é¢æ¿çš„ UIï¼›
> ps.é‡Œé¢çš„ 5672ã€5671 å¾ˆé‡è¦ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹‹é—´å°±æ˜¯é€šè¿‡ 5672 ç«¯å£æ¥å’Œ RabbitMQ åšé“¾æ¥çš„ï¼Œå°±åƒ redis çš„6379ï¼Œes çš„ 9200æ˜¯ä¸€æ ·çš„ã€‚

è®¿é—®ï¼š
[http://localhost:15672/](http://localhost:15672/)
è´¦å· guest 
å¯†ç  guest
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723702687651-a704c45f-4e80-482b-af73-98aba42f722c.png#averageHue=%23fdfcfb&clientId=u4ca622be-41e5-4&from=paste&height=258&id=ub9bbd484&originHeight=310&originWidth=1338&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=18050&status=done&style=none&taskId=uc977703d-6415-4cd5-b8c0-6a9048849be&title=&width=1114.9999556938824)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723702754853-58df9223-c1b4-446b-8892-2b9281479cfc.png#averageHue=%23f9f9f2&clientId=u4ca622be-41e5-4&from=paste&height=822&id=u06a7cf99&originHeight=986&originWidth=1902&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=103778&status=done&style=none&taskId=u33e41201-404a-448d-8859-85aeb3bd51e&title=&width=1584.999937017761)
**æ³¨æ„ï¼š**å¦‚æœä½ æ‰“ç®—åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½² RabbitMQï¼Œä½ å¿…é¡»çŸ¥é“åœ¨é»˜è®¤è®¾ç½®ä¸‹ï¼Œä½¿ç”¨ guest è´¦å·æ˜¯æ— æ³•è®¿é—®çš„ã€‚ä¸ºä½•ä¼šè¿™æ ·å‘¢ï¼ŸåŸå› åœ¨äºç³»ç»Ÿå®‰å…¨æ€§çš„éœ€æ±‚ã€‚å¦‚æœä½ æƒ³ä»è¿œç¨‹æœåŠ¡å™¨è®¿é—®ç®¡ç†é¢æ¿ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜è´¦å·ï¼Œä¸èƒ½ä½¿ç”¨é»˜è®¤çš„ guest è´¦å·ï¼Œå¦åˆ™ä¼šè¢«ç³»ç»Ÿæ‹¦æˆªï¼Œå¯¼è‡´æ— æ³•è®¿é—®æˆ–ç™»å½•ã€‚ 
ç‚¹å‡»å³ä¾§çš„ User guestï¼Œä¼šå‘ç°è¯¥ç”¨æˆ·æ‹¥æœ‰ç®¡ç†å‘˜æƒé™ï¼Œä½†è¿™ä»…é™äºæœ¬åœ°è®¿é—®ã€‚å¦‚æœä½ ç›´æ¥ä¸Šçº¿å¹¶ä½¿ç”¨é»˜è®¤çš„ç®¡ç†å‘˜æƒé™ï¼Œä½ å¯ä»¥æƒ³è±¡å¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šæ‰«æä½ æœåŠ¡å™¨çš„ç«¯å£ï¼Œå¹¶ä¸æ–­å°è¯•ç”¨ guest è´¦å·ç™»å½•ã€‚ä¸€æ—¦æ‰¾åˆ°ä¸€ä¸ªå¼€æ”¾çš„ç«¯å£å¹¶ç”¨ guest ç™»å½•ï¼Œæ”»å‡»è€…å°±å¯ä»¥å…¥ä¾µä½ çš„æœåŠ¡å™¨ï¼Œç„¶ååœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¸æ–­æ·»åŠ æ¶ˆæ¯ï¼Œå¡«æ»¡ä½ çš„æœåŠ¡å™¨ç¡¬ç›˜ã€‚å› æ­¤ï¼Œä¸ºäº†å®‰å…¨ï¼Œç³»ç»Ÿé»˜è®¤å…³é—­äº† guest è´¦å·çš„è¿œç¨‹è®¿é—®æƒé™ï¼Œè¿™ä¹Ÿæ˜¯å®˜æ–¹å‡ºäºå®‰å…¨è€ƒè™‘çš„æªæ–½ã€‚å…³äºå¦‚ä½•åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œä¸åœ¨è¿™é‡Œæ¼”ç¤ºï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£è¿›è¡Œæ“ä½œï¼š
[https://www.rabbitmq.com/docs/access-control](https://www.rabbitmq.com/docs/access-control)
#### 3.2.2 Linux å®‰è£…
å®‰è£…Docker
```
sudo yum install docker-ce
```
å®‰è£…å®ŒDockeråï¼Œå¯åŠ¨DockeræœåŠ¡ï¼š
```
sudo systemctl start docker
```
é€šè¿‡ docke ræ‹‰å– rabbitmq é•œåƒï¼š
```
sudo docker pull rabbitmq:ç‰ˆæœ¬å·
docker pull rabbitmq:3.9-management
```
è¯·å°† "ç‰ˆæœ¬å·" æ›¿æ¢ä¸ºæ‚¨æƒ³è¦çš„RabbitMQç‰ˆæœ¬å·ã€‚å¦‚æœä¸æŒ‡å®šç‰ˆæœ¬å·ï¼Œåˆ™ä¼šæ‹‰å–æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ã€‚
å®Œæˆé•œåƒæ‹‰å–åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨RabbitMQå®¹å™¨ï¼š
```
sudo docker run -d --name myrabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:ç‰ˆæœ¬å·
sudo docker run -d --name myrabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.9-management
```
åŒæ ·ï¼Œè¯·å°†"ç‰ˆæœ¬å·"æ›¿æ¢ä¸ºæ‚¨ä¹‹å‰é€‰æ‹©çš„RabbitMQç‰ˆæœ¬å·ã€‚
å®¹å™¨å¯åŠ¨åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š
```
sudo docker ps
```
å¦‚æœèƒ½çœ‹åˆ°åˆšåˆšå¯åŠ¨çš„RabbitMQå®¹å™¨æ­£åœ¨è¿è¡Œï¼Œé‚£ä¹ˆæ­å–œæ‚¨å·²æˆåŠŸåœ¨CentOSä¸Šä½¿ç”¨Dockerå®‰è£…äº†RabbitMQã€‚
è¿˜åœ¨å°†æœåŠ¡å™¨çš„1562ã€5672ç«¯å£å¼€æ”¾ï¼Œ
æœ€åï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® `http:// æœåŠ¡å™¨IPåœ°å€:15672` æ¥æ‰“å¼€RabbitMQçš„WebUIç®¡ç†ç•Œé¢ï¼Œé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯"guest"ã€‚å¯ä»¥è¿›è¡Œç”¨æˆ·è®¾ç½®ã€é˜Ÿåˆ—ç®¡ç†ç­‰æ“ä½œã€‚
Linuxä¸‹çš„RabbitMQæ–°å¢ä¸€ä¸ªç”¨æˆ·ï¼Œåˆ†åˆ«æ‰§è¡Œä»¥ä¸‹çš„å‘½ä»¤ï¼š
```bash
# æŸ¥çœ‹rabbitmq è¿è¡Œçš„å®¹å™¨id
dcker ps
## è¿›å…¥æ­£åœ¨è¿è¡Œçš„ RabbitMQ å®¹å™¨çš„ Shellã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆå°† <container_id> æ›¿æ¢ä¸ºå®é™…çš„å®¹å™¨ IDï¼‰ï¼š
docker exec -it <container_id> /bin/bash
# æ·»åŠ æ–°ç”¨æˆ·
rabbitmqctl add_user ç”¨æˆ·å å¯†ç 
# ç®¡ç†å‘˜æƒé™
rabbitmqctl set_user_tags ä¸Šé¢çš„ç”¨æˆ·å administrator 
# åˆ—å‡ºç”¨æˆ·åˆ—è¡¨
rabbitmqctl list_users
# ç›®å½•æƒé™
# ç¬¬ä¸€ä¸ª".*" ç”¨äºåœ¨æ¯ä¸ªå®ä½“ä¸Šé…ç½®æƒé™
# ç¬¬äºŒä¸ª".*" è¡¨ç¤ºå¯¹æ¯ä¸ªå®ä½“çš„å†™å…¥æƒé™
# ç¬¬ä¸‰ä¸ª".*â€ å¯¹æ¯ä¸ªå®ä½“çš„è¯»å–æƒé™
rabbitmqctl set_permissions -p "/" "ç”¨æˆ·å" ".*" ".*" ".*"
```

### 3.3 å¿«é€Ÿå…¥é—¨
ç°åœ¨æˆ‘ä»¬çš„ RabbitMQ å·²ç»ç®—å¯åŠ¨äº†ï¼Œå»å®˜ç½‘ç‚¹å‡» RabbitMQ Tutorials
[https://www.rabbitmq.com/tutorials](https://www.rabbitmq.com/tutorials)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723706297781-722c1c0f-c767-4cda-8c10-7f3f55f6075f.png#averageHue=%23faf8f7&clientId=u4ca622be-41e5-4&from=paste&height=1337&id=uced6f59c&originHeight=1605&originWidth=2849&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=476469&status=done&style=none&taskId=ub3d01f0e-8dce-479a-8965-20f8e300617&title=&width=2374.1665723257634)
#### 3.3.1 å•å‘å‘é€
> ä¸€ä¸ªç”Ÿäº§è€…ç»™ä¸€ä¸ªé˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­è·å–åˆ°æ¶ˆæ¯ã€‚1 å¯¹ 1 å…³ç³»

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230617172656480.png#id=APDHM&originHeight=225&originWidth=978&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
å¼•å…¥Rabbit MQ ç»„ä»¶ä¾èµ–
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723706381465-261a4d3e-5123-4292-bbe9-49c67250ab72.png#averageHue=%23fdfcfb&clientId=u4ca622be-41e5-4&from=paste&height=1305&id=ucd2108f3&originHeight=1566&originWidth=2815&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=439509&status=done&style=none&taskId=u77f719ca-2863-4a1b-bc7d-191b7ad56ea&title=&width=2345.833240118295)
è¿™é‡Œç›´æ¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723706435408-2e6ccc5f-47bf-4c03-9f0f-f91c83bc24da.png#averageHue=%23f9f9f8&clientId=u4ca622be-41e5-4&from=paste&height=657&id=ue34d74e8&originHeight=789&originWidth=1496&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=102918&status=done&style=none&taskId=ub1c56bb5-0bba-461f-ac8a-d6da387d216&title=&width=1246.666617128586)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723706492942-a5a6fc48-e601-4580-916b-e7d84a3e9d6b.png#averageHue=%23faf9f9&clientId=u4ca622be-41e5-4&from=paste&height=1335&id=u8a88cf54&originHeight=1602&originWidth=2838&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=380082&status=done&style=none&taskId=u9157f758-52ce-4561-9866-21939625bc3&title=&width=2364.999906023347)
```xml
<!-- https://mvnrepository.com/artifact/com.rabbitmq/amqp-client -->
<dependency>
    <groupId>com.rabbitmq</groupId>
    <artifactId>amqp-client</artifactId>
    <version>5.16.0</version>
</dependency>

<!-- https://mvnrepository.com/artifact/com.rabbitmq/amqp-client -->
<dependency>
    <groupId>com.rabbitmq</groupId>
    <artifactId>amqp-client</artifactId>
    <version>5.21.0</version>
</dependency>
```
å›åˆ°å®˜æ–¹æ–‡æ¡£ï¼Œå¾€ä¸‹æ»‘ï¼š 
å®ƒè¯´ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯å‘é€è€…è´Ÿè´£å‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯ã€‚
> é—®ï¼šåˆšåˆšæˆ‘ä»¬å¯åŠ¨çš„æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼šä¸€ä¸ª RabbitMQ çš„æœåŠ¡ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„æ¶æ„æ¨¡å‹ã€‚ é—®ï¼šä½†æ˜¯è¿™ä¸ªæ¶ˆæ¯ç”Ÿäº§è€…ã€æ¶ˆæ¯å‘é€è€…ä»¥åŠæ¶ˆæ¯æ¶ˆè´¹è€…éƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ç­”ï¼šæ˜¯æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬è‡ªå·±çš„ç³»ç»Ÿã€‚

å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦åšçš„å°±æ˜¯å¼€å‘æ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚ä»–å±•ç¤ºäº†ç”Ÿäº§è€…çš„ä»£ç ï¼Œå¹¶ä¸”å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ä»¥ä¸‹çš„ä»£ç æ¥å‘é€æ¶ˆæ¯ã€‚ä¸è¿‡ï¼Œä½ ä¸å¿…å…³æ³¨è¿™äº›ç¢ç‰‡åŒ–çš„ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥çœ‹è¿™ä»½å®Œæ•´çš„ä»£ç ï¼Œå¹¶å°†å…¶å®Œæ•´å¤åˆ¶ä¸‹æ¥ï¼Œå®é™…ä¸Šè¿™åªæ˜¯ä¸€ä¸ªç°æˆçš„ demoï¼Œéå¸¸ç®€å•ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723707704461-22395c90-10e5-49c3-a867-c0be6012c9e6.png#averageHue=%23debd9c&clientId=u4ca622be-41e5-4&from=paste&height=1374&id=u2f1e4509&originHeight=1649&originWidth=2813&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=449238&status=done&style=none&taskId=uc221c45e-7010-4f98-8547-330cbd572b8&title=&width=2344.1665735178562)
åœ¨åç«¯æ–°å»º mqåŒ… ï¼Œé€‰ä¸­è¿™ä¸ªåŒ…
```java
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

import java.nio.charset.StandardCharsets;

public class Send {

    private final static String QUEUE_NAME = "hello";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        try (Connection connection = factory.newConnection();
             Channel channel = connection.createChannel()) {
            channel.queueDeclare(QUEUE_NAME, false, false, false, null);
            String message = "Hello World!";
            channel.basicPublish("", QUEUE_NAME, null, message.getBytes(StandardCharsets.UTF_8));
            System.out.println(" [x] Sent '" + message + "'");
        }
    }
}
```
æ”¹åä¸ºç”Ÿäº§è€…ä»£ç 
ä¿®æ”¹ç±»åä¸º SingleProducer ï¼Œé€‰ä¸­ç±»åï¼Œå¹¶æŒ‰[Shift+F6]é‡æ„
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

import java.nio.charset.StandardCharsets;
/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-15 15:43
 **/
public class SingleProducer {

    private final static String QUEUE_NAME = "hello";

    public static void main(String[] argv) throws Exception {
        // åˆ›å»ºé“¾æ¥å·¥åœº
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
//        factory.setUsername("xxxx");
//        factory.setPassword("xxxx");
//        factory.setHost("xxxx");
        try (Connection connection = factory.newConnection();
             // å»ºç«‹é“¾æ¥ï¼Œå¸¸è§é¢‘é“
             Channel channel = connection.createChannel()) {
            // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—
            channel.queueDeclare(QUEUE_NAME, false, false, false, null);
            String message = "Hello World!";
            channel.basicPublish("", QUEUE_NAME, null, message.getBytes(StandardCharsets.UTF_8));
            System.out.println(" [x] Sent '" + message + "'");
        }
    }
}
```
Channel é¢‘é“ï¼šç†è§£ä¸ºæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—çš„client(æ¯”å¦‚ JDBCClientã€redisClient)ï¼Œæä¾›äº†å’Œæ¶ˆæ¯é˜Ÿåˆ—serverå»ºç«‹é€šä¿¡çš„ä¼ è¾“æ–¹æ³•ï¼ˆä¸ºäº†å¤ç”¨è¿æ¥ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ï¼‰ã€‚ç¨‹åºé€šè¿‡channelæ“ä½œ rabbitmq (æ”¶å‘æ¶ˆæ¯)
> ä½ å¯ä»¥å°†é¢‘é“çœ‹ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯èƒ½å·²ç»æ¥è§¦è¿‡å…¶ä»–ç±»å‹çš„å®¢æˆ·ç«¯ï¼Œå¦‚ JDBCï¼ˆç”¨äºè¿æ¥æ•°æ®åº“ï¼‰ å’Œ Redis Clientï¼ˆç”¨äºæ“ä½œç¼“å­˜ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å°†é¢‘é“çœ‹ä½œæ˜¯ç”¨äºæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—çš„å®¢ æˆ·ç«¯ã€‚ 
> é¢‘é“(Channel)æä¾›äº†ä¸€ç§ä¸ RabbitMQ æœåŠ¡å™¨é€šä¿¡çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å»ºç«‹ä¸ 
> RabbitMQ æœåŠ¡å™¨çš„è¿æ¥ã€‚å¦‚æœä½ ä¹‹å‰å­¦ä¹ è¿‡ Nettyï¼Œå¯¹ Channel çš„æ¦‚å¿µå¯èƒ½æ›´ä¸ºç†Ÿæ‚‰ã€‚ 
> RabbitMQ ä¿ç•™ Channel çš„åŸå› åœ¨äºå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°è¿æ¥å¤ç”¨ï¼Œä»è€Œæé«˜ä¼ è¾“æ•ˆç‡ã€‚æ‰€æœ‰ çš„ä»»åŠ¡éƒ½äº¤ç»™ Channel å»ç»Ÿä¸€å¤„ç†ã€‚

```java
Queue.DeclareOk queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete,
                             Map<String, Object> arguments) throws IOException;
```
åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—çš„å‚æ•°è¯´æ˜ï¼š

-  queueNameï¼šæ¶ˆæ¯é˜Ÿåˆ—åç§°ï¼ˆæ³¨æ„ï¼ŒåŒåç§°çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªèƒ½ç”¨åŒæ ·çš„å‚æ•°åˆ›å»ºä¸€æ¬¡ï¼‰ 
-  durabaleï¼šæ¶ˆæ¯é˜Ÿåˆ—é‡å¯åï¼Œæ¶ˆæ¯æ˜¯å¦ä¸¢å¤±ï¼ŒæŒä¹…åŒ–å¤„ç† 
-  exclusiveï¼šæ˜¯å¦**åªå…è®¸å½“å‰è¿™ä¸ªåˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—**çš„è¿æ¥æ“ä½œæ¶ˆæ¯é˜Ÿåˆ— 
-  autoDeleteï¼šæ²¡æœ‰äººç”¨é˜Ÿåˆ—åï¼Œæ˜¯å¦è¦åˆ é™¤é˜Ÿåˆ— 

æ‰“å°å‡ºäº† System.out.println å†…çš„å†…å®¹ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723741190424-f0bd0b45-b43b-4e5d-aef2-eba8422c08aa.png#averageHue=%232b303a&clientId=u4ca622be-41e5-4&from=paste&height=421&id=u0f76bc50&originHeight=505&originWidth=2579&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=80370&status=done&style=none&taskId=u51cfc1c7-269b-4cf8-adb8-b22d42e0e27&title=&width=2149.1665812664596)
è®¿é—®:
[http://localhost:15672/#/queues](http://localhost:15672/#/queues)
é»˜è®¤ç”¨æˆ·åå¯†ç éƒ½æ˜¯ 
guestï¼Œç‚¹å‡» Login ã€‚
ç‚¹å‡» Queues and streamsï¼Œå¯ä»¥æŸ¥çœ‹åˆ°ä¸€ä¸ªåå« hello çš„é˜Ÿåˆ—
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723741254734-1d9f87bd-c735-4704-9ba7-0f2d0ef3b92c.png#averageHue=%23f8f8f0&clientId=u4ca622be-41e5-4&from=paste&height=1347&id=ua6af075c&originHeight=1617&originWidth=2829&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=259344&status=done&style=none&taskId=uff75f553-c066-4dcc-9376-790bed158e6&title=&width=2357.4999063213704)
æ¶ˆæ¯å‘é€å¥½ä¹‹åï¼Œæ¥ä¸‹æ¥è¦å»æ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œç»§ç»­çœ‹å®˜æ–¹æ–‡æ¡£ï¼ŒæŸ¥çœ‹å®Œæ•´ç‰ˆçš„æ¶ˆè´¹è€…ä»£ç ã€‚
æ¶ˆè´¹è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.DeliverCallback;
import java.nio.charset.StandardCharsets;
/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-16 01:05
 **/

public class SingleConsumer {
    private final static String QUEUE_NAME = "hello";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        channel.queueDeclare(QUEUE_NAME, false, false, false, null);
        System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

        DeliverCallback deliverCallback = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), StandardCharsets.UTF_8);
            System.out.println(" [x] Received '" + message + "'");
        };
        channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -> { });
    }
}
```
 **ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œéƒ½è¦åˆ›å»ºé˜Ÿåˆ—å‘¢ï¼Ÿ **
ä¸»è¦æ˜¯ä¸ºäº†ç¡®ä¿è¯¥é˜Ÿåˆ—çš„å­˜åœ¨ï¼Œå¦åˆ™åœ¨åç»­çš„æ“ä½œä¸­å¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚ä¸»è¦æ˜¯ä¸ºäº†è¿™ç‚¹ï¼Œå³ä¾¿ä½ çš„é˜Ÿåˆ—åŸæœ¬å¹¶ä¸å­˜åœ¨ï¼Œæ­¤è¯­å¥ä¹Ÿèƒ½å¤Ÿå¸®ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ã€‚ä½†æ˜¯éœ€è¦ç‰¹åˆ«æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœä½ çš„é˜Ÿåˆ—å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”ä½ æƒ³å†æ¬¡æ‰§è¡Œå£°æ˜é˜Ÿåˆ—çš„æ“ä½œï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å‚æ•°å¿…é¡»ä¸ä¹‹å‰çš„è®¾ç½®å®Œå…¨ä¸€è‡´ã€‚è¿™æ˜¯å› ä¸ºä¸€æ—¦ä¸€ä¸ªé˜Ÿåˆ—å·²ç»è¢«åˆ›å»ºï¼Œå°±ä¸èƒ½å†åˆ›å»ºä¸€ä¸ªä¸å…¶å‚æ•°ä¸ä¸€è‡´çš„åŒåé˜Ÿåˆ—ã€‚å¯ä»¥ç±» æ¯”ä¸ºï¼Œä¸€æ—¦ä½ å»ºå¥½äº†ä¸€ä¸ªå¿«é€’ç«™ï¼Œå°±ä¸èƒ½å†åœ¨åŒä¸€ä½ç½®å»ºç«‹ä¸€ä¸ªä¸ä¹‹ä¸åŒçš„å¿«é€’ç«™ã€‚ 
**æ³¨æ„ï¼š**è¯·ç¡®ä¿æ¶ˆè´¹é˜Ÿåˆ—çš„åç§°ä¸å‘é€æ¶ˆæ¯çš„é˜Ÿåˆ—åç§°ä¿æŒä¸€è‡´ã€‚æ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç»Ÿä¸€ä½¿ 
ç”¨"hello"ä½œä¸ºé˜Ÿåˆ—åã€‚
ç°åœ¨æ‰§è¡Œä¹‹åèƒ½ç«‹åˆ»æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯ï¼Œå› ä¸ºä¹‹å‰å·²ç»å‘äº†ä¸€ä¸ªæ¶ˆæ¯äº†ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723741741761-07ff89ad-054c-45e3-97bb-94c9010cac9d.png#averageHue=%23292e38&clientId=u4ca622be-41e5-4&from=paste&height=474&id=u72a8ffad&originHeight=569&originWidth=2406&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=59594&status=done&style=none&taskId=u5c674d9e-08e2-42c0-933c-18139778cb8&title=&width=2004.9999203284613)
è¿™æ—¶å€™å†çœ‹ç®¡ç†é¡µé¢ï¼Œå˜æˆ 0 äº†ï¼Œå·²ç»æ¶ˆè´¹å®Œäº†ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723741785054-bebe7f56-c31d-457a-94cf-2b24b2ea6745.png#averageHue=%23f8f7f0&clientId=u4ca622be-41e5-4&from=paste&height=1353&id=u37178f45&originHeight=1624&originWidth=2847&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=276106&status=done&style=none&taskId=u6820d298-087b-491b-ac37-2d51a5e3942&title=&width=2372.499905725324)
ç‚¹è¿›æ¥ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723741816096-2ff65c5a-3b8e-49a6-9811-41f822979d80.png#averageHue=%23f7f7f6&clientId=u4ca622be-41e5-4&from=paste&height=1139&id=uf5f1ef6a&originHeight=1367&originWidth=2807&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=199339&status=done&style=none&taskId=u025dbcae-c261-40ae-ae19-d6479696adb&title=&width=2339.166573716538)
æ˜¯ä¸æ˜¯å†å²æ¶ˆè´¹è¿‡ä¸€æ¡æ¶ˆæ¯ï¼Œç°åœ¨æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚
å›åˆ°ç®¡ç†é¡µé¢ï¼Œä¼šçœ‹åˆ°æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œäº†(å¤ªå¿«äº†)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723741921227-a65c6355-fc62-46ff-a46e-8e6730bc1eb3.png#averageHue=%23f9f8f8&clientId=u4ca622be-41e5-4&from=paste&height=1211&id=u1bc9a211&originHeight=1453&originWidth=2799&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=227519&status=done&style=none&taskId=u205a8868-ce59-4c99-99bf-3a76bb72ae1&title=&width=2332.499907314781)

#### 3.3.2 å¤šæ¶ˆè´¹è€… ï¼ˆä½¿ç”¨è¾ƒå°‘ï¼‰
> åœºæ™¯ï¼šå¤šä¸ªæœºå™¨åŒæ—¶å»æ¥å—å¹¶å¤„ç†ä»»åŠ¡ï¼ˆå°¤å…¶æ˜¯æ¯ä¸ªæœºå™¨çš„å¤„ç†èƒ½åŠ›æœ‰é™ï¼‰
> ä¸€ä¸ªç”Ÿäº§è€…ç»™ä¸€ä¸ªé˜Ÿåˆ—å‘æ¶ˆæ¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ä»è¿™ä¸ªé˜Ÿåˆ—å–æ¶ˆæ¯ã€‚1 å¯¹ å¤šå…³ç³»ã€‚
> - è¿™æœ‰ç‚¹åƒå‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼Œé€‚ç”¨äºä»€ä¹ˆåœºæ™¯å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œç”±äºå…¶æ€§èƒ½æœ‰é™ï¼Œå¯èƒ½æ— æ³•å¤„ç†æ‰€æœ‰ä»»åŠ¡ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ æœºå™¨æ¥æé«˜å¤„ç†èƒ½åŠ›ã€‚å‡è®¾ä¸€ä¸ªç”Ÿäº§è€…åœ¨ä¸æ–­åœ°ç”Ÿæˆä»»åŠ¡ï¼Œä½†ä¸€ä¸ªæ¶ˆè´¹è€…æ— æ³•å…¨éƒ¨å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ªæ¶ˆè´¹è€…æ¥å…±åŒå®Œæˆè¿™äº›ä»» åŠ¡ã€‚å› æ­¤ï¼Œè¿™ç§åœºæ™¯ç‰¹åˆ«é€‚åˆäºå¤šä¸ªæœºå™¨åŒæ—¶æ¥æ”¶å¹¶å¤„ç†ä»»åŠ¡ï¼Œå°¤å…¶æ˜¯åœ¨æ¯ä¸ªæœºå™¨çš„å¤„ç†èƒ½åŠ›æœ‰é™çš„æƒ…å†µä¸‹ã€‚
> - æœ‰åŒå­¦æå‡ºï¼Œä¸€ä¸ªUPä¸»å‘å¸ƒçš„è§†é¢‘è¢«ç™¾ä¸‡ç²‰ä¸è§‚çœ‹ï¼Œè¿™ä¸ªæ„Ÿè§‰åƒæ˜¯å‘å¸ƒ-è®¢é˜…æ¨¡å‹ã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸ªåœºæ™¯ä¸æˆ‘ä»¬ç°åœ¨è®¨è®ºçš„å¹¶ä¸å®Œå…¨ç›¸åŒã€‚

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230617173154369.png#id=RdCL4&originHeight=288&originWidth=856&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ç»§ç»­å‘ä¸‹æµè§ˆï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªè½®è¯¢åˆ†é…ç®—æ³•ã€‚å°±æ˜¯è¯´å¦‚æœç”Ÿäº§è€…è¿ç»­å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆæ¯å°†ä¼šæŒ‰ç…§è½®è¯¢çš„æ–¹å¼åˆ†é…ç»™æ¶ˆè´¹è€…ã€‚å³ï¼Œç¬¬ä¸€æ¡æ¶ˆæ¯ä¼šè¢«ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…å–èµ°ï¼Œ ç¬¬äºŒæ¡æ¶ˆæ¯åˆ™ä¼šè¢«ç¬¬äºŒä¸ªæ¶ˆè´¹è€…å–èµ°ã€‚è¿™æ ·çš„åˆ†é…æ–¹å¼ä½¿å¾—ä»»åŠ¡åˆ†å·¥æ›´ä¸ºåˆç†ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723742988173-11afbbc0-84f7-461d-b442-78d237c378fe.png#averageHue=%23d59f6b&clientId=u4ca622be-41e5-4&from=paste&height=1332&id=u4f2c483a&originHeight=1599&originWidth=2819&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=428718&status=done&style=none&taskId=uf80ec1b1-2b39-426a-94de-b8824d5dcd8&title=&width=2349.166573319174)
å†å¾€ä¸‹æ»‘ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå«æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ŒæŒºé‡è¦çš„(ä¸‹æœŸè®²)ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723743015001-b41b8dc8-0a7c-43e1-97c9-4158f06a8bb2.png#averageHue=%23fdfcfb&clientId=u4ca622be-41e5-4&from=paste&height=1317&id=uc41af95b&originHeight=1581&originWidth=2871&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=532292&status=done&style=none&taskId=u4414d6f6-39ca-4776-9b20-6652411bcd3&title=&width=2392.499904930595)
å¾€ä¸‹æ»‘ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå«æ¶ˆæ¯æŒä¹…åŒ–(ä¸‹æœŸè®²)ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723743035846-24bd7442-8105-4470-b004-fdbd6eee1b7d.png#averageHue=%23fdfcfb&clientId=u4ca622be-41e5-4&from=paste&height=1322&id=ue7e548ca&originHeight=1586&originWidth=2841&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=500537&status=done&style=none&taskId=uc68a3d09-abeb-4363-a46b-d58b25f97df&title=&width=2367.4999059240063)
å¾€ä¸‹æ»‘ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå«å…¬å¹³åˆ†é…ï¼Œå°±æ˜¯åˆšåˆšè¯´çš„ä¸€äººåˆ†ä¸€æ¡ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723743054671-e9f7d44a-5703-4005-840e-35ab268a6b44.png#averageHue=%23fdfcfb&clientId=u4ca622be-41e5-4&from=paste&height=1338&id=ub7daa974&originHeight=1606&originWidth=2868&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=516657&status=done&style=none&taskId=u3b2479a6-a4ac-4c87-9885-e24ede220ed&title=&width=2389.9999050299366)
å¾€ä¸‹æ»‘ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œå« Putting it all together(æŠŠæ‰€æœ‰çš„ä»£ç å…¨æ”¾åœ¨ä¸€èµ·)ï¼› å¤åˆ¶è¿™æ®µä»£ç ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723743087553-592d6a95-2540-4018-bce5-8fd8e4200b47.png#averageHue=%2378776a&clientId=u4ca622be-41e5-4&from=paste&height=1327&id=u12420af8&originHeight=1592&originWidth=2874&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=479102&status=done&style=none&taskId=ua12e4d84-86a6-429c-9fc6-3efbed0d5d2&title=&width=2394.9999048312543)
##### 1ï¼‰é˜Ÿåˆ—æŒä¹…åŒ–
ç¬¬äºŒä¸ªå‚æ•°ï¼šdurable å‚æ•°è®¾ç½®ä¸º true ï¼ŒæœåŠ¡å™¨é‡å¯åé˜Ÿåˆ—ä¸ä¸¢å¤±
```java
channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);
```

##### 2ï¼‰æ¶ˆæ¯æŒä¹…åŒ–
å°† basicPublish ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¸º MessageProperties.PERSISTENT_TEXT_PLAIN ï¼š
```java
channel.basicPublish("", TASK_QUEUE_NAME,
       MessageProperties.PERSISTENT_TEXT_PLAIN,
       message.getBytes("UTF-8"));
```

##### 3ï¼‰ç”Ÿäº§è€…ä»£ç ï¼š
ä½¿ç”¨ Scanner æ¥å—ç”¨æˆ·è¾“å…¥ï¼Œä¾¿äºå‘é€å¤šæ¡æ¶ˆæ¯
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.MessageProperties;

import java.util.Scanner;

public class MultiProducer {

  private static final String TASK_QUEUE_NAME = "multi_queue";

  public static void main(String[] argv) throws Exception {
    ConnectionFactory factory = new ConnectionFactory();
    factory.setHost("localhost");
    try (Connection connection = factory.newConnection();
         Channel channel = connection.createChannel()) {
        // åˆ›å»ºé˜Ÿåˆ—
        channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);

        Scanner scanner = new Scanner(System.in);
        while (scanner.hasNext()){
            String message = scanner.nextLine();
            channel.basicPublish("", TASK_QUEUE_NAME,
                    MessageProperties.PERSISTENT_TEXT_PLAIN,
                    message.getBytes("UTF-8"));
            System.out.println(" [x] Sent '" + message + "'");
        }
    }
  }

}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723743369321-bbf92fa2-2565-4b20-bf59-759ad9c5dcc6.png#averageHue=%23282d35&clientId=u4ca622be-41e5-4&from=paste&height=1284&id=u07d396fd&originHeight=1541&originWidth=2810&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=319274&status=done&style=none&taskId=u8d82dd0d-48e2-4326-ac60-afc094cbf94&title=&width=2341.666573617197)
totalæ€»æ•°ä¸º4
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723743401203-6469b776-0d27-4d59-9d9a-dce72277a7a6.png#averageHue=%23f8f7ef&clientId=u4ca622be-41e5-4&from=paste&height=1292&id=u4e281ec2&originHeight=1551&originWidth=2860&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=271715&status=done&style=none&taskId=u2c9975dd-598e-4959-b02d-fd8477482d1&title=&width=2383.333238628179)
å¦‚æœæ¶ˆæ¯ä¸å°å¿ƒåˆ·å¤šäº†ï¼Œæ€ä¹ˆåˆ æ‰è¿™ä¸ªé˜Ÿåˆ—ï¼Ÿ 
###### 1. åœ¨ RabbitMQ ç®¡ç†ç•Œé¢ä¸­åˆ é™¤é˜Ÿåˆ—(æ¨è) 
åœ¨ RabbitMQ çš„ç®¡ç†ç•Œé¢ï¼Œç‚¹å‡»"Queues"é€‰é¡¹ï¼Œæ‰¾åˆ°ä½ æƒ³è¦åˆ é™¤çš„é˜Ÿåˆ—ï¼Œç‚¹å‡»é˜Ÿåˆ—åç§°è¿›å…¥è¯¦æƒ…é¡µé¢ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723744092863-50652d53-7501-4105-9986-cd9142ac228d.png#averageHue=%23f5f5f5&clientId=u4ca622be-41e5-4&from=paste&height=362&id=ua5cecd39&originHeight=435&originWidth=2305&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=59771&status=done&style=none&taskId=u623abfa1-e5ff-4795-89f3-66b646ea7cd&title=&width=1920.8332570062773)
åœ¨è¯¦æƒ…é¡µé¢ä¸‹æ–¹ï¼Œç‚¹å‡»"Delete"æŒ‰é’®ï¼Œç¡®è®¤åˆ é™¤æ“ä½œå³å¯ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723744123588-7d963dd9-3a7a-4d08-ad3b-8d53877143ec.png#averageHue=%23f9f8f2&clientId=u4ca622be-41e5-4&from=paste&height=1247&id=u12e5c28c&originHeight=1496&originWidth=2880&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=203754&status=done&style=none&taskId=ud1ecae57-5117-418d-8044-cfb39502495&title=&width=2399.999904632572)
###### 2. åœ¨ä»£ç ä¸­åˆ é™¤é˜Ÿåˆ— 
åœ¨ RabbitMQ çš„å®¢æˆ·ç«¯åº“ä¸­(å¦‚ Java çš„ RabbitMQ å®¢æˆ·ç«¯åº“)ï¼Œé€šå¸¸æä¾›äº†åˆ é™¤é˜Ÿåˆ—çš„å‡½æ•°ã€‚åœ¨ Java çš„RabbitMQ å®¢æˆ·ç«¯åº“ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ Channel çš„ queueDelete æ–¹æ³•åˆ é™¤é˜Ÿåˆ—ã€‚ å¦‚ï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723744447055-611ac273-fda9-4a68-9f5b-ad7c91711a6b.png#averageHue=%23292e37&clientId=u4ca622be-41e5-4&from=paste&height=527&id=u8c7d9232&originHeight=633&originWidth=2419&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=68009&status=done&style=none&taskId=udedbc8ab-c149-4fe7-8702-640ea2b3ff5&title=&width=2015.8332532313166)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723744424850-284e08ad-2baa-475c-85bf-a51f5c4fd72b.png#averageHue=%23f8f7f7&clientId=u4ca622be-41e5-4&from=paste&height=1247&id=u33521bad&originHeight=1496&originWidth=2880&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=215265&status=done&style=none&taskId=ubc54f060-97bb-4ed4-b4b1-b96832afb7c&title=&width=2399.999904632572)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723744474006-39790abd-fe6f-440d-953b-f277d5107e64.png#averageHue=%23f9f9f8&clientId=u4ca622be-41e5-4&from=paste&height=90&id=u7b29c4bd&originHeight=108&originWidth=625&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=18742&status=done&style=none&taskId=u9522a48a-859a-4afb-893e-7933f593cb9&title=&width=520.8333126372769)
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.MessageProperties;

import java.util.Scanner;
/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-16 01:50
 **/

public class delete {
    private static final String TASK_QUEUE_NAME = "multi_queue";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        try (Connection connection = factory.newConnection();
             // è·å–RabbitMQçš„Channel
             Channel channel = connection.createChannel()) {
            // éœ€è¦åˆ é™¤çš„é˜Ÿåˆ—å
            channel.queueDelete(TASK_QUEUE_NAME);
        }
    }
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723744508925-f238e0d2-eb4a-4ab9-aa23-e516623d16f5.png#averageHue=%23f8f8f7&clientId=u4ca622be-41e5-4&from=paste&height=1247&id=uf9802c79&originHeight=1496&originWidth=2880&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=201353&status=done&style=none&taskId=uad6c6193-0fe8-413b-8fdb-627527c0e64&title=&width=2399.999904632572)
##### 4ï¼‰æ¶ˆè´¹è€…ä»£ç ï¼š
```java
/**
 * @author Shier
 */
public class MultiConsumer {

    private static final String TASK_QUEUE_NAME = "multi_queue";

    public static void main(String[] argv) throws Exception {
        // å»ºç«‹é“¾æ¥
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("xxxxx.xxxx.xxxx");
        factory.setUsername("xxxx.xxxx.xxx");
        factory.setPassword("xxx.xxx.xxx");
        final Connection connection = factory.newConnection();

        for (int i = 0; i < 2; i++) {
            // åˆ›å»ºä¸¤ä¸ªæ¶ˆè´¹è€…é¢‘é“
            final Channel channel = connection.createChannel();
            channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);
            System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

            // æ§åˆ¶å½“ä¸ªæ¶ˆè´¹è€…çš„ç§¯å‹æ•°
            channel.basicQos(1);

            int finalI = i;
            DeliverCallback deliverCallback = (consumerTag, delivery) -> {

                String message = new String(delivery.getBody(), "UTF-8");
                try {
                    // å¤„ç†å·¥ä½œ
                    System.out.println(" [x] Received 'æ¶ˆè´¹è€…ï¼š" + finalI + "ï¼Œæ¶ˆè´¹äº†ï¼š" + message + "'");
                    // æŒ‡å®šå–æŸæ¡æ¶ˆæ¯
                    channel.basicAck(delivery.getEnvelope().getDeliveryTag(),false);
                    // åœ20ç§’ æ¨¡æ‹Ÿæœºå™¨å¤„ç†èƒ½åŠ›æœ‰é™
                    Thread.sleep(10000);
                } catch (InterruptedException e) {
                    e.getStackTrace();
                    // ç¬¬ä¸‰ä¸ªå‚æ•°
                    channel.basicNack(delivery.getEnvelope().getDeliveryTag(),false,false);
                } finally {
                    System.out.println(" [x] Done");
                    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                }
            };
            // å¼€å¯æ¶ˆè´¹ç›‘å¬ï¼Œä¼šä¸€ç›´ç›‘å¬ç”Ÿäº§è€…çš„æ¶ˆæ¯
            channel.basicConsume(TASK_QUEUE_NAME, false, deliverCallback, consumerTag -> {
            });
        }
    }
}
```
æ§åˆ¶å•ä¸ªæ¶ˆè´¹è€…çš„å¤„ç†ä»»åŠ¡ç§¯å‹æ•°ï¼šæ¯ä¸ªæ¶ˆè´¹è€…æœ€å¤šåŒæ—¶å¤„ç†1ä¸ªä»»åŠ¡
```java
channel.basicQos(1);
```
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.DeliverCallback;

public class MultiConsumer {

  private static final String TASK_QUEUE_NAME = "multi_queue";

  public static void main(String[] argv) throws Exception {
      // å»ºç«‹é“¾æ¥
    ConnectionFactory factory = new ConnectionFactory();
      // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
    factory.setHost("localhost");
    final Connection connection = factory.newConnection();
    final Channel channel = connection.createChannel();

    channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);
    System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

    channel.basicQos(1);

    // å®šä¹‰å¦‚ä½•å¤„ç†æ¶ˆæ¯
    DeliverCallback deliverCallback = (consumerTag, delivery) -> {
        String message = new String(delivery.getBody(), "UTF-8");

//        System.out.println(" [x] Received '" + message + "'");
        try {
            // è‡ªå·±å®šä¹‰å¤„ç†çš„å·¥ä½œ
            System.out.println(" [x] Received '" + message + "'");
//            doWork(message);
            // åœ20sï¼Œæ¨¡æ‹Ÿæœºå™¨å¤„ç†èƒ½åŠ›
            Thread.sleep(20000);
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        } finally {
            System.out.println(" [x] Done");
            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
        }
    };
    channel.basicConsume(TASK_QUEUE_NAME, false, deliverCallback, consumerTag -> { });
  }

//  private static void doWork(String task) {
//    for (char ch : task.toCharArray()) {
//        if (ch == '.') {
//            try {
//                Thread.sleep(1000);
//            } catch (InterruptedException _ignored) {
//                Thread.currentThread().interrupt();
//            }
//        }
//    }
//  }
}
```
ç»“æœï¼š
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723744841115-cff11f64-4e39-436a-81b0-fb2dfb05a263.png#averageHue=%232a2f39&clientId=u4ca622be-41e5-4&from=paste&height=518&id=uaaebf284&originHeight=622&originWidth=2649&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=92551&status=done&style=none&taskId=ua070aeff-c759-43d1-a20b-01670aa7003&title=&width=2207.4999122818344)
å®Œæ•´ä»£ç ï¼Œç„¶åå†™ä¸ª for å¾ªç¯ï¼ŒæŠŠä»è¿æ¥è·å–ä¸€ä¸ªæ–°çš„é€šé“çš„ä»£ç éƒ½æ”¾è¿›å»
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.DeliverCallback;

public class MultiConsumer {

    private static final String TASK_QUEUE_NAME = "multi_queue";

    public static void main(String[] argv) throws Exception {
        // å»ºç«‹é“¾æ¥
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("localhost");
        final Connection connection = factory.newConnection();

        for (int i = 0; i < 2; i++) {
            //åˆ›å»ºä¸¤ä¸ªæ¶ˆè´¹è€…é¢‘é“
            final Channel channel = connection.createChannel();

            channel.queueDeclare(TASK_QUEUE_NAME, true, false, false, null);
            System.out.println(" [*] Waiting for messages. To exit press CTRL+C");
            // æ§åˆ¶å½“ä¸ªæ¶ˆè´¹è€…çš„ç§¯å‹æ•°
            channel.basicQos(1);

            int finalI = i;
            // å®šä¹‰å¦‚ä½•å¤„ç†æ¶ˆæ¯
            DeliverCallback deliverCallback = (consumerTag, delivery) -> {
                String message = new String(delivery.getBody(), "UTF-8");
                try {
                    // è‡ªå·±å®šä¹‰å¤„ç†çš„å·¥ä½œ
                    System.out.println(" [x] Received 'æ¶ˆè´¹è€…ï¼š" + finalI + "ï¼Œæ¶ˆè´¹äº†ï¼š" + message + "'");
                    // æŒ‡å®šå–æŸæ¡æ¶ˆæ¯
                    channel.basicAck(delivery.getEnvelope().getDeliveryTag(),false);
                    // åœ20sï¼Œæ¨¡æ‹Ÿæœºå™¨å¤„ç†èƒ½åŠ›
                    Thread.sleep(20000);
                } catch (InterruptedException e) {
                    e.getStackTrace();
                    // ç¬¬ä¸‰ä¸ªå‚æ•°
                    channel.basicNack(delivery.getEnvelope().getDeliveryTag(),false,false);
                } finally {
                    System.out.println(" [x] Done");
                    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                }
            };
            // å¼€å¯æ¶ˆè´¹ç›‘å¬ï¼Œä¼šä¸€ç›´ç›‘å¬ç”Ÿäº§è€…çš„æ¶ˆæ¯
            channel.basicConsume(TASK_QUEUE_NAME, false, deliverCallback, consumerTag -> {
            });
        }
    }
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723745294013-2ae82105-b955-4587-8d05-68bcc4379c85.png#averageHue=%23282c34&clientId=u4ca622be-41e5-4&from=paste&height=292&id=u84e8c91a&originHeight=350&originWidth=1599&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=17600&status=done&style=none&taskId=u730795da-69c9-4de2-bf38-13c28eb780c&title=&width=1332.4999470512093)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723745366370-a00f88da-ba7d-4a46-a0af-3672ebbb5aee.png#averageHue=%232a2e37&clientId=u4ca622be-41e5-4&from=paste&height=399&id=uf3cd81d7&originHeight=479&originWidth=2371&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=84414&status=done&style=none&taskId=u0ad41d3c-1af0-465b-951c-d93c4f1105c&title=&width=1975.8332548207738)
##### **æ¶ˆæ¯ç¡®è®¤æœºåˆ¶** â­â­â­â­â­ï¼ˆé¢è¯•çˆ±é—®ï¼‰
è¿™é‡Œæœ‰ä¸ªå¾ˆæœ‰æ„æ€çš„åœ°æ–¹ï¼Œå« autoackï¼Œé»˜è®¤ä¸º false â€”â€” æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ã€‚
```java
channel.basicConsume(TASK_QUEUE_NAME, false, deliverCallback, consumerTag -> {});
// basicConsume()æ–¹æ³•æºç ï¼š
String basicConsume(String queue, boolean autoAck, DeliverCallback deliverCallback, CancelCallback cancelCallback) throws IOException;
```
> æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ç¡®ä¿æ¶ˆè´¹è€…å·²ç»æˆåŠŸå–å‡ºæ¶ˆæ¯å‘¢ï¼Ÿå®ƒä¾èµ–ä¸€ä¸ªç§°ä¸ºæ¶ˆæ¯ç¡®è®¤çš„æœºåˆ¶ã€‚å½“æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­å–èµ°æ¶ˆæ¯åï¼Œå¿…é¡»å¯¹æ­¤è¿›è¡Œç¡®è®¤ã€‚è¿™å°±åƒåœ¨æ”¶åˆ°å¿«é€’åç¡®è®¤æ”¶è´§ä¸€æ ·ï¼Œè¿™æ ·æ¶ˆæ¯é˜Ÿåˆ—æ‰èƒ½çŸ¥é“æ¶ˆè´¹è€…å·²ç»æˆåŠŸå–èµ°äº†æ¶ˆæ¯ï¼Œå¹¶èƒ½å®‰å¿ƒåœ°åœæ­¢ä¼ è¾“ã€‚å› æ­¤ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±åƒè¿™æ ·ã€‚ 
> åœ¨é¢è¯•ä¸­ï¼Œå¦‚æœè¢«é—®åŠå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œä¾‹å¦‚å½“ä¸šåŠ¡æµç¨‹å¤±è´¥æ—¶è¯¥æ€ä¹ˆåŠï¼Œä½ å¯ä»¥å›ç­”ï¼š â€œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ‹’ç»æ¥æ”¶å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¹¶é‡æ–°å¯åŠ¨ã€‚é‡æ–°å¯åŠ¨æˆ–è¿›è¡Œå…¶ä»–å¤„ç†å¯ä»¥æŒ‡å®šæ‹’ç»æŸæ¡æ¶ˆæ¯ã€‚

ä¸ºäº†ä¿è¯æ¶ˆæ¯æˆåŠŸè¢«æ¶ˆè´¹ï¼ˆå¿«é€’æˆåŠŸè¢«å–èµ°ï¼‰ï¼Œrabbitmgæä¾›äº†æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œå½“æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œæ¯”å¦‚è¦ç»™ä¸€ä¸ªåé¦ˆï¼š

- ackï¼šæ¶ˆè´¹æˆåŠŸ
- nackï¼šæ¶ˆè´¹å¤±è´¥
- rejectï¼šæ‹’ç»
> å¦‚æœå‘Šè¯‰ Rabbit MQ æœåŠ¡å™¨æ¶ˆè´¹æˆåŠŸï¼ŒæœåŠ¡å™¨æ‰ä¼šæ”¾å¿ƒåœ°ç§»é™¤æ¶ˆæ¯ã€‚
>  æ”¯æŒé…ç½®autoackï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œ ack å‘½ä»¤ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯ç«‹åˆ»å°±æˆåŠŸäº†ã€‚
>  å¦‚æœåœ¨æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå·¥ä½œå°šæœªå®Œæˆï¼Œæˆ‘ä»¬æ˜¯å¦å°±ä¸éœ€è¦ç¡®è®¤æˆåŠŸå‘¢ï¼Ÿè¿™ç§æƒ…å†µï¼Œå»ºè®®å°† 
> autoack è®¾ç½®ä¸º falseï¼Œæ ¹æ®å®é™…æƒ…å†µï¼Œå»æ‰‹åŠ¨ç¡®è®¤ã€‚

###### æŒ‡å®šç¡®è®¤æŸæ¡æ¶ˆæ¯ï¼š
```java
channel.basicAck(delivery.getEnvelope().getDeliveryTag(),false);
// æºç 
void basicAck(long deliveryTag, boolean multiple) throws IOException;
```
> å‚æ•°è§£é‡Šï¼š
> 1. `deliveryTag`ï¼šè¡¨ç¤ºè¦ç¡®è®¤çš„æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„`deliveryTag`ï¼Œç”¨äºæ ‡è¯†æ¶ˆæ¯çš„é¡ºåºã€‚
> 2. `multiple`ï¼šè¡¨ç¤ºæ˜¯å¦æ‰¹é‡ç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®ä¸º`true`ï¼Œåˆ™è¡¨ç¤ºç¡®è®¤æ‰€æœ‰åœ¨`deliveryTag`ä¹‹å‰çš„æœªç¡®è®¤æ¶ˆæ¯ï¼›å¦‚æœè®¾ç½®ä¸º`false`ï¼Œåˆ™åªç¡®è®¤å½“å‰`deliveryTag`çš„æ¶ˆæ¯ã€‚
> 
ç¬¬äºŒå‚æ•° multiple æ‰¹é‡ç¡®è®¤ï¼šæ˜¯æŒ‡æ˜¯å¦è¦ä¸€æ¬¡æ€§ç¡®è®¤æ‰€æœ‰çš„å†å²æ¶ˆæ¯ç›´åˆ°å½“å‰è¿™æ¡


###### æŒ‡å®šæ‹’ç»æŸæ¡æ¶ˆæ¯ï¼š
```java
channel.basicNack(delivery.getEnvelope().getDeliveryTag(),false,false);
// æºç 
void basicNack(long deliveryTag, boolean multiple, boolean requeue)
            throws IOException;
```
> å‚æ•°è§£é‡Šï¼š
> 1. `deliveryTag`ï¼šè¡¨ç¤ºè¦å¦å®šç¡®è®¤çš„æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„`deliveryTag`ï¼Œç”¨äºæ ‡è¯†æ¶ˆæ¯çš„é¡ºåºã€‚
> 2. `multiple`ï¼šè¡¨ç¤ºæ˜¯å¦æ‰¹é‡å¦å®šç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®ä¸º`true`ï¼Œåˆ™è¡¨ç¤ºå¦å®šæ‰€æœ‰åœ¨`deliveryTag`ä¹‹å‰çš„æœªç¡®è®¤æ¶ˆæ¯ï¼›å¦‚æœè®¾ç½®ä¸º`false`ï¼Œåˆ™åªå¦å®šå½“å‰`deliveryTag`çš„æ¶ˆæ¯ã€‚
> 3. `requeue`ï¼šè¡¨ç¤ºæ˜¯å¦å°†æ¶ˆæ¯é‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚å¦‚æœè®¾ç½®ä¸º`true`ï¼Œåˆ™æ¶ˆæ¯å°†è¢«é‡æ–°æ”¾å›é˜Ÿåˆ—å¹¶å¯ä»¥è¢«å…¶ä»–æ¶ˆè´¹è€…é‡æ–°æ¶ˆè´¹ï¼›å¦‚æœè®¾ç½®ä¸º`false`ï¼Œåˆ™æ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒã€‚
> 
ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦é‡æ–°å…¥é˜Ÿï¼Œå¯ç”¨äºé‡è¯•

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723746178441-5b7c8ca4-ed11-4053-b1cc-6c5898153f17.png#averageHue=%23fafaf9&clientId=u4ca622be-41e5-4&from=paste&height=419&id=ua264eb10&originHeight=503&originWidth=580&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=128778&status=done&style=none&taskId=u6c468120-7688-467c-a1fd-25040fc8c00&title=&width=483.333314127393)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723746198595-d0185677-e024-4b72-aa45-8b6f04626bab.png#averageHue=%23f9f7f6&clientId=u4ca622be-41e5-4&from=paste&height=447&id=ud7efe60f&originHeight=536&originWidth=637&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=146838&status=done&style=none&taskId=u04721b42-e0f1-4e04-a658-e91530e913d&title=&width=530.8333122399126)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723746214113-0c1232b6-7130-4b7e-94cb-19a9cd4881a9.png#averageHue=%23faf8f7&clientId=u4ca622be-41e5-4&from=paste&height=422&id=u0b3e4c2e&originHeight=507&originWidth=643&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=109470&status=done&style=none&taskId=u3fd97c8a-8b4a-4612-a766-c85d15dd1d1&title=&width=535.8333120412306)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723746223336-7894b37d-c957-4af4-8c1c-dfd8f3118f7c.png#averageHue=%23fbfaf9&clientId=u4ca622be-41e5-4&from=paste&height=453&id=u4eb38de1&originHeight=544&originWidth=618&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=126466&status=done&style=none&taskId=uf1574d89-878a-4540-8ebb-347a9f83be7&title=&width=514.9999795357394)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723746232957-2456341a-0673-4b6f-9fcd-3cf29968e094.png#averageHue=%23f8f7f6&clientId=u4ca622be-41e5-4&from=paste&height=342&id=u007a2e7b&originHeight=410&originWidth=657&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=130444&status=done&style=none&taskId=u2eec79f1-c64b-4048-80c9-28365b17bc5&title=&width=547.4999782443056)
###### 2ä¸ªæµ‹è¯•å°æŠ€å·§ï¼š

1. ä½¿ç”¨Scanneræ¥å—ç”¨æˆ·è¾“å…¥ï¼Œä¾¿äºå¿«é€Ÿå‘é€å¤šæ¡æ¶ˆæ¯
2. ä½¿ç”¨ for å¾ªç¯åˆ›å»ºå¤šä¸ªæ¶ˆè´¹è€…ï¼Œä¾¿äºå¿«é€ŸéªŒè¯é˜Ÿåˆ—æ¨¡å‹å·¥ä½œæœºåˆ¶
### 3.4 Rabbit MQ äº¤æ¢æœºï¼ˆ**Publish/Subscribe**ï¼‰
> [https://www.rabbitmq.com/tutorials/tutorial-three-java](https://www.rabbitmq.com/tutorials/tutorial-three-java)

##### ä»€ä¹ˆæ˜¯äº¤æ¢æœºï¼Ÿ 
**äº¤æ¢æœº **æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºç½‘ç»œè·¯ç”±å™¨ã€‚å®ƒè´Ÿè´£å°†æˆ‘ä»¬å‘é€çš„æ¶ˆæ¯è½¬å‘åˆ°ç›¸åº”çš„ç›®æ ‡ï¼Œå°±åƒå¿«é€’ç«™å°†å¿«é€’å‘é€åˆ°å¯¹åº”çš„ç«™ç‚¹ï¼Œæˆ–è€…ç½‘ç»œè·¯ç”±å™¨å°†ç½‘ç»œè¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ä¸€æ ·ã€‚äº¤æ¢æœºçš„ä¸»è¦åŠŸèƒ½æ˜¯æä¾›è½¬å‘æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œæ ¹æ®æ¶ˆæ¯çš„è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯æŠ•é€’åˆ°åˆé€‚çš„é˜Ÿåˆ—æˆ–ç»‘å®šçš„æ¶ˆè´¹è€…ã€‚ æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œå¦‚æœè¯´ä¸€ä¸ªå¿«é€’ç«™å·²ç»æ‰¿å—ä¸äº†é‚£ä¹ˆå¤šçš„å¿«é€’äº†ï¼Œå°±å»ºå¤šä¸ªå¿«é€’ç«™ã€‚
ä¸€ä¸ªç”Ÿäº§è€…ç»™å¤šä¸ªé˜Ÿåˆ—å‘æ¶ˆæ¯ï¼Œ1ä¸ªç”Ÿäº§è€…å¯¹å¤šä¸ªé˜Ÿåˆ—ã€‚
äº¤æ¢æœºçš„ä½œç”¨ï¼šæä¾›æ¶ˆæ¯è½¬å‘åŠŸèƒ½ï¼Œç±»ä»¥äºç½‘ç»œè·¯ç”±å™¨
è¦è§£å†³çš„é—®é¢˜ï¼šæ€ä¹ˆæŠŠæ¶ˆæ¯è½¬å‘åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸Šï¼Œå¥½è®©æ¶ˆè´¹è€…ä»ä¸åŒçš„é˜Ÿåˆ—æ¶ˆè´¹ã€‚
ç»‘å®šï¼šäº¤æ¢æœºå’Œé˜Ÿåˆ—å…³è”èµ·æ¥ï¼Œä¹Ÿå¯ä»¥å«è·¯ç”±ï¼Œç®—æ˜¯ä¸€ä¸ªç®—æ³•æˆ–è½¬å‘ç­–ç•¥
##### ç»‘å®šä»£ç æ–¹æ³•ï¼š
```java
channel.exchangeDeclare(FANOUT_EXCHANGE_NAME, "fanout");
```
![](https://cdn.nlark.com/yuque/0/2023/png/398476/1686839285368-841c3ded-965b-4ed7-8214-091ac7f2c922.png#averageHue=%23ecb9af&id=q3MIG&originHeight=247&originWidth=745&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

> åé¢çš„å°±æ˜¯ä¸åŒçš„é˜Ÿåˆ—


#### 3.4.1 äº¤æ¢æœºç±»å‹

1. **Fanout Exchange**ï¼ˆå¹¿æ’­ç±»å‹ï¼‰ï¼šFanoutäº¤æ¢æœº**å°†æ¶ˆæ¯å¹¿æ’­åˆ°å…¶ç»‘å®šçš„æ‰€æœ‰é˜Ÿåˆ—**ã€‚å½“æ¶ˆæ¯è¢«å‘é€åˆ°Fanoutäº¤æ¢æœºæ—¶ï¼Œå®ƒä¼šå°†æ¶ˆæ¯å¤åˆ¶åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ä¸Šï¼Œè€Œä¸è€ƒè™‘è·¯ç”±é”®çš„å€¼ã€‚å› æ­¤ï¼Œæ— è®ºæ¶ˆæ¯çš„è·¯ç”±é”®æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«å¹¿æ’­åˆ°æ‰€æœ‰é˜Ÿåˆ—ã€‚Fanoutäº¤æ¢æœºä¸»è¦ç”¨äºå¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ã€‚
2. **Direct Exchange**ï¼ˆç›´è¿ç±»å‹ï¼‰ï¼šDirectäº¤æ¢æœºæ˜¯**æ ¹æ®æ¶ˆæ¯çš„è·¯ç”±é”®é€‰æ‹©å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸æ¶ˆæ¯å…·æœ‰ç›¸åŒè·¯ç”±é”®ç»‘å®šçš„é˜Ÿåˆ—**ã€‚ä¾‹å¦‚ï¼Œå½“æ¶ˆæ¯çš„è·¯ç”±é”®ä¸ç»‘å®šé”®å®Œå…¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯å°†è¢«è·¯ç”±åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚Directäº¤æ¢æœºä¸»è¦ç”¨äºä¸€å¯¹ä¸€çš„æ¶ˆæ¯è·¯ç”±ã€‚
3. **Topic Exchange**ï¼ˆä¸»é¢˜ç±»å‹ï¼‰ï¼šTopicäº¤æ¢æœº**å°†æ¶ˆæ¯æ ¹æ®è·¯ç”±é”®çš„æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå¹¶å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸æ¶ˆæ¯çš„è·¯ç”±é”®åŒ¹é…çš„é˜Ÿåˆ—**ã€‚è·¯ç”±é”®å¯ä»¥ä½¿ç”¨é€šé…ç¬¦åŒ¹é…ï¼Œæ”¯æŒä¸¤ç§é€šé…ç¬¦ç¬¦å·ï¼Œ"#"è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ï¼Œ"*"è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªå•è¯ã€‚Topicäº¤æ¢æœºä¸»è¦ç”¨äºçµæ´»çš„æ¶ˆæ¯è·¯ç”±ã€‚
4. **Headers Exchange**ï¼ˆå¤´ç±»å‹ï¼‰ï¼šHeadersäº¤æ¢æœºæ˜¯**æ ¹æ®æ¶ˆæ¯çš„å¤´éƒ¨ä¿¡æ¯è¿›è¡ŒåŒ¹é…ï¼Œå¹¶å°†æ¶ˆæ¯è·¯ç”±åˆ°åŒ¹é…çš„é˜Ÿåˆ—**ã€‚å¤´éƒ¨ä¿¡æ¯é€šå¸¸æ˜¯ä¸€ç»„é”®å€¼å¯¹ï¼Œå¯ä»¥ä½¿ç”¨å„ç§è‡ªå®šä¹‰çš„æ ‡å‡†å’Œéæ ‡å‡†çš„å¤´éƒ¨ä¿¡æ¯è¿›è¡ŒåŒ¹é…ã€‚Headersäº¤æ¢æœºä¸»è¦ç”¨äºå¤æ‚çš„åŒ¹é…è§„åˆ™ã€‚

#### 3.4.2 fanout äº¤æ¢æœº
æ‰‡å‡ºï¼šå°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šåˆ°è¯¥äº¤æ¢æœºçš„é˜Ÿåˆ—çš„è¿‡ç¨‹ã€‚å®ƒå¾—åäºæ‰‡å½¢æ‰©æ•£çš„å½¢çŠ¶ï¼Œç±»ä¼¼äº 
æŠŠä¸€æ¡æ¶ˆæ¯ä»äº¤æ¢æœºä¼ æ’­åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œå°±åƒæ‰‡å­å±•å¼€ä¸€æ ·ã€‚
å¹¿æ’­æ¶ˆæ¯ï¼šå°†æ¶ˆæ¯å‘é€åˆ°æ‰€æœ‰ä¸è¯¥äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—çš„è¿‡ç¨‹ã€‚å½“å‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ° fanout äº¤æ¢æœºæ—¶ï¼Œäº¤æ¢æœºä¼šç«‹å³å°†è¯¥æ¶ˆæ¯å¤åˆ¶å¹¶ä¼ é€’ç»™æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ï¼Œæ— è®ºç›®æ ‡é˜Ÿåˆ—çš„æ•°é‡æ˜¯å¤š 
å°‘ã€‚
ç‰¹ç‚¹ï¼šæ¶ˆæ¯ä¼šè¢«è½¬å‘åˆ°æ‰€æœ‰ç»‘å®šåˆ°è¯¥äº¤æ¢æœºçš„é˜Ÿåˆ—
åœºæ™¯ï¼šå¾ˆé€‚ç”¨äºå‘å¸ƒè®¢é˜…çš„åœºæ™¯ã€‚æ¯”å¦‚å†™æ—¥å¿—ï¼Œå¯ä»¥å¤šä¸ªç³»ç»Ÿé—´å…±äº«
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/1686839285368-841c3ded-965b-4ed7-8214-091ac7f2c922.png#id=f7932&originHeight=247&originWidth=745&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
å®ä¾‹åœºæ™¯ï¼š
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230619225118563.png#id=jg892&originHeight=388&originWidth=1096&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ç”Ÿäº§è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

import java.util.Scanner;

public class FanoutProducer {

  private static final String FANOUT_EXCHANGE_NAME = "fanout-exchange";

  public static void main(String[] argv) throws Exception {
    ConnectionFactory factory = new ConnectionFactory();
      // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
    factory.setHost("localhost");
    try (Connection connection = factory.newConnection();
         Channel channel = connection.createChannel()) {
        // åˆ›å»ºäº¤æ¢æœº
        channel.exchangeDeclare(FANOUT_EXCHANGE_NAME, "fanout");
// å‘é€ç»™æ‰€æœ‰çš„é˜Ÿåˆ—ï¼Œæ‰€ä»¥è¯´ä¸è¦å†™é˜Ÿåˆ—åç§°
        Scanner scanner = new Scanner(System.in);
        while (scanner.hasNext()) {
            String message = scanner.nextLine();
            channel.basicPublish(FANOUT_EXCHANGE_NAME, "", null, message.getBytes("UTF-8"));
            System.out.println(" [x] Sent '" + message + "'");
        }
    }
  }
}
```

æ¶ˆè´¹è€…ä»£ç ï¼š

1. æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…è¦ç»‘å®šåŒä¸€ä¸ªäº¤æ¢æœº
2. å…ˆæœ‰é˜Ÿåˆ—queueDeclareï¼Œæ‰èƒ½è¿›è¡Œç»‘å®šqueueBind
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.DeliverCallback;

/**
 * @author Shier
 */
public class FanoutConsumer {
    private static final String FANOUT_EXCHANGE_NAME = "fanout-exchange";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("localhost");
        Connection connection = factory.newConnection();
        Channel channel1 = connection.createChannel();
        Channel channel2 = connection.createChannel();

        // å£°æ˜äº¤æ¢æœº
        channel1.exchangeDeclare(FANOUT_EXCHANGE_NAME, "fanout");
        //channel2.exchangeDeclare(FANOUT_EXCHANGE_NAME, "fanout");

        // å‘˜å·¥å°çº¢
        String queueName1 = "xiaohong_queue";
        channel1.queueDeclare(queueName1, true, false, false, null);
        channel1.queueBind(queueName1, FANOUT_EXCHANGE_NAME, "");
        // å‘˜å·¥å°è“
        String queueName2 = "xiaolan_queue";
        channel2.queueDeclare(queueName2, true, false, false, null);
        channel2.queueBind(queueName2, FANOUT_EXCHANGE_NAME, "");

        System.out.println(" [*] =========================================");

        DeliverCallback deliverCallback1 = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), "UTF-8");
            System.out.println(" [xiaohong] Received '" + message + "'");
        };

        DeliverCallback deliverCallback2 = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), "UTF-8");
            System.out.println(" [xiaolan] Received '" + message + "'");
        };

        // ç›‘å¬æ¶ˆæ¯
        channel1.basicConsume(queueName1, true, deliverCallback1, consumerTag -> {
        });
        channel2.basicConsume(queueName2, true, deliverCallback2, consumerTag -> {
        });
    }
}
```
> æ•ˆæœï¼šæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723747368880-772d2d46-37f5-403a-8159-10ede992f2af.png#averageHue=%23292e36&clientId=u4ca622be-41e5-4&from=paste&height=616&id=u686160a3&originHeight=739&originWidth=2508&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=73555&status=done&style=none&taskId=u4160f5e8-dc65-4051-b3d3-5370c477b02&title=&width=2089.999916950865)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723747381129-b266fec1-e3bf-4f42-adbf-f16428c87040.png#averageHue=%232a2e37&clientId=u4ca622be-41e5-4&from=paste&height=612&id=u501ac5da&originHeight=734&originWidth=2458&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=99422&status=done&style=none&taskId=u51dc5362-99aa-4866-9ac4-ab8d2a73398&title=&width=2048.3332519398828)
#### 3.4.3 Direct äº¤æ¢æœº
å®˜ç½‘ä»‹ç»æ•™ç¨‹ï¼š[https://www.rabbitmq.com/tutorials/tutorial-four-java.html](https://www.rabbitmq.com/tutorials/tutorial-four-java.html)

- **ç»‘å®šï¼š**å¯ä»¥è®©äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œå…³è”ï¼Œå¯ä»¥æŒ‡å®šè®©äº¤æ¢æœºæŠŠä»€ä¹ˆæ ·çš„æ¶ˆæ¯å‘é€ç»™å“ªä¸ªé˜Ÿåˆ—ï¼ˆç±»ä»¥äºè®¡ç®—æœºç½‘ç»œä¸­ï¼Œä¸¤ä¸ªè·¯ç”±å™¨ï¼Œæˆ–è€…ç½‘ç»œè®¾å¤‡ç›¸äº’è¿æ¥ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºç½‘çº¿)
- **routing Keyï¼š**è·¯ç”±é”®ï¼Œæ§åˆ¶æ¶ˆæ¯è¦è½¬å‘ç»™å“ªä¸ªé˜Ÿåˆ—çš„ ï¼ˆå¯ä»¥ç®€å•çš„è¯´æ˜¯ IPåœ°å€ï¼‰
- **ç‰¹ç‚¹ï¼š**æ¶ˆæ¯**ä¼šæ ¹æ®è·¯ç”±é”®è½¬å‘åˆ°æŒ‡å®šçš„é˜Ÿåˆ—**
- **åœºæ™¯ï¼š**ç‰¹å®šçš„æ¶ˆæ¯åªäº¤ç»™ç‰¹å®šçš„ç³»ç»Ÿï¼ˆç¨‹åºï¼‰æ¥å¤„ç†
- **ç»‘å®šå…³ç³»ï¼š**å®Œå…¨åŒ¹é…å­—ç¬¦ä¸²ï¼Œè·¯ç”±é”®è¦å®Œå…¨åŒ¹é…

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230620131236850.png#id=rtZLc&originHeight=180&originWidth=450&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ä¸åŒçš„é˜Ÿåˆ—ä¹Ÿå¯ä»¥ç»‘å®šåŒæ ·çš„è·¯ç”±é”®ã€‚
æ¯”å¦‚å‘æ—¥å¿—çš„åœºæ™¯ï¼Œå¸Œæœ›ç”¨ç‹¬ç«‹çš„ç¨‹åºæ¥å¤„ç†ä¸åŒçº§åˆ«çš„æ—¥å¿—ï¼Œæ¯”å¦‚ C1 ç³»ç»Ÿå¤„ç† error æ—¥å¿—ï¼ŒC2ç³»ç»Ÿå¤„ç†å…¶ä»–çº§åˆ«çš„æ—¥å¿—
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230620163511572.png#id=fEUcV&originHeight=185&originWidth=466&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
**ç¤ºä¾‹åœºæ™¯**
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230620165023953.png#id=vyJfR&originHeight=370&originWidth=1096&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ç”Ÿäº§è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

import java.util.Scanner;

public class DirectProducer {

  private static final String DIRECT_EXCHANGER = "direct-exchange";

  public static void main(String[] argv) throws Exception {
    ConnectionFactory factory = new ConnectionFactory();
    factory.setHost("localhost");
    try (Connection connection = factory.newConnection();
         Channel channel = connection.createChannel()) {
        channel.exchangeDeclare(DIRECT_EXCHANGER, "direct");

        Scanner scanner = new Scanner(System.in);
        while (scanner.hasNext()) {
            String userInput = scanner.nextLine();
            String[] splits = userInput.split(" ");
            if (splits.length < 1) {
                continue;
            }
            String message = splits[0];
            String routingKey = splits[1];

            channel.basicPublish(DIRECT_EXCHANGER, routingKey, null, message.getBytes("UTF-8"));
            System.out.println(" [x] Sent '" + message + " with routing " + routingKey + "'");
        }
    }
  }
  //..
}
```
æ¶ˆè´¹è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.*;

public class DirectConsumer {

    private static final String DIRECT_EXCHANGE = "direct-exchange";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        channel.exchangeDeclare(DIRECT_EXCHANGE, "direct");

        // åˆ›å»ºé˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šå°ç´«
        String queueName = "zky11_queue";
        channel.queueDeclare(queueName, true, false, false, null);
        channel.queueBind(queueName, DIRECT_EXCHANGE, "zky1");

        // åˆ›å»ºé˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šå°é»‘
        String queueName2 = "zky2_queue";
        channel.queueDeclare(queueName2, true, false, false, null);
        channel.queueBind(queueName2, DIRECT_EXCHANGE, "zky2");

        System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

        // å°ç´«é˜Ÿåˆ—ç›‘å¬æœºåˆ¶
        DeliverCallback xiaoziDeliverCallback = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), "UTF-8");
            System.out.println(" [xiaozi] Received '" +
                    delivery.getEnvelope().getRoutingKey() + "':'" + message + "'");
        };
        // å°é»‘é˜Ÿåˆ—ç›‘å¬æœºåˆ¶
        DeliverCallback xiaoheiDeliverCallback = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), "UTF-8");
            System.out.println(" [xiaohei] Received '" +
                    delivery.getEnvelope().getRoutingKey() + "':'" + message + "'");
        };
        channel.basicConsume(queueName, true, xiaoziDeliverCallback, consumerTag -> {
        });
        channel.basicConsume(queueName2, true, xiaoheiDeliverCallback, consumerTag -> {
        });
    }
}
```

![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723893967432-4ed6ce4e-3716-4c81-8148-8b723a6a9e70.png#averageHue=%23fcfbf5&clientId=u7dd9098c-b5a5-4&from=paste&height=795&id=uba49ed42&originHeight=954&originWidth=1866&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=80830&status=done&style=none&taskId=ua3b7714f-ae77-4a64-a3b2-f62e5d1dbb0&title=&width=1554.999938209854)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723895706805-bc8532b1-b29b-4561-82ac-a94a45973d7e.png#averageHue=%232a2f38&clientId=u7dd9098c-b5a5-4&from=paste&height=448&id=ueb259c03&originHeight=538&originWidth=1283&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=55643&status=done&style=none&taskId=uf536376a-0787-4849-bce0-c3c558a22f4&title=&width=1069.166624181802)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723895716140-d2d676e7-4c91-434c-9211-b93f8c33bf3e.png#averageHue=%232b303a&clientId=u7dd9098c-b5a5-4&from=paste&height=426&id=u03586d21&originHeight=511&originWidth=1107&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=57484&status=done&style=none&taskId=ufbf83ec1-cffe-4755-8da6-d92a6c320fd&title=&width=922.4999633431449)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723895743716-d2b67321-bc9c-4111-9ad4-48316bb41e3a.png#averageHue=%232a2e37&clientId=u7dd9098c-b5a5-4&from=paste&height=552&id=u656f5eda&originHeight=662&originWidth=2322&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=93637&status=done&style=none&taskId=ud2b13627-153f-415d-b7cb-5d26eabbdb2&title=&width=1934.9999231100112)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723895753885-4e502346-e1e4-413b-b7b8-30ecf6f10cf7.png#averageHue=%232a2f37&clientId=u7dd9098c-b5a5-4&from=paste&height=478&id=u41d3f0d0&originHeight=574&originWidth=2305&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=70254&status=done&style=none&taskId=u984ebd02-3a3b-4c3c-9874-c97268f2e42&title=&width=1920.8332570062773)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723895791769-773b35f0-5bc4-4bac-9f03-72dcd6abe707.png#averageHue=%232a2f37&clientId=u7dd9098c-b5a5-4&from=paste&height=520&id=u6d43718f&originHeight=624&originWidth=2303&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=104290&status=done&style=none&taskId=u8a3ad7bf-7a74-4c42-bbf9-5c350ed5bb0&title=&width=1919.1665904058382)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723895800196-7aaa3ef4-a52d-40bb-a4dd-691fc01ddb9a.png#averageHue=%232b2f38&clientId=u7dd9098c-b5a5-4&from=paste&height=419&id=u8d1cd894&originHeight=503&originWidth=2308&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=88106&status=done&style=none&taskId=u88e6fd64-e000-4a17-b0c8-c918e31ff42&title=&width=1923.3332569069362)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723895829469-d56dbc6a-247a-4689-97cc-15df617936f4.png#averageHue=%23fbfbfb&clientId=u7dd9098c-b5a5-4&from=paste&height=668&id=uaa1cd63b&originHeight=802&originWidth=1496&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=46752&status=done&style=none&taskId=uedb013e0-d1e4-4276-b070-57616c90829&title=&width=1246.666617128586)
#### 3.4.4 **topic äº¤æ¢**æœº
å®˜ç½‘æ•™ç¨‹ï¼š[https://www.rabbitmq.com/tutorials/tutorial-five-java.html](https://www.rabbitmq.com/tutorials/tutorial-five-java.html)

- **ç‰¹ç‚¹**ï¼šæ¶ˆæ¯ä¼šæ ¹æ®ä¸€ä¸ªæ¨¡ç³Šçš„è·¯ç”±é”®è½¬å‘åˆ°æŒ‡å®šçš„é˜Ÿåˆ—
- **åœºæ™¯ï¼š**ç‰¹å®šçš„ä¸€ç±»æ¶ˆæ¯å¯ä»¥äº¤ç»™ç‰¹å®šçš„ä¸€ç±»ç³»ç»Ÿï¼ˆç¨‹åºï¼‰æ¥å¤„ç†
- **ç»‘å®šå…³ç³»**ï¼šå¯ä»¥æ¨¡æ¹–åŒ¹é…å¤šä¸ªç»‘å®š
1.  `*`ï¼šåŒ¹é…ä¸€ä¸ªå•è¯ï¼Œæ¯”å¦‚`*.shier`ï¼Œé‚£ä¹ˆ`a.shier`ã€`b.shier`éƒ½èƒ½åŒ¹é… 
2.  `#`ï¼šåŒ¹é…0ä¸ªæˆ–å¤šä¸ªå•è¯ï¼Œæ¯”å¦‚`a.#`ï¼Œé‚£ä¹ˆ`a.a`ã€`a.b`ã€`a.a.a`éƒ½åŒ¹é… 
> `#.a.#` å¯ä»¥åŒ¹é… `a.b` Â ã€`a1.a` Â ç­‰å½¢å¼
> açš„å‰é¢å¯ä»¥æ˜¯0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²ï¼Œåé¢ä¹Ÿæ˜¯0ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦ä¸²

æ³¨æ„ï¼Œè¿™é‡Œçš„åŒ¹é…å’Œ MySQL çš„ like çš„ % ä¸ä¸€ç¥¥ï¼ŒåªæŒ‰ç…§å•è¯æ¥åŒ¹é…ï¼Œæ¯ä¸ª`'.'`åˆ†éš”å•è¯ï¼Œå¦‚æœæ˜¯`'#.'`ï¼Œå…¶å®å¯ä»¥å¿½ç•¥ï¼ŒåŒ¹é…0ä¸ªè¯å¯ä»¥çš„
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230620131840253.png#id=iItW0&originHeight=175&originWidth=467&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ç¤ºä¾‹åœºæ™¯ï¼š
> è€æ¿ä¸‹å‘ä¸€ä¸ªä»»åŠ¡ï¼Œè®©å¤šä¸ªä»»åŠ¡ç»„éƒ½èƒ½æ¥å—åˆ°è¿™ä¸ªä»»åŠ¡æ¶ˆæ¯

![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230623145040023.png#id=aZxRZ&originHeight=581&originWidth=1194&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
ç”Ÿäº§è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

import java.util.Scanner;

/**
 * @author Shier
 * ä¸»é¢˜æ¶ˆè´¹è€… - ç”Ÿäº§è€…
 */
public class TopicProducer {

    private static final String TOPIC_EXCHANGE = "topic-exchange";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("localhost");

        try (Connection connection = factory.newConnection();
             Channel channel = connection.createChannel()) {

            channel.exchangeDeclare(TOPIC_EXCHANGE, "topic");

            Scanner scanner = new Scanner(System.in);
            while (scanner.hasNext()) {
                String userInput = scanner.nextLine();
                String[] splits = userInput.split(" ");
                if (splits.length < 1) {
                    continue;
                }
                String message = splits[0];
                String routingKey = splits[1];

                channel.basicPublish(TOPIC_EXCHANGE, routingKey, null, message.getBytes("UTF-8"));
                System.out.println(" [x] Sent '" + message + " with routing " + routingKey + "'");
            }
        }
    }
}
```
æ¶ˆè´¹è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.DeliverCallback;

/**
 * @author Shier
 * ä¸»é¢˜äº¤æ¢æœº - æ¶ˆè´¹è€…
 */
public class TopicConsumer {

    private static final String TOPIC_EXCHANGE = "topic-exchange";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("localhost");
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        channel.exchangeDeclare(TOPIC_EXCHANGE, "topic");

        // åˆ›å»ºå‰ç«¯é˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šfrontend
        String queueName = "frontend_queue";
        channel.queueDeclare(queueName, true, false, false, null);
        channel.queueBind(queueName, TOPIC_EXCHANGE, "#.å‰ç«¯.#");

        // åˆ›å»ºåç«¯é˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šbackend
        String queueName2 = "backend_queue";
        channel.queueDeclare(queueName2, true, false, false, null);
        channel.queueBind(queueName2, TOPIC_EXCHANGE, "#.åç«¯.#");

        // åˆ›å»ºåç«¯é˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šbackend
        String queueName3 = "product_queue";
        channel.queueDeclare(queueName3, true, false, false, null);
        channel.queueBind(queueName3, TOPIC_EXCHANGE, "#.äº§å“.#");

        System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

        // Aé˜Ÿåˆ—ç›‘å¬æœºåˆ¶
        DeliverCallback xiaoADeliverCallback = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), "UTF-8");
            System.out.println(" [xiaoA] Received '" +
                    delivery.getEnvelope().getRoutingKey() + "':'" + message + "'");
        };
        // Bé˜Ÿåˆ—ç›‘å¬æœºåˆ¶
        DeliverCallback xiaoBDeliverCallback = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), "UTF-8");
            System.out.println(" [xiaoB] Received '" +
                    delivery.getEnvelope().getRoutingKey() + "':'" + message + "'");
        };

        // Cé˜Ÿåˆ—ç›‘å¬æœºåˆ¶
        DeliverCallback xiaoCDeliverCallback = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), "UTF-8");
            System.out.println(" [xiaoC] Received '" +
                    delivery.getEnvelope().getRoutingKey() + "':'" + message + "'");
        };

        channel.basicConsume(queueName, true, xiaoADeliverCallback, consumerTag -> {
        });
        channel.basicConsume(queueName2, true, xiaoBDeliverCallback, consumerTag -> {
        });
        channel.basicConsume(queueName3, true, xiaoCDeliverCallback, consumerTag -> {
        });
    }
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723897991142-c1e4cf49-a1b9-4467-b234-d244b4f82842.png#averageHue=%23f9f9f1&clientId=u7dd9098c-b5a5-4&from=paste&height=663&id=uc3bdb35a&originHeight=1592&originWidth=2851&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=240127&status=done&style=none&taskId=uabf258b4-1775-47b8-ba13-faffc711eaa&title=&width=1187.9166194631011)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723898089424-ebc96fe3-2fdf-45cb-ba04-c1dab86a5c99.png#averageHue=%232b3039&clientId=u7dd9098c-b5a5-4&from=paste&id=u11e9b2f2&originHeight=525&originWidth=1286&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=65230&status=done&style=none&taskId=u5dcb576a-79ae-4ce0-83fd-08904959b6e&title=)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723898098853-58cf3964-f92e-497a-8d48-8555ee645e52.png#averageHue=%232a2f38&clientId=u7dd9098c-b5a5-4&from=paste&id=u9f245aa9&originHeight=480&originWidth=1123&originalType=binary&ratio=1.2000000476837158&rotation=0&showTitle=false&size=66023&status=done&style=none&taskId=uf3fca81b-9121-4180-a267-72004223765&title=)
#### 3.4.5 Headers äº¤æ¢æœº
ç±»ä»¥ä¸»é¢˜å’Œç›´æ¥äº¤æ¢æœºï¼Œå¯ä»¥æ ¹æ®headersä¸­çš„å†…å®¹æ¥æŒ‡å®šå‘é€åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚
ç”±äºæ€§å·®ã€æ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨ã€‚
> rabbitmqä¸­çš„ headers äº¤æ¢æœºæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ
> AIç­”ï¼š
> åœ¨RabbitMQæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ŒHeadersäº¤æ¢æœºæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„äº¤æ¢æœºï¼Œå®ƒä½¿ç”¨æ¶ˆæ¯å¤´ï¼ˆHeadersï¼‰ä¸­çš„é”®å€¼å¯¹æ¥è¿›è¡Œæ¶ˆæ¯è·¯ç”±ã€‚ä¸å…¶ä»–ç±»å‹çš„äº¤æ¢æœºä¸åŒï¼ŒHeadersäº¤æ¢æœºæ— è§†æ¶ˆæ¯çš„è·¯ç”±é”®ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯å¤´ä¸­çš„é”®å€¼å¯¹æ¥å†³å®šæ¶ˆæ¯çš„è·¯ç”±ã€‚
> Headersäº¤æ¢æœºçš„ä¸»è¦ç”¨é€”æ˜¯åŸºäºæ¶ˆæ¯çš„é™„åŠ å±æ€§æ¥è¿›è¡Œè·¯ç”±ï¼Œè€Œä¸æ˜¯é€šè¿‡å›ºå®šçš„è·¯ç”±é”®è¿›è¡ŒåŒ¹é…ã€‚å®ƒé€‚ç”¨äºä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ï¼Œä¾‹å¦‚éœ€è¦æ ¹æ®æ¶ˆæ¯çš„ç‰¹å®šå±æ€§æ¥è¿›è¡Œè¿‡æ»¤ã€è·¯ç”±æˆ–åŒ¹é…çš„æƒ…å†µã€‚Headersäº¤æ¢æœºå¯ä»¥è®©æˆ‘ä»¬åœ¨æ¶ˆæ¯å‘å¸ƒçš„æ—¶å€™æ ¹æ®æ¶ˆæ¯å¤´çš„é”®å€¼å¯¹æ¥æŒ‡å®šæ¶ˆæ¯çš„ç›®æ ‡é˜Ÿåˆ—æˆ–è€…è·¯ç”±è§„åˆ™ã€‚
> ä¼˜ç‚¹ï¼š
> - çµæ´»æ€§é«˜ï¼šHeadersäº¤æ¢æœºå¯ä»¥æ ¹æ®æ¶ˆæ¯çš„é™„åŠ å±æ€§è¿›è¡Œçµæ´»çš„è·¯ç”±å’ŒåŒ¹é…ï¼Œå¯ä»¥æ»¡è¶³ä¸€äº›ç‰¹æ®Šéœ€æ±‚ã€‚
> - å¯ä»¥è¿›è¡Œå¤æ‚çš„åŒ¹é…ï¼šHeadersäº¤æ¢æœºæ”¯æŒå¤æ‚çš„åŒ¹é…è§„åˆ™ï¼Œå¯ä»¥æ ¹æ®å¤šä¸ªå±æ€§è¿›è¡ŒåŒ¹é…å’Œè·¯ç”±ã€‚
> 
ç¼ºç‚¹ï¼š
> - æ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼šHeadersäº¤æ¢æœºéœ€è¦å¯¹æ‰€æœ‰æ¶ˆæ¯çš„æ¶ˆæ¯å¤´è¿›è¡ŒåŒ¹é…ï¼Œå› æ­¤åœ¨æ¶ˆæ¯æ•°é‡è¾ƒå¤§çš„æƒ…å†µä¸‹æ€§èƒ½ä¼šæœ‰æ‰€ä¸‹é™ã€‚
> - é…ç½®å¤æ‚ï¼šHeadersäº¤æ¢æœºéœ€è¦æ˜ç¡®æŒ‡å®šæ¶ˆæ¯å¤´çš„é”®å€¼å¯¹ä½œä¸ºåŒ¹é…æ¡ä»¶ï¼Œå› æ­¤åœ¨é…ç½®æ—¶ç›¸å¯¹è¾ƒä¸ºå¤æ‚ã€‚
> 
åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒHeadersäº¤æ¢æœºå¸¸å¸¸ç”¨äºä¸€äº›ç‰¹å®šçš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼š
> - æ ¹æ®æ¶ˆæ¯çš„è‡ªå®šä¹‰å±æ€§è¿›è¡Œè¿‡æ»¤å’Œè·¯ç”±ï¼Œä»¥è¾¾åˆ°æ¶ˆæ¯çš„åˆ†å‘å’Œæ¶ˆè´¹çš„ç›®çš„ã€‚
> - å¯¹æ¶ˆæ¯è¿›è¡Œå®šåˆ¶åŒ–çš„è·¯ç”±ï¼Œæ ¹æ®æ¶ˆæ¯å¤´ä¸­çš„è‡ªå®šä¹‰å±æ€§é€‰æ‹©ä¸åŒçš„æ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ã€‚
> 
éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHeadersäº¤æ¢æœºå¹¶ä¸æ˜¯å¸¸è§çš„äº¤æ¢æœºç±»å‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨Directã€Fanoutå’ŒTopicäº¤æ¢æœºå°±å¯ä»¥æ»¡è¶³å¤§å¤šæ•°çš„éœ€æ±‚ã€‚åªæœ‰åœ¨éœ€è¦æ ¹æ®æ¶ˆæ¯çš„é™„åŠ å±æ€§è¿›è¡Œè·¯ç”±æˆ–è¿‡æ»¤æ—¶æ‰è€ƒè™‘ä½¿ç”¨Headersäº¤æ¢æœºã€‚


#### 3.4.6 RPCï¼šè¿œç¨‹è¿‡ç¨‹è°ƒç”¨
> æ”¯æŒç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥æ¨¡æ‹ŸRPCçš„è°ƒç”¨ï¼Œä½†æ˜¯ä¸€èˆ¬æ²¡å¿…è¦ï¼Œç›´æ¥ç”¨Dubboã€GRPCç­‰RPCæ¡†æ¶å°±å¥½äº†ã€‚
> å®ç°ä¸€ä¸ªåœºæ™¯æ€»æœ‰æ›´åˆé€‚çš„ã€æ›´ä¸“æ³¨çš„æŠ€æœ¯ã€‚ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨Dubboã€GRPCç­‰RPCæ¡†æ¶æŠ€æœ¯å³å¯ã€‚

åœ¨RabbitMQæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ŒRPCï¼ˆRemote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æ˜¯ä¸€ç§é€šä¿¡æ¨¡å¼ï¼Œç”¨äºå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è¿œç¨‹è°ƒç”¨ã€‚RPCå…è®¸ä¸€ä¸ªè¿›ç¨‹ï¼ˆç§°ä¸ºå®¢æˆ·ç«¯ï¼‰è°ƒç”¨å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆç§°ä¸ºæœåŠ¡ç«¯ï¼‰ä¸Šçš„æŸä¸ªå‡½æ•°å¹¶è·å–è¿”å›ç»“æœï¼Œå°±åƒåœ¨æœ¬åœ°è°ƒç”¨å‡½æ•°ä¸€æ ·ã€‚
RPCçš„ä½¿ç”¨å¯ä»¥ç®€åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿé—´çš„é€šä¿¡ï¼Œæä¾›æ›´æ–¹ä¾¿çš„è¿œç¨‹è°ƒç”¨æ–¹å¼ã€‚å®¢æˆ·ç«¯å¯ä»¥å°†è¯·æ±‚å‚æ•°å°è£…æˆæ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€ä¸ªç‰¹å®šé˜Ÿåˆ—ä¸­ï¼ŒæœåŠ¡ç«¯ç›‘å¬è¯¥é˜Ÿåˆ—å¹¶æ¥æ”¶æ¶ˆæ¯ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘ï¼Œå¹¶å°†å¤„ç†ç»“æœå‘é€å›å®¢æˆ·ç«¯ã€‚
ä½¿ç”¨**RPCçš„ä¸»è¦ç›®çš„**æ˜¯å®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„ååŒå·¥ä½œï¼Œä¾‹å¦‚ï¼š

- å°†è®¡ç®—ä»»åŠ¡åˆ†å‘åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚
- å®ç°å¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡é—´çš„å‡½æ•°è°ƒç”¨ã€‚

ä¼˜ç‚¹ï¼š

- è§£è€¦æ€§ï¼šRPCå…è®¸æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯é€šè¿‡å¼‚æ­¥æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼Œå‡å°‘äº†æœåŠ¡ä¹‹é—´çš„ç›´æ¥ä¾èµ–ã€‚
- å¯æ‰©å±•æ€§ï¼šRPCå¯ä»¥æ–¹ä¾¿åœ°åŠ å…¥æ–°çš„æœåŠ¡æˆ–è€…ç§»é™¤ä¸å†éœ€è¦çš„æœåŠ¡ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°åŠ¨æ€çš„æœåŠ¡å‘ç°å’Œæ³¨å†Œã€‚
- å¹¶å‘å¤„ç†ï¼šRPCå¯ä»¥å®ç°å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œæé«˜ç³»ç»Ÿçš„ååé‡å’Œå¹¶å‘èƒ½åŠ›ã€‚

ç¼ºç‚¹ï¼š

- æ€§èƒ½å¼€é”€ï¼šRPCé€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ï¼Œç›¸å¯¹äºæœ¬åœ°å‡½æ•°è°ƒç”¨ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚
- é…ç½®å¤æ‚ï¼šRPCéœ€è¦å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œæ­£ç¡®çš„é…ç½®å’Œåè°ƒï¼ŒåŒ…æ‹¬é˜Ÿåˆ—ã€äº¤æ¢æœºã€è·¯ç”±ç­‰å‚æ•°çš„è®¾ç½®ã€‚

å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š

- åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡é—´è°ƒç”¨
- å®ç°è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯é€šè¿‡RPCè°ƒç”¨æœåŠ¡å™¨ç«¯çš„API

åœ¨é€‰æ‹©ä½¿ç”¨RPCæ—¶ï¼Œéœ€è¦è€ƒè™‘ç³»ç»Ÿçš„æ€§èƒ½éœ€æ±‚å’Œè§„æ¨¡ï¼Œç¡®ä¿æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½èƒ½å¤Ÿæ»¡è¶³RPCçš„é€šä¿¡éœ€æ±‚ã€‚åŒæ—¶ï¼Œè¿˜éœ€è¦åˆç†è®¾ç½®RPCçš„è¶…æ—¶å’Œé‡è¯•æœºåˆ¶ï¼Œä»¥åº”å¯¹ç½‘ç»œæ•…éšœæˆ–æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µã€‚

### 3.5 Rabbit MQ æ ¸å¿ƒç‰¹æ€§
#### 3.5.1 æ¶ˆæ¯è¿‡æœŸæœºåˆ¶
å®˜ç½‘ï¼š[https://www.rabbitmq.com/ttl.html](https://www.rabbitmq.com/ttl.html)
å¯ä»¥ç»™æ¯æ¡æ¶ˆæ¯æŒ‡å®šä¸€ä¸ªæœ‰æ•ˆæœŸï¼Œä¸€æ®µæ—¶é—´å†…æœªè¢«æ¶ˆè´¹è€…å¤„ç†ï¼Œå°±è¿‡æœŸäº†ã€‚
ç¤ºä¾‹åœºæ™¯ï¼š

- æ¶ˆè´¹è€…ï¼ˆåº“å­˜ç³»ç»Ÿï¼‰æŒ‚äº†ï¼Œä¸€ä¸ªè®¢å•15åˆ†é’Ÿè¿˜æ²¡è¢«åº“å­˜ç³»ç»Ÿå¤„ç†ï¼Œè¿™ä¸ªè®¢å•å…¶å®å·²ç»å¤±æ•ˆäº†ï¼Œå“ªæ€•åº“å­˜ç³»ç»Ÿå†æ¢å¤ï¼Œå…¶å®ä¹Ÿä¸ç”¨æ‰£å‡åº“å­˜ã€‚

é€‚ç”¨åœºæ™¯ï¼šæ¸…ç†è¿‡æœŸæ•°æ®ã€æ¨¡æ‹Ÿå»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°ï¼ˆä¸å¼€ä¼šå‘˜å°±æ…¢é€Ÿï¼‰ã€ä¸“é—¨è®©æŸä¸ªç¨‹åºå¤„ç†è¿‡æœŸè¯·æ±‚

1. è®¢å•è¶…æ—¶å–æ¶ˆï¼šåœ¨ç”µå•†å¹³å°ä¸­ï¼Œå¯ä»¥è®¾ç½®è®¢å•çš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœç”¨æˆ·åœ¨è§„å®šæ—¶é—´å†…æœªæ”¯ä»˜è®¢å•ï¼Œåˆ™å°†è®¢å•æ ‡è®°ä¸ºè¿‡æœŸå–æ¶ˆã€‚
2. é¢„çº¦å¤±æ•ˆå¤„ç†ï¼šåœ¨åŒ»é™¢æˆ–ç¾å®¹é™¢ç­‰åœºæ‰€ï¼Œç”¨æˆ·é¢„çº¦æœåŠ¡åï¼Œå¯ä»¥è®¾ç½®é¢„çº¦æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœç”¨æˆ·åœ¨è§„å®šæ—¶é—´å†…æœªåˆ°è¾¾ï¼Œå¯ä»¥å–æ¶ˆé¢„çº¦æˆ–é‡Šæ”¾æ—¶é—´ã€‚
3. ç¼“å­˜æ›´æ–°å’Œå¤±æ•ˆï¼šåœ¨ç½‘ç«™æˆ–åº”ç”¨ä¸­ï¼Œå¯ä»¥å°†æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ä»¥ä¿æŒæ•°æ®çš„æ–°é²œåº¦ï¼Œå¹¶åœ¨æ•°æ®è¿‡æœŸåé‡æ–°åŠ è½½æœ€æ–°æ•°æ®ã€‚
4. æ—¥å¿—è®°å½•å’Œæ¸…ç†ï¼šåœ¨ç³»ç»Ÿä¸­ï¼Œå¯ä»¥å°†æ—¥å¿—è®°å½•ä¸ºæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ä»¥é™åˆ¶æ—¥å¿—æ•°æ®çš„ä¿ç•™æ—¶é—´ï¼Œä»¥åŠè‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„æ—¥å¿—ã€‚
5. å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼šå¯ä»¥ä½¿ç”¨RabbitMQç»“åˆè¿‡æœŸæ—¶é—´æ¥å®ç°å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€‚é€šè¿‡è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œå°†ä»»åŠ¡æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶åœ¨è¿‡æœŸåè§¦å‘æ‰§è¡Œç›¸åº”çš„ä»»åŠ¡æ“ä½œã€‚
> AI è¯´ï¼š
> RabbitMQæä¾›äº†æ¶ˆæ¯è¿‡æœŸæœºåˆ¶ï¼ˆMessage Expirationï¼‰ä½œä¸ºå…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ã€‚è¯¥æœºåˆ¶å…è®¸ä½ ä¸ºæ¶ˆæ¯è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œåœ¨æ­¤æ—¶é—´åï¼Œå¦‚æœæ¶ˆæ¯ä»ç„¶æœªè¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œå°†ä¼šè‡ªåŠ¨ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚
> æ¶ˆæ¯è¿‡æœŸæœºåˆ¶çš„ä¸»è¦ç”¨é€”æ˜¯å¤„ç†ä¸€äº›å…·æœ‰æ—¶é—´æ•æ„Ÿæ€§çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚ä¸´æ—¶çš„çŠ¶æ€æ›´æ–°ã€æ—¶æ•ˆæ€§è¾ƒå¼ºçš„ä»»åŠ¡ç­‰ã€‚é€šè¿‡è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯åœ¨ä¸€å®šæ—¶é—´å†…å¾—åˆ°åŠæ—¶æ¶ˆè´¹ï¼Œé¿å…å› æ¶ˆæ¯å †ç§¯è€Œå¯¼è‡´çš„èµ„æºæµªè´¹æˆ–ä¸šåŠ¡å»¶è¿Ÿã€‚
>  
> ä¼˜ç‚¹ï¼š
> - çµæ´»æ€§é«˜ï¼šå¯ä»¥æ ¹æ®æ¶ˆæ¯çš„ç‰¹å®šéœ€æ±‚ï¼Œçµæ´»åœ°è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯çš„æ—¶æ•ˆæ€§ã€‚
> - èµ„æºåˆ©ç”¨ç‡é«˜ï¼šè¿‡æœŸçš„æ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨ä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œé¿å…äº†æ— æ•ˆæ¶ˆæ¯çš„å †ç§¯å’Œå½±å“é˜Ÿåˆ—æ€§èƒ½ã€‚
> 

> ç¼ºç‚¹ï¼š
> - å¯¹å»¶è¿Ÿè¦æ±‚è¾ƒé«˜ï¼šåœ¨æ¶ˆæ¯è¿‡æœŸä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿æ¶ˆè´¹è€…èƒ½å¤ŸåŠæ—¶æ¶ˆè´¹åˆ°æ¶ˆæ¯ï¼Œé¿å…æ¶ˆæ¯è¿‡æœŸè€Œå¯¼è‡´ä¸šåŠ¡å»¶è¿Ÿã€‚
> - ä¸é€‚ç”¨äºæŒä¹…åŒ–ï¼šå¦‚æœæ¶ˆæ¯æ˜¯æŒä¹…åŒ–çš„ï¼ˆpersistentï¼‰ï¼Œåˆ™å³ä½¿æ¶ˆæ¯è¿‡æœŸäº†ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨ä»ç£ç›˜ä¸Šåˆ é™¤ã€‚
> 

> ä½¿ç”¨æ¶ˆæ¯è¿‡æœŸæœºåˆ¶çš„å¸¸è§åœºæ™¯åŒ…æ‹¬ï¼š
> - å®šæ—¶ä»»åŠ¡ï¼šåœ¨æ¶ˆæ¯ä¸­è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç¡®ä¿ä»»åŠ¡åœ¨è§„å®šæ—¶é—´å†…è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚
> - ç¼“å­˜ç®¡ç†ï¼šå¯¹äºä¸€äº›ç¼“å­˜æ•°æ®ï¼Œå¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´æ¥è‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„æ•°æ®ã€‚
> - ä¸´æ—¶çŠ¶æ€æ›´æ–°ï¼šä¾‹å¦‚åœ¨æŸä¸ªçŠ¶æ€æ›´æ–°åä¸€æ®µæ—¶é—´å†…æ²¡æœ‰è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œåˆ™å¯ä»¥è®¾ç½®æ¶ˆæ¯è¿‡æœŸï¼Œé¿å…æ— æ•ˆçŠ¶æ€çš„å †ç§¯ã€‚
> 

> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¶ˆæ¯è¿‡æœŸæœºåˆ¶é€‚ç”¨äºä¸€äº›å…·æœ‰æ—¶æ•ˆæ€§éœ€æ±‚çš„åœºæ™¯ã€‚å¦‚æœä¸éœ€è¦å¼ºåˆ¶å®ç°æ¶ˆæ¯çš„æ—¶æ•ˆæ€§ï¼Œå¯ä»¥ä¸ä½¿ç”¨æ¶ˆæ¯è¿‡æœŸæœºåˆ¶ï¼Œè€Œæ˜¯ä½¿ç”¨å…¶ä»–æ›´é€‚åˆçš„æœºåˆ¶æ¥å¤„ç†æ¶ˆæ¯çš„è¿‡æœŸå’Œæ¸…ç†ï¼Œæ¯”å¦‚å®šæœŸæ¸…ç†æ— æ•ˆæ¶ˆæ¯ç­‰ã€‚

##### 1ï¼‰ç»™é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯æŒ‡å®šè¿‡æœŸæ—¶é—´
```java
// åˆ›å»ºé˜Ÿåˆ—
Map<String, Object> msg = new HashMap<String, Object>();
msg.put("x-message-ttl", 5000);
// æŒ‡å®šargså‚æ•°
channel.queueDeclare(TTL_QUEUE, false, false, false, msg);
```
å¦‚æœåœ¨è¿‡æœŸæ—¶é—´å†…ï¼Œè¿˜æ²¡æœ‰æ¶ˆè´¹è€…å–æ¶ˆæ¯ï¼Œæ¶ˆæ¯æ‰ä¼šè¿‡æœŸã€‚
**æ³¨æ„ï¼Œå¦‚æœæ¶ˆæ¯å·²ç»æ¥æ”¶åˆ°ï¼Œä½†æ˜¯æ²¡ç¡®è®¤ï¼Œæ˜¯ä¸ä¼šè¿‡æœŸçš„ã€‚**
> å¦‚æœæ¶ˆæ¯å¤„äºå¾…æ¶ˆè´¹çŠ¶æ€å¹¶ä¸”è¿‡æœŸæ—¶é—´åˆ°è¾¾åï¼Œæ¶ˆæ¯å°†è¢«æ ‡è®°ä¸ºè¿‡æœŸã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œå¹¶ä¸”æ­£åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå³ä½¿è¿‡æœŸæ—¶é—´åˆ°è¾¾ï¼Œæ¶ˆæ¯ä»ç„¶ä¼šè¢«æ­£å¸¸å¤„ç†ã€‚

ç”Ÿäº§è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

import java.nio.charset.StandardCharsets;

/**
 * @author Shier
 */
public class TtlProducer {
    private final static String TTL_QUEUE = "ttl-queue";

    public static void main(String[] argv) throws Exception {
        // åˆ›å»ºé“¾æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("localhost");
        try (Connection connection = factory.newConnection();
             // å»ºç«‹é“¾æ¥ï¼Œåˆ›å»ºé¢‘é“
             Channel channel = connection.createChannel()) {
            // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ— è¦åˆ é™¤æ‰ï¼Œå› ä¸ºå·²ç»åœ¨æ¶ˆè´¹è€…ä¸­åˆ›å»ºäº†é˜Ÿåˆ—ï¼Œæ²¡æœ‰å¿…è¦å†é‡æ–°åˆ›å»ºä¸€æ¬¡è¿™ä¸ªé˜Ÿåˆ—ï¼Œå¦‚æœåœ¨æ­¤å¤„è¿˜åˆ›å»ºé˜Ÿåˆ—ï¼Œé‡Œé¢çš„å‚æ•°å¿…é¡»è¦å’Œæ¶ˆè´¹è€…çš„å‚æ•°ä¸€è‡´
            // channel.queueDeclare(SINGLE_QUEUE_NAME, false, false, false, null);
            String message = "Hello World!";
            channel.basicPublish("", TTL_QUEUE, null, message.getBytes(StandardCharsets.UTF_8));
            System.out.println(" [x] Sent '" + message + "'");
        }
    }
}
```
æ¶ˆè´¹è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.DeliverCallback;

import java.nio.charset.StandardCharsets;
import java.util.HashMap;
import java.util.Map;

/**
 * @author Shier
 */
public class TtlConsumer {

    private final static String TTL_QUEUE = "ttl-queue";

    public static void main(String[] argv) throws Exception {
        // å»ºç«‹é“¾æ¥ï¼Œ
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("localhost");

        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        // åˆ›å»ºé˜Ÿåˆ—
        Map<String, Object> msg = new HashMap<String, Object>();
        msg.put("x-message-ttl", 5000);
        // æŒ‡å®šargså‚æ•°
        channel.queueDeclare(TTL_QUEUE, false, false, false, msg);

        System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

        // å®šä¹‰å¦‚ä½•å¤„ç†æ¶ˆæ¯
        DeliverCallback deliverCallback = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), StandardCharsets.UTF_8);
            System.out.println(" [x] Received '" + message + "'");
        };
        // æ¶ˆè´¹æ¶ˆæ¯ autoAckè®¾ç½®ä¸ºfalse å–æ¶ˆæ‰è‡ªåŠ¨ç¡®è®¤æ¶ˆæ¯
        channel.basicConsume(TTL_QUEUE, false, deliverCallback, consumerTag -> { });
    }
}
```

##### 2ï¼‰ç»™æŸæ¡æ¶ˆæ¯æŒ‡å®šè¿‡æœŸæ—¶é—´
> åœ¨æ¶ˆæ¯å‘é€è€…è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯ç”Ÿäº§è€…ä»£ç å¤„

è¯­æ³•
```java
byte[] messageBodyBytes = "Hello, world!".getBytes();
AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                                   .expiration("60000")
                                   .build();
channel.basicPublish("my-exchange", "routing-key", properties, messageBodyBytes);
```
ç¤ºä¾‹ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.AMQP;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

import java.nio.charset.StandardCharsets;

/**
 * @author Shier
 */
public class TtlProducer {
    private final static String TTL_QUEUE = "ttl-queue";

    public static void main(String[] argv) throws Exception {
        // åˆ›å»ºé“¾æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("localhost");
        try (Connection connection = factory.newConnection();
             // å»ºç«‹é“¾æ¥ï¼Œåˆ›å»ºé¢‘é“
             Channel channel = connection.createChannel()) {
            // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ— è¦åˆ é™¤æ‰ï¼Œå› ä¸ºå·²ç»åœ¨æ¶ˆè´¹è€…ä¸­åˆ›å»ºäº†é˜Ÿåˆ—ï¼Œæ²¡æœ‰å¿…è¦å†é‡æ–°åˆ›å»ºä¸€æ¬¡è¿™ä¸ªé˜Ÿåˆ—ï¼Œå¦‚æœåœ¨æ­¤å¤„è¿˜åˆ›å»ºé˜Ÿåˆ—ï¼Œé‡Œé¢çš„å‚æ•°å¿…é¡»è¦å’Œæ¶ˆè´¹è€…çš„å‚æ•°ä¸€è‡´
            // channel.queueDeclare(SINGLE_QUEUE_NAME, false, false, false, null);
            String message = "Hello World!";

            // ç»™æ¶ˆæ¯æŒ‡å®šè¿‡æœŸæ—¶é—´
            AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
                    .expiration("60000")
                    .build();
            channel.basicPublish("", TTL_QUEUE, properties, message.getBytes(StandardCharsets.UTF_8));
            System.out.println(" [x] Sent '" + message + "'");
        }
    }
}
```

#### 3.5.2 æ¶ˆæ¯ç¡®è®¤æœºåˆ¶â­â­â­â­â­ï¼ˆé¢è¯•çˆ±é—®ï¼‰
å®˜ç½‘ä»‹ç»ï¼š[https://www.rabbitmq.com/confirms.html](https://www.rabbitmq.com/confirms.html)
```java
channel.basicConsume(TASK_QUEUE_NAME, false, deliverCallback, consumerTag -> {});
// basicConsume()æ–¹æ³•æºç ï¼š
String basicConsume(String queue, boolean autoAck, DeliverCallback deliverCallback, CancelCallback cancelCallback) throws IOException;
```
ä¸ºäº†ä¿è¯æ¶ˆæ¯æˆåŠŸè¢«æ¶ˆè´¹ï¼ˆå¿«é€’æˆåŠŸè¢«å–èµ°ï¼‰ï¼Œrabbitmgæä¾›äº†æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œå½“æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œæ¯”å¦‚è¦ç»™ä¸€ä¸ªåé¦ˆï¼š

- ackï¼šæ¶ˆè´¹æˆåŠŸï¼ˆæˆåŠŸå–åˆ°å¿«é€’ï¼Œæˆ‘å·²ç¡®è®¤æ”¶è´§ï¼Œæˆ‘çš„æ¶ˆæ¯ä¸ç”¨åœ¨ä¿å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
- nackï¼šæ¶ˆè´¹å¤±è´¥ï¼ˆæœªèƒ½å»åˆ°å¿«é€’ï¼Œå¯èƒ½å‡ºäºå¿«é€’æ¶ˆå¤±äº†ã€è¢«äººæ‹¿èµ°äº†ã€å¿«é€’å­˜åœ¨é—®é¢˜ç­‰ç­‰çš„åŸå› ï¼Œæˆ‘éœ€è¦é€€è´§ï¼Œéœ€è¦å’Œå•†å®¶åè°ƒï¼Œä½ ä¸èƒ½å°±æ­¤å°†æˆ‘çš„æ¶ˆæ¯å»é™¤ï¼‰
- rejectï¼šæ‹’ç»
> å¦‚æœå‘Šè¯‰ Rabbit MQ æœåŠ¡å™¨æ¶ˆè´¹æˆåŠŸï¼ŒæœåŠ¡å™¨æ‰ä¼šæ”¾å¿ƒåœ°ç§»é™¤æ¶ˆæ¯ã€‚
> æ”¯æŒé…ç½®autoackï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œ ack å‘½ä»¤ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯ç«‹åˆ»å°±æˆåŠŸäº†ã€‚
> **ä¸€èˆ¬å»ºè®® autoack æ”¹ä¸º false ï¼Œæ ¹æ®å®é™…æƒ…å†µï¼Œå»æ‰‹åŠ¨ç¡®è®¤ã€‚**
> æ¯”å¦‚ï¼šfalseæ—¶ï¼Œå°±è¦è‡ªå·±æ‰‹åŠ¨çš„ç­¾æ”¶å¿«é€’ï¼Œç­‰æˆ‘æ”¶åˆ°å¿«é€’ä¹‹åï¼ŒæŸ¥çœ‹æ²¡æœ‰é—®é¢˜äº†ï¼Œå†å»ç­¾æ”¶å¿«é€’ï¼Œè¿™æ ·å¯ä»¥æŒ‰ç…§æµç¨‹å‡å°‘ä¸å¿…è¦çš„äº‹æƒ…ã€‚
> 		 Â  trueæ—¶ï¼Œå°±æ˜¯å¿«é€’å‘˜ä¸é€šçŸ¥ä½ å°±å¸®ä½ ç­¾æ”¶äº†å¿«é€’ã€‚ï¼ˆä¸‡ä¸€å¿«é€’å‡ºäº†é—®é¢˜å°±ä¸å¥½æäº†ï¼Œä¸è¿‡ç°å®ä¸­å¸®ä½ ç­¾æ”¶äº†çš„æƒ…å†µä¹Ÿä¸å°‘ï¼Œæœ‰é—®é¢˜ä¹Ÿè¿˜æ˜¯å¯ä»¥å¤„ç†çš„ï¼‰

##### 1ï¼‰æŒ‡å®šç¡®è®¤æŸæ¡æ¶ˆæ¯ï¼š
```java
channel.basicAck(delivery.getEnvelope().getDeliveryTag(),false);
// æºç 
void basicAck(long deliveryTag, boolean multiple) throws IOException;
```
> å‚æ•°è§£é‡Šï¼š
> 1. `deliveryTag`ï¼šè¡¨ç¤ºè¦ç¡®è®¤çš„æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„`deliveryTag`ï¼Œç”¨äºæ ‡è¯†æ¶ˆæ¯çš„é¡ºåºã€‚
> 2. `multiple`ï¼šè¡¨ç¤ºæ˜¯å¦æ‰¹é‡ç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®ä¸º`true`ï¼Œåˆ™è¡¨ç¤ºç¡®è®¤æ‰€æœ‰åœ¨`deliveryTag`ä¹‹å‰çš„æœªç¡®è®¤æ¶ˆæ¯ï¼›å¦‚æœè®¾ç½®ä¸º`false`ï¼Œåˆ™åªç¡®è®¤å½“å‰`deliveryTag`çš„æ¶ˆæ¯ã€‚
> 
ç¬¬äºŒå‚æ•° multiple æ‰¹é‡ç¡®è®¤ï¼šæ˜¯æŒ‡æ˜¯å¦è¦ä¸€æ¬¡æ€§ç¡®è®¤æ‰€æœ‰çš„å†å²æ¶ˆæ¯ç›´åˆ°å½“å‰è¿™æ¡


##### 2ï¼‰æŒ‡å®šæ‹’ç»æŸæ¡æ¶ˆæ¯ï¼š
```java
channel.basicNack(delivery.getEnvelope().getDeliveryTag(),false,false);
// æºç 
void basicNack(long deliveryTag, boolean multiple, boolean requeue)
            throws IOException;
```
> å‚æ•°è§£é‡Šï¼š
> 1. `deliveryTag`ï¼šè¡¨ç¤ºè¦å¦å®šç¡®è®¤çš„æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„`deliveryTag`ï¼Œç”¨äºæ ‡è¯†æ¶ˆæ¯çš„é¡ºåºã€‚
> 2. `multiple`ï¼šè¡¨ç¤ºæ˜¯å¦æ‰¹é‡å¦å®šç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æœè®¾ç½®ä¸º`true`ï¼Œåˆ™è¡¨ç¤ºå¦å®šæ‰€æœ‰åœ¨`deliveryTag`ä¹‹å‰çš„æœªç¡®è®¤æ¶ˆæ¯ï¼›å¦‚æœè®¾ç½®ä¸º`false`ï¼Œåˆ™åªå¦å®šå½“å‰`deliveryTag`çš„æ¶ˆæ¯ã€‚
> 3. `requeue`ï¼šè¡¨ç¤ºæ˜¯å¦å°†æ¶ˆæ¯é‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚å¦‚æœè®¾ç½®ä¸º`true`ï¼Œåˆ™æ¶ˆæ¯å°†è¢«é‡æ–°æ”¾å›é˜Ÿåˆ—å¹¶å¯ä»¥è¢«å…¶ä»–æ¶ˆè´¹è€…é‡æ–°æ¶ˆè´¹ï¼›å¦‚æœè®¾ç½®ä¸º`false`ï¼Œåˆ™æ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒã€‚
> 
ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦é‡æ–°å…¥é˜Ÿï¼Œå¯ç”¨äºé‡è¯•

#### 3.5.3 æ­»ä¿¡é˜Ÿåˆ—
å®˜ç½‘ä»‹ç»ï¼š[https://www.rabbitmq.com/dlx.html](https://www.rabbitmq.com/dlx.html)
ä¸ºäº†ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œæ¯”å¦‚æ¯æ¡æ¶ˆæ¯éƒ½æˆåŠŸæ¶ˆè´¹ï¼Œéœ€è¦æä¾›ä¸€ä¸ªå®¹æªæœºåˆ¶ï¼Œå³ï¼šå¤±è´¥çš„æ¶ˆæ¯æ€ä¹ˆå¤„ç†ï¼Ÿ
æ­»ä¿¡ï¼šè¿‡æœŸçš„æ¶ˆæ¯ã€æ‹’æ”¶çš„æ¶ˆæ¯ã€æ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ã€å¤„ç†å¤±è´¥çš„æ¶ˆæ¯çš„çµ±ç§°
æ­»ä¿¡é˜Ÿåˆ—ï¼šä¸“é—¨å¤„ç†æ­»ä¿¡çš„é˜Ÿåˆ—ï¼ˆæ³¨æ„ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šé˜Ÿåˆ—ï¼Œåªä¸è¿‡æ˜¯ä¸“é—¨ç”¨æ¥å¤„ç†æ­»ä¿¡çš„ï¼Œä½ ç”šè‡³å¯ä»¥ç†è§£è¿™ä¸ªé˜Ÿåˆ—çš„åç§°å«â€œæ­»ä¿¡é˜Ÿåˆ—â€)
æ­»ä¿¡äº¤æ¢æœºï¼šä¸“é—¨ç»™æ­»ä¿¡é˜Ÿåˆ—è½¬å‘æ¶ˆæ¯çš„äº¤æ¢æœºï¼ˆæ³¨æ„ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šäº¤æ¢æœºï¼Œåªä¸è¿‡æ˜¯ä¸“é—¨ç»™æ­»ä¿¡é˜Ÿåˆ—å‘æ¶ˆæ¯è€Œå·²ï¼Œç†è§£ä¸ºè¿™ä¸ªäº¤æ¢æœºçš„åç§°å°±å«â€œæ­»ä¿¡äº¤æ¢æœºâ€)ã€‚ä¹Ÿå­˜åœ¨è·¯ç”±ç»‘å®š
æ­»ä¿¡å¯ä»¥é€šè¿‡æ­»ä¿¡äº¤æ¢æœºç»‘å®šåˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚
> AIè¯´ï¼š
> RabbitMQçš„æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead-Letter Queueï¼‰æ˜¯ä¸€ç§**ç”¨äºå¤„ç†æ— æ³•è¢«æ¶ˆè´¹æˆ–è€…è¢«æ‹’ç»çš„æ¶ˆæ¯çš„ç‰¹æ®Šé˜Ÿåˆ—**ã€‚å½“æ¶ˆæ¯æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶ï¼Œä¾‹å¦‚æ¶ˆæ¯è¢«æ‹’ç»ã€æ¶ˆæ¯è¿‡æœŸæˆ–æ¶ˆæ¯æ— æ³•è·¯ç”±åˆ°ç›®æ ‡é˜Ÿåˆ—æ—¶ï¼Œå¯ä»¥å°†è¿™äº›æ¶ˆæ¯æŠ•é€’åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚
> æ­»ä¿¡é˜Ÿåˆ—çš„ä¸»è¦ä½œç”¨æ˜¯å¤„ç†æ— æ³•æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š
> - é”™è¯¯å¤„ç†ï¼šå°†å¤„ç†å¤±è´¥çš„æ¶ˆæ¯è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„å¼‚å¸¸å¤„ç†ã€æ—¥å¿—è®°å½•ç­‰ã€‚
> - é‡æ–°å¤„ç†ï¼šå°†æ— æ³•è·¯ç”±çš„æ¶ˆæ¯è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—åï¼Œå¯ä»¥è¿›è¡ŒäºŒæ¬¡å¤„ç†æˆ–é‡æ–°æŠ•é€’ã€‚
> 

> ä¼˜ç‚¹ï¼š
> - å¼‚å¸¸å¤„ç†ï¼šå¯ä»¥å¯¹å¤„ç†å¤±è´¥çš„æ¶ˆæ¯è¿›è¡Œç‰¹æ®Šçš„å¼‚å¸¸å¤„ç†ï¼Œä»¥ä¾¿æ’æŸ¥å’Œä¿®å¤é”™è¯¯ã€‚
> - é‡è¯•æœºåˆ¶ï¼šæ­»ä¿¡é˜Ÿåˆ—å¯ä»¥ç”¨äºé‡æ–°å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¯ä»¥å®ç°æ¶ˆæ¯çš„é‡è¯•æœºåˆ¶ï¼Œæé«˜æ¶ˆæ¯çš„å¯é æ€§ã€‚
> 

> ç¼ºç‚¹ï¼š
> - å¢åŠ å¤æ‚æ€§ï¼šä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œéœ€è¦è®¾è®¡å’Œå®ç°é’ˆå¯¹æ­»ä¿¡é˜Ÿåˆ—çš„å¤„ç†é€»è¾‘ã€‚
> - éœ€è¦é¢å¤–çš„èµ„æºï¼šæ­»ä¿¡é˜Ÿåˆ—éœ€è¦é¢å¤–çš„é˜Ÿåˆ—å’Œå¤„ç†é€»è¾‘ï¼Œå¯èƒ½å¢åŠ ç³»ç»Ÿçš„èµ„æºæ¶ˆè€—ã€‚
> 

> ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—çš„å¸¸è§åœºæ™¯åŒ…æ‹¬ï¼š
> - æ¶ˆæ¯é‡è¯•ï¼šå½“æ¶ˆæ¯å¤„ç†å¤±è´¥æ—¶ï¼Œå¯ä»¥å°†æ¶ˆæ¯æŠ•é€’åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­è¿›è¡Œé‡è¯•ã€‚
> - å¼‚å¸¸å¤„ç†ï¼šå¯¹äºæ— æ³•æ­£å¸¸å¤„ç†çš„æ¶ˆæ¯ï¼Œå¯ä»¥å°†å…¶è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—ä»¥è¿›è¡Œç‰¹æ®Šçš„å¼‚å¸¸å¤„ç†ã€‚
> - å»¶è¿Ÿé˜Ÿåˆ—ï¼šé€šè¿‡è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ä»¥åŠå°†è¿‡æœŸçš„æ¶ˆæ¯æŠ•é€’åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¯ä»¥æ¨¡æ‹Ÿå®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½ã€‚
> 

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­»ä¿¡é˜Ÿåˆ—çš„ä½¿ç”¨éœ€è¦è°¨æ…ï¼Œä¸å®œæ»¥ç”¨ã€‚åˆç†è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—çš„æ¡ä»¶å’Œå¤„ç†é€»è¾‘ï¼Œä»¥é¿å…æ­»ä¿¡é˜Ÿåˆ—çš„å †ç§¯å’Œå¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ã€‚


ç¤ºä¾‹åœºæ™¯ï¼š
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230623211815329.png#id=U9dV8&originHeight=750&originWidth=1321&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)

å®ç°è¿‡ç¨‹ï¼š
1ï¼‰åˆ›å»ºæ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œå¹¶ä¸”ç»‘å®šå…³ç³»
![](https://shierimages.oss-cn-shenzhen.aliyuncs.com/TyporaImages/image-20230623212927797.png#id=B65tr&originHeight=290&originWidth=771&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)
```java
// åˆ›å»ºè€æ¿çš„æ­»ä¿¡é˜Ÿåˆ—
String queueName = "laoban_queue";
channel.queueDeclare(queueName, true, false, false, null);
channel.queueBind(queueName, DLX_DIRECT_EXCHANGE, "laoban");

// åˆ›å»ºå¤–åŒ…çš„æ­»ä¿¡é˜Ÿåˆ—
String queueName2 = "waibao_queue";
channel.queueDeclare(queueName2, true, false, false, null);
channel.queueBind(queueName2, DLX_DIRECT_EXCHANGE, "waibao");
```

2ï¼‰ç»™å¤±è´¥ä¹‹åéœ€è¦å®¹é”™å¤„ç†çš„çš„é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº
ç¤ºä¾‹ä»£ç ï¼š
```java
// æŒ‡å®šæ­»ä¿¡é˜Ÿåˆ—çš„å‚æ•°
Map<String, Object> args = new HashMap<>();
// æŒ‡å®šæ­»ä¿¡é˜Ÿåˆ—ç»‘å®šåˆ°å“ªä¸ªäº¤æ¢æœº ï¼Œæ­¤å¤„ç»‘å®šçš„æ˜¯ dlx-direct-exchange äº¤æ¢æœº
args.put("x-dead-letter-exchange", DLX_DIRECT_EXCHANGE);
// æŒ‡å®šæ­»ä¿¡è¦è½¬å‘åˆ°å“ªä¸ªæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ­¤å¤„è½¬å‘åˆ° laoban è¿™ä¸ªæ­»ä¿¡é˜Ÿåˆ—
args.put("x-dead-letter-routing-key", "laoban");

// åˆ›å»ºé˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šå°çº¢
String queueName = "xiaohong_queue";
channel.queueDeclare(queueName, true, false, false, args);
channel.queueBind(queueName, DIRECT_2_EXCHANGE, "xiaohong");

Map<String, Object> args1 = new HashMap<>();
args.put("x-dead-letter-exchange", DLX_DIRECT_EXCHANGE);
args.put("x-dead-letter-routing-key", "waibao");

// åˆ›å»ºé˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šå°è“
String queueName2 = "xiaolan_queue";
channel.queueDeclare(queueName2, true, false, false, args1);
channel.queueBind(queueName2, DIRECT_2_EXCHANGE, "xiaolan");
```
3ï¼‰å¯ä»¥ç»™è¦å®¹é”™çš„é˜Ÿåˆ—æŒ‡å®šæ­»ä¿¡ä¹‹åçš„è½¬å‘è§„åˆ™ï¼Œæ­»ä¿¡åº”è¯¥å†è½¬å‘åˆ°å“ªä¸ªæ­»ä¿¡é˜Ÿåˆ—
```java
// æŒ‡å®šæ­»ä¿¡è¦è½¬å‘åˆ°å“ªä¸ªæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ­¤å¤„è½¬å‘åˆ° laoban è¿™ä¸ªæ­»ä¿¡é˜Ÿåˆ—
args.put("x-dead-letter-routing-key", "laoban");
```

4ï¼‰å¯ä»¥é€šè¿‡ç¨‹åºæ¥è¯»å–æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œä»è€Œè¿›è¡Œå¤„ç†
æ­»ä¿¡é˜Ÿåˆ—ç”Ÿäº§è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.DeliverCallback;

import java.util.Scanner;

/**
 * @author Shier
 */
public class DlxDirectProducer {

    private static final String DLX_DIRECT_EXCHANGE = "dlx-direct-exchange";
    private static final String WORK_EXCHANGE_NAME = "direct2-exchange";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();

        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("localhost");

        try (Connection connection = factory.newConnection();
             Channel channel = connection.createChannel()) {
            // å£°æ˜ç§ä¿¡äº¤æ¢æœº
            channel.exchangeDeclare(DLX_DIRECT_EXCHANGE, "direct");

            // åˆ›å»ºè€æ¿çš„æ­»ä¿¡é˜Ÿåˆ—
            String queueName = "laoban_dlx_queue";
            channel.queueDeclare(queueName, true, false, false, null);
            channel.queueBind(queueName, DLX_DIRECT_EXCHANGE, "laoban");

            // åˆ›å»ºå¤–åŒ…çš„æ­»ä¿¡é˜Ÿåˆ—
            String queueName2 = "waibao_dlx_queue";
            channel.queueDeclare(queueName2, true, false, false, null);
            channel.queueBind(queueName2, DLX_DIRECT_EXCHANGE, "waibao");


            // è€æ¿é˜Ÿåˆ—ç›‘å¬æœºåˆ¶
            DeliverCallback laobanDeliverCallback = (consumerTag, delivery) -> {
                String message = new String(delivery.getBody(), "UTF-8");
                // æ‹’ç»æ¶ˆæ¯
                channel.basicNack(delivery.getEnvelope().getDeliveryTag(),false,false);
                System.out.println(" [laoban] Received '" +
                        delivery.getEnvelope().getRoutingKey() + "':'" + message + "'");
            };
            // å¤–åŒ…é˜Ÿåˆ—ç›‘å¬æœºåˆ¶
            DeliverCallback waibaoDeliverCallback = (consumerTag, delivery) -> {
                String message = new String(delivery.getBody(), "UTF-8");
                // æ‹’ç»æ¶ˆæ¯
                channel.basicNack(delivery.getEnvelope().getDeliveryTag(),false,false);
                System.out.println(" [waibao] Received '" +
                        delivery.getEnvelope().getRoutingKey() + "':'" + message + "'");
            };
            // å¼€å¯æ¶ˆè´¹é€šé“è¿›è¡Œç›‘å¬
            channel.basicConsume(queueName, false, laobanDeliverCallback, consumerTag -> {
            });
            channel.basicConsume(queueName2, false, waibaoDeliverCallback, consumerTag -> {
            });


            Scanner scanner = new Scanner(System.in);
            while (scanner.hasNext()) {
                String userInput = scanner.nextLine();
                String[] splits = userInput.split(" ");
                if (splits.length < 1) {
                    continue;
                }
                String message = splits[0];
                String routingKey = splits[1];

                channel.basicPublish(WORK_EXCHANGE_NAME, routingKey, null, message.getBytes("UTF-8"));
                System.out.println(" [x] Sent '" + message + " with routing " + routingKey + "'");
            }
        }
    }
}
```

æ­»ä¿¡é˜Ÿåˆ—æ¶ˆè´¹è€…ä»£ç ï¼š
```java
package com.yupi.springbootinit.mq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.DeliverCallback;

import java.util.HashMap;
import java.util.Map;

/**
 * @author Shier
 */
public class DlxDirectConsumer {

    private static final String DLX_DIRECT_EXCHANGE = "dlx-direct-exchange";

    private static final String WORK_EXCHANGE_NAME = "direct2-exchange";

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
        factory.setHost("localhost");

        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        channel.exchangeDeclare(WORK_EXCHANGE_NAME, "direct");

        // æŒ‡å®šæ­»ä¿¡é˜Ÿåˆ—çš„å‚æ•°
        Map<String, Object> args = new HashMap<>();
        // æŒ‡å®šæ­»ä¿¡é˜Ÿåˆ—ç»‘å®šåˆ°å“ªä¸ªäº¤æ¢æœº ï¼Œæ­¤å¤„ç»‘å®šçš„æ˜¯ dlx-direct-exchange äº¤æ¢æœº
        args.put("x-dead-letter-exchange", DLX_DIRECT_EXCHANGE);
        // æŒ‡å®šæ­»ä¿¡è¦è½¬å‘åˆ°å“ªä¸ªæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ­¤å¤„è½¬å‘åˆ° laoban è¿™ä¸ªæ­»ä¿¡é˜Ÿåˆ—
        args.put("x-dead-letter-routing-key", "laoban");

        // åˆ›å»ºé˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šå°çº¢
        String queueName = "xiaohong_queue";
        channel.queueDeclare(queueName, true, false, false, args);
        channel.queueBind(queueName, WORK_EXCHANGE_NAME, "xiaohong");

        Map<String, Object> args2 = new HashMap<>();
        args2.put("x-dead-letter-exchange", DLX_DIRECT_EXCHANGE);
        args2.put("x-dead-letter-routing-key", "waibao");

        // åˆ›å»ºé˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šå°è“
        String queueName2 = "xiaolan_queue";
        channel.queueDeclare(queueName2, true, false, false, args2);
        channel.queueBind(queueName2, WORK_EXCHANGE_NAME, "xiaolan");

        System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

        // å°çº¢é˜Ÿåˆ—ç›‘å¬æœºåˆ¶
        DeliverCallback xiaohongDeliverCallback = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), "UTF-8");
            // æ‹’ç»æ¶ˆæ¯
            channel.basicNack(delivery.getEnvelope().getDeliveryTag(),false,false);
            System.out.println(" [xiaohong] Received '" +
                    delivery.getEnvelope().getRoutingKey() + "':'" + message + "'");
        };
        // å°è“é˜Ÿåˆ—ç›‘å¬æœºåˆ¶
        DeliverCallback xiaolanDeliverCallback = (consumerTag, delivery) -> {
            String message = new String(delivery.getBody(), "UTF-8");
            // æ‹’ç»æ¶ˆæ¯
            channel.basicNack(delivery.getEnvelope().getDeliveryTag(),false,false);
            System.out.println(" [xiaolan] Received '" +
                    delivery.getEnvelope().getRoutingKey() + "':'" + message + "'");
        };
        // å¼€å¯æ¶ˆè´¹é€šé“è¿›è¡Œç›‘å¬
        channel.basicConsume(queueName, false, xiaohongDeliverCallback, consumerTag -> {
        });
        channel.basicConsume(queueName2, false, xiaolanDeliverCallback, consumerTag -> {
        });
    }
}
```
> æ€»å¾—æ¥è¯´å°±æ˜¯ï¼Œè€æ¿ä¸‹å‘ä»»åŠ¡ç»™å‘˜å·¥ï¼ˆæ¶ˆæ¯è¿›å…¥å‘˜å·¥é˜Ÿåˆ—ï¼‰ï¼Œå¦‚æœå‘˜å·¥å‘ç°è‡ªå·±å¤„ç†ä¸äº†è¿™ä¸ªä»»åŠ¡ï¼ˆå‘˜å·¥å°†æ­¤æ¶ˆæ¯äº¤ç”±æ­»ä¿¡äº¤æ¢æœºï¼Œç„¶åå«è€æ¿å¸®å¿™è§£å†³ä¸€ä¸‹ï¼‰ï¼Œå°±ä¼šå†å»è¯·æ±‚è€æ¿å¸®å¿™è§£å†³ï¼ˆæœ€åå°†æ­¤æ¶ˆæ¯æ”¾å…¥åˆ°è€æ¿çš„æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼‰
> ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜æ­»ä¿¡é˜Ÿåˆ—çš„ä½¿ç”¨å’Œè§£å†³è¿‡ç¨‹ï¼š
> å‡è®¾æœ‰ä¸€ä¸ªè®¢å•æ”¯ä»˜ç³»ç»Ÿï¼ŒåŒ…å«è®¢å•é˜Ÿåˆ—å’Œæ”¯ä»˜ç»“æœé˜Ÿåˆ—ã€‚å½“ç”¨æˆ·ä¸‹å•åï¼Œè®¢å•ä¿¡æ¯ä¼šè¢«å‘é€åˆ°è®¢å•é˜Ÿåˆ—ä¸­è¿›è¡Œå¤„ç†ï¼Œç„¶åæ ¹æ®æ”¯ä»˜ç»“æœå°†è®¢å•ä¿¡æ¯å‘é€åˆ°æ”¯ä»˜ç»“æœé˜Ÿåˆ—ã€‚ä½†æ˜¯æœ‰æ—¶è®¢å•é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å¤„ç†å¤±è´¥æˆ–è€…è¶…æ—¶ï¼Œå¯¼è‡´æ”¯ä»˜ç»“æœæ— æ³•è¢«å‘é€åˆ°æ”¯ä»˜ç»“æœé˜Ÿåˆ—ä¸­ã€‚
> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—æ¥è§£å†³é—®é¢˜ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š
> 1. åˆ›å»ºä¸€ä¸ªæ­£å¸¸çš„è®¢å•é˜Ÿåˆ—å’Œæ”¯ä»˜ç»“æœé˜Ÿåˆ—ï¼Œå¹¶å®šä¹‰å®ƒä»¬ä¹‹é—´çš„äº¤æ¢æœºå’Œç»‘å®šå…³ç³»ã€‚
> 2. åˆ›å»ºä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œå¹¶å®šä¹‰å®ƒä»¬ä¹‹é—´çš„ç»‘å®šå…³ç³»ã€‚å°†è®¢å•é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”±åˆ°æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚
> 3. åœ¨è®¢å•é˜Ÿåˆ—ä¸­è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œå½“æ¶ˆæ¯è¿‡æœŸåï¼Œä¼šæˆä¸ºæ­»ä¿¡æ¶ˆæ¯ï¼Œå¹¶è¢«è·¯ç”±åˆ°æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚
> 4. åœ¨æ”¯ä»˜ç»“æœé˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¤„ç†è®¢å•çš„æ”¯ä»˜ç»“æœã€‚
> 5. åœ¨æ­»ä¿¡é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ­»ä¿¡æ¶ˆæ¯ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚å¯ä»¥è®°å½•æ—¥å¿—ã€å‘é€é€šçŸ¥ç­‰ã€‚
> 
é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå½“è®¢å•é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¸èƒ½æŒ‰æ—¶å¤„ç†æ—¶ï¼Œæ¶ˆæ¯ä¼šè¿‡æœŸæˆä¸ºæ­»ä¿¡æ¶ˆæ¯ï¼Œå¹¶è¢«è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æ­»ä¿¡é˜Ÿåˆ—ä¸­è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚
> ä¾‹å¦‚ï¼Œåœ¨æ”¯ä»˜ç»“æœé˜Ÿåˆ—ä¸­çš„æ¶ˆè´¹è€…å‘ç°æŸä¸ªè®¢å•æ— æ³•å¤„ç†æ—¶ï¼Œå¯ä»¥å°†è¯¥æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æ­»ä¿¡é˜Ÿåˆ—ä¸­å†™å…¥æ—¥å¿—æˆ–è€…å‘é€é‚®ä»¶é€šçŸ¥ç›¸å…³äººå‘˜ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†è¿™äº›æ­»ä¿¡æ¶ˆæ¯ã€‚
> è¿™æ ·ï¼Œé€šè¿‡ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°å¤„ç†æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå¹¶è¿›è¡Œç›¸å…³çš„è¡¥æ•‘æªæ–½ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå®¹é”™æ€§ã€‚


#### 3.5.4 å»¶è¿Ÿé˜Ÿåˆ—
å®˜ç½‘åœ°å€ï¼š[https://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq](https://blog.rabbitmq.com/posts/2015/04/scheduling-messages-with-rabbitmq)
å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆDelayed Queueï¼‰ï¼Œå®ƒå…è®¸æ¶ˆæ¯åœ¨ä¸€å®šçš„å»¶è¿Ÿæ—¶é—´åè¢«æ¶ˆè´¹ã€‚
ä½œç”¨ï¼š**åœ¨æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—åï¼Œä¸ç«‹å³å°†æ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€…ï¼Œè€Œæ˜¯åœ¨ä¸€å®šå»¶è¿Ÿæ—¶é—´åå†è¿›è¡ŒæŠ•é€’ã€‚å»¶è¿Ÿé˜Ÿåˆ—é€šå¸¸ç”¨äºéœ€è¦å»¶è¿Ÿå¤„ç†çš„ä¸šåŠ¡åœºæ™¯ã€‚** Â å»¶è¿Ÿé˜Ÿåˆ—ä¸»è¦ç”¨äºå¤„ç†éœ€è¦åœ¨ç‰¹å®šæ—¶é—´åæ‰§è¡Œçš„ä»»åŠ¡æˆ–å»¶è¿Ÿæ¶ˆæ¯ã€‚å®ƒå¯ä»¥ä¸ºæ¶ˆæ¯è®¾ç½®ä¸€ä¸ªå»¶è¿Ÿæ—¶é—´ï¼Œåœ¨æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åï¼Œæ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨æŠ•é€’åˆ°æŒ‡å®šçš„æ¶ˆè´¹è€…ã€‚ä¾‹å¦‚å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯é‡è¯•ã€å»¶è¿Ÿé€šçŸ¥ç­‰ã€‚
å»¶è¿Ÿé˜Ÿåˆ—é€‚ç”¨äºè®¸å¤šåœºæ™¯ï¼ŒåŒ…æ‹¬ï¼š

1. **å®šæ—¶ä»»åŠ¡ï¼š**å¯ä»¥ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—æ¥å®ç°ä»»åŠ¡çš„å®šæ—¶è§¦å‘ï¼Œä¾‹å¦‚å®šæ—¶å‘é€é‚®ä»¶æˆ–æ¨é€é€šçŸ¥ã€‚
2. **æ¶ˆæ¯é‡è¯•ï¼š**å½“æŸä¸ªæ¶ˆæ¯å¤±è´¥åï¼Œå¯ä»¥å°†å…¶æ”¾å…¥å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼Œä»¥ä¾¿ç¨åé‡æ–°æŠ•é€’ã€‚
3. **å»¶è¿Ÿé€šçŸ¥ï¼š**ä¾‹å¦‚åœ¨æŸä¸ªæ—¶é—´åå‘é€æé†’é€šçŸ¥ã€‚

å»¶è¿Ÿé˜Ÿåˆ—çš„ä¼˜ç‚¹æœ‰ï¼š

1. çµæ´»æ€§ï¼šå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚ï¼Œçµæ´»åœ°è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼Œé€‚åº”å„ç§ä¸šåŠ¡åœºæ™¯ã€‚
2. è§£è€¦æ€§ï¼šå»¶è¿Ÿé˜Ÿåˆ—å¯ä»¥å°†æ¶ˆæ¯å‘é€ä¸æ¶ˆè´¹è§£è€¦ï¼Œæé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œç¨³å®šæ€§ã€‚
3. å¯é æ€§ï¼šé€šè¿‡å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯åœ¨ä¸€å®šæ—¶é—´åè¢«æŠ•é€’ï¼Œé™ä½æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ã€‚

å»¶è¿Ÿé˜Ÿåˆ—çš„ç¼ºç‚¹æœ‰ï¼š

1. ç³»ç»Ÿå¤æ‚æ€§ï¼šå¼•å…¥å»¶è¿Ÿé˜Ÿåˆ—ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§å’Œç»´æŠ¤æˆæœ¬ã€‚
2. å»¶è¿Ÿæ—¶é—´ä¸å‡†ç¡®ï¼šç”±äºç½‘ç»œå»¶è¿Ÿã€ç³»ç»Ÿè´Ÿè½½ç­‰åŸå› ï¼Œå»¶è¿Ÿæ—¶é—´å¯èƒ½ä¼šæœ‰ä¸€å®šçš„è¯¯å·®ã€‚

### 3.6 RabbitMQé‡ç‚¹çŸ¥è¯† â­â­â­â­â­
> ä¹Ÿæ˜¯é¢è¯•è€ƒç‚¹

1. æ¶ˆæ¯é˜Ÿåˆ—çš„æ¦‚å¿µã€æ¨¡å‹ï¼ˆä¸Šé¢çš„ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å›¾è§£ï¼‰ã€åº”ç”¨åœºæ™¯
2. äº¤æ¢æœºçš„ç±»åˆ«ã€è·¯ç”±ç»‘å®šçš„å…³ç³»
3. æ¶ˆæ¯å¯é æ€§ 
   - æ¶ˆæ¯ç¡®è®¤æœºåˆ¶(ackã€nackã€reject)
   - æ¶ˆæ¯ç‰¹ä¹…åŒ–(durable)
   - æ¶ˆæ¯è¿‡æœŸæœºåˆ¶
   - æ­»ä¿¡é˜Ÿåˆ—
4. å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆç±»ä¼¼æ­»ä¿¡é˜Ÿåˆ—ï¼‰
5. é¡ºåºæ¶ˆè´¹ã€æ¶ˆè´¹å¹‚ç­‰æ€§
6. å¯æ‰©å±•æ€§ï¼ˆä»…ä½œäº†è§£ï¼‰ 
   - é›†ç¾¤
   - æ•…éšœçš„æ¢å¤æœºåˆ¶
   - é•œåƒ
7. è¿ç»´ç›‘æ§å‘Šè­¦ï¼ˆä»…ä½œäº†è§£ï¼‰

## 4ã€RabbitMQ BI é¡¹ç›®å®æˆ˜
### 4.1 é€‰æ‹©å®¢æˆ·ç«¯
> æ€ä¹ˆåœ¨é¡¹ç›®ä¸­ä½¿ç”¨RabbitMQ?

1. **ä½¿ç”¨å®˜æ–¹çš„å®¢æˆ·ç«¯**

ä¼˜ç‚¹ï¼šå…¼å®¹æ€§å¥½ï¼Œæ¢è¯­è¨€æˆæœ¬ä½ï¼Œæ¯”è¾ƒçµæ´»
ç¼ºç‚¹ï¼šå¤ªçµæ´»ï¼Œè¦è‡ªå·±å»å¤„ç†ä¸€äº›äº‹æƒ…ã€‚æ¯”å¦‚è¦è‡ªå·±ç»´æŠ¤ç®¡ç†é“¾æ¥ï¼Œå¾ˆéº»çƒ¦ã€‚

2. **ä½¿ç”¨å°è£…å¥½çš„å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚Spring Boot RabbitMQ Starter**

ä¼˜ç‚¹ï¼šç®€å•æ˜“ç”¨ï¼Œç›´æ¥é…ç½®ç›´æ¥ç”¨ï¼Œæ›´æ–¹ä¾¿åœ°å»ç®¡ç†è¿æ¥
ç¼ºç‚¹ï¼šå°è£…çš„å¤ªå¥½äº†ï¼Œä½ æ²¡å­¦è¿‡çš„è¯åè€Œä¸çŸ¥é“æ€ä¹ˆç”¨ã€‚ä¸å¤Ÿçµæ´»ï¼Œè¢«æ¡†æ¶é™åˆ¶ã€‚
> æ ¹æ®åœºæ™¯æ¥é€‰æ‹©ï¼Œæ²¡æœ‰ç»å¯¹çš„ä¼˜åŠ£ï¼Œç±»ä¼¼ jdbc å’Œ MyBatis
> ä¼˜ç‚¹ï¼š
> 1. å¼ºå¤§çš„åŠŸèƒ½æ”¯æŒï¼šRabbitMQ Javaå®¢æˆ·ç«¯æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œç‰¹æ€§ï¼Œä¾‹å¦‚æ¶ˆæ¯ç¡®è®¤ã€äº‹åŠ¡æ”¯æŒã€æ¶ˆè´¹è€…æ‹‰å–ã€æ¶ˆæ¯é‡è¯•ã€å¯é æ€§æ¶ˆæ¯ä¼ é€’ç­‰ã€‚
> 2. å¯é æ€§å’Œç¨³å®šæ€§ï¼šé€šè¿‡ä½¿ç”¨å¯é çš„æ¶ˆæ¯ç¡®è®¤æœºåˆ¶å’Œäº‹åŠ¡æ”¯æŒï¼ŒJavaå®¢æˆ·ç«¯å¯ä»¥ç¡®ä¿æ¶ˆæ¯çš„å¯é ä¼ é€’å’Œå¤„ç†ã€‚
> 3. å¼€å‘äººå‘˜ç¤¾åŒºæ”¯æŒï¼šRabbitMQ Javaå®¢æˆ·ç«¯æ‹¥æœ‰å¹¿æ³›çš„å¼€å‘äººå‘˜ç¤¾åŒºæ”¯æŒï¼Œå¹¶ä¸”æœ‰å¤§é‡çš„æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç å¯ä¾›å‚è€ƒã€‚
> 4. è‰¯å¥½çš„æ€§èƒ½ï¼šJavaå®¢æˆ·ç«¯é‡‡ç”¨äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡åè®®å’Œçº¿ç¨‹æ¨¡å‹ï¼Œå¯ä»¥åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹è¡¨ç°å‡ºè¾ƒå¥½çš„æ€§èƒ½ã€‚
> 
ç¼ºç‚¹ï¼š
> 1. å¤æ‚æ€§ï¼šç›¸å¯¹äºå…¶ä»–è¯­è¨€çš„RabbitMQå®¢æˆ·ç«¯ï¼ŒJavaå®¢æˆ·ç«¯å¯èƒ½ä¼šæ›´åŠ å¤æ‚å’Œè‡ƒè‚¿ï¼Œéœ€è¦æ›´å¤šçš„ä»£ç å’Œé…ç½®ã€‚
> 2. å†…å­˜å ç”¨ï¼šç”±äºJavaå®¢æˆ·ç«¯çš„ä¸€äº›è®¾è®¡å’Œä¾èµ–ï¼Œå¯èƒ½ä¼šå ç”¨è¾ƒå¤šçš„å†…å­˜èµ„æºï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ã€‚


æœ¬æ¬¡ä½¿ç”¨ Spring Boot RabbitMQ Starter (å› ä¸ºæˆ‘ä»¬æ˜¯Spring Booté¡¹ç›®)
å¦‚æœä½ æœ‰ä¸€å®šæ°´å¹³ï¼Œæœ‰åŸºç¡€ï¼Œè‹±æ–‡å¥½ï¼Œå»ºè®®çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä¸è¦çœ‹è¿‡æœŸåšå®¢ï¼
å®˜ç½‘åœ°å€ï¼š[https://spring.io/guides/gs/messaging-rabbitmq/](https://spring.io/guides/gs/messaging-rabbitmq/)

### 4.2 é¡¹ç›®å®æˆ˜
##### 4.2.1 å¼•å…¥ä¾èµ–
é¦–å…ˆå» maven å®˜æ–¹ä»“åº“
[https://mvnrepository.com/](https://mvnrepository.com/)
å¼•å…¥ä¾èµ–ã€‚
æœç´¢ Spring Boot Starter AMQP
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723912979900-e01d3cf9-968a-4e4d-9969-a6de9ac9641f.png#averageHue=%23fafafa&clientId=ud916e621-faab-4&from=paste&height=668&id=u25e959e3&originHeight=1603&originWidth=2813&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=414983&status=done&style=none&taskId=u26e617a0-e745-406b-ad30-85c0dcbbd0b&title=&width=1172.0832867589281)
```xml
<!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-amqp -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-amqp</artifactId>
    <version>2.7.2</version>
</dependency>

<!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-amqp -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-amqp</artifactId>
    <version>3.3.2</version>
</dependency>
```
AMQP æ˜¯ RabbitMQ å®ç°çš„ä¸€ä¸ªåè®®ï¼Œè¿›å…¥åå¯ä»¥çœ‹åˆ°å®ƒçš„è¯´æ˜ï¼Œæ”¯æŒ AMQP å’Œ RabbitMQï¼Œä»–ä»¬æ˜¯å¤ç”¨ã€‚
æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ï¼Œç¡®ä¿é€‰æ‹©çš„ç‰ˆæœ¬ä¸ä½¿ç”¨çš„ Spring Boot ç‰ˆæœ¬ä¿æŒä¸€è‡´ã€‚ä¸ºäº†é¿å…å‡ºç°ä¸å…¼å®¹çš„æƒ…å†µï¼ŒæŸ¥çœ‹é¡¹ç›®ä½¿ç”¨çš„ Spring Boot ç‰ˆæœ¬æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œ Spring Boot çš„ç‰ˆæœ¬æ˜¯ 2.7.2ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723913067982-3f294a08-28c1-4efb-bc4e-029c0610dffb.png#averageHue=%23292e36&clientId=ud916e621-faab-4&from=paste&height=258&id=u9818977a&originHeight=620&originWidth=1439&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=132911&status=done&style=none&taskId=u36195f8b-a31b-45e5-bd49-7a11758646d&title=&width=599.5833095080333)
æ‰€ä»¥é€‰æ‹© 2.7.2 çš„ç‰ˆæœ¬ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723913145578-0223841c-40ec-47ca-9480-845070d2bbb1.png#averageHue=%23fcfcfc&clientId=ud916e621-faab-4&from=paste&height=310&id=u93c9c45d&originHeight=745&originWidth=1441&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=73293&status=done&style=none&taskId=u24fb7523-0482-404e-90cc-cd6ab3fde4c&title=&width=600.4166428082528)
```xml
<!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-amqp -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-amqp</artifactId>
    <version>2.7.2</version>
</dependency>
```
##### 4.2.2 åœ¨ymlä¸­è¿›è¡Œé…ç½®
```yaml
spring: 
    # rabbitmq ä¿¡æ¯
    rabbitmq:
        host: localhost
        port: 5672
        password: guest
        username: guest
```
##### 4.2.3 åˆ›å»ºäº¤æ¢æœºå’Œé˜Ÿåˆ—
æŠŠä¹‹å‰å¯åŠ¨çš„ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…åœæ‰ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723913409810-42dbe26c-3886-432a-9353-d5c9caeeef7c.png#averageHue=%23f7f3f2&clientId=ud916e621-faab-4&from=paste&height=107&id=ufadf22f2&originHeight=257&originWidth=790&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=75104&status=done&style=none&taskId=uf00fab68-bc83-471d-b11f-a317caecd8f&title=&width=329.166653586759)
æ–°å»ºä¸€ä¸ªåŒ…ï¼š bizmq (å­˜æ”¾ä¸šåŠ¡ç›¸å…³çš„ mq ä»£ç )ã€‚
##### 4.2.4 ç”Ÿäº§è€…ä»£ç 
```java
package com.yupi.springbootinit.bizmq;

import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;

/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-18 00:52
 **/
@Component
public class MyMessageProducer {
    @Resource
    private RabbitTemplate rabbitTemplate;
    /**
     * å‘é€æ¶ˆæ¯
     * @param exchange
     * @param routingKey
     * @param message
     */
    public void sendMessage(String exchange, String routingKey, String message) {
        rabbitTemplate.convertAndSend(exchange, routingKey, message);
    }
}
```

##### 4.2.5 æ¶ˆè´¹è€…ä»£ç 
```java
package com.yupi.springbootinit.bizmq;

import com.rabbitmq.client.Channel;
import lombok.extern.slf4j.Slf4j;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.amqp.support.AmqpHeaders;
import org.springframework.messaging.handler.annotation.Header;
import org.springframework.stereotype.Component;

import java.io.IOException;


/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-18 00:54
 **/
@Component
@Slf4j
public class MyMessageConsumer {
    /**
     * æŒ‡å®šç¨‹åºç›‘å¬çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œç¡®è®¤æœºåˆ¶
     * @param message
     * @param channel
     * @param deliveryTag
     */
    @RabbitListener(queues = {"demo_queue"}, ackMode = "MANUAL")
    private void receiveMessage(String message, Channel channel, @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag){
        log.info("receiveMessage = {}",message);
        try {
            // æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯
            channel.basicAck(deliveryTag,false);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}
```
åˆ›å»ºåè¿è¡Œä¸€æ¬¡
```java
package com.yupi.springbootinit.bizmq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-18 00:58
 * åˆ›å»ºæµ‹è¯•æµ‹åºç”¨åˆ°çš„äº¤æ¢æœºå’Œé˜Ÿåˆ— (ä»…æ‰§è¡Œä¸€æ¬¡)
 **/

public class MqInitMain {
    public static void main(String[] args) {
        try {
            ConnectionFactory factory = new ConnectionFactory();
            // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
            factory.setHost("localhost");

            Connection connection = factory.newConnection();
            Channel channel = connection.createChannel();

            String demoExchange = "demo_exchange";

            channel.exchangeDeclare(demoExchange, "direct");

            // åˆ›å»ºé˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°ï¼šå°ç´«
            String queueName = "demo_queue";
            channel.queueDeclare(queueName, true, false, false, null);
            channel.queueBind(queueName, demoExchange, "demo_routingKey");

        }catch (Exception e){

        }
    }
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723914212687-edbf1fde-2716-4d1b-b1d4-3fd04d5dd1da.png#averageHue=%23eeeeed&clientId=ud916e621-faab-4&from=paste&height=513&id=u43429dff&originHeight=1231&originWidth=2473&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=274961&status=done&style=none&taskId=u9e711fdf-6a7c-4c87-b811-d4b46c3e2b4&title=&width=1030.4166257215886)
##### 4.2.6 å•å…ƒæµ‹è¯•æ‰§è¡Œ
```java
package com.yupi.springbootinit.bizmq;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import javax.annotation.Resource;

import static org.junit.jupiter.api.Assertions.*;
@SpringBootTest
class MyMessageProducerTest {

    @Resource
    private MyMessageProducer myMessageProducer;

    @Test
    void sendMessage() {
        myMessageProducer.sendMessage("demo_exchange","demo_routingKey","æ¬¢è¿æ¥åˆ°æ™ºèƒ½BIç³»ç»Ÿ");
    }
}
```

ç»“æœå¦‚ä¸‹ï¼š
å¯åŠ¨main
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723914504993-08d04680-41c0-4cef-aeb5-d58bc6766147.png#averageHue=%232a3038&clientId=ud916e621-faab-4&from=paste&height=683&id=ue48aeb80&originHeight=1640&originWidth=2811&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=537880&status=done&style=none&taskId=u4ecc4c3e-190f-42c9-996d-96468d78b43&title=&width=1171.2499534587084)
å¯åŠ¨æµ‹è¯•ç±»
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723914542036-59305375-d12c-4c0b-9c72-977e96973a0d.png#averageHue=%232a2e37&clientId=ud916e621-faab-4&from=paste&height=680&id=ubd6ac4fb&originHeight=1633&originWidth=2817&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=448110&status=done&style=none&taskId=uf18594e4-2639-482d-9478-083f0e38d47&title=&width=1173.7499533593673)
ç»“æœ
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723914575161-adc93e1b-6a28-4b6a-9201-9efdb4ec77cc.png#averageHue=%232a3038&clientId=ud916e621-faab-4&from=paste&height=698&id=ud62bac14&originHeight=1676&originWidth=2827&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=546013&status=done&style=none&taskId=u8bbfa7ed-346d-4d3f-a79c-a6aba1b6143&title=&width=1177.9166198604655)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723914598033-4b73f8ee-53ec-4ab3-827f-11660380652f.png#averageHue=%232d343d&clientId=ud916e621-faab-4&from=paste&height=166&id=ud75378a1&originHeight=398&originWidth=2698&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=193770&status=done&style=none&taskId=ubae58431-c458-414d-aee9-9f9f53193fe&title=&width=1124.1666219962985)
### 4.3 BIé¡¹ç›®æ”¹é€ ï¼ˆ2:42-ï¼‰
##### 4.3.1 æ”¹é€ å‰BI
ä»¥å‰æ˜¯æŠŠä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ï¼Œç„¶ååœ¨çº¿ç¨‹æ± æäº¤ä¸­ç¼–å†™å¤„ç†ç¨‹åºçš„ä»£ç ï¼Œçº¿ç¨‹æ± å†…æ’é˜Ÿã€‚
å¦‚æœç¨‹åºä¸­æ–­äº†ï¼Œä»»åŠ¡å°±æ²¡äº†ï¼Œå°±ä¸¢äº†ã€‚
##### 4.3.2 æ”¹é€ åçš„BI
æ”¹é€ åçš„æµç¨‹ï¼š

1.  æŠŠä»»åŠ¡æäº¤æ”¹ä¸ºå‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯ 
2.  å†™ä¸€ä¸ªä¸“å¼•é—¨çš„æ¥å—æ¶ˆæ¯çš„ç¨‹åºï¼Œå¤„ç†ä»»åŠ¡ 
3.  å¦‚æœç¨‹åºä¸­æ–­äº†ï¼Œæ¶ˆæ¯æœªè¢«ç¡®è®¤ï¼Œè¿˜ä¼šé‡å‘ 
4.  ç°åœ¨ï¼Œæ¶ˆæ¯å…¨éƒ¨é›†ä¸­å‘åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥éƒ¨ç½²å¤šä¸ªåç«¯ï¼Œéƒ½ä»åŒä¸€ä¸ªåœ°æ–¹å–ä»»åŠ¡ï¼Œä»è€Œå®ç°äº†åˆ†å¸ƒå¼è´Ÿè½½å‡è¡¡ 

å®ç°æ­¥éª¤ï¼š

1. åˆ›å»ºäº¤æ¢æœºå’Œé˜Ÿåˆ—
2. å°†çº¿ç¨‹æ± ä¸­çš„æ‰§è¡Œä»£ç ç§»åˆ°æ¶ˆè´¹è€…ç±»ä¸­
3. æ ¹æ®æ¶ˆè´¹è€…çš„éœ€æ±‚æ¥ç¡®è®¤æ¶ˆæ¯çš„æ ¼å¼(chartld)
4. å°†æäº¤çº¿ç¨‹æ± æ”¹é€ ä¸ºå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—

éªŒè¯
éªŒè¯å‘ç°ï¼Œå¦‚æœç¨‹åºä¸­æ–­äº†ï¼Œæ²¡æœ‰ ackã€ä¹Ÿæ²¡æœ‰ nack (æœåŠ¡ä¸­æ–­ï¼Œæ²¡æœ‰ä»»ä½•å“åº”)ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯ä¼šè¢«é‡æ–°æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œä»è€Œå®ç°äº†æ¯ä¸ªä»»åŠ¡éƒ½ä¼šæ‰§è¡Œã€‚

##### 4.3.3 å®ç°ä»£ç 
###### 0ï¼‰å®šä¹‰å¸¸é‡
å°†å¸¸é‡å­˜æ”¾åœ¨ä¸€ä¸ªåŒ…çš„æ¥å£ä¸­(åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºå­˜æ”¾å¸¸é‡çš„åŒ…ï¼Œå¹¶åœ¨è¯¥åŒ…ä¸­å®šä¹‰æ¥å£æˆ–ç±»æ¥å­˜æ”¾ 
ç›¸å…³å¸¸é‡)ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723950182441-bf15bf4b-792c-4a19-8e65-fa20455090c2.png#averageHue=%23f9f8f8&clientId=u6a6faefb-591e-4&from=paste&height=826&id=ua8fb7177&originHeight=991&originWidth=1298&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=256899&status=done&style=none&taskId=ub946edd8-1e57-4edc-a339-45bd8f23916&title=&width=1081.6666236850967)
å°†å¸¸é‡å­˜æ”¾åœ¨ä¸€ä¸ªåŒ…çš„æ¥å£ä¸­(åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºå­˜æ”¾å¸¸é‡çš„åŒ…ï¼Œå¹¶åœ¨è¯¥åŒ…ä¸­å®šä¹‰æ¥å£æˆ–ç±»æ¥å­˜æ”¾ 
ç›¸å…³å¸¸é‡)ã€‚
è¿™é‡Œå¦‚æœä¸ºäº†å¤ç”¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œä½ å¯ä»¥åšå¤šä¸ªè·¯ç”±é”®ã€‚
```java
package com.yupi.springbootinit.bizmq;

/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-18 10:17
 **/

public class BiMqConstant {
    static final String BI_EXCHANGE_NAME = "bi_exchange";

    static final String BI_QUEUE_NAME = "bi_queue";

    static final String BI_ROUTING_KEY = "bi_routingKey";

    static final String BI_HOST = "localhost";
}
```
**çº¿ç¨‹æ± æ˜¯ä¸æ˜¯æ›´é€‚ç”¨äºéœ€è¦å¤šä¸ªçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼Œè€Œ MQ æ›´é€‚ç”¨äºæœåŠ¡é—´é€šä¿¡ä¸åº”ç”¨è§£è€¦ï¼Ÿ **
å¯¹ï¼Œçº¿ç¨‹æ± å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰åœ¨ä¸åŒçš„åœºæ™¯ä¸‹æœ‰ä¸åŒçš„é€‚ç”¨æ€§ã€‚çº¿ç¨‹æ± æ›´é€‚åˆå¤„ç†éœ€è¦å¤šä¸ªçº¿ 
ç¨‹å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè€Œ MQ æ›´é€‚åˆç”¨äºåˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„ä¿¡æ¯ä¼ è¾“ã€åº”ç”¨è§£è€¦ã€è´Ÿè½½å‡è¡¡ä»¥åŠæ¶ˆæ¯ 
å¯é æ€§ä¿è¯ã€‚
**ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†å¸ƒå¼ä¸­ä½¿ç”¨çº¿ç¨‹æ± å°±ä¸é€‚åˆäº†å‘—ï¼Œä¿è¯ä¸äº†ä»»åŠ¡çš„å…ˆåï¼Ÿ **
ç¡®å®ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ä½¿ç”¨çº¿ç¨‹æ± å¯èƒ½æ— æ³•ä¿è¯ä»»åŠ¡çš„å…ˆåé¡ºåºã€‚å¦‚æœä½ éœ€è¦è€ƒè™‘æ¶ˆæ¯çš„é¡ºåº 
æ€§ï¼Œå°±éœ€è¦è®¾è®¡é¢å¤–çš„æœºåˆ¶æ¥å®ç°ã€‚å•ç‹¬ä½¿ç”¨ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ç¡®ä¿æ¶ˆæ¯çš„é¡ºåºä¼ é€’ï¼Œä½†æ˜¯å¦‚æœ 
å¼•å…¥äº†å…¶ä»–å¤æ‚çš„æœºåˆ¶ï¼Œå°±æ— æ³•ä¿è¯é¡ºåºäº†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æŒ‰é¡ºåºæ¥æ”¶æ¶ˆæ¯ 1ã€2ã€3ã€4ã€5ï¼Œä½† 
æ˜¯å°†å®ƒä»¬ä½œä¸ºä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œï¼Œå°±æ— æ³•ä¿è¯å®ƒä»¬æŒ‰ç…§é¡ºåºæ‰§è¡Œã€‚ 
ç„¶è€Œï¼Œåªè¦ä½ ä¿è¯æŒ‰é¡ºåºå°†ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± ï¼Œå®ƒä»¬å®é™…ä¸Šä¹Ÿä¼šæŒ‰é¡ºåºæ‰§è¡Œã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½  
ä»¥é¡ºåºæ–¹å¼å°†æ¶ˆæ¯ 1ã€2ã€3ã€4ã€5 è¿›å…¥çº¿ç¨‹æ± ä½œä¸ºä»»åŠ¡ï¼Œçº¿ç¨‹æ± ä¼šæŒ‰ç…§ä»»åŠ¡çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ 
å› æ­¤ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µæ¥æƒè¡¡ä½¿ç”¨çº¿ç¨‹æ± å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶è®¾è®¡é€‚å½“çš„æœºåˆ¶æ¥ç¡®ä¿ä»»åŠ¡çš„é¡ºåº 
æ€§ã€‚å¦‚æœæ¶ˆæ¯çš„é¡ºåºå¯¹ä¸šåŠ¡å¾ˆé‡è¦ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æœ‰åºæ¶ˆæ¯é˜Ÿåˆ—æˆ–å…¶ä»–ä¿è¯é¡ºåºæ€§çš„è§£å†³æ–¹æ¡ˆã€‚
###### 1ï¼‰BI åˆ›å»ºé˜Ÿåˆ—å’Œäº¤æ¢æœº
```java
package com.yupi.springbootinit.bizmq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

/**
 * @program: zkybi-backend
 * @description:
 * @author: ZKYAAA
 * @create: 2024-08-18 00:58
 * åˆ›å»ºæµ‹è¯•æµ‹åºç”¨åˆ°çš„äº¤æ¢æœºå’Œé˜Ÿåˆ— (ä»…æ‰§è¡Œä¸€æ¬¡)
 **/
public class BiInitMain {
    public static void main(String[] args) {
        try {
            ConnectionFactory factory = new ConnectionFactory();
            // è®¾ç½® rabbitmq å¯¹åº”çš„ä¿¡æ¯
            factory.setHost(BiMqConstant.BI_HOST);
            // åˆ›å»ºè¿æ¥åˆ° RabbitMQ æœåŠ¡å™¨çš„è¿æ¥å·¥å‚
            Connection connection = factory.newConnection();
            // ç”¨äºä¸ RabbitMQ æœåŠ¡å™¨çš„é€šä¿¡
            Channel channel = connection.createChannel();
            String EXCHANGE_NAME = BiMqConstant.BI_EXCHANGE_NAME;
            // å®šä¹‰äº¤æ¢æœºçš„åç§°
            channel.exchangeDeclare(EXCHANGE_NAME, BiMqConstant.BI_DIRECT_EXCHANGE);

            // åˆ›å»ºé˜Ÿåˆ—ï¼Œåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°
            String queueName = BiMqConstant.BI_QUEUE_NAME;
            // å®šä¹‰é˜Ÿåˆ—çš„åç§°
            channel.queueDeclare(queueName, true, false, false, null);
            // å°†é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœº
            channel.queueBind(queueName, EXCHANGE_NAME, BiMqConstant.BI_ROUTING_KEY);
        }catch (Exception e){
            e.printStackTrace();
        }
    }
}
```
###### 2ï¼‰BI æ¶ˆè´¹è€…ç¨‹åº
```java
package com.yupi.springbootinit.bizmq;

import com.rabbitmq.client.Channel;
import lombok.SneakyThrows;
import lombok.extern.slf4j.Slf4j;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.amqp.support.AmqpHeaders;
import org.springframework.messaging.handler.annotation.Header;
import org.springframework.stereotype.Component;

@Component
@Slf4j
public class BiMessageConsumer {
    // æŒ‡å®šç¨‹åºç›‘å¬çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œç¡®è®¤æœºåˆ¶
    @SneakyThrows
    @RabbitListener(queues = {BiMqConstant.BI_QUEUE_NAME}, ackMode = "MANUAL")
    public void receiveMessage(String message, Channel channel, @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
        log.info("receiveMessage message = {}", message);
        // æ¶ˆæ¯ç¡®è®¤
        channel.basicAck(deliveryTag, false);
    }
}
```
###### 3ï¼‰ç”Ÿäº§è€…ä»£ç 
```java
package com.yupi.springbootinit.bizmq;

import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;

@Component
public class BiMessageProducer {

    @Resource
    private RabbitTemplate rabbitTemplate;

    /**
     * å‘é€æ¶ˆæ¯
     * @param message
     */
    public void sendMessage(String message) {
        rabbitTemplate.convertAndSend(BiMqConstant.BI_EXCHANGE_NAME, BiMqConstant.BI_ROUTING_KEY, message);
    }

}
```
##### 4.3.4 æ”¹é€ ä¸šåŠ¡æµç¨‹
å¤åˆ¶ä¹‹å‰å†™çš„å¼‚æ­¥ä¸šåŠ¡ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723950542310-01e2b8cf-2c2b-4fc6-a486-dd96eaac3d52.png#averageHue=%23272c34&clientId=u6a6faefb-591e-4&from=paste&height=1303&id=u078b7ae7&originHeight=1564&originWidth=2858&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=510882&status=done&style=none&taskId=u2e43900f-eb5b-4fde-9e0c-c0a64215b45&title=&width=2381.66657202774)
ç„¶åå¼•å…¥æ¶ˆæ¯ç”Ÿäº§è€…ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723950587565-1678d0f8-0b84-4993-9a79-a2559872b5c5.png#averageHue=%23272c33&clientId=u6a6faefb-591e-4&from=paste&height=1406&id=u1a57052c&originHeight=1687&originWidth=2843&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=484594&status=done&style=none&taskId=ua97f41e9-107c-453f-97e6-c75ab50860f&title=&width=2369.166572524445)
ç°åœ¨è¦æ”¹é€ å¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™å—åœ°æ–¹ï¼Œä»¥å‰æ˜¯æˆ‘ä»¬ç›´æ¥æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723960268645-9e8f95e5-2e2a-4b76-b3fe-55f7ebd6149e.png#averageHue=%23282d35&clientId=u6a6faefb-591e-4&from=paste&height=1337&id=u6a4b7b3b&originHeight=1604&originWidth=2794&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=533071&status=done&style=none&taskId=u9ac1b9de-b41d-496c-9122-a52ebd4905f&title=&width=2328.333240813683)
æŠŠä¸­é—´è¿™æ®µä»£ç é€»è¾‘å…¨éƒ¨å‰ªåˆ‡ï¼Œè¿™ä¸€æ­¥ä¸æçº¿ç¨‹æ± ã€‚
```java
// todo ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼ŒæŠ›ä¸ªå¼‚å¸¸
CompletableFuture.runAsync(()->{
    // todo ç­‰å¾…å¤ªä¹…äº†ï¼ŒæŠ›å¼‚å¸¸ï¼Œè¶…æ—¶æ—¶é—´
    // ç­‰å¾…-->æ‰§è¡Œä¸­--> æˆåŠŸ/å¤±è´¥
    //å…ˆä¿®æ”¹å›¾è¡¨ä»»åŠ¡çŠ¶æ€ä¸º"æ‰§è¡Œä¸­"ã€‚ç­‰æ‰§è¡ŒæˆåŠŸåï¼Œä¿®æ”¹ä¸º"å·²å®Œæˆ"ã€ä¿å­˜æ‰§è¡Œç»“æœï¼›
    // æ‰§è¡Œå¤±è´¥åï¼ŒçŠ¶æ€ä¿®æ”¹ä¸º"å¤±è´¥"ï¼Œè®°å½•ä»»åŠ¡å¤±è´¥ä¿¡æ¯ã€‚
    Chart updateChart = new Chart();
    updateChart.setId(chart.getId());
    updateChart.setStatus("running");  // todo  è®¾ç½®æšä¸¾å€¼
    boolean updateChartById = chartService.updateById(updateChart);
    if(!updateChartById) {
//                throw new BusinessException(ErrorCode.OPERATION_ERROR, "å›¾è¡¨çŠ¶æ€æ›´æ–°å¤±è´¥"); // todo
        handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æ‰§è¡Œä¸­çŠ¶æ€Â·å¤±è´¥");
        return;
    }
    // è°ƒç”¨é±¼çš®æ¥å£,æ‹¿åˆ°è¿”å›ç»“æœ
    String result = aiManager.doChat(biModelId,userInput.toString());
    //å¯¹è¿”å›ç»“æœåšæ‹†åˆ†,æŒ‰ç…§5ä¸ªä¸­æ‹¬å·è¿›è¡Œæ‹†åˆ†
    String[] splits = result.split("ã€ã€ã€ã€ã€");
    // æ‹†åˆ†ä¹‹åè¿˜è¦è¿›è¡Œæ ¡éªŒ
    if (splits.length < 3) {
//                throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
        handleChartUpdateError(chart.getId(), "AIç”Ÿæˆé”™è¯¯");
        return;
    }
    String genChart = splits[1].trim();
    String genResult = splits[2].trim();

    Chart updateChartResult = new Chart();
    updateChartResult.setId(chart.getId());
    updateChartResult.setGenResult(genResult);
    updateChartResult.setGenChart(genChart);
    updateChartResult.setStatus("succeed");  // todo  è®¾ç½®æšä¸¾å€¼
    boolean b = chartService.updateById(updateChartResult);
    if(!b) {
//                throw new BusinessException(ErrorCode.OPERATION_ERROR, "å›¾è¡¨çŠ¶æ€æ›´æ–°å¤±è´¥"); // todo
        handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æˆåŠŸçŠ¶æ€Â·å¤±è´¥");
    }
}, threadPoolExecutor);
```
åˆ æ‰å¤šä½™çš„å†…å®¹ã€‚
```java
// todo ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼ŒæŠ›ä¸ªå¼‚å¸¸
CompletableFuture.runAsync(()->{
    
}, threadPoolExecutor);
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723960323884-6172f70a-8eed-4c09-8bb0-b732cb8a4bcc.png#averageHue=%23292d36&clientId=u6a6faefb-591e-4&from=paste&height=1038&id=ub40a4919&originHeight=1246&originWidth=2262&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=247698&status=done&style=none&taskId=u40d0ee15-4b42-4af2-a868-507fa15aca2&title=&width=1884.9999250968326)
æ”¹æˆå¾€æ¶ˆæ¯é˜Ÿåˆ—é‡Œå‘æ¶ˆæ¯ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723960899439-0b9be190-d36b-4c21-9b61-ac01c88b0b73.png#averageHue=%23292d36&clientId=u6a6faefb-591e-4&from=paste&height=1037&id=ud037c8fc&originHeight=1244&originWidth=2070&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=229324&status=done&style=none&taskId=ucc39d656-eb3e-4fb9-96ca-cced4f6f805&title=&width=1724.9999314546612)
é‚£è¿™ä¸ªæ¶ˆæ¯å‘é€ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯ä¸æ˜¯è¦æŠŠè¿™ä¸ªå‚æ•°ä¼ é€’ç»™æ¶ˆè´¹è€…ã€‚æ¢å¥è¯è¯´ï¼Œå°†æ¶ˆè´¹è€…éœ€è¦çš„å‚æ•°ä½œ 
ä¸ºæ¶ˆæ¯çš„å†…å®¹ä¼ é€’è¿‡å»ï¼Œå°†å…¶å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚è¿™æ ·ï¼Œæ¶ˆè´¹è€…å°±å¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ï¼Œ 
å¹¶æ¢å¤å½“æ—¶çš„åœºæ™¯ï¼Œä»¥ä¾¿æ‰§è¡Œç›¸åº”çš„ä»»åŠ¡ã€‚è¿™ç§æ–¹å¼ä½¿å¾—æ¶ˆè´¹è€…èƒ½å¤Ÿç‹¬ç«‹å¤„ç†ä»»åŠ¡ï¼Œè€Œä¸æ˜¯åœ¨çº¿ 
ç¨‹æ± ä¸­å¤„ç†ã€‚é€šè¿‡åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯å¹¶æºå¸¦æ‰€éœ€å‚æ•°ï¼Œæ¶ˆè´¹è€…å¯ä»¥è·å–åˆ°è¿™äº›æ¶ˆæ¯å¹¶è¿›è¡Œç›¸ 
åº”çš„å¤„ç†ã€‚ 
æ‰€ä»¥åœ¨è¿™é‡Œï¼Œé¦–å…ˆéœ€è¦æŸ¥çœ‹æ¶ˆè´¹è€…çš„ä»£ç ï¼Œä»¥äº†è§£æ¶ˆè´¹è€…éœ€è¦ä»€ä¹ˆæ ·çš„å‚æ•°æˆ–æ•°æ®ã€‚æ ¹æ®æ¶ˆè´¹è€… 
éœ€è¦çš„å†…å®¹æ¥ç¡®å®šç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å†…å®¹ã€‚å› æ­¤ï¼Œç”Ÿäº§è€…çš„ä»£ç åº”è¯¥ä¸æ¶ˆè´¹è€…çš„ä»£ç ä¿æŒä¸€è‡´ï¼Œ 
æ ¹æ®æ¶ˆè´¹è€…çš„è¦æ±‚æ¥å‘é€ç›¸åº”çš„æ¶ˆæ¯ã€‚
###### 1ï¼‰å®ç° mq çš„æ¥å£
```java
/**
 * æ™ºèƒ½åˆ†æ é±¼çš®æ¥å£ï¼ˆå¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
 *
 * @param multipartFile
 * @param genChartByAiRequest
 * @param request
 * @return
 */
@PostMapping("/gen/async/mq")
public BaseResponse<BiResponse> genChartByAiAsyncMq(@RequestPart("file") MultipartFile multipartFile,
                                                  GenChartByAiRequest genChartByAiRequest, HttpServletRequest request) {
    String name = genChartByAiRequest.getName();
    String goal = genChartByAiRequest.getGoal();
    String chartType = genChartByAiRequest.getChartType();
    // é€šè¿‡responseå¯¹è±¡æ‹¿åˆ°ç”¨æˆ·id(å¿…é¡»ç™»å½•æ‰èƒ½ä½¿ç”¨)
    User loginUser = userService.getLoginUser(request);

    // æ ¡éªŒ
    // å¦‚æœåˆ†æç›®æ ‡ä¸ºç©ºï¼Œå°±æŠ›å‡ºè¯·æ±‚å‚æ•°é”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
    ThrowUtils.throwIf(StringUtils.isBlank(goal), ErrorCode.PARAMS_ERROR, "ç›®æ ‡ä¸ºç©º");
    // å¦‚æœåç§°ä¸ä¸ºç©ºï¼Œå¹¶ä¸”åç§°é•¿åº¦å¤§äº100ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»™å‡ºæç¤º
    ThrowUtils.throwIf(StringUtils.isNotBlank(name) && name.length() > 100, ErrorCode.PARAMS_ERROR, "åç§°è¿‡é•¿");
    // æ ¡éªŒæ–‡ä»¶
    long size = multipartFile.getSize();
    String originalFilename = multipartFile.getOriginalFilename();
    // æ ¡éªŒæ–‡ä»¶å¤§å°
    final long ONE_MB = 1024 * 1024L;
    ThrowUtils.throwIf(size > ONE_MB, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶è¶…è¿‡ 1M");
    // æ ¡éªŒæ–‡ä»¶åç¼€
    String suffix = FileUtil.getSuffix(originalFilename);
    final List<String> validFileSuffixList = Arrays.asList("xlsx","csv","xls","json");
    ThrowUtils.throwIf(!validFileSuffixList.contains(suffix), ErrorCode.PARAMS_ERROR, "æ–‡ä»¶åç¼€éæ³•");

    //é™æµåˆ¤æ–­ï¼Œæ¯ä¸ªç”¨æˆ·ä¸€ä¸ªé™æµå™¨
    redisLimiterManager.doRateLimit("genChartByAi_" + loginUser.getId());
    /*
    * ç”¨æˆ·çš„è¾“å…¥(å‚è€ƒ)
      åˆ†æéœ€æ±‚ï¼š
      åˆ†æç½‘ç«™ç”¨æˆ·çš„å¢é•¿æƒ…å†µ
      åŸå§‹æ•°æ®ï¼š
      æ—¥æœŸ,ç”¨æˆ·æ•°
      1å·,10
      2å·,20
      3å·,30
    * */
    // æ— éœ€Promptï¼Œç›´æ¥è°ƒç”¨ç°æœ‰æ¨¡å‹
    // æ„é€ ç”¨æˆ·è¾“å…¥
    long biModelId = CommonConstant.BI_MODEL_ID;

    // æ„é€ ç”¨æˆ·è¾“å…¥
    StringBuilder userInput = new StringBuilder();
    userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
    // æ‹¼æ¥åˆ†æç›®æ ‡
    String userGoal = goal;
    // å¦‚æœå›¾è¡¨ç±»å‹ä¸ä¸ºç©º
    if (StringUtils.isNotBlank(chartType)) {
        // å°±å°†åˆ†æç›®æ ‡æ‹¼æ¥ä¸Šâ€œè¯·ä½¿ç”¨â€+å›¾è¡¨ç±»å‹
        userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
    }
    userInput.append(userGoal).append("\n");
    userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");

    // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼‰
    String csvData = ExcelUtils.excelToCsv(multipartFile);
    userInput.append(csvData).append("\n");

    // å…ˆæ’å…¥æ•°æ®åˆ°æ•°æ®åº“
    Chart chart = new Chart();
    chart.setName(name);
    chart.setGoal(goal);
    chart.setChartData(csvData);
    chart.setChartType(chartType);
    chart.setStatus("wait");   // todo è®¾ç½®æšä¸¾å€¼
    chart.setUserId(loginUser.getId());
    boolean saveResult = chartService.save(chart);
    ThrowUtils.throwIf(!saveResult, ErrorCode.SYSTEM_ERROR, "å›¾è¡¨ä¿å­˜å¤±è´¥");
    // todo ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼ŒæŠ›ä¸ªå¼‚å¸¸
    if(threadPoolExecutor.getQueue().size()> threadPoolExecutor.getMaximumPoolSize()) {
        throw new BusinessException(ErrorCode.SYSTEM_ERROR, "å½“å‰é˜Ÿåˆ—å·²æ»¡");
    }
    long newChartId = chart.getId();
    biMessageProducer.sendMessage(String.valueOf(newChartId));
    // è¿”å›åˆ°å‰ç«¯
    BiResponse biResponse = new BiResponse();
    biResponse.setChartId(newChartId);
    return ResultUtils.success(biResponse);
}
```
###### 2ï¼‰constantåŒ…ä¸‹çš„CommonConstantæ–¹æ³•
å°†BIMODEL_IDæŠ½å–å‡ºæ¥
```java
package com.yupi.springbootinit.constant;

/**
 * é€šç”¨å¸¸é‡
 *
 * @author <a href="https://github.com/liyupi">ç¨‹åºå‘˜é±¼çš®</a>
 * @from <a href="https://yupi.icu">ç¼–ç¨‹å¯¼èˆªçŸ¥è¯†æ˜Ÿçƒ</a>
 */
public interface CommonConstant {

    /**
     * å‡åº
     */
    String SORT_ORDER_ASC = "ascend";

    /**
     * é™åº
     */
    String SORT_ORDER_DESC = " descend";

    /**
     * BI æ¨¡å‹ id
     */
    // æŒ‡å®šä¸€ä¸ªæ¨¡å‹id(æŠŠidå†™æ­»ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æˆä¸€ä¸ªå¸¸é‡)
    long BI_MODEL_ID = 1821914479207112706L;
}
```
###### 3ï¼‰BiMessageConsumeræ–¹æ³•å®Œå–„
```java
package com.yupi.springbootinit.bizmq;

import com.rabbitmq.client.Channel;
import com.yupi.springbootinit.common.ErrorCode;
import com.yupi.springbootinit.constant.CommonConstant;
import com.yupi.springbootinit.exception.BusinessException;
import com.yupi.springbootinit.manager.AiManager;
import com.yupi.springbootinit.model.entity.Chart;
import com.yupi.springbootinit.service.ChartService;
import com.yupi.springbootinit.utils.ExcelUtils;
import lombok.SneakyThrows;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.StringUtils;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.amqp.support.AmqpHeaders;
import org.springframework.messaging.handler.annotation.Header;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;

@Component
@Slf4j
public class BiMessageConsumer {

    @Resource
    private ChartService chartService;

    @Resource
    private AiManager aiManager;

    // æŒ‡å®šç¨‹åºç›‘å¬çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œç¡®è®¤æœºåˆ¶
    @SneakyThrows
    @RabbitListener(queues = {BiMqConstant.BI_QUEUE_NAME}, ackMode = "MANUAL")
    public void receiveMessage(String message, Channel channel, @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
        if(StringUtils.isBlank(message)) {
            // æ¶ˆæ¯æ‹’ç»ï¼šæŠ›å¼‚å¸¸äº†ï¼Œåº”è¯¥å°†å½“å‰æ¶ˆæ¯æ‹’ç»äº†
            channel.basicNack(deliveryTag, false, false);
            throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ¶ˆæ¯ä¸ºç©º");
        }
        long chartId = Long.parseLong(message);
        Chart chart = chartService.getById(chartId);
        if(chart == null) {
            // æŠ›å¼‚å¸¸äº†ï¼Œåº”è¯¥å°†å½“å‰æ¶ˆæ¯æ‹’ç»äº†
            channel.basicNack(deliveryTag, false, false);
            throw new BusinessException(ErrorCode.NOT_FOUND_ERROR, "å›¾è¡¨ä¸ºç©º");
        }
        // todo ç­‰å¾…å¤ªä¹…äº†ï¼ŒæŠ›å¼‚å¸¸ï¼Œè¶…æ—¶æ—¶é—´
        // ç­‰å¾…-->æ‰§è¡Œä¸­--> æˆåŠŸ/å¤±è´¥
        //å…ˆä¿®æ”¹å›¾è¡¨ä»»åŠ¡çŠ¶æ€ä¸º"æ‰§è¡Œä¸­"ã€‚ç­‰æ‰§è¡ŒæˆåŠŸåï¼Œä¿®æ”¹ä¸º"å·²å®Œæˆ"ã€ä¿å­˜æ‰§è¡Œç»“æœï¼›
        // æ‰§è¡Œå¤±è´¥åï¼ŒçŠ¶æ€ä¿®æ”¹ä¸º"å¤±è´¥"ï¼Œè®°å½•ä»»åŠ¡å¤±è´¥ä¿¡æ¯ã€‚
        Chart updateChart = new Chart();
        updateChart.setId(chart.getId());
        updateChart.setStatus("running");  // todo  è®¾ç½®æšä¸¾å€¼
        boolean updateChartById = chartService.updateById(updateChart);
        if(!updateChartById) {
            // æ¶ˆæ¯æ‹’ç»
            channel.basicNack(deliveryTag, false, false);
//                throw new BusinessException(ErrorCode.OPERATION_ERROR, "å›¾è¡¨çŠ¶æ€æ›´æ–°å¤±è´¥"); // todo
            handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æ‰§è¡Œä¸­çŠ¶æ€Â·å¤±è´¥");
            return;
        }
        // è°ƒç”¨é±¼çš®æ¥å£,æ‹¿åˆ°è¿”å›ç»“æœ
        String result = aiManager.doChat(CommonConstant.BI_MODEL_ID ,buildUserInput(chart));
        //å¯¹è¿”å›ç»“æœåšæ‹†åˆ†,æŒ‰ç…§5ä¸ªä¸­æ‹¬å·è¿›è¡Œæ‹†åˆ†
        String[] splits = result.split("ã€ã€ã€ã€ã€");
        // æ‹†åˆ†ä¹‹åè¿˜è¦è¿›è¡Œæ ¡éªŒ
        if (splits.length < 3) {
            // æ¶ˆæ¯æ‹’ç»
            channel.basicNack(deliveryTag, false, false);
//                throw new BusinessException(ErrorCode.SYSTEM_ERROR,"AI ç”Ÿæˆé”™è¯¯");
            handleChartUpdateError(chart.getId(), "AIç”Ÿæˆé”™è¯¯");
            return;
        }
        String genChart = splits[1].trim();
        String genResult = splits[2].trim();

        Chart updateChartResult = new Chart();
        updateChartResult.setId(chart.getId());
        updateChartResult.setGenResult(genResult);
        updateChartResult.setGenChart(genChart);
        updateChartResult.setStatus("succeed");  // todo  è®¾ç½®æšä¸¾å€¼
        boolean b = chartService.updateById(updateChartResult);
        if(!b) {
            // æ¶ˆæ¯æ‹’ç»
            channel.basicNack(deliveryTag, false, false);
//                throw new BusinessException(ErrorCode.OPERATION_ERROR, "å›¾è¡¨çŠ¶æ€æ›´æ–°å¤±è´¥"); // todo
            handleChartUpdateError(chart.getId(), "æ›´æ–°å›¾è¡¨Â·æˆåŠŸçŠ¶æ€Â·å¤±è´¥");
        }
        // æ¶ˆæ¯ç¡®è®¤
        channel.basicAck(deliveryTag, false);
    }

    private String buildUserInput(Chart chart) {
        String goal = chart.getGoal();
        String chartType = chart.getChartType();
        String csvData = chart.getChartData();
        // æ„é€ ç”¨æˆ·è¾“å…¥
        StringBuilder userInput = new StringBuilder();
        userInput.append("åˆ†æéœ€æ±‚ï¼š").append("\n");
        // æ‹¼æ¥åˆ†æç›®æ ‡
        String userGoal = goal;
        // å¦‚æœå›¾è¡¨ç±»å‹ä¸ä¸ºç©º
        if (StringUtils.isNotBlank(chartType)) {
            // å°±å°†åˆ†æç›®æ ‡æ‹¼æ¥ä¸Šâ€œè¯·ä½¿ç”¨â€+å›¾è¡¨ç±»å‹
            userGoal += "ï¼Œè¯·ä½¿ç”¨" + chartType;
        }
        userInput.append(userGoal).append("\n");
        userInput.append("åŸå§‹æ•°æ®ï¼š").append("\n");
        // å‹ç¼©åçš„æ•°æ®ï¼ˆæŠŠmultipartFileä¼ è¿›æ¥ï¼‰
//        String csvData = ExcelUtils.excelToCsv(multipartFile);
        userInput.append(csvData).append("\n");
        return userInput.toString();
    }

    /**
     * å›¾è¡¨æ›´æ–°é”™è¯¯
     *
     * @param chartId
     * @param execMessage
     */
    private void handleChartUpdateError(long chartId, String execMessage) {
        Chart updateChartResult = new Chart();
        updateChartResult.setId(chartId);
        updateChartResult.setStatus("failed");
        updateChartResult.setExecMessage("execMessageï¼ï¼");
        boolean updateResult = chartService.updateById(updateChartResult);
        if (!updateResult) {
            log.error("æ›´æ–°å›¾è¡¨å¤±è´¥çŠ¶æ€å¤±è´¥" + chartId + "," + execMessage);
        }
    }
}
```
**é›†ç¾¤æƒ…å†µæ˜¯ä¸æ˜¯å¾—ä¿è¯æ¶ˆæ¯ä¸é‡å¤ï¼Ÿ **
æ˜¯çš„ï¼Œé›†ç¾¤ç¯å¢ƒä¸‹ç¡®å®éœ€è¦è€ƒè™‘æ¶ˆæ¯çš„å»é‡ã€‚RabbitMQ æœ¬èº«æä¾›äº†æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆ 
æ¯åªè¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚å½“åŒä¸€æ¡æ¶ˆæ¯è¢«ç¡®è®¤åï¼Œå®ƒå°±ä¼šè¢«æ ‡è®°ä¸ºå·²ç¡®è®¤ï¼Œè¿™æ ·å°±ä¸ä¼šå†è¢«æ¶ˆè´¹è€…æ¥æ”¶ 
åˆ°ã€‚å¦‚æœä½ çš„é›†ç¾¤æ˜¯å¤‡ä»½é›†ç¾¤ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªæœºå™¨éƒ½å¯èƒ½æ¥æ”¶å’Œå­˜å‚¨åŒä¸€æ¡æ¶ˆæ¯ï¼Œä½ éœ€è¦ç¡®ä¿æ¶ˆè´¹ 
è€…ä¸ä¼šé‡å¤è¯»å–å¤šä¸ªæœºå™¨çš„æ¶ˆæ¯ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒRabbitMQ å·²ç»ä¸ºä½ æä¾›äº†ç›¸åº”çš„æœºåˆ¶æ¥è§£å†³è¿™ 
ä¸ªé—®é¢˜ã€‚å¯ä»¥å‚è€ƒç½‘ä¸Šçš„æ•™ç¨‹æ¥æ·±å…¥äº†è§£ã€‚
###### 4ï¼‰å¯åŠ¨ BiInitMain.java 
åˆ›å»ºç¨‹åºç”¨åˆ°çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964050123-5b8fd92c-86dc-4ca4-afd1-d2f1c5977dbe.png#averageHue=%23282d35&clientId=u6a6faefb-591e-4&from=paste&height=1295&id=u5129c5c4&originHeight=1554&originWidth=2869&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=446480&status=done&style=none&taskId=u5940b2fb-26be-4a06-972f-940adcf255e&title=&width=2390.8332383301563)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964100309-538ff50a-6671-4d4a-8546-42339a565c17.png#averageHue=%23faf9f9&clientId=u6a6faefb-591e-4&from=paste&height=721&id=u8cf20a97&originHeight=865&originWidth=1870&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=86782&status=done&style=none&taskId=ufc1ba1f7-720d-4b80-8f31-92c1fe2cab3&title=&width=1558.3332714107326)
çœ‹åˆ°äº†æ–°çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964146156-5d0a94b9-4110-4af1-8d12-1b0db39aaf4d.png#averageHue=%23f8f7f0&clientId=u6a6faefb-591e-4&from=paste&height=770&id=u30e3776d&originHeight=924&originWidth=1876&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=125783&status=done&style=none&taskId=ue1e42cf9-b409-4d1d-b1f8-a5e0414f878&title=&width=1563.3332712120505)
ç‚¹å‡»äº¤æ¢æœºï¼ŒæŸ¥çœ‹ç»‘å®šå…³ç³»
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964195295-4510d7c2-e010-4845-b257-378a3ca3530e.png#averageHue=%23fbfbfb&clientId=u6a6faefb-591e-4&from=paste&height=698&id=uc429849d&originHeight=838&originWidth=1888&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=65956&status=done&style=none&taskId=ud9139135-56a1-4291-8a31-4d3c4166f24&title=&width=1573.333270814686)
å…³é—­æ‰€æœ‰çš„ç¨‹åºã€‚
ä»¥ debugæ¨¡å¼ å¯åŠ¨ Spring Boot é¡¹ç›®ã€‚
å›åˆ°å‰ç«¯ï¼Œæˆ‘ä»¬åœ¨åç«¯æ–°å†™äº†ä¸€ä¸ªæ¥å£ï¼Œå‰ç«¯æƒ³è¦å¿«é€Ÿåœ°å»è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±è¦å»æ‰§è¡Œ openAPI ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964294383-5f61e299-1b09-4e4f-99c9-c684ebcc803c.png#averageHue=%23232529&clientId=u6a6faefb-591e-4&from=paste&height=1351&id=ue1beec7e&originHeight=1621&originWidth=2802&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=414941&status=done&style=none&taskId=u1f5aea0f-aba9-43a9-a016-cfd330b65a0&title=&width=2334.99990721544)
ç°åœ¨å·²ç»ç”Ÿæˆè°ƒç”¨åç«¯æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥æ¥å£çš„ä»£ç ï¼› 
æ”¹ä¸€ä¸‹ æ™ºèƒ½åˆ†æ(å¼‚æ­¥) é¡µçš„å‡½æ•°åï¼Œä¹‹å‰æˆ‘ä»¬æ˜¯ç”¨ genChartByAiAsyncUsingPOST ã€‚
ç°åœ¨å°†å…¶ä¿®æ”¹ä¸ºä½¿ç”¨Mqçš„å¼‚æ­¥æ–¹å¼ genChartByAiAsyncMqUsingPost
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964484600-2e7390b8-2802-4a45-9fc2-c35b54f08154.png#averageHue=%23242529&clientId=u6a6faefb-591e-4&from=paste&height=1342&id=u678ece82&originHeight=1610&originWidth=2845&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=388307&status=done&style=none&taskId=u8ea67dde-004a-4d5d-8797-9d2a39af8fc&title=&width=2370.8332391248846)
å¯åŠ¨å‰ç«¯ã€‚
å¡«å†™åˆ†ææ•°æ®ï¼Œç‚¹å‡» æäº¤ ã€‚
æ˜¾ç¤ºåˆ†ææˆåŠŸã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964842904-e0f94a6d-9836-4109-a197-5461d58a6237.png#averageHue=%23f9f9f9&clientId=u6a6faefb-591e-4&from=paste&height=677&id=u69512d1a&originHeight=1625&originWidth=2863&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=628030&status=done&style=none&taskId=ud391a4f9-6c8c-4d20-ba0d-8722e8d3726&title=&width=1192.916619264419)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964963891-f79d8866-02e4-4ab6-a03d-ed360408534c.png#averageHue=%23f9f9f9&clientId=u6a6faefb-591e-4&from=paste&height=668&id=ub4e3c12c&originHeight=1603&originWidth=2869&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=603671&status=done&style=none&taskId=uc89f5c72-03a8-4859-b837-52f77ca0652&title=&width=1195.4166191650781)
å» æˆ‘çš„å›¾è¡¨ é¡µæŸ¥çœ‹ï¼Œè¿˜åœ¨ç”Ÿæˆä¸­ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964986095-d796525c-5a1f-4ec1-8f33-53071022a6ab.png#averageHue=%23f8f8f8&clientId=u6a6faefb-591e-4&from=paste&height=666&id=u09ef3e56&originHeight=1599&originWidth=2842&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=742389&status=done&style=none&taskId=u083a7cf6-d609-46a0-a208-08d74f5ad0b&title=&width=1184.1666196121128)
åˆ·æ–°å‡ æ¬¡é¡µé¢åï¼Œå›¾è¡¨ç”Ÿæˆå‡ºæ¥äº†ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723964867579-e0a836a4-90c1-44ef-b105-e811c9f5c5c5.png#averageHue=%23dbcfc1&clientId=u6a6faefb-591e-4&from=paste&height=670&id=u2b102e69&originHeight=1607&originWidth=2867&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=809904&status=done&style=none&taskId=u66d84d80-182b-43da-9543-089737dcd65&title=&width=1194.5832858648585)
ğŸŸæå‰æ¢æ‰ç§˜é’¥ï¼Œå¯¼è‡´è¿ä¸ä¸Šé±¼èªæ˜AIï¼Œç”Ÿæˆçš„å›¾è¡¨å¤„ç†ä¸ºç¡®è®¤æ¶ˆæ¯çš„çŠ¶æ€ï¼Œç¨‹åºä¸­æ–­åï¼Œæ¶ˆæ¯è¢«é‡æ–°æ”¾åˆ°é˜Ÿåˆ—é‡Œã€‚
æŸ¥çœ‹ç®¡ç†é¡µé¢ï¼Œæ¶ˆæ¯å‘è¿‡å»äº†ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723965012894-45060767-b746-49f3-b21b-a572e0da1427.png#averageHue=%23faf9f2&clientId=u6a6faefb-591e-4&from=paste&height=666&id=u1f2fd06b&originHeight=1599&originWidth=2845&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=251023&status=done&style=none&taskId=u3d7b8486-70f6-4242-b94f-da73f526778&title=&width=1185.4166195624423)
ä½†å¤„äºæœªç¡®è®¤çŠ¶æ€ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723965055089-e2df0b49-f435-48db-bb9b-bdf6910a87d4.png#averageHue=%23f9f8f1&clientId=u6a6faefb-591e-4&from=paste&height=668&id=u6b4acd5e&originHeight=1604&originWidth=2826&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=292217&status=done&style=none&taskId=u9d63a338-564f-40e8-80da-e68235eadda&title=&width=1177.4999532103557)
ç§˜é’¥æ›´æ–°åï¼Œå›¾è¡¨æ˜¾ç¤ºå‡ºæ¥äº†ã€‚
![image.png](https://cdn.nlark.com/yuque/0/2024/png/1389428/1723965278889-5c23f5e6-3cfd-42ae-884f-a04748ff0f77.png#averageHue=%23d8cabf&clientId=u6a6faefb-591e-4&from=paste&height=673&id=u42f7e3ed&originHeight=1616&originWidth=2866&originalType=binary&ratio=2.4000000953674316&rotation=0&showTitle=false&size=745894&status=done&style=none&taskId=u45d70e6f-1e1e-49ba-b164-1bff8ab6b6b&title=&width=1194.1666192147486)
**éªŒè¯ï¼š**å‘ç°ï¼Œå¦‚æœç¨‹åºä¸­æ–­äº†ï¼Œæ²¡æœ‰ ackã€ä¹Ÿæ²¡æœ‰ nackï¼ˆæœåŠ¡ä¸­æ–­ï¼Œæ²¡æœ‰ä»»ä½•å“åº”ï¼‰ï¼Œé‚£ä¹ˆè¿™ 
æ¡æ¶ˆæ¯ä¼šè¢«é‡æ–°æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œä»è€Œå®ç°äº†æ¯ä¸ªä»»åŠ¡éƒ½ä¼šæ‰§è¡Œã€‚ 
**æ–°çš„é—®é¢˜ï¼š**å®ƒä¼šä¸ä¼šæ— é™æ‰§è¡Œï¼Ÿè¿™æ˜¯ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚æ¯æ¬¡é‡å¯æ—¶ï¼Œæ‰€æœ‰å¤±è´¥çš„ä»»åŠ¡éƒ½ä¼šé‡ 
æ–°æ‰§è¡Œï¼Œå¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯æ‰§è¡Œçš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘åœ¨æ•°æ®åº“ä¸­è®°å½•ä»»åŠ¡çš„ 
æ‰§è¡ŒçŠ¶æ€ã€‚å½“ç¨‹åºé‡å¯åï¼Œå¯ä»¥æ£€æŸ¥ä»»åŠ¡çš„çŠ¶æ€ï¼Œå¦‚æœä»»åŠ¡å·²ç»æˆåŠŸæ‰§è¡Œè¿‡ï¼Œåˆ™å¯ä»¥è·³è¿‡è¯¥ä»» 
åŠ¡ï¼Œé¿å…é‡å¤æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°é˜²æ­¢ä»»åŠ¡çš„æ— é™æ‰§è¡Œï¼Œç¡®ä¿ä»»åŠ¡çš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚
> åˆ°æ­¤æœ¬é¡¹ç›®å·²å®Œæˆï¼Œå®Œç»“æ’’èŠ±ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰
